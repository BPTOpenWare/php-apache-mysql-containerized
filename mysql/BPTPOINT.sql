CREATE DATABASE  IF NOT EXISTS `BPTPOINT` /*!40100 DEFAULT CHARACTER SET latin1 */;
USE `BPTPOINT`;
-- MySQL dump 10.13  Distrib 5.7.28, for Linux (x86_64)
--
-- Host: 192.168.1.101    Database: BPTPOINT
-- ------------------------------------------------------
-- Server version	5.7.25

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `AdminVerify`
--

DROP TABLE IF EXISTS `AdminVerify`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `AdminVerify` (
  `VID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `UID` int(10) unsigned NOT NULL,
  `RAnswer` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `RegID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`VID`),
  KEY `RegTypes_RegID` (`RegID`),
  KEY `Users_UID` (`UID`),
  CONSTRAINT `RegTypes_RegID` FOREIGN KEY (`RegID`) REFERENCES `RegistrationTypes` (`RegID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `Users_UID` FOREIGN KEY (`UID`) REFERENCES `ODOUsers` (`UID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `AdminVerify`
--

LOCK TABLES `AdminVerify` WRITE;
/*!40000 ALTER TABLE `AdminVerify` DISABLE KEYS */;
/*!40000 ALTER TABLE `AdminVerify` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `Constants`
--

DROP TABLE IF EXISTS `Constants`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Constants` (
  `ConstID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `ConstName` varchar(254) CHARACTER SET latin1 NOT NULL,
  `Value` varchar(254) CHARACTER SET latin1 NOT NULL,
  `Description` varchar(254) CHARACTER SET latin1 NOT NULL,
  `ModID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ConstID`),
  KEY `fk_Constants_ModID` (`ModID`),
  CONSTRAINT `fk_Constants_ModID` FOREIGN KEY (`ModID`) REFERENCES `Modules` (`ModID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=66 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `Constants`
--

LOCK TABLES `Constants` WRITE;
/*!40000 ALTER TABLE `Constants` DISABLE KEYS */;
INSERT INTO `Constants` VALUES (1,'VERIFYUIDPERPAGE','0','This Will Verify a User on Every page view',1),(2,'EMAILTHRESHOLD','3','This is the Severity Level to e-mail the system Admin',1),(3,'SYSADMINEMAILADDY','admin@localhost','E-mail address of user to e-mail',1),(4,'EMAILEVENTS','1','This flag is set to e-mail the System Admin',1),(5,'EXITONALLERRORS','1','If Set then all errors will exit the script.',1),(6,'SHOWERRORS','2','This flag is used to show errors in your pages to the user.',1),(7,'ALLOWUSERANYPAGELOGIN','1','This flag is used to allow a user to Login at any web page in the system.',1),(8,'NUMBEROFVALIDPWORDTRIES','5','This is the number of password tries a user can have',1),(9,'SERVERNAME','ODOWeb Test','This is the server\'s name',1),(10,'GLOBALUSEROBJECTS','1','If set then all user Objects will be placed into the global array.',1),(11,'LOCKOUTONSELFPASSRESET','1','If set then attempts to answer the question will count against them as well.',1),(12,'ADMINOBJECTSINNONADMINPAGES','1','if set then admin Objects can be loaded on non admin flagged pages',1),(13,'REQUIREQARESETONREGISTRATION','1','if set then any user that Registers will have to answer the registration question and answers before being registered',1),(14,'ADMINVERIFYSTANDARDUSERREG','0','if set then any standard user registering will have to wait for the admin to confirm their registration',1),(15,'ALLOWGUESTSTANDARDREG','1','if set then guests can register as a standard user. Verification may still be required depending on AdminVerify flag.',1),(16,'ALLOWMULTIPLESESSIONS','1','Set this to prevent someone from logging in more than once at a time. Older Session is logged off on new login.',1),(17,'WRONGUSERNAMESEVLEVEL','3','Set the severity level of a user entering the wrong username.',1),(18,'ACCOUNTLOCKEDSEVLEVEL','2','Set the severity level of a user getting their account locked out.',1),(19,'LOGINAFTERACCTLOCKEDSEV','3','Set the severity level of a user trying to login after their account was locked.',1),(20,'WRONGPASSWORDSEVLEVEL','2','Set the severity level of a user failing to login correctly.',1),(21,'SERVERADDRESS','localhost','This is the Server Address and is used in many sections of ODOWeb. Please set to your domain name.',1),(22,'TOSONREGISTER','1','This is a flag to require confirming that the user read the TOS for the site.',1),(23,'GETFILEURLPATH','GetFile.php','The location of the Get File script on the local server',1),(24,'GETIMAGEURLPATH','GetImage.php','The location of the GetImage script on the local server',1),(26,'DEFAULTREGCOMPLETEURL','index.php?pg=RegisterComplete','The Default URL to direct the user to when registration is complete.',1),(27,'ENCRYPTODOUSER','1','This enables or disables encrypting fields of ODOUsers table. This will not encrypt or decrypt previous entries.',1),(28,'ODOSHA','3','Password encryption level. 3=md5sum 2=sha256 1=sha512',1),(29,'REGREPLYEMAIL','admin@localhost','The reply address for registration e-mails.',1),(30,'JSVALIDATELOGIN','0','Login form will call loginvalidate js function instead of submitting form.',1),(31,'LOGOUTSEVLEVEL','3','Sev level of a user logging out.',1),(32,'LOGINSEVLEVEL','3','Sev level of a user logging in.',1),(33,'ODOUSERUPDATE','3','Log level a user updating their information.',1),(34,'ODOUSERUPDATEERROR','1','Error level of a user attempting to update their information but failed.',1),(36,'DUMPEVALERROR','0','Dumps on eval error',1),(37,'DUMPEVALDIR','/var/www/dump/','path to dir to dump evals to',1),(48,'loginphp','1','Flag to force login script to point to login.php',1),(49,'DEFAULTAFTERLOGINPAGE','Home','Page to goto after login is complete regardless of what was passed in the request',1),(50,'USEREMOTEEMAILSERVER','0','If set to 1 the remote e-mail server will be used to send emails for log events',1),(51,'REMOTESERVERKEY','YOURKEY','Set this to a unique id key. You don\'t want to allow just anyone to send emails using your server right?',1),(52,'REMOTEEMAILSERVERADDPARMS','','If this string is greater than 0 then all additional params will be tacked onto the request. If you\'re using ODOCMS index.php you could add pg=yourpage here',1),(53,'REMOTEEMAILSERVERURL','http://localhost','Use your remote e-mail server address here',1),(54,'LOGSESSIONTIME','1','If set to 1 then session time is logged to apache logger.',1),(55,'LOGDBQUERYTIME','1','If set to 1 then DB query time is logged to apache logger',1),(56,'USESYSTEMLOG','0','If set to 1 then logging is set to the local system logger',1),(57,'FORWARDFORHEADER','X-Forwarded-For','Set this to the header used to indicate a forwarded for ip. This would be defined by your reverse proxy',1),(58,'INSTANCEIDHEADER','X-CF-APP-INSTANCE','Set this to the header used to indicate  the instance id of the node in the cluster.',1),(59,'USESTICKYSESSION','0','Set to 1 to indicate that the STICKYSESSIONHEADER name will be set as a the STICKYSESSIONCOOKIE name',1),(60,'STICKYSESSIONCOOKIE','VCAP_ID','Cookie to be set with the STICKYSESSIONHEADER',1),(61,'STICKYSESSIONHEADER','X-CF-APP-INSTANCE','Session header name of the instance id',1),(63,'CACHEPAGES','0','Cache pages on server instead of using eval',1),(64,'OURCACHEPATH','','Cache location',1),(65,'REMOTEEMAILENCRYPTED','0','If set to 1 the data stored in MailQueue table is encrypted',1);
/*!40000 ALTER TABLE `Constants` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `FCategories`
--

DROP TABLE IF EXISTS `FCategories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `FCategories` (
  `CatID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(254) CHARACTER SET latin1 NOT NULL,
  `Description` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `Parent` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`CatID`),
  KEY `fk_FCat_Parent` (`Parent`),
  CONSTRAINT `fk_FCat_Parent` FOREIGN KEY (`Parent`) REFERENCES `FCategories` (`CatID`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `FCategories`
--

LOCK TABLES `FCategories` WRITE;
/*!40000 ALTER TABLE `FCategories` DISABLE KEYS */;
INSERT INTO `FCategories` VALUES (1,'Client','Client documents off site',NULL),(2,'Backups','Client backups',1);
/*!40000 ALTER TABLE `FCategories` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `FileTypes`
--

DROP TABLE IF EXISTS `FileTypes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `FileTypes` (
  `FTypeID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Type` varchar(254) CHARACTER SET latin1 NOT NULL,
  PRIMARY KEY (`FTypeID`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `FileTypes`
--

LOCK TABLES `FileTypes` WRITE;
/*!40000 ALTER TABLE `FileTypes` DISABLE KEYS */;
INSERT INTO `FileTypes` VALUES (1,'application/pdf'),(2,'application/zip'),(3,'application/gz');
/*!40000 ALTER TABLE `FileTypes` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `GroupsForFiles`
--

DROP TABLE IF EXISTS `GroupsForFiles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `GroupsForFiles` (
  `GID` int(10) unsigned NOT NULL,
  `FID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`GID`,`FID`),
  KEY `fk_Files_FID` (`FID`),
  CONSTRAINT `fk_Files_FID` FOREIGN KEY (`FID`) REFERENCES `ODOFiles` (`FID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_Files_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `GroupsForFiles`
--

LOCK TABLES `GroupsForFiles` WRITE;
/*!40000 ALTER TABLE `GroupsForFiles` DISABLE KEYS */;
/*!40000 ALTER TABLE `GroupsForFiles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `GroupsForImages`
--

DROP TABLE IF EXISTS `GroupsForImages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `GroupsForImages` (
  `ImgID` int(10) unsigned NOT NULL,
  `GID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ImgID`,`GID`),
  KEY `fk_Images_GID` (`GID`),
  CONSTRAINT `fk_Images_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_Images_ImgID` FOREIGN KEY (`ImgID`) REFERENCES `ODOImages` (`ImgID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `GroupsForImages`
--

LOCK TABLES `GroupsForImages` WRITE;
/*!40000 ALTER TABLE `GroupsForImages` DISABLE KEYS */;
/*!40000 ALTER TABLE `GroupsForImages` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `LoggedIn`
--

DROP TABLE IF EXISTS `LoggedIn`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `LoggedIn` (
  `PriKey` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `TimeLoggedIn` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `UID` int(10) unsigned NOT NULL,
  `SessionID` varchar(254) CHARACTER SET latin1 NOT NULL,
  `IPAdd` varchar(30) CHARACTER SET latin1 NOT NULL,
  PRIMARY KEY (`PriKey`),
  KEY `fk_LoggedIn_UID` (`UID`),
  CONSTRAINT `fk_LoggedIn_UID` FOREIGN KEY (`UID`) REFERENCES `ODOUsers` (`UID`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='Currently logged in users';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `LoggedIn`
--

LOCK TABLES `LoggedIn` WRITE;
/*!40000 ALTER TABLE `LoggedIn` DISABLE KEYS */;
/*!40000 ALTER TABLE `LoggedIn` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `MailQueue`
--

DROP TABLE IF EXISTS `MailQueue`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `MailQueue` (
  `idMailQueue` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `rcvMail` varchar(128) NOT NULL,
  `subject` varchar(254) NOT NULL,
  `headers` varchar(254) NOT NULL,
  `message` longtext NOT NULL,
  `encrypted` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`idMailQueue`),
  UNIQUE KEY `idMailQueue_UNIQUE` (`idMailQueue`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `MailQueue`
--

LOCK TABLES `MailQueue` WRITE;
/*!40000 ALTER TABLE `MailQueue` DISABLE KEYS */;
/*!40000 ALTER TABLE `MailQueue` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `Modules`
--

DROP TABLE IF EXISTS `Modules`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Modules` (
  `ModID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `XMLBlob` blob,
  `Description` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `ModName` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`ModID`)
) ENGINE=InnoDB AUTO_INCREMENT=106 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `Modules`
--

LOCK TABLES `Modules` WRITE;
/*!40000 ALTER TABLE `Modules` DISABLE KEYS */;
INSERT INTO `Modules` VALUES (1,NULL,'ODOGeneral','Default'),(100,NULL,'ODOAdmin','ODOAdmin'),(103,NULL,'Private Pages','Private'),(104,NULL,'BPTPOINT','BPTPOINT'),(105,NULL,'ODOStore','ODOStore');
/*!40000 ALTER TABLE `Modules` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `NoSpam`
--

DROP TABLE IF EXISTS `NoSpam`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `NoSpam` (
  `PriKey` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `SessionID` varchar(255) CHARACTER SET latin1 NOT NULL,
  `txtSpam` varchar(255) CHARACTER SET latin1 NOT NULL,
  `tstamp` int(10) unsigned NOT NULL,
  PRIMARY KEY (`PriKey`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `NoSpam`
--

LOCK TABLES `NoSpam` WRITE;
/*!40000 ALTER TABLE `NoSpam` DISABLE KEYS */;
/*!40000 ALTER TABLE `NoSpam` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOFiles`
--

DROP TABLE IF EXISTS `ODOFiles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOFiles` (
  `FID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(254) CHARACTER SET latin1 NOT NULL,
  `BFile` longblob NOT NULL,
  `Description` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `chksum` varchar(254) CHARACTER SET latin1 NOT NULL,
  `Size` mediumint(9) unsigned NOT NULL,
  `PermFlag` tinyint(1) unsigned NOT NULL,
  `CatID` int(10) unsigned DEFAULT NULL,
  `FTypeID` int(10) unsigned NOT NULL,
  `LastMod` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`FID`),
  KEY `fk_ODOFiles_CatID` (`CatID`),
  KEY `fk_ODOFiles_FTypeID` (`FTypeID`),
  CONSTRAINT `fk_ODOFiles_CatID` FOREIGN KEY (`CatID`) REFERENCES `FCategories` (`CatID`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_ODOFiles_FTypeID` FOREIGN KEY (`FTypeID`) REFERENCES `FileTypes` (`FTypeID`) ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOFiles`
--

LOCK TABLES `ODOFiles` WRITE;
/*!40000 ALTER TABLE `ODOFiles` DISABLE KEYS */;
/*!40000 ALTER TABLE `ODOFiles` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOGACL`
--

DROP TABLE IF EXISTS `ODOGACL`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOGACL` (
  `GID` int(10) unsigned NOT NULL,
  `PageID` int(10) unsigned NOT NULL,
  `WriteOK` tinyint(1) NOT NULL DEFAULT '0',
  PRIMARY KEY (`GID`,`PageID`),
  KEY `fk_ODOGACL_PageID` (`PageID`),
  CONSTRAINT `fk_ODOGACL_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_ODOGACL_PageID` FOREIGN KEY (`PageID`) REFERENCES `ODOPages` (`PageID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Group Access Control List';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOGACL`
--

LOCK TABLES `ODOGACL` WRITE;
/*!40000 ALTER TABLE `ODOGACL` DISABLE KEYS */;
INSERT INTO `ODOGACL` VALUES (1,3000,0),(1,10101,0),(1,10105,1),(1,10109,0),(1,10110,1),(1,10111,1),(1,10121,0),(1,10143,0),(1,10144,0),(1,10145,0),(1,10146,0),(1,10147,0),(1,10148,0),(1,10160,0),(1,10175,0),(2,10101,0),(2,10105,0),(2,10109,0),(2,10121,0),(2,10143,0),(2,10144,0),(2,10145,0),(2,10146,0),(2,10147,0),(2,10160,0),(2,10175,0),(5,10101,0),(5,10105,0),(5,10106,0),(5,10121,0),(5,10143,0),(5,10144,0),(5,10145,0),(5,10146,0),(5,10160,0),(5,10175,0);
/*!40000 ALTER TABLE `ODOGACL` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOGroups`
--

DROP TABLE IF EXISTS `ODOGroups`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOGroups` (
  `GID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `GroupName` varchar(254) CHARACTER SET latin1 NOT NULL,
  `GroupDesc` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`GID`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COMMENT='Groups in database';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOGroups`
--

LOCK TABLES `ODOGroups` WRITE;
/*!40000 ALTER TABLE `ODOGroups` DISABLE KEYS */;
INSERT INTO `ODOGroups` VALUES (1,'Admins','This Group is just for Admins of ODOWeb'),(2,'Standard Users','Group for any user that has login rights.'),(5,'guest','Default group. This group is needed for all anonymous communications. DO NOT DELETE UNLESS YOU KNOW WHAT YOU ARE DOING!');
/*!40000 ALTER TABLE `ODOGroups` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOImages`
--

DROP TABLE IF EXISTS `ODOImages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOImages` (
  `ImgID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `BImage` mediumblob NOT NULL,
  `Name` varchar(45) CHARACTER SET latin1 NOT NULL,
  `Height` smallint(5) unsigned NOT NULL,
  `Width` smallint(5) unsigned NOT NULL,
  `chksum` varchar(255) CHARACTER SET latin1 NOT NULL,
  `Description` varchar(255) CHARACTER SET latin1 DEFAULT NULL,
  `PermFlag` tinyint(1) unsigned NOT NULL,
  `Size` mediumint(8) unsigned NOT NULL,
  PRIMARY KEY (`ImgID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOImages`
--

LOCK TABLES `ODOImages` WRITE;
/*!40000 ALTER TABLE `ODOImages` DISABLE KEYS */;
/*!40000 ALTER TABLE `ODOImages` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOLogs`
--

DROP TABLE IF EXISTS `ODOLogs`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOLogs` (
  `PriKey` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `UID` int(10) unsigned NOT NULL,
  `ActionDone` varchar(20) CHARACTER SET latin1 NOT NULL,
  `TimeStamp` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `Comment` varchar(255) CHARACTER SET latin1 DEFAULT NULL,
  `Severity` tinyint(4) DEFAULT NULL,
  `IP` varchar(40) CHARACTER SET latin1 NOT NULL,
  `ForwardedFor` varchar(40) DEFAULT NULL,
  `InstanceId` varchar(255) DEFAULT NULL,
  `ModID` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`PriKey`)
) ENGINE=InnoDB AUTO_INCREMENT=67 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOLogs`
--

LOCK TABLES `ODOLogs` WRITE;
/*!40000 ALTER TABLE `ODOLogs` DISABLE KEYS */;
/*!40000 ALTER TABLE `ODOLogs` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOMenus`
--

DROP TABLE IF EXISTS `ODOMenus`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOMenus` (
  `GID` int(10) unsigned NOT NULL,
  `StaticLinkID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`GID`,`StaticLinkID`),
  KEY `fk_ODOMenus_StaticL` (`StaticLinkID`),
  CONSTRAINT `fk_ODOMenus_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_ODOMenus_StaticL` FOREIGN KEY (`StaticLinkID`) REFERENCES `ODOTree` (`PriKey`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOMenus`
--

LOCK TABLES `ODOMenus` WRITE;
/*!40000 ALTER TABLE `ODOMenus` DISABLE KEYS */;
INSERT INTO `ODOMenus` VALUES (1,1),(2,1),(1,4),(1,5),(1,6),(1,7),(1,8),(1,9),(1,10),(1,11),(1,12),(1,13),(1,14),(1,17),(1,18),(1,20),(1,21),(1,22),(1,23),(1,24),(1,25),(1,26),(1,27),(1,28),(1,29),(1,30),(1,31),(1,32),(1,33),(1,34),(1,35),(1,36),(1,40),(1,41),(1,42),(1,43),(1,44),(1,45),(1,46),(1,47),(1,48),(1,56),(1,57),(1,58),(1,59),(1,60),(1,61),(1,62),(1,63),(1,64),(1,65),(1,68),(1,69),(1,70),(1,80),(1,81),(1,82),(1,83),(1,84),(1,85),(1,86),(1,87),(1,88),(1,89),(1,90),(1,91),(1,102),(1,103),(1,143),(1,144),(1,145),(1,146),(1,150),(1,151),(1,152),(1,153),(1,171),(1,172),(1,173),(1,174),(1,175),(1,176),(1,177),(1,178),(1,179),(1,180),(1,181),(1,182),(1,183),(1,184),(1,187),(1,188),(1,193),(1,194),(1,218),(2,218),(5,218),(1,219),(2,219),(5,219),(1,224),(2,224),(5,224),(1,225);
/*!40000 ALTER TABLE `ODOMenus` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOObjectACL`
--

DROP TABLE IF EXISTS `ODOObjectACL`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOObjectACL` (
  `GID` int(10) unsigned NOT NULL,
  `CodeSegID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`GID`,`CodeSegID`),
  KEY `fk_ObjectACL_CodeSegID` (`CodeSegID`),
  CONSTRAINT `fk_ObjectACL_CodeSegID` FOREIGN KEY (`CodeSegID`) REFERENCES `Objects` (`CodeSegID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_ObjectACL_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOObjectACL`
--

LOCK TABLES `ODOObjectACL` WRITE;
/*!40000 ALTER TABLE `ODOObjectACL` DISABLE KEYS */;
INSERT INTO `ODOObjectACL` VALUES (1,4),(2,4),(5,4),(1,5),(1,6),(1,7),(1,8),(1,9),(1,10),(1,11),(1,12),(1,13),(1,14),(1,15),(1,16),(2,16),(5,16),(1,17),(2,17),(5,17),(1,18),(1,19),(1,22),(1,23),(1,24),(1,25),(1,26),(1,27),(1,28),(1,29),(1,30),(1,31),(1,32),(1,33),(1,34),(1,35),(1,36),(1,37),(1,38),(1,39),(1,40),(1,41),(1,42),(1,43),(1,44),(1,45),(1,46),(1,47),(1,48),(1,49),(1,50),(1,51),(1,52),(1,53),(1,58),(1,59),(1,60),(1,61),(1,62),(1,63),(1,64),(1,65),(1,67),(1,68),(1,69),(1,70),(1,71),(1,72),(1,73),(1,74),(1,75),(1,76),(1,77),(1,81),(1,82),(1,83),(1,84),(1,85),(1,86),(1,87),(1,88),(1,93),(2,93),(5,93),(1,94),(2,94),(5,94),(1,95),(2,95),(5,95),(1,96),(2,96),(5,96),(1,97),(2,97),(5,97),(1,98),(1,99),(1,100),(1,101),(1,102),(1,103),(1,145),(1,146),(1,147),(1,148),(1,149),(1,150),(1,151),(1,152),(1,156),(2,156),(5,156),(1,157),(2,157),(5,157),(1,158),(2,158),(5,158),(1,204);
/*!40000 ALTER TABLE `ODOObjectACL` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOPageObject`
--

DROP TABLE IF EXISTS `ODOPageObject`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOPageObject` (
  `ObjID` int(10) unsigned NOT NULL,
  `PageID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`ObjID`,`PageID`),
  KEY `fk_PageObject_PageID` (`PageID`),
  CONSTRAINT `fk_PageObject_ObjID` FOREIGN KEY (`ObjID`) REFERENCES `ObjectNames` (`ObjID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_PageObject_PageID` FOREIGN KEY (`PageID`) REFERENCES `ODOPages` (`PageID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOPageObject`
--

LOCK TABLES `ODOPageObject` WRITE;
/*!40000 ALTER TABLE `ODOPageObject` DISABLE KEYS */;
INSERT INTO `ODOPageObject` VALUES (2,3000),(3,3000),(4,3000),(5,3000),(6,3000),(12,3000),(13,3000),(19,3000),(27,3000),(2,10109),(2,10110),(2,10111),(14,10111),(2,10121),(18,10121),(31,10121),(32,10121),(33,10121),(2,10144),(31,10144),(32,10144),(33,10144),(48,10144),(2,10146),(31,10146),(32,10146),(33,10146),(48,10146),(2,10147),(48,10147),(2,10160),(2,10175),(48,10175);
/*!40000 ALTER TABLE `ODOPageObject` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOPages`
--

DROP TABLE IF EXISTS `ODOPages`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOPages` (
  `PageID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PageName` varchar(254) CHARACTER SET latin1 NOT NULL,
  `PageDesc` varchar(254) CHARACTER SET latin1 NOT NULL,
  `PageContent` blob NOT NULL,
  `IsDynamic` tinyint(1) NOT NULL DEFAULT '0',
  `IsAdmin` tinyint(1) NOT NULL DEFAULT '0',
  `ModID` int(10) unsigned NOT NULL DEFAULT '0',
  `Author` int(10) unsigned DEFAULT NULL,
  `CreatedDate` datetime NOT NULL,
  `LastModBy` int(10) unsigned DEFAULT NULL,
  `LastModDate` datetime NOT NULL,
  PRIMARY KEY (`PageID`),
  KEY `fk_Pages_ModID` (`ModID`),
  KEY `fk_Pages_Author` (`Author`),
  KEY `fk_Pages_LastModBy` (`LastModBy`),
  CONSTRAINT `fk_Pages_Author` FOREIGN KEY (`Author`) REFERENCES `ODOUsers` (`UID`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_Pages_LastModBy` FOREIGN KEY (`LastModBy`) REFERENCES `ODOUsers` (`UID`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_Pages_ModID` FOREIGN KEY (`ModID`) REFERENCES `Modules` (`ModID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=10177 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC COMMENT='Pages stored';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOPages`
--

LOCK TABLES `ODOPages` WRITE;
/*!40000 ALTER TABLE `ODOPages` DISABLE KEYS */;
INSERT INTO `ODOPages` VALUES (3000,'ODOCMS','ODOCMS Admin page',_binary '//ODOCMS\n\n$ODOMenuO;\n$ODOCMSPagesO;\n$ODOCMSUsersO;\n$ODOCMSGroupsO;\n$ODOCMSObjectsO;\n$ODOCMSMenusO;\n$ODOCMSLogsO;\n$ODOCMSRegisterO;\n$ODOCMSConstantsO;\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\n	$ODOMenuO = new ODOMenu;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\n\n} else {\n\n	$ODOMenuO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOMenuO\");\n}\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSGroupsO\")) {\n	$ODOCMSGroupsO = new ODOCMSGroups;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSGroupsO\", $ODOCMSGroupsO);\n\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"EditGroup\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"DeleteGroup\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"ListGroups\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"NewGroup\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"UpdateUsers\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"UpdatePages\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSGroupsO\", \"ODOCMSGroups\", \"UpdateObjects\");\n\n} else {\n\n	$ODOCMSGroupsO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSGroupsO\");\n\n}\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSPagesO\")) {\n	$ODOCMSPagesO = new ODOCMSPages;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSPagesO\", $ODOCMSPagesO);\n	\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"ListCat\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"DeleteCat\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"NewCat\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"SearchPages\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"CatView\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"DeletePage\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"ListPages\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"NewPage\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"EditPage\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"AddRemoveGroups\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSPagesO\", \"ODOCMSPages\", \"AddRemoveObjects\");\n	\n\n\n} else {\n	$ODOCMSPagesO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSPagesO\");\n}\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSUsersO\")) {\n	$ODOCMSUsersO = new ODOCMSUsers;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSUsersO\", $ODOCMSUsersO);\n	\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"lstUsers\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"lstByGroups\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"NewUser\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"DeleteUser\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"EditUser\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"ChangeUserPassword\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"EditGroups\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"ShowUserLogs\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSUsersO\", \"ODOCMSUsers\", \"Search\");\n\n} else {\n	$ODOCMSUsersO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSUsersO\");\n}\n\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSObjectsO\")) {\n	$ODOCMSObjectsO = new ODOCMSObjects;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSObjectsO\", $ODOCMSObjectsO);\n	\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"ListObjects\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"NewObject\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"AddRemovePages\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"AddRemoveGroups\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"EditObject\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"DeleteObject\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"ListFunctions\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"DeleteFunction\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"NewFunction\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSObjectsO\", \"ODOCMSObjects\", \"EditFunctions\");\n	\n} else {\n	$ODOCMSObjectsO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSObjectsO\");\n}\n\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSMenusO\")) {\n	$ODOCMSMenusO = new ODOCMSMenus;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSMenusO\", $ODOCMSMenusO);\n\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"ListHeads\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"EditTree\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"NewMenuItem\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"EditMenuItem\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"DeleteMenuItem\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"MoveUp\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"MoveDown\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"NewHead\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"DeleteTree\");\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSMenusO\", \"ODOCMSMenus\", \"EditPermissions\");\n\n} else {\n\n	$ODOCMSMenusO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSMenusO\");\n\n}\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSLogsO\")) {\n	$ODOCMSLogsO = new ODOCMSLogs;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSLogsO\", $ODOCMSLogsO);\n\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSLogsO\", \"ODOCMSLogs\", \"ViewByType\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSLogsO\", \"ODOCMSLogs\", \"ViewBySeverity\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSLogsO\", \"ODOCMSLogs\", \"ViewByTimeStamp\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSLogsO\", \"ODOCMSLogs\", \"UserLoginLogoutReport\");\n\n} else {\n\n	$ODOCMSLogsO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSLogsO\");\n\n}\n\n\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSRegisterO\")) {\n	$ODOCMSRegisterO = new ODOCMSRegister;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSRegisterO\", $ODOCMSRegisterO);\n\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"VerifyReg\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"DeleteRegRequest\");\n    $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"ListPending\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"ViewRegTypes\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"EditEmail\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSRegisterO\", \"ODOCMSRegister\", \"PrevVerified\");\n	\n} else {\n\n	$ODOCMSRegisterO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSRegisterO\");\n\n}\n\n\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSConstantsO\")) {\n	$ODOCMSConstantsO = new ODOCMSConstants;\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSConstantsO\", $ODOCMSConstantsO);\n\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSConstantsO\", \"ODOCMSConstants\", \"ViewConstants\");\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSConstantsO\", \"ODOCMSConstants\", \"EditConstants\");\n	\n} else {\n\n	$ODOCMSConstantsO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOCMSConstantsO\");\n\n}\n\n$Output = \"<!DOCTYPE HTML><html>\\n<head>\\n<title>ODOWeb Admin</title>\\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/global.css\'>\\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/menus.css\'>\";\n\n$Output = $Output . \"\\n<script type=\\\"text/javascript\\\" src=\\\"js/odoweb.js\\\">\\n </script>\\n</head>\\n<body>\\n<div class=LeftNav>\\n<center>\\n<br>\\n<div id=\\\"logo\\\"></div>\\n<br>\";\n\n$Output = $Output . $ODOMenuO->GetODOLeftMenu(\"Admin\");\n$Output = $Output . \"<br><br><br><br>\\n<sub>Bluff Point Tech LLC &copy</sub>\\n</center>\\n</div>\\n\\n<div class=Right>\";\n\nif((isset($_SESSION[\"FirstLoad\"]))&&(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"]))) {\n	if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSPagesO\") {\n		$Output = $Output . $ODOCMSPagesO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSGroupsO\") {\n		$Output = $Output . $ODOCMSGroupsO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSUsersO\") {\n		$Output = $Output . $ODOCMSUsersO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSObjectsO\") {\n		$Output = $Output . $ODOCMSObjectsO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSMenusO\") {\n		$Output = $Output . $ODOCMSMenusO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSLogsO\") {\n		$Output = $Output . $ODOCMSLogsO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSRegisterO\") {\n		$Output = $Output . $ODOCMSRegisterO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSConstantsO\") {\n		$Output = $Output . $ODOCMSConstantsO->Content . \"\\n</div>\\n</body>\\n</html>\";\n	} else {\n		//who knows what was passed just thorw out the default.\n		$Output = $Output . \"<center><H2><B>Welcome to ODOWeb!</B></H2></center><BR><BR></DIV></BODY></HTML>\";\n	}\n\n} else {\n	$_SESSION[\"FirstLoad\"] = true;\n	$Output = $Output . \"<center><H2><B>Welcome to ODOWeb!</B></H2></center><BR><BR></DIV></BODY></HTML>\";\n}\n\necho($Output);\n\n',1,1,100,NULL,'2009-05-02 17:32:56',NULL,'2012-11-24 16:57:14'),(10101,'404','404 Error Page',_binary '<html>\r\n	<head>\r\n		<title>404 Page Not Found</title>\r\n		<link rel=\'stylesheet\' type=\'text/css\' href=\'css/global.css\'>\r\n	</head>\r\n	<body>\r\n		<div class=LeftNav>\r\n			<center><br>\r\n			<div id=\"logo\"></div>\r\n			<br><br><br>\r\n			<sub>Bluff Point Tech LLC &copy</sub>\r\n			</center>\r\n		</div>\r\n	\r\n		<div class=Right>\r\n	\r\n			<center><H1>404 Page Not Found!</H1></center>\r\n			<br><br>\r\n			<H2>Oops!</h2>\r\n			<br>\r\n			<p>We are sorry but it looks like you have found a missing page!</p>\r\n		</div>\r\n	</body>\r\n</html>\r\n',0,0,1,NULL,'2008-12-21 12:19:27',1342,'2016-10-06 01:46:33'),(10105,'DefaultLogOut','This is the Default Logout page. It will be called when a user logs out from the system.',_binary '<html>\r\n	<head>\r\n		<title>You Are Logged Off</title>\r\n		<link rel=\'stylesheet\' type=\'text/css\' href=\'css/global.css\'>\r\n	</head>\r\n	<body>\r\n		<div class=LeftNav>\r\n			<center><br>\r\n			<div id=\"logo\"></div>\r\n			<br><br><br>\r\n			<sub>Bluff Point Tech LLC &copy</sub>\r\n			</center>\r\n		</div>\r\n	\r\n		<div class=Right>\r\n	\r\n			<center><H1>You are logged out.</H1>\r\n			<br><br>\r\n			Click <a href=\"index.php?pg=Home\">HERE</a> to go back to the home page. If you did not intend on logging out please click <a href=\"login.php?pg=Home\">HERE</a> to log back in.\r\n			</center>\r\n		</div>\r\n	</body>\r\n</html>\r\n',0,0,1,NULL,'2008-12-27 12:04:07',NULL,'2012-11-19 21:24:42'),(10106,'test7','test',_binary 'test\r\n\r\ntest44',0,0,100,NULL,'2009-05-06 21:30:50',NULL,'2012-04-22 20:23:34'),(10109,'MenuTest','Test for Menu Object',_binary '$ODOMenuO;\r\n$Content;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO =& $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"];\r\n}\r\n\r\n\r\nif(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadSelected\"])) {\r\n      \r\n        \r\n	$Content = \"<HTML>\\n<HEAD><TITLE>Menu Test Page</TITLE></HEAD><BODY>\" . $ODOMenuO->FullMenu($_SESSION[\"ODOSessionO\"]->EscapedVars[\"MenuHead\"]) . \"</BODY></HTML>\";\r\n	\r\n	echo $Content;\r\n\r\n} else {\r\n	$query = \"SELECT * FROM ODOTree WHERE ParentID=0\";\r\n	$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n	\r\n	$Content = \"<HTML>\\n<HEAD><TITLE>Menu Test Page</TITLE></HEAD><BODY><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"MenuTest\\\"><input type=\\\"hidden\\\" name=\\\"HeadSelected\\\" value=\\\"true\\\"><select name=\\\"MenuHead\\\">\";\r\n\r\n	while($row = mysql_fetch_assoc($Result)){\r\n		$Content = $Content . \"<option value=\\\"\" . $row[\"HeadTag\"] . \"\\\">\" . $row[\"HeadTag\"] . \"</OPTION>\";\r\n\r\n	}\r\n	\r\n	$Content = $Content . \"<input type=\\\"submit\\\" name=\\\"submit\\\" value=\\\"submit\\\"></form></BODY></HTML>\";\r\n	\r\n	echo $Content;\r\n}\r\n',1,0,1,NULL,'2009-04-05 22:30:26',NULL,'2014-01-01 01:01:01'),(10110,'News','Basic News posting page',_binary '$ODOMenuO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO =& $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"];\r\n}\r\n\r\n?>\r\n\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n<title>\r\n<?php\r\necho SERVERNAME\r\n?></title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/global.css\'>\r\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/menus.css\'>\r\n\r\n<script type=\"text/javascript\" src=\"js/odoweb.js\"></script>\r\n<style type=\"text/css\">\r\n.loginbox {\r\n	padding: 0px;\r\n	top:0px;\r\n	left:0px;\r\n  margin-top: 0px;\r\n  margin-left: 0px;\r\n  margin-bottom: 0px;  \r\n  margin-right: 1em;  \r\nposition:relative;\r\n}\r\n\r\n</style>\r\n</head>\r\n<body>\r\n<div class=\"LeftNav\">\r\n<center>\r\n<br>\r\n<div id=\"logo\"></div>\r\n<br><br>\r\n<?php\r\n\r\necho $ODOMenuO->GetODOLeftMenu(\"PublicSite\");\r\n\r\n?>\r\n<br><br><br><br>\r\n<sub>Bluff Point Tech LLC &copy</sub>\r\n</center>\r\n</div>\r\n\r\n<?php\r\n\r\n//Load up by Post first then Cat then Date if no parameters are specified then we need to load all \r\n//cats we have permission for. The result is displayed by the dynamic news page which everyone in the\r\n//system has access to.\r\nif(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"])) {\r\n	//verify they have access rights to it also\r\n	//if guest though we need to check based on guest group and not guest userid\r\n	//this allows guests to be in the system but not have a guest login id\r\n\r\n	if(!is_numeric($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"])) {\r\n		trigger_error(\"PostID is not numeric! Your IP and this event have been logged.\", E_USER_ERROR);\r\n		exit(1);\r\n	}\r\n\r\n	if($_SESSION[\"ODOUserO\"]->getIsGuest()) {\r\n\r\n		$query = \"SELECT news.PriKey, news.title, news.Article, news.Date, newsCats.CatName, news.CatID from news, newsCats where news.AllowGuest=1 and news.CatID=newsCats.PriKey and news.PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n\r\n	} else {\r\n\r\n		$query = \"SELECT distinct news.PriKey, news.title, news.Article, news.Date, newsCats.CatName, news.CatID FROM news, ODOUserGID, newsGACL, newsCats where ODOUserGID.UID=\" . $_SESSION[\"ODOUserO\"]->getUID() . \" and ODOUserGID.GID=newsGACL.GID and newsGACL.newsGID=news.CatID and news.CatID=newsCats.PriKey and news.PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n\r\n	}\r\n\r\n	\r\n\r\n} else {\r\n	//else we are going to do a standard search given params and permissions\r\n	\r\n\r\n	if($_SESSION[\"ODOUserO\"]->getIsGuest()) {\r\n		$query = \"SELECT news.PriKey, news.title, news.Article, news.Date, newsCats.CatName, news.CatID FROM news, newsCats where news.AllowGuest=1 and news.CatID=newsCats.PriKey\";\r\n	\r\n	} else {\r\n		$query = \"SELECT distinct news.PriKey, news.title, news.Article, news.Date, newsCats.CatName, news.CatID FROM news, ODOUserGID, newsGACL, newsCats where ODOUserGID.UID=\" . $_SESSION[\"ODOUserO\"]->getUID() . \" and ODOUserGID.GID=newsGACL.GID and newsGACL.newsGID=news.CatID and news.CatID=newsCats.PriKey\";\r\n	}\r\n\r\n	\r\n\r\n	if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n		\r\n		if(!is_numeric($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n			trigger_error(\"CatID is not numeric! Your IP and this event have been logged.\", E_USER_ERROR);\r\n			exit(1);\r\n		}\r\n\r\n		$query = $query . \" and news.CatID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n	}\r\n	\r\n	if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"sDate\"])) {\r\n\r\n		$query = $query . \" and news.Date>=\" . date(\"Y-m-d\", strtotime($_SESSION[\"ODOSessionO\"]->EscapedVars[\"sDate\"]));\r\n\r\n	}\r\n\r\n	if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"eDate\"])) {\r\n\r\n		$query = $query . \" and news.Date<=\" . date(\"Y-m-d\", strtotime($_SESSION[\"ODOSessionO\"]->EscapedVars[\"eDate\"]));\r\n	}\r\n}\r\n\r\n$query = $query . \" order by news.Date DESC\";\r\n$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n$Output = \"<div id=\\\"MiddleContent\\\">\";\r\n\r\nwhile ($row = mysql_fetch_assoc($TempRecords)) {\r\n\r\n		date_default_timezone_set(\'America/Chicago\');\r\n		\r\n		//format date\r\n		$datefromdb = $row[\"Date\"];\r\n		$year = substr($datefromdb,0,4);\r\n		$mon  = substr($datefromdb,5,2);\r\n		$day  = substr($datefromdb,8,2);\r\n		//$hour = substr($datefromdb,8,2);\r\n		//$min  = substr($datefromdb,10,2);\r\n		//$sec  = substr($datefromdb,12,2);\r\n		//$orgdate = date(\"l F dS, Y h:i A\",mktime($hour,$min,$sec,$mon,$day,$year));\r\n		$mktimeDate = mktime( 0, 0, 0,$mon, $day, $year);\r\n\r\n		$Output = $Output . \"<div class=\\\"post\\\"><a href=\\\"index.php?pg=News&PostID=\" . $row[\"PriKey\"] . \"\\\"><h2 class=\\\"title\\\">\" . $row[\"title\"] . \"</h2></a>\";\r\n\r\n		$Output = $Output . \"<div class=\\\"meta\\\"><p>Posted under <a href=\\\"index.php?pg=News&CatID=\" . $row[\"CatID\"] . \"\\\">\" . $row[\"CatName\"] . \"</a>&nbsp;&nbsp;Date Posted:\" . date(\'F\', $mktimeDate) . \"&nbsp;\" . date(\'j\', $mktimeDate) . \", \" . date(\'Y\', $mktimeDate) . \"</p></div>\";\r\n		\r\n		//story\r\n		//we only output the entire story if PostID is set in Get\r\n		if(isset($_GET[\"PostID\"])) {\r\n			$Output = $Output . \"<div class=\\\"story\\\">\" . $row[\"Article\"] . \"</div></div>\";   \r\n		} else {\r\n\r\n			$Output = $Output . \"<div class=\\\"story\\\">\" . strip_tags(substr($row[\"Article\"], 0, 700), \'<p><a>\');\r\n\r\n			$Output = $Output . \"&nbsp;&nbsp;<a href=\\\"index.php?pg=News&PostID=\" . $row[\"PriKey\"] . \"\\\">Full Article..</a></div></div>\";\r\n		}\r\n\r\n	}\r\n\r\n\r\n$Output = $Output . \"</div>\";\r\n\r\n//Right column\r\n$query = \"select * from newsCats\";\r\n$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n$Output = $Output . \"<div id=\\\"RightContent\\\"><img src=\\\"images/ODONews.jpg\\\"><br><br><div id=\\\"menu\\\" class=\\\"boxed\\\"><center><h2 class=\\\"title\\\">Categories</h2></center><div class=\\\"content\\\"><ul>\";\r\n\r\nif(!mysql_num_rows($TempRecords))\r\n{\r\n	//do nothing since no Cats are available\r\n} else {\r\n	while ($row = mysql_fetch_assoc($TempRecords)) {\r\n		$Output = $Output . \"<li class=\\\"active\\\"><a href=\\\"index.php?pg=News&CatID=\" . $row[\"PriKey\"] . \"\\\">\" . $row[\"CatName\"] . \"</a></li>\";\r\n	\r\n	}\r\n}\r\n\r\n$Output = $Output . \"</ul></div></div>\";\r\n\r\n//Login Box\r\n$Output = $Output . \"<br><br><br>\";\r\n\r\n//check if we are logged in. If we are guests then we are not logged in\r\nif($_SESSION[\"ODOUserO\"]->getIsGuest()) {\r\n	\r\n	$Output = $Output . $_SESSION[\"ODOUserO\"]->GetLoginForm(false) . \"</div>\";\r\n\r\n} else {\r\n	\r\n	$Output = $Output . \"<div id=\\\"menu\\\" class=\\\"boxed\\\"><center><h2 class=\\\"title\\\">Logged In As</h2></center><div class=\\\"content\\\"><center><B>\" . $_SESSION[\"ODOUserO\"]->getusername() . \"</B><BR><form action=\\\"index.php\\\" method=\\\"POST\\\" enctype=\\\"application/x-www-form-urlencoded\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->pg . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOUserO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"LogoutPublic\\\"><input type=\\\"hidden\\\" name=\\\"ObjectOnlyOutput\\\" value=\\\"1\\\"><input type=\\\"submit\\\" name=\\\"logout\\\" value=\\\"logout\\\"></form></center></div></div></div>\";\r\n\r\n}\r\n\r\n$Output = $Output . \"</body></html>\";\r\n\r\n\r\necho $Output;\r\n\r\n',1,0,1,NULL,'2009-05-06 21:29:29',NULL,'2012-11-24 17:13:29'),(10111,'CMSNews','CMS News Page',_binary '//News admin page\r\n$ODOCMSNewsO;\r\n$ODOMenuO;\r\n\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO =& $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"];\r\n}\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOCMSNewsO\")) {\r\n	$ODOCMSNewsO = new ODOCMSNews;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOCMSNewsO\", $ODOCMSNewsO);\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"ListPosts\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"NewPost\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"EditPost\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"DeletePost\");\r\n\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"DeteletCategory\");	\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"AddRemoveGroups\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"EditCategory\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"NewCategory\");\r\n	$_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"ListCategories\");\r\n        $_SESSION[\"ODOSessionO\"]->RegisterPublicFunction(\"ODOCMSNewsO\", \"ODOCMSNews\", \"DeleteCategory\");\r\n\r\n} else {\r\n\r\n	$ODOCMSNewsO =& $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOCMSNewsO\"];\r\n}\r\n\r\n?>\r\n\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n<title>\r\n<?PHP\r\n\r\necho SERVERNAME;\r\n\r\n?>\r\n</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/global.css\'>\r\n<link rel=\'stylesheet\' type=\'text/css\' href=\'css/menus.css\'>\r\n<script type=\"text/javascript\" src=\"js/odoweb.js\"></script>\r\n<script type=\"text/javascript\">\r\nvar _editor_url  = document.location.href.replace(/index.php.*/, \'Xinha/\')\r\n\r\nvar _editor_lang = \"en\";\r\n</script>\r\n<!-- Load up the actual editor core -->\r\n<script type=\"text/javascript\" src=\"Xinha/XinhaCore.js\"></script>\r\n<script type=\"text/javascript\">\r\n\r\nvar xinha_plugins =\r\n[\r\n \'Linker\'\r\n];\r\nvar xinha_editors =\r\n[\r\n  \'article\'\r\n];\r\n\r\nfunction xinha_init()\r\n{\r\n  if(!Xinha.loadPlugins(xinha_plugins, xinha_init)) return;\r\n\r\n  var xinha_config = new Xinha.Config();\r\n\r\n  xinha_editors = Xinha.makeEditors(xinha_editors, xinha_config, xinha_plugins);\r\n\r\n  Xinha.startEditors(xinha_editors);\r\n}\r\nXinha.addOnloadHandler(xinha_init);\r\n</script>\r\n\r\n</head>\r\n<body>\r\n<div class=\"LeftNav\">\r\n<center>\r\n<br>\r\n<div id=\"logo\"></div>\r\n<br>\r\n\r\n<?PHP\r\n\r\necho $ODOMenuO->GetODOLeftMenu(\"Admin\");\r\n\r\n?>\r\n\r\n<br><br><br><br>\r\n<sub>Bluff Point Tech LLC &copy</sub>\r\n</center>\r\n</div>\r\n<div class=\"Right\">\r\n\r\n<?php\r\n\r\n$Output = \"\";\r\nif(isset($_SESSION[\"FirstLoadNews\"])) {\r\n	if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] ))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ob\"] == \"ODOCMSNewsO\")) {\r\n		$Output = $Output . $ODOCMSNewsO->Content . \"\\n</div>\\n</body>\\n</html>\";\r\n	} else {\r\n		 $ODOCMSNewsO->ListPosts();\r\n        $Output = $Output . $ODOCMSNewsO->Content . \"\\n</div>\\n</body>\\n</html>\";\r\n	}\r\n\r\n\r\n} else {\r\n	$_SESSION[\"FirstLoadNews\"] = true;\r\n        //make a call to load up News Edit content.\r\n        $ODOCMSNewsO->ListPosts();\r\n        $Output = $Output . $ODOCMSNewsO->Content . \"\\n</div>\\n</body>\\n</html>\";\r\n	\r\n}\r\n\r\necho($Output);\r\n\r\n',1,1,100,NULL,'2014-01-01 01:01:01',NULL,'2012-11-24 17:16:19'),(10121,'Register','ODOWeb\'s Register Page',_binary '\r\n$ODORegisterO;\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODORegisterO\")) {\r\n	$ODORegisterO = new ODORegister;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODORegisterO\", $ODORegisterO);\r\n\r\n} else {\r\n\r\n	$ODORegisterO =& $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODORegisterO\"];\r\n}\r\n\r\n\r\n\r\n?>\r\n<!DOCTYPE HTML>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>Register</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<link href=\"css/global.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/menus.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n\r\n</head>\r\n<body>\r\n<div id=\"container\">\r\n  \r\n        <h1>Site Registration</h1>\r\n<?PHP\r\n\r\n//set the default registration if no RegID was passed\r\n\r\nif(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"])) {\r\n	$_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"] = 1;\r\n}\r\n\r\nif(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegMe\"])) {\r\n\r\n	if($ODORegisterO->ProcRegisterPage()) {\r\n\r\n		echo $ODORegisterO->Content;\r\n		\r\n		//output next link\r\n		\r\n\r\n	} else {\r\n		//error messagees\r\n		//style=\"color:#FF0D05\"\r\n		echo \"<div id=\\\"regcontenterrormsg\\\" class=\\\"error\\\">Please fix the following issues:\" . $ODORegisterO->MissingText . \"</div>\";\r\n		\r\n		if($ODORegisterO->LoadRegisterPage()) {\r\n\r\n			echo $ODORegisterO->Content;\r\n\r\n		} else {\r\n\r\n			echo \"<BR><H4>You have passed an invalid Register ID! Please hit your browser back button.</H4>\";\r\n\r\n		}\r\n	}\r\n	\r\n\r\n} else {\r\n\r\n	if($ODORegisterO->LoadRegisterPage()) {\r\n\r\n		echo $ODORegisterO->Content;\r\n\r\n	} else {\r\n\r\n		echo \"<BR><H4>You have passed an invalid Register ID! Please hit your browser back button.</H4>\";\r\n\r\n	}\r\n\r\n}\r\n\r\n?>\r\n    </div>\r\n</body>\r\n</html>\r\n\r\n<?PHP\r\n\r\n',1,0,1,NULL,'2014-01-01 01:01:01',1342,'2016-10-08 13:11:04'),(10143,'CreateData','Creates encrypted data using UserIV',_binary '?>\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n<title>Test ODOWeb encryption</title>\r\n<body>\r\n<center>\r\n<?PHP\r\n\r\nif(!$_SESSION[\"ODOUserO\"]->IsEncrypted()) {\r\n echo \"<B>User is not setup for encryption! Exiting.</B></center></body></html>\";\r\n exit();\r\n}\r\n\r\n//test data to store\r\n$test = \"message\";\r\n$testtwo = \"testtwo\";\r\n$testthree = \"testthree\";\r\n\r\n//output strings\r\necho \"String 1:\" . $test;\r\necho \"<BR>String 2:\" . $testtwo;\r\necho \"<BR>String 3:\" . $testthree;\r\n\r\n//build EncryptedData container object\r\n$encData = new EncryptedData();\r\n\r\n//populate the decrypted array with our values\r\n$encData->decArray[\"test\"] = $test;\r\n$encData->decArray[\"testtwo\"] = $testtwo;\r\n$encData->decArray[\"testthree\"] = $testthree;\r\n\r\n//tell the system to use the current user\'s IV\r\n$encData->useODOUserIV = true;\r\n\r\n//call the encrypt routine (mcrypt)\r\n$encData = $_SESSION[\"ODOUtil\"]->ODOEncrypt($encData);\r\n\r\n//output encrypted strings\r\necho \"<BR><BR>Encrypted String 1:\" . htmlentities($encData->encArray[\"test\"]);\r\necho \"<BR>Encrypted String 2:\" . htmlentities($encData->encArray[\"testtwo\"]);\r\necho \"<BR>Encrypted String 3:\" . htmlentities($encData->encArray[\"testthree\"]);\r\n\r\n//Insert our encrypted data\r\n//don\'t forget to escape them\r\n//get the current User\'s ID and inser as UID in table\r\n$query = \"INSERT INTO testEncryption(UID,DataFieldOne,DataFieldTwo,DataFieldThree) values(\" . $_SESSION[\"ODOUserO\"]->getUID() . \",\";\r\n\r\n//escape string 1\r\n$query .= \"\'\" . mysql_real_escape_string($encData->encArray[\"test\"]) . \"\',\";\r\n\r\n//escape string 2\r\n$query .= \"\'\" . mysql_real_escape_string($encData->encArray[\"testtwo\"]) . \"\',\";\r\n\r\n//escape string 3\r\n$query .= \"\'\" . mysql_real_escape_string($encData->encArray[\"testthree\"]) . \"\')\";\r\n\r\n//execute query\r\nglobal $ODODBO;\r\n$result = $ODODBO->Query($query);\r\n\r\n\r\n\r\n?>\r\n</center></body></html>\r\n<?PHP\r\n',1,0,1,NULL,'2012-10-27 17:28:43',NULL,'2012-11-18 23:36:14'),(10144,'Home','Default Public Home Page',_binary '$ODOMenuO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOMenuO\");\r\n}\r\n\r\n\r\n$NewsViewO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"NewsViewO\")) {\r\n	$NewsViewO = new NewsView();\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"NewsViewO\", $NewsViewO);\r\n\r\n} else {\r\n\r\n	$NewsViewO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"NewsViewO\");\r\n}\r\n\r\n\r\n\r\n$NewsLastPost = $NewsViewO->GetLastPost();\r\n\r\n$MenuHtml = $ODOMenuO->GetBPTPOINTTopMenu(\'PublicSite\');\r\n\r\n\r\n?>\r\n<!DOCTYPE HTML>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>Example page</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<link href=\"css/global.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/menus.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n</head>\r\n<body>\r\n<div id=\"container\">\r\n  <div id=\"header\">\r\n    <div id=\"title\">\r\n      <div id=\"sitetitle\"><h2>Example page</h2></div>\r\n    </div>\r\n \r\n  </div>\r\n  <div id=\"banner\">\r\n    <div id=\"banner_text\">\r\n<?PHP\r\n\r\necho $NewsLastPost;\r\n\r\n?>\r\n      \r\n    </div>\r\n  </div>\r\n<?PHP\r\n\r\necho $MenuHtml;\r\n\r\n?>\r\n  \r\n  <div id=\"content\">\r\n    <div id=\"left_column\">\r\n      \r\n<?php\r\n\r\nif($_SESSION[\"ODOUserO\"]->isNonGuestLogin()) {\r\n	\r\n    echo \"<h4>Welcome \" . $_SESSION[\"ODOUserO\"]->getfirstname() . \"</h4>\";\r\n	echo \"<div class=\\\"left_col_box\\\">\\n\\n<a href=\\\"index.php?pg=MyInfo\\\">Edit My Info</a><form action=\\\"index.php\\\" name=\\\"loginform\\\" method=\\\"POST\\\" enctype=\\\"application/x-www-form-urlencoded\\\">\\n<input type=\\\"hidden\\\" name=\\\"ObjectOnlyOutput\\\" value=\\\"1\\\">\\n<input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOUserO\\\">\\n<input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"LogoutPublic\\\">\\n<BR><input type=\\\"submit\\\" name=\\\"Logout\\\" value=\\\"Logout\\\">\\n<BR></form></div>\";\r\n		\r\n	\r\n} else {\r\n	\r\n	echo \"<div class=\\\"left_col_box\\\">\\n\";\r\n	echo $_SESSION[\"ODOUserO\"]->GetLoginForm(true);\r\n	echo \"\\n</div>\";\r\n\r\n}\r\n\r\n?>\r\n      \r\n    </div>\r\n    <div id=\"right_column\">\r\n \r\n      </div>\r\n  </div>\r\n  <div id=\"footer\"> </div>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<?PHP\r\n\r\n',1,0,1,NULL,'2012-11-03 23:19:55',1342,'2016-10-08 13:22:42'),(10145,'ViewData','Displays encrypted data',_binary '?>\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n<title>Test View Encrypted Data</title>\r\n</head>\r\n<body><center>\r\n<?PHP\r\n\r\nif(!$_SESSION[\"ODOUserO\"]->IsEncrypted()) {\r\n echo \"<B>User is not setup for encryption! Exiting.</B></center></body></html>\";\r\n exit();\r\n}\r\n\r\n//get all data from database\r\n$query = \"SELECT * FROM testEncryption\";\r\n\r\nglobal $ODODBO;\r\n\r\n$result = $ODODBO->Query($query);\r\n\r\nif(mysql_num_rows($result) < 1) {\r\n echo \"<B>Table is empty. Visit CreateData page to create a few rows <a href=\\\"index.php?pg=CreateData\\\">here</a>.</B>\";\r\n} else {\r\n\r\n echo \"<TABLE BORDER=1><TR><TH>User\'s UID</TH><TH>Field One</TH><TH>Field Two</TH><TH>Field Three</TH></TR>\";\r\n while($row = mysql_fetch_assoc($result)) {\r\n       \r\n       //decrypt the data\r\n       //build EncryptedData container object\r\n       $encData = new EncryptedData();\r\n\r\n       //populate the decrypted array with our values\r\n       $encData->encArray[\"test\"] = $row[\"DataFieldOne\"];\r\n       $encData->encArray[\"testtwo\"] = $row[\"DataFieldTwo\"];\r\n       $encData->encArray[\"testthree\"] = $row[\"DataFieldThree\"];\r\n\r\n       //tell the system to use the current user\'s IV\r\n       $encData->useODOUserIV = true;\r\n\r\n       //call the encrypt routine (mcrypt)\r\n       $encData = $_SESSION[\"ODOUtil\"]->ODODecrypt($encData);\r\n\r\n\r\n	echo \"<TR><TD>\" . $row[\"UID\"] . \"</TD><TD>\" . $encData->decArray[\"test\"] . \"</TD><TD>\" . $encData->decArray[\"testtwo\"] . \"</TD><TD>\" . $encData->decArray[\"testthree\"] . \"</TD></TR>\";\r\n }\r\n\r\n echo \"</TABLE>\";\r\n}\r\n\r\n\r\n?>\r\n</center></body></html>\r\n<?PHP\r\n\r\n',1,0,1,NULL,'2012-11-18 23:37:38',NULL,'2012-11-19 21:19:20'),(10146,'Legal','TOS for site',_binary 'TOS\r\n--\r\nenter your TOS here',0,0,1,NULL,'2012-11-25 17:35:41',1342,'2016-10-06 01:39:12'),(10147,'MyInfo','User update page for ODOUser table',_binary '\r\n$ODOMenuO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOMenuO\");\r\n}\r\n\r\n\r\n\r\n$MenuHtml = $ODOMenuO->GetBPTPOINTTopMenu(\'PublicSite\');\r\n\r\n\r\n?>\r\n<!DOCTYPE HTML>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>BPTPOINT</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/menus.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n</head>\r\n<body>\r\n<div id=\"container\">\r\n\r\n        <h1>My Information</h1> \r\n        <form action=\"index.php\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\">\r\n<input type=\"hidden\" name=\"pg\" value=\"MyInfo\">\r\n<input type=\"hidden\" name=\"UPDATE\" value=\"UPDATE\">\r\n        \r\n<table class=\"MyInfoBlock\" cellspacing=0>\r\n\r\n\r\n<?php\r\n\r\n$Output = \"\";\r\n\r\nif((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UPDATE\"]))&&(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]))&&(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"]))&&(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"]))) {\r\n\r\n	$email = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]);\r\n	$fname = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"]);\r\n	$lname = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"]);\r\n\r\n	try {\r\n\r\n		$_SESSION[\"ODOUserO\"]->updateUserInfo($email, $lname, $fname);\r\n\r\n		$Output .= \"<TR><TH colspan=\\\"2\\\" class=\\\"MyInfoMessage\\\">Update complete.</TH></TR>\";\r\n\r\n	} catch(Exception $ex) {\r\n\r\n		$GLOBALS[\'globalref\'][4]->LogEvent(\"ODOUSERUPDATE\", \"Updating user information failed.\" . $ex->getMessage(), ODOUSERUPDATEERROR);\r\n\r\n		$Output .= \"<TR><TH colspan=\\\"2\\\" class=\\\"MyInfoError\\\">We had an error updating your information. We have been notified of this issue. Please try again later.</TH></TR>\";\r\n\r\n	}\r\n\r\n}\r\n\r\n$Output .= \"<TR><TD>UserName:</TD><TD>\" . $_SESSION[\"ODOUserO\"]->getusername() . \"</TD></TR>\";\r\n\r\n$Output .= \"<TR><TD>E-mail Address:</TD><TD><input type=\\\"text\\\" name=\\\"email\\\" value=\\\"\" . $_SESSION[\"ODOUserO\"]->getemail() . \"\\\" size=\\\"25\\\" maxlength=\\\"100\\\"></TD></TR>\";\r\n\r\n$Output .= \"<TR><TD>First Name:</TD><TD><input type=\\\"text\\\" name=\\\"fname\\\" value=\\\"\" . $_SESSION[\"ODOUserO\"]->getfirstname() . \"\\\" size=\\\"20\\\" maxlength=\\\"100\\\"></TD></TR>\";\r\n\r\n\r\n$Output .= \"<TR><TD>Last Name:</TD><TD><input type=\\\"text\\\" name=\\\"lname\\\" value=\\\"\" . $_SESSION[\"ODOUserO\"]->getlastname() . \"\\\" size=\\\"20\\\" maxlength=\\\"100\\\"></TD></TR>\";\r\n\r\n$Output .= \"<TR><TD colspan=\\\"2\\\" class=\\\"MyInfoBlocksubmit\\\"><input type=\\\"submit\\\" name=\\\"submit\\\" value=\\\"submit\\\"></TD></TR>\";\r\n\r\necho $Output;\r\n\r\n?>\r\n</table>\r\n</form>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<?PHP\r\n\r\n\r\n',1,0,1,NULL,'2013-01-11 23:25:08',1342,'2016-10-07 01:39:04'),(10148,'testpage','test',_binary '	if(function_exists(\'sodium_pad\')) {\r\necho \"Sodium pad exists\";\r\n} else { echo \"sodium pad missing\"; }\r\n\r\nif(function_exists(\'sodium_crypto_secretbox\')) {\r\necho \"Sodium crypto secretbox exists\";\r\n} else { echo \"sodium crypto missing\"; }\r\n\r\nif(defined(\'SODIUM_LIBRARY_VERSION\')) {\r\necho \"sodium library version exists\";\r\n} else { echo \"sodium lib missing\"; }\r\n\r\nif(defined(\'SODIUM_CRYPTO_SECRETBOX_NONCEBYTES\')) {\r\necho \"sodium crypto secretbox noncebytes exists\";\r\n} else { echo \"sodium noncebytes missing\"; }\r\n\r\nif((defined(\'ENCRYPTODOUSER\'))&&(ENCRYPTODOUSER == 1)) {\r\necho \"encryptodouser exists\";\r\n} else { echo \"encryptodouser not set\"; }\r\n\r\n\r\n',1,0,1,NULL,'2013-02-10 17:29:48',1342,'2019-12-03 08:06:40'),(10160,'RegisterComplete','Page for completed registration',_binary '\r\n$ODOMenuO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOMenuO\");\r\n}\r\n\r\n$MenuHtml = $ODOMenuO->GetBPTPOINTTopMenu(\'PublicSite\');\r\n\r\n?>\r\n<!DOCTYPE HTML>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>BPTPOINT</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/menus.css\" rel=\"stylesheet\" type=\"text/css\"/>\r\n</head>\r\n<body>\r\n<div id=\"container\">\r\n \r\n<P>Please check your e-mail. You should have received an e-mail with your login details.</P> \r\n \r\n</div>\r\n\r\n\r\n</body>\r\n</html>\r\n\r\n<?PHP\r\n\r\n',1,0,1,NULL,'2014-12-04 00:37:23',1342,'2016-10-07 01:19:04'),(10175,'ContactUs','Contact Us Page',_binary '$ODOMenuO;\r\n\r\nif(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"ODOMenuO\")) {\r\n	$ODOMenuO = new ODOMenu;\r\n	$_SESSION[\"ODOSessionO\"]->RegisterObject(\"ODOMenuO\", $ODOMenuO);\r\n\r\n} else {\r\n\r\n	$ODOMenuO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"ODOMenuO\");\r\n}\r\n\r\n\r\n$messagesent = false;\r\n?>\r\n<!DOCTYPE HTML>\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n<head>\r\n<title>BPTPOINT</title>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n<link href=\"css/style.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/menus.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n</head>\r\n<body>\r\n<div id=\"container\">\r\n\r\n        <h1>Contact Us</h1>\r\n      \r\n<?PHP\r\n\r\n\r\nif(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"submitOK\"])) {\r\n	//validate form content\r\n	$valid = true;\r\n	$errorStr = \"\";\r\n	\r\n	\r\n	if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"chanswer\"])) {\r\n		$errorStr = \"<div id=\\\"error\\\" class=\\\"error\\\"><B>You need to enter the challenge fields on the form! Please hit your browser\'s back button and try again.</B></div>\";\r\n		$valid = false;\r\n	} else {\r\n	\r\n	\r\n		$OKCAPTCHA = false;\r\n\r\n		$query = \"SELECT * FROM NoSpam WHERE SessionID=\'\" . session_id() . \"\'\";\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		\r\n		if(mysqli_num_rows($result) > 0) {\r\n			$row = mysqli_fetch_assoc($result);\r\n			if($row[\"txtSpam\"] != $_SESSION[\"ODOSessionO\"]->EscapedVars[\"chanswer\"]) {\r\n				$strlog = \"Failed CAPTCHA\";\r\n				$_SESSION[\"ODOLoggingO\"]->LogEvent(\"CAPTCHAWRONG\", $strlog, 3);\r\n				$errorStr .= \"<div  id=\\\"error\\\" class=\\\"error\\\"><B>Invalid Challange Word! Please enter the text you see at the bottom of the form.</B></div>\";\r\n				$valid = false;\r\n			} \r\n		}\r\n	}\r\n	\r\n	$trans = array(\"\\n\" => \"newline\", \"\\r\" => \"newline\", \":\" => \"COLON\");\r\n	$from = \"\";\r\n	$subject = \"\";\r\n	$to = REGREPLYEMAIL;\r\n	$message = \"\";\r\n		\r\n	if((!isset($_POST[\"email\"]))||(!isset($_POST[\"SUBJECT\"]))||(!isset($_POST[\"mymessage\"]))) {\r\n		$errorStr .= \"<div id=\\\"error\\\" class=\\\"error\\\"><B>You are missing some important info! Please enter all fields on the form.</B></div>\";\r\n		$valid = false;\r\n	} else {\r\n\r\n		$from = strtr($_POST[\"email\"], $trans);\r\n		$subject = strtr($_POST[\"SUBJECT\"], $trans);\r\n		$message = htmlentities($_POST[\"mymessage\"]);\r\n		\r\n		if (!preg_match(\'/^[^0-9][a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[@][a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{2,4}$/\',$from)) \r\n		{\r\n			$errorStr .= \"<div id=\\\"error\\\" class=\\\"error\\\"><B>Invalid email address.</B></div>\";\r\n			$valid = false;\r\n		}\r\n		\r\n		if(strlen($_POST[\"mymessage\"])>8000) {\r\n			$errorStr .= \"<div id=\\\"error\\\" class=\\\"error\\\"><B>Your message must be shorter than 8,000 characters</B></div>\";\r\n			$valid = false;\r\n		}\r\n	}\r\n		\r\n	if($valid) {\r\n		$Header = \'From: <\' . $from . \'>\';\r\n			\r\n		if(!mail($to, $subject, $message, $Header)) {\r\n			$strlog = \"We could not send an e-mail!\";\r\n			$_SESSION[\"ODOLoggingO\"]->LogEvent(\"EMAILSENDFAILED\", $strlog, 3);\r\n			$Output = \"<div id=\\\"error\\\" class=\\\"error\\\"><B>There was an error sending your e-mail. We have been notified of this error. Please try again later.</B></div>\";\r\n		\r\n			echo $Output;\r\n			\r\n		} \r\n			\r\n		$Output = \"<div id=\\\"success\\\" class=\\\"success\\\"><B>Your message has been sent. We will reply as soon as we can. Thank You!</B></div>\";\r\n		echo $Output;\r\n		\r\n		$messagesent = true;\r\n		\r\n	} else {\r\n		\r\n		echo $errorStr;\r\n	}\r\n		\r\n} \r\n\r\nif(!$messagesent) {\r\n	\r\n?>\r\n<form action=\"index.php\" enctype=\"application/x-www-form-urlencoded\" method=\"POST\">\r\n<input type=\"hidden\" name=\"pg\" value=\"ContactUs\">\r\n<input type=\"hidden\" name=\"submitOK\" value=\"submitOK\">\r\n<table>\r\n<TR>\r\n	<TD>Your E-mail Address:</TD>\r\n	<TD>\r\n		<input type=\"text\" name=\"email\" maxlength=\"50\" size=\"20\" <?PHP \r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"])) \r\n		{ \r\n			echo \"value=\\\"\" . htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]) . \"\\\"\"; \r\n		} \r\n		?>>\r\n	</TD>\r\n</TR>\r\n<TR>\r\n	<TD>Subject:</TD>\r\n	<TD>\r\n		<SELECT Name=\"SUBJECT\">\r\n			<OPTION value=\"COPYRIGHT\" <?PHP \r\n			\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]==\"COPYRIGHT\")) \r\n			{ \r\n				echo \"selected\";\r\n			} \r\n			?>>I need to report a copyright issue.</OPTION>\r\n			<OPTION VALUE=\"ACCOUNT\" <?PHP \r\n			\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]==\"ACCOUNT\")) \r\n			{ \r\n				echo \"selected\";\r\n			} \r\n			?>>I\'m having issues with my account.</OPTION>\r\n			<OPTION value=\"Complaint\" <?PHP \r\n			\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]==\"Complaint\")) \r\n			{ \r\n				echo \"selected\";\r\n			} \r\n			?>>I have a valid complaint to file.</OPTION>\r\n			<OPTION Value=\"OTHER\" <?PHP \r\n			\r\n			if(((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]==\"OTHER\"))||\r\n					(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SUBJECT\"]))) \r\n			{ \r\n				echo \"selected\";\r\n			} \r\n			?>>Other issue...</Option>\r\n		</SELECT>\r\n	</TD>\r\n</TR>\r\n<TR>\r\n	<TD colspan=\"2\" align=\"center\">\r\n		<textarea NAME=\"mymessage\" COLS=\"80\" ROWS=\"20\"><?PHP\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"mymessage\"])) \r\n			{ \r\n				echo htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"mymessage\"]);\r\n			}\r\n		?></textarea>\r\n	</TD>\r\n</TR>\r\n</table>\r\n<BR>\r\n<sub>Enter the text you see in the image.</sub>\r\n<br>\r\n<table>\r\n	<TR>\r\n		<TD>\r\n			<img src=\"NoSpam.php\">\r\n		</TD>\r\n		<TD>\r\n			<input type=\"text\" name=\"chanswer\" size=\"10\" maxlength=\"8\">\r\n		</TD>\r\n	</TR>\r\n</TABLE>\r\n<BR>\r\n<input type=\"submit\" name=\"submit\" value=\"Submit\">\r\n<BR>\r\n</form>\r\n<?php \r\n}\r\n\r\n?>\r\n</div>\r\n</body>\r\n</html>\r\n\r\n<?PHP\r\n\r\n\r\n',1,0,1,NULL,'2015-03-01 14:39:55',1342,'2016-10-07 01:30:56'),(10176,'mHome','Mobile version of home',_binary 'Mobile version of home.',0,0,1,1342,'2016-10-08 13:44:47',1342,'2016-10-08 13:44:47');
/*!40000 ALTER TABLE `ODOPages` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOSessions`
--

DROP TABLE IF EXISTS `ODOSessions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOSessions` (
  `SessionID` varchar(254) NOT NULL,
  `CreationTS` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `RevisionTS` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `data` blob,
  PRIMARY KEY (`SessionID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOSessions`
--

LOCK TABLES `ODOSessions` WRITE;
/*!40000 ALTER TABLE `ODOSessions` DISABLE KEYS */;
/*!40000 ALTER TABLE `ODOSessions` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOTree`
--

DROP TABLE IF EXISTS `ODOTree`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOTree` (
  `PriKey` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `PageID` int(10) unsigned DEFAULT NULL,
  `ParentID` int(10) unsigned DEFAULT NULL,
  `IsObject` tinyint(1) NOT NULL DEFAULT '0',
  `URL` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `HeadTag` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `LinkName` varchar(254) CHARACTER SET latin1 NOT NULL,
  `ChildPos` int(10) unsigned DEFAULT NULL,
  `DependVar` varchar(255) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`PriKey`),
  KEY `fk_ODOTree_ParentID` (`ParentID`),
  KEY `fk_ODOTree_PageID` (`PageID`),
  CONSTRAINT `fk_ODOTree_PageID` FOREIGN KEY (`PageID`) REFERENCES `ODOPages` (`PageID`) ON DELETE SET NULL ON UPDATE CASCADE,
  CONSTRAINT `fk_ODOTree_ParentID` FOREIGN KEY (`ParentID`) REFERENCES `ODOTree` (`PriKey`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=226 DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOTree`
--

LOCK TABLES `ODOTree` WRITE;
/*!40000 ALTER TABLE `ODOTree` DISABLE KEYS */;
INSERT INTO `ODOTree` VALUES (1,NULL,NULL,0,'','Admin','',NULL,NULL),(4,NULL,1,0,'',NULL,'ODOWeb',2,NULL),(5,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=ListGroups',NULL,'Groups',3,NULL),(6,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages',NULL,'Pages',2,NULL),(7,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers','','Users',1,NULL),(8,3000,NULL,0,'','AdminCMSUser','',NULL,NULL),(9,3000,10,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers',NULL,'List By name',2,NULL),(10,3000,8,0,'','','Users',1,NULL),(11,3000,10,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=NewUser',NULL,'New User',1,NULL),(12,3000,10,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstByGroups',NULL,'List By Groups',3,NULL),(13,3000,8,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=Search',NULL,'Search',4,NULL),(14,3000,8,0,'',NULL,'Selected User',3,NULL),(17,3000,8,0,'','','Permissions',2,NULL),(18,3000,NULL,0,'','AdminCMSPage','',NULL,NULL),(20,3000,18,0,'',NULL,'Permissions',3,NULL),(21,3000,18,0,'',NULL,'Categories',2,NULL),(22,3000,18,0,'',NULL,'Pages',1,NULL),(23,3000,22,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=SearchPages','','Search',5,NULL),(24,3000,22,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&ClearCat=true',NULL,'Pages By Category',4,NULL),(25,3000,22,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages',NULL,'List Pages',3,NULL),(26,3000,22,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=EditPage',NULL,'Edit Page',1,NULL),(27,3000,22,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=NewPage','','New Page',2,NULL),(28,3000,21,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListCat',NULL,'List Page Categories',3,'SelectedPage'),(29,3000,21,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=DeleteCat',NULL,'Delete a Category',2,NULL),(30,3000,21,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=NewCat',NULL,'New Category',1,NULL),(31,3000,NULL,0,'','AdminCMSGroups','',NULL,NULL),(32,3000,31,0,'',NULL,'Groups',1,NULL),(33,3000,32,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=NewGroup',NULL,'New Group',1,NULL),(34,3000,32,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=ListGroups',NULL,'List Groups',2,NULL),(35,3000,32,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=EditGroup',NULL,'Edit Group',3,NULL),(36,3000,31,0,'',NULL,'Permissions',2,NULL),(40,3000,NULL,0,NULL,'AdminCMSObjects','',4,NULL),(41,3000,40,0,'',NULL,'Objects',1,NULL),(42,3000,41,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=NewObject','','New Object',1,NULL),(43,3000,41,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListObjects',NULL,'List Objects',2,NULL),(44,3000,40,0,'','','Permissions',2,NULL),(45,3000,40,0,NULL,NULL,'Object Menu',3,NULL),(46,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByType',NULL,'Logs',6,NULL),(47,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=ListHeads','','Menus',5,NULL),(48,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListObjects','','Objects',4,NULL),(56,3000,57,0,NULL,NULL,'Menus',1,NULL),(57,3000,NULL,0,NULL,'AdminCMSMenus','',NULL,NULL),(58,3000,56,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=ListHeads',NULL,'List Heads',1,NULL),(59,3000,56,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=CloneTree',NULL,'Clone Tree',5,NULL),(60,3000,56,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=DeleteTree',NULL,'Delete Tree',4,NULL),(61,3000,56,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree',NULL,'Edit Tree',3,NULL),(62,3000,56,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=NewHead',NULL,'New Head',2,NULL),(63,3000,64,0,NULL,NULL,'Logs',1,NULL),(64,3000,NULL,0,NULL,'AdminCMSLogs','',NULL,NULL),(65,3000,63,1,'index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByType',NULL,'View By Types',1,NULL),(68,3000,64,0,NULL,NULL,'Reports',2,NULL),(69,3000,63,1,'index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewBySeverity',NULL,'View By Severity',2,NULL),(70,3000,63,1,'index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp',NULL,'View By TimeStamp',3,NULL),(80,NULL,1,0,'',NULL,'ODONews',3,NULL),(81,10111,80,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=ListPosts',NULL,'News',1,NULL),(82,10111,NULL,0,NULL,'AdminCMSNews','',NULL,NULL),(83,10111,82,0,NULL,NULL,'Categories',2,NULL),(84,10111,82,0,'',NULL,'Posts',1,NULL),(85,10111,84,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=NewPost',NULL,'New Post',2,NULL),(86,10111,84,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=EditPost',NULL,'Edit Post',3,NULL),(87,10111,84,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=ListPosts',NULL,'List Postings',1,NULL),(88,10111,84,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=DeletePost',NULL,'Delete Post',4,NULL),(89,10111,83,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=NewCategory',NULL,'New Category',1,NULL),(90,10111,83,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=ListCategories',NULL,'List Categories',2,NULL),(91,10111,83,1,'index.php?pg=CMSNews&ob=ODOCMSNewsO&fn=AddRemoveGroups',NULL,'Add/Remove Groups',3,NULL),(102,3000,57,0,'',NULL,'Permissions',2,NULL),(103,3000,102,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditPermissions',NULL,'Add/Edit Permissions',1,NULL),(104,3000,102,1,'index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=BuildTrees',NULL,'Build Permission Trees',2,NULL),(143,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewRegTypes',NULL,'Register Types',7,NULL),(144,NULL,NULL,0,NULL,'AdminCMSRegister','',NULL,NULL),(145,3000,144,0,'',NULL,'Register Types',1,NULL),(146,3000,145,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewRegTypes',NULL,'List',1,NULL),(150,3000,144,0,'',NULL,'Verifications',2,NULL),(151,3000,150,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ListPending',NULL,'List Pending',1,NULL),(152,3000,150,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified',NULL,'Check Logs For Previous Verified',3,NULL),(153,3000,150,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=EditEmail',NULL,'E-Mail Notice Setup',4,NULL),(160,3000,150,1,'index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewPendingByType',NULL,'View Pending By Type',2,NULL),(171,3000,14,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditUser',NULL,'Edit User',1,'userid'),(172,3000,14,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=ChangeUserPassword',NULL,'Change User Password',2,'userid'),(173,3000,14,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=ShowUserLogs',NULL,'Show User Logs',3,'userid'),(174,3000,17,1,'index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditGroups',NULL,'Edit Groups',1,'userid'),(175,3000,20,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=AddRemoveGroups',NULL,'Add/Remove Groups',1,'SelectedPage'),(176,3000,20,1,'index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=AddRemoveObjects',NULL,'Add/Remove Objects',2,'SelectedPage'),(177,3000,36,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=UpdateUsers',NULL,'Update users in group',1,'GID'),(178,3000,36,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=UpdatePages',NULL,'Update pages in group',2,'GID'),(179,3000,36,1,'index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=UpdateObjects',NULL,'Update Objects in group',3,'GID'),(180,3000,44,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=AddRemovePages',NULL,'Add/Remove Pages',1,'ObjID'),(181,3000,44,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=AddRemoveGroups',NULL,'Add/Remove Groups',2,'ObjID'),(182,3000,45,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=EditObject',NULL,'Edit Object',1,'ObjID'),(183,3000,45,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=NewFunction',NULL,'New Function',2,'ObjID'),(184,3000,45,1,'index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListFunctions',NULL,'List Functions',3,'ObjID'),(187,3000,4,1,'index.php?pg=ODOCMS&ob=ODOCMSConstantsO&fn=ViewConstants',NULL,'Constants',8,NULL),(188,3000,68,1,'index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=UserLoginLogoutReport',NULL,'User Login/Logout Report',1,NULL),(193,NULL,NULL,0,NULL,'PublicSite','',NULL,NULL),(194,10144,193,0,'index.php?pg=Home',NULL,'Home',1,NULL),(215,3000,1,0,'',NULL,'ODOStore',4,NULL),(216,NULL,215,1,'index.php?pg=ODOCMSStore&ob=ODOCMSStoreLogsO&fn=ViewLogs',NULL,'Store Logs',1,NULL),(217,NULL,NULL,0,NULL,'mobilePublic','',NULL,NULL),(218,NULL,217,0,'index.php?pg=mHome',NULL,'Home',1,NULL),(219,10175,194,0,'index.php?pg=ContactUs',NULL,'ContactUs',1,NULL),(224,NULL,217,0,'index.php?pg=mContactUs',NULL,'Contact Us',6,NULL),(225,3000,194,0,'index.php?pg=ODOCMS',NULL,'ODOCMS Admin',2,NULL);
/*!40000 ALTER TABLE `ODOTree` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOUserGID`
--

DROP TABLE IF EXISTS `ODOUserGID`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOUserGID` (
  `GID` int(10) unsigned NOT NULL,
  `UID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`GID`,`UID`),
  KEY `UIDIndex` (`UID`),
  CONSTRAINT `fk_UserGID_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_UserGID_UID` FOREIGN KEY (`UID`) REFERENCES `ODOUsers` (`UID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Associates Users with GIDs';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOUserGID`
--

LOCK TABLES `ODOUserGID` WRITE;
/*!40000 ALTER TABLE `ODOUserGID` DISABLE KEYS */;
INSERT INTO `ODOUserGID` VALUES (5,2),(1,1342),(2,1343);
/*!40000 ALTER TABLE `ODOUserGID` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ODOUsers`
--

DROP TABLE IF EXISTS `ODOUsers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOUsers` (
  `UID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `user` varchar(20) NOT NULL,
  `pass` varbinary(270) NOT NULL,
  `rnameLast` varbinary(116) DEFAULT NULL,
  `rnameFirst` varbinary(116) DEFAULT NULL,
  `emailadd` varbinary(116) DEFAULT NULL,
  `Pistemp` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `ResetQID` tinyint(3) unsigned DEFAULT NULL,
  `ResetA` varbinary(270) DEFAULT NULL,
  `IsLocked` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `FailedLogins` tinyint(3) unsigned NOT NULL DEFAULT '0',
  `IsEncrypted` tinyint(1) unsigned NOT NULL DEFAULT '0',
  `HashedMode` tinyint(1) unsigned NOT NULL DEFAULT '3',
  `EncIV` varbinary(512) DEFAULT NULL,
  `LastLogin` datetime DEFAULT NULL,
  PRIMARY KEY (`UID`),
  KEY `fk_ODOUsers_ResetQID` (`ResetQID`),
  CONSTRAINT `fk_ODOUsers_ResetQID` FOREIGN KEY (`ResetQID`) REFERENCES `ResetQuestions` (`ResetQID`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=1344 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOUsers`
--

LOCK TABLES `ODOUsers` WRITE;
/*!40000 ALTER TABLE `ODOUsers` DISABLE KEYS */;
INSERT INTO `ODOUsers` VALUES (2,'guest',_binary 'letmein',_binary 'Guest',_binary 'First Name',_binary 'test@nowhere.net',0,NULL,NULL,0,0,0,3,NULL,NULL),(1342,'admin',_binary '21232f297a57a5a743894a0e4a801fc3',_binary 'admin lastname',_binary 'admin',_binary 'admin@localhost',0,1,_binary '$6$rounds=5000$a4g2hjwtOK9kA3pw$AUaQ0Xk2MseJVx8O0XAsuGQWHMVrT.Zf0Lj2GaN.L9lit0ex3gziAlAQ61eXxVEmfaXZOr97u//ziYLiqEFly0',0,1,0,3,NULL,'2020-01-01 03:10:03'),(1343,'testUserOne',_binary 'a92e7826a1d9fd3a0d7d7f3580b99635',_binary ')A\v\\rG`Q-C\\z',_binary 'Wu\\$YUG+C\\z',_binary ' !:\|!)\h^\C7$1\|w\a\jmC\\">vW\',1,1,_binary '3a368818b7341d48660e8dd6c5a77dbe',0,0,1,3,_binary '\I\\C\9b}E\g#',NULL);
/*!40000 ALTER TABLE `ODOUsers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ObjectNames`
--

DROP TABLE IF EXISTS `ObjectNames`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ObjectNames` (
  `ObjID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(254) CHARACTER SET latin1 NOT NULL,
  `IsWhole` tinyint(1) NOT NULL DEFAULT '1',
  `Description` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `IsAdmin` tinyint(1) NOT NULL DEFAULT '0',
  `ModID` int(10) unsigned DEFAULT NULL,
  PRIMARY KEY (`ObjID`),
  KEY `fk_ObjectNames_ModID` (`ModID`),
  CONSTRAINT `fk_ObjectNames_ModID` FOREIGN KEY (`ModID`) REFERENCES `Modules` (`ModID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=51 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ObjectNames`
--

LOCK TABLES `ObjectNames` WRITE;
/*!40000 ALTER TABLE `ObjectNames` DISABLE KEYS */;
INSERT INTO `ObjectNames` VALUES (2,'ODOMenu',0,'Menu Object',0,1),(3,'ODOCMSUsers',0,'CMS User Object',1,100),(4,'ODOCMSPages',0,'CMS Page Object',1,100),(5,'ODOCMSGroups',0,'CMS Group Object',1,100),(6,'ODOCMSObjects',0,'CMS Objects Object',1,100),(12,'ODOCMSMenus',0,'CMS object to manage Menu locations',1,100),(13,'ODOCMSLogs',0,'CMS Logs object. This is used to view and generate reports for ODO Logs',1,100),(14,'ODOCMSNews',0,'News Posting Module Object',1,1),(18,'ODORegister',0,'This object is the public object for Registering users into the system.',0,1),(19,'ODOCMSRegister',0,'Register object to complete admin verifies and setup Registration Types.',1,100),(27,'ODOCMSConstants',0,'CMS Constants class to update existing Constants.',1,100),(31,'NewsItem',1,'News Post',0,1),(32,'NewsDB',1,'News database object',0,1),(33,'NewsView',1,'News View Object',0,1),(48,'BPTPOINTGenericObjects',1,'All generic classes',0,104),(50,'FileUtil',1,'FileUtil allows adding files or updating',0,1);
/*!40000 ALTER TABLE `ObjectNames` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `Objects`
--

DROP TABLE IF EXISTS `Objects`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `Objects` (
  `CodeSegID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `fnName` varchar(254) CHARACTER SET latin1 NOT NULL,
  `Code` blob NOT NULL,
  `IsHeader` tinyint(1) NOT NULL DEFAULT '0',
  `IsFooter` tinyint(1) NOT NULL DEFAULT '0',
  `ObjID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`CodeSegID`),
  KEY `fk_Objects_ObjID` (`ObjID`),
  CONSTRAINT `fk_Objects_ObjID` FOREIGN KEY (`ObjID`) REFERENCES `ObjectNames` (`ObjID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=205 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `Objects`
--

LOCK TABLES `Objects` WRITE;
/*!40000 ALTER TABLE `Objects` DISABLE KEYS */;
INSERT INTO `Objects` VALUES (4,'ODOMenu',_binary '	function GetBPTPOINTTopMenu($HeadTag) {\r\n\r\n		$RValue = null;		\r\n		$DepVar = false;\r\n		$DepVarSet = false;\r\n		$TopLevelMenuCounter = 0;\r\n		\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n\r\n			$RValue = \"<div class=\\\"BPTPOINTMenu\\\">\\n<ul>\\n\";\r\n			//level 1\r\n			foreach($this->ChildrenArray[$this->IsHeadArray[$HeadTag]] as $ID=>$Value) {\r\n				//reset\r\n				$DepVar = false;\r\n				$DepVarSet = false;\r\n				$DepVar2 = false;\r\n				$DepVarSet2 = false;\r\n				$DepVar3 = false;\r\n				$DepVarSet3 = false;\r\n				\r\n				//check for conditional var\r\n				if(isset($this->DepVarArray [$ID])) {\r\n						$DepVar = true;\r\n				} \r\n				\r\n				if($DepVar) {\r\n			\r\n					if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$ID]])) {\r\n						$DepVarSet = true;\r\n					}\r\n					\r\n				}\r\n					\r\n				if((!$DepVar)||(($DepVar)&&($DepVarSet))) {\r\n					\r\n					if($TopLevelMenuCounter == (count($this->ChildrenArray[$this->IsHeadArray[$HeadTag]] ) - 1)) {\r\n						$RValue = $RValue . \"<li class=\\\"lastmenu\\\">\";\r\n					} else {\r\n						$RValue = $RValue . \"<li>\";\r\n					}\r\n				\r\n					if(strlen($this->URLArray[$ID]) > 0) {\r\n						$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$ID];\r\n						if($DepVarSet) {\r\n							$RValue = $RValue . \"&\" . $this->DepVarArray[$ID] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$ID]);\r\n						}\r\n						$RValue = $RValue . \"\\\">\" . $this->NameArray[$ID] . \"</a>\";\r\n					} else {\r\n						$RValue = $RValue . \"<a href=\\\"#\\\" >\" . $this->NameArray[$ID] . \"</a>\";\r\n					}\r\n\r\n					if(isset($this->ChildrenArray[$ID])) {\r\n						$RValue = $RValue . \"\\n<ul>\";\r\n						//level 2\r\n						foreach($this->ChildrenArray[$ID] as $Child=>$CValue) {\r\n							//reset this level\r\n							$DepVar2 = false;\r\n							$DepVarSet2 = false;\r\n								\r\n							//check for conditional var\r\n							if(isset($this->DepVarArray [$Child])) {\r\n								$DepVar2 = true;\r\n							} \r\n				\r\n							if($DepVar2) {\r\n			\r\n								if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$Child]])) {\r\n									$DepVarSet2 = true;\r\n								}\r\n					\r\n							}\r\n					\r\n							if((!$DepVar2)||(($DepVar2)&&($DepVarSet2))) {\r\n								$RValue = $RValue . \"\\n<li>\";\r\n								if(isset($this->URLArray[$Child])) {\r\n									$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$Child];\r\n									if($DepVarSet2) {\r\n										$RValue = $RValue . \"&\" . $this->DepVarArray[$Child] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$Child]);\r\n									}\r\n									$RValue = $RValue . \"\\\">\" . $this->NameArray[$Child] . \"</a>\";\r\n								} else {\r\n									$RValue = $RValue . \"<a href=\\\"#\\\">\" . $this->NameArray[$Child] . \"</a>\" ;\r\n								}\r\n						\r\n								if(isset($this->ChildrenArray[$Child])) {\r\n									$RValue = $RValue . \"\\n<ul>\";\r\n									//level 3\r\n									foreach($this->ChildrenArray[$Child] as $ChildThree=>$CValueThree) {\r\n										//reset this level\r\n										$DepVar3 = false;\r\n										$DepVarSet3 = false;\r\n										\r\n										//check for conditional var\r\n										if(isset($this->DepVarArray [$ChildThree])) {\r\n											$DepVar3 = true;\r\n										} \r\n				\r\n										if($DepVar3) {\r\n			\r\n											if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$ChildThree]])) {\r\n												$DepVarSet3 = true;\r\n											}\r\n					\r\n										}\r\n					\r\n										if((!$DepVar3)||(($DepVar3)&&($DepVarSet3))) {\r\n			\r\n											$RValue = $RValue . \"\\n<li>\";\r\n											if(isset($this->URLArray[$ChildThree])) {\r\n												$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$ChildThree];\r\n												if($DepVarSet3) {\r\n													$RValue = $RValue . \"&\" . $this->DepVarArray[$ChildThree] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$ChildThree]);\r\n												}\r\n												$RValue = $RValue . \"\\\">\" . $this->NameArray[$ChildThree] . \"</a>\";\r\n											} else {\r\n												$RValue = $RValue . \"<a href=\\\"#\\\">\" . $this->NameArray[$ChildThree] . \"</a>\" ;\r\n											}\r\n						\r\n											$RValue = $RValue . \"</li>\";\r\n										}\r\n									}\r\n									\r\n									$RValue = $RValue . \"\\n</ul>\";\r\n								}\r\n								$RValue = $RValue . \"</li>\";\r\n							}\r\n						}\r\n						$RValue = $RValue . \"\\n</ul>\";\r\n					}\r\n					$RValue = $RValue . \"</li>\";\r\n				}\r\n				\r\n				$TopLevelMenuCounter++;\r\n			}\r\n			\r\n			$RValue = $RValue . \"</ul></div>\\n\";\r\n		}\r\n		\r\n		return $RValue;\r\n		\r\n	}\r\n\r\n\r\n\r\n	/**\r\n	 * Builds menu for mobile users\r\n	 */\r\n	function getBPTPOINTMobile($HeadTag) {\r\n		\r\n		$RValue = null;\r\n		$TopLevelMenuCounter = 0;\r\n		\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n		\r\n			$RValue = \"\";\r\n			\r\n			//level 1\r\n			foreach($this->ChildrenArray[$this->IsHeadArray[$HeadTag]] as $ID=>$Value) {\r\n				//reset\r\n		\r\n				$RValue .= \"<a href=\\\"{$this->URLArray[$ID]}\\\" class=\\\"ui-btn\\\">{$this->NameArray[$ID]}</a>\";\r\n				\r\n			}\r\n			\r\n			//add search form\r\n			$RValue .= \"<div id=\\\"search\\\" data-role=\\\"collapsible\\\">\\n<h1>Search</h1>\\n<p>\\n\\n<form method=\\\"get\\\" action=\\\"index.php\\\">\";\r\n			$RValue .= \"<input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"msearch\\\">\\n\";\r\n			$RValue .= \"<div><label>Search Artists:</label>&nbsp;<input class=\\\"inputfield\\\" name=\\\"keyword\\\" type=\\\"text\\\" id=\\\"keyword\\\" size=\\\"15\\\"/></div>\\n\";\r\n			$RValue .= \"<input class=\\\"button\\\" type=\\\"submit\\\" name=\\\"Search\\\" value=\\\"Search\\\" />\\n</form>\\n</p>\\n</div>\";\r\n			\r\n			\r\n			if($_SESSION[\"ODOUserO\"]->isNonGuestLogin()) {\r\n				\r\n				$RValue .= \"<FORM action=\\\"index.php\\\" name=\\\"loginform\\\" method=\\\"POST\\\" data-ajax=\\\"false\\\" enctype=\\\"application/x-www-form-urlencoded\\\">\\n\";\r\n				$RValue .= \"<input type=\\\"hidden\\\" name=\\\"ObjectOnlyOutput\\\" value=\\\"1\\\">\\n\";\r\n				$RValue .= \"<input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOUserO\\\">\\n\";\r\n				$RValue .= \"<input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"LogoutPublic\\\">\\n\";\r\n				$RValue .= \"<input type=\\\"submit\\\" name=\\\"Logout\\\" class=\\\"ui-btn ui-icon-lock ui-btn-icon-left\\\" value=\\\"Logout\\\"></form>\\n\";\r\n				\r\n			} else {\r\n				\r\n				$RValue .= \"<a href=\\\"login.php\\\" data-ajax=\\\"false\\\" class=\\\"ui-btn ui-icon-lock ui-btn-icon-left\\\">Log In</a>\\n\";\r\n				$RValue .= \"<a href=\\\"index.php?pg=mRegister\\\" class=\\\"ui-btn\\\">Regsiter</a>\\n\";\r\n				\r\n			}\r\n			\r\n			$RValue .= \"<a href=\\\"../index.php?overrideMobile=true\\\" data-ajax=\\\"false\\\">Load Full Site</a>\\n\";\r\n			\r\n			\r\n		}\r\n		\r\n		return $RValue;\r\n	}\r\n	\r\n	\r\n\r\n',0,0,2),(5,'lstUsers',_binary '\r\n	function lstUsers() {\r\n		//check count and starting point\r\n		$this->CurUser = 0;\r\n		$this->CurUserLogCount = 0;\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		//load UserRecords\r\n		$query = \"select * from ODOUsers ORDER BY user\";\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 15;\r\n		$Count = 0;\r\n\r\n		if( ($RecordCount % 15 > 0) ) {\r\n			$NumofPages = intval($NumofPages) + 1;\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		$this->Content = $this->Content . \"<br><br><table border=1><TH>User ID</TH><th>User Name</th><th>User\'s Real Name</th><th>User\'s e-mail address</th><th>Select User</th><th>Delete User</th>\";\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = \"<center><h4>Page number is out of bounds!</h4><br><br></center>\";\r\n		} else {\r\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n			mysqli_data_seek($TempRecords, $ChangeToRow);\r\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n				\r\n				$rnameL = \"\";\r\n				$rnameF = \"\";\r\n				$email = \"\";\r\n					\r\n				if(($row[\"IsEncrypted\"] == 1)&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\r\n					$encData = new EncryptedData();\r\n					\r\n					$encData->encArray[\"rnameLast\"] = $row[\"rnameLast\"];\r\n					$encData->encArray[\"rnameFirst\"] = $row[\"rnameFirst\"];\r\n					$encData->encArray[\"emailadd\"] = $row[\"emailadd\"];\r\n					$encData->iv = $row[\"EncIV\"];\r\n\r\n					$encData = $_SESSION[\"ODOUtil\"]->ODODecrypt($encData);\r\n						\r\n					$rnameL = $encData->decArray[\"rnameLast\"];\r\n					$rnameF = $encData->decArray[\"rnameFirst\"];\r\n					$email = $encData->decArray[\"emailadd\"];\r\n						\r\n				} else {\r\n					$rnameL = $row[\"rnameLast\"];\r\n					$rnameF = $row[\"rnameFirst\"];\r\n					$email = $row[\"emailadd\"];\r\n				}\r\n					\r\n				$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td>\" . $row[\"UID\"] . \"</td><td>\" . $row[\"user\"] . \"</td><td>\" . $rnameL . \", \" . $rnameF . \"</td><td>\" . $email . \"</td><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n				$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n			\r\n				$Count = $Count + 1;\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n			} else {\r\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers&PageNum=\" . ($i+5) . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstUsers&PageNum=\" . $NumofPages . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n\r\n		}\r\n	\r\n	}\r\n\r\n',0,0,3),(6,'ODOCMSUserHead',_binary '\r\nclass ODOCMSUsers {\r\n\r\n	private $CurUser;\r\n	private $CurUserLogCount;\r\n	private $PrevUser;\r\n	var $Content;\r\n	var $UserName;\r\n	var $email;\r\n	var $FName;\r\n	var $LName;\r\n	var $iv;\r\n	\r\n\r\n	function  __construct() {\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"])) {\r\n			$this->CurUser = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"];\r\n			$this->PrevUser = $this->CurUser;\r\n		} else {\r\n			$this->CurUser = 0;\r\n			$this->PrevUser = 0;\r\n		}\r\n		$this->Content = \"\";\r\n		$this->UserName = \"\";\r\n		$this->email = \"\";\r\n		$this->FName = \"\";\r\n		$this->LName = \"\";\r\n		$this->iv = \"\";\r\n		$this->CurUserLogCount=0;\r\n	}\r\n\r\n	function LoadUserMenus() {\r\n\r\n		if($this->CurUser != 0) {\r\n			//then we load user drop down menus\r\n			//Menu Item Selected User\r\n		\r\n			\r\n			if($this->CurUser != $this->PrevUser) {\r\n				$query = \"select IsEncrypted, emailadd, rnameFirst, rnameLast, EncIV, user from ODOUsers where UID=\" . $this->CurUser;\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				if($row = mysqli_fetch_assoc($TempRecords)){\r\n					//update local vars here\r\n					$rnameL = \"\";\r\n					$rnameF = \"\";\r\n					$email = \"\";\r\n					$uname = $row[\"user\"];\r\n					$iv = \"\";\r\n					if(($row[\"IsEncrypted\"] == 1)&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\r\n						$encData = new EncryptedData();\r\n					\r\n						$encData->encArray[\"rnameLast\"] = $row[\"rnameLast\"];\r\n						$encData->encArray[\"rnameFirst\"] = $row[\"rnameFirst\"];\r\n						$encData->encArray[\"emailadd\"] = $row[\"emailadd\"];\r\n						$encData->iv = $row[\"EncIV\"];\r\n\r\n						$encData = $_SESSION[\"ODOUtil\"]->ODODecrypt($encData);\r\n						\r\n						$rnameL = $encData->decArray[\"rnameLast\"];\r\n						$rnameF = $encData->decArray[\"rnameFirst\"];\r\n						$email = $encData->decArray[\"emailadd\"];\r\n						$iv = $encData->iv;\r\n						\r\n					} else {\r\n						$rnameL = $row[\"rnameLast\"];\r\n						$rnameF = $row[\"rnameFirst\"];\r\n						$email = $row[\"emailadd\"];\r\n					}\r\n			\r\n\r\n					$this->email = $email;\r\n					$this->UserName = $uname;\r\n					$this->FName = $rnameF;\r\n					$this->LName = $rnameL;\r\n					$this->iv = $iv;\r\n					$this->PrevUser = $this->CurUser;\r\n						\r\n					\r\n				}\r\n			}\r\n			\r\n			//insert selected user code here\r\n			$this->Content = $this->Content . \"\\n<br><h4>Selected User</h4><table border=1><tr><td><B>Username: </b></td><td><B>\" . $this->UserName . \"</B></td></tr>\\n<tr><td><B>UID: </B></td><td><B>\" . $this->CurUser . \"</B></td></tr>\\n<tr><td><B>Last Name, First Name</B></td><td><B>\" . $this->LName . \",&nbsp;\" . $this->FName . \"</B></td></tr>\\n<tr><td><B>E-Mail: </B></td><td><B>\" . $this->email . \"</B></td></tr></table>\";\r\n\r\n		} else {\r\n				$this->UserName = \"\";\r\n				$this->email = \"\";\r\n				$this->FName = \"\";\r\n				$this->LName = \"\";\r\n				$this->CurUserLogCount=0;\r\n				$this->PrevUser = 0;\r\n				\r\n		}\r\n	}\r\n\r\n',1,0,3),(7,'ODOCMSUserFoot',_binary '\r\n	function __sleep() {\r\n		$this->Content = \"\";\r\n		return( array_keys( get_object_vars( $this ) ) );\r\n	}\r\n	\r\n} \r\n\r\n',0,1,3),(8,'lstByGroups',_binary '\r\n	function lstByGroups() {\r\n		\r\n		$grpid = 0;\r\n		$this->CurUser = 0;\r\n		$this->CurUserLogCount = 0;\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		$query = \"select * from ODOGroups\";\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		\r\n		$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"lstByGroups\\\"><H4><B>Select Group: </B></H4><select name=\\\"grpid\\\">\\n\";\r\n\r\n		while($row = mysqli_fetch_assoc($TempRecords)) {\r\n			$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"GID\"] . \"\\\"\";\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"]))&&($row[\"GID\"] == $_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"])) {\r\n				$this->Content = $this->Content . \" selected \";\r\n				$grpid = $row[\"GID\"];\r\n			}\r\n			$this->Content = $this->Content . \">\" . $row[\"GroupName\"] . \"</option>\\n\";\r\n			\r\n		}\r\n\r\n		$this->Content = $this->Content . \"</select><br>\\n<input type=\\\"submit\\\" name=\\\"ChangeToGroup\\\" value=\\\"Change View To Group\\\"></form><br><br>\";\r\n\r\n		//Next Load Page\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		//load UserRecords\r\n		$query = \"select ODOUsers.UID, ODOUsers.user, ODOUsers.rnameFirst, ODOUsers.rnameLast, ODOUsers.emailadd, ODOUsers.IsEncrypted, ODOUsers.EncIV from ODOUsers, ODOUserGID WHERE ODOUserGID.GID = \" . $grpid . \" AND ODOUsers.UID = ODOUserGID.UID ORDER BY user\";\r\n\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 15;\r\n		$Count = 0;\r\n\r\n		if( ($RecordCount % 15 > 0) ) {\r\n			$NumofPages = intval($NumofPages) + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = $this->Content . \"<center><h4>Select a group of users to view.</h4><br><br></center>\";\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"<br><br><table border=1><TH>User ID</TH><th>User Name</th><th>User\'s Real Name</th><th>User\'s e-mail address</th><th>Select User</th><th>Delete User</th>\";\r\n\r\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n			mysqli_data_seek($TempRecords, $ChangeToRow);\r\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n				$rnameL = \"\";\r\n				$rnameF = \"\";\r\n				$email = \"\";\r\n					\r\n				if(($row[\"IsEncrypted\"] == 1)&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\r\n					$encData = new EncryptedData();\r\n					\r\n					$encData->encArray[\"rnameLast\"] = $row[\"rnameLast\"];\r\n					$encData->encArray[\"rnameFirst\"] = $row[\"rnameFirst\"];\r\n					$encData->encArray[\"emailadd\"] = $row[\"emailadd\"];\r\n					$encData->iv = $row[\"EncIV\"];\r\n\r\n					$encData = $_SESSION[\"ODOUtil\"]->ODODecrypt($encData);\r\n						\r\n					$rnameL = $encData->decArray[\"rnameLast\"];\r\n					$rnameF = $encData->decArray[\"rnameFirst\"];\r\n					$email = $encData->decArray[\"emailadd\"];\r\n						\r\n				} else {\r\n					$rnameL = $row[\"rnameLast\"];\r\n					$rnameF = $row[\"rnameFirst\"];\r\n					$email = $row[\"emailadd\"];\r\n				}\r\n					\r\n					\r\n				$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td>\" . $row[\"UID\"] . \"</td><td>\" . $row[\"user\"] . \"</td><td>\" . $rnameL . \", \" . $rnameF . \"</td><td>\" . $email . \"</td><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n				$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n				$Count = $Count + 1;\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages so we only have up to\r\n			//10 links between the previous and next links\r\n			$NumberofLinks = 1;\r\n			//$i is the current link we are generating\r\n			$i = $CurPage - 4; //at max we are going to generate back 4 links from current\r\n			if($i < 1) { //we should never be generating a 0 or negative page number\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstByGroups&PageNum=\" . ($CurPage - 5) . \"&grpid=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"] . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n			} else {\r\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstByGroups&PageNum=\" . $i . \"&grpid=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"] . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstByGroups&PageNum=\" . ($i+5) . \"&grpid=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"] . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=lstByGroups&PageNum=\" . $NumofPages . \"&grpid=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"grpid\"] . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n\r\n		}\r\n	}\r\n\r\n',0,0,3),(9,'NewUser',_binary '\n	function NewUser() {\n		\n		$this->CurUser = 0;\n		$this->CurUserLogCount = 0;\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\n\n		$this->LoadUserMenus();\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"])) {\n			$this->Content = $this->Content . \"<H3><B>Creating User...\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"</B></H3><br>\";\n			//generate password.\n			$tempPass = $_SESSION[\"ODOUtil\"]->randomstring(10);\n			\n			//check if username already exists.\n			$query = \"select * from ODOUsers where user=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\'\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n		\n			if(mysqli_num_rows($TempRecords) > 0) { \n				$this->Content = $this->Content . \"<br><B>ERROR CREATING USER!: Username already exists!</b></center>\";\n				return;\n			}\n\n			//create user\n			$query = \"insert into ODOUsers (user, pass, rnameLast, rnameFirst, emailadd, Pistemp, ResetQID, ResetA, IsLocked, FailedLogins, IsEncrypted, HashedMode, EncIV) values (\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\', \'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($_SESSION[\"ODOUserO\"]->ODOHash($tempPass, $_SESSION[\"ODOUserO\"]->GetHashMode())) . \"\',\";\n			\n			$fname = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"];\n			$lname = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"];\n			$email = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\n			\n			$IsEncrypted = 0;\n			$EncIV = \"\";\n			\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"]==\"On\")&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\n				//Create EncryptedData container\n				$encData = new EncryptedData();\n				\n				if(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"]) > 0) {\n					$encData->decArray[\"rnameLast\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"];\n				}\n				\n				if(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"]) > 0) {\n					$encData->decArray[\"rnameFirst\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"];\n				}\n				\n				if(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]) > 0) {\n					$encData->decArray[\"emailadd\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\n				}\n				\n				$encData = $_SESSION[\"ODOUtil\"]->ODOEncrypt($encData);\n			\n				if(isset($encData->encArray[\"rnameFirst\"])) {\n					$fname = $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameFirst\"]);\n				}\n				\n				if(isset($encData->encArray[\"rnameLast\"])) {\n					$lname = $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameLast\"]);\n				}\n				\n				if(isset($encData->encArray[\"emailadd\"])) {\n					$email = $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"emailadd\"]);\n				}\n					\n				$EncIV = $GLOBALS[\'globalref\'][1]->EscapeMe($encData->iv);\n				\n			} \n			\n			if(strlen($lname) > 0) {\n				$query = $query . \"\'\" . $lname . \"\',\";\n			} else {\n				$query = $query . \"NULL,\";\n			}\n			\n			if(strlen($fname) > 0) {\n				$query = $query . \"\'\" . $fname . \"\',\";\n			} else {\n				$query = $query . \"NULL,\";\n			}\n			\n			if(strlen($email)>0) {\n				$query = $query . \"\'\" . $email . \"\',\";\n			} else {\n				$query = $query . \"NULL,\";\n			}\n			\n			//Password is temporary on new\n			$query = $query . \"1,\";\n			\n			//confirm rquestion ID\n			\n			$questionquery = \"SELECT * FROM ResetQuestions WHERE ResetQID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"];\n			$questionresult = $GLOBALS[\'globalref\'][1]->Query($questionquery);\n\n			if(mysqli_num_rows($questionresult)>0) {\n				$query .= $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"] . \",\";\n			} else {\n				$query .= \"NULL,\";\n			}\n			\n\n			\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ResetA\"])&&(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ResetA\"])>0)) {\n				$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($_SESSION[\"ODOUserO\"]->ODOHash($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ResetA\"], $_SESSION[\"ODOUserO\"]->GetHashMode())) . \"\',\";\n			} else {\n				$query = $query . \"NULL,\";\n			}\n			\n			//Locked turned off by default on new\n			//Failed logins set to 0 by default\n			$query =  $query . \"0, 0,\";\n			\n			//set IV for user\n			if(strlen($EncIV)>0) {\n				//encryption is on so set it to on\n				$query = $query . \"1,\" . $_SESSION[\"ODOUserO\"]->GetHashMode() . \",\'\" . $EncIV . \"\')\";\n			} else {\n				$query = $query . \"0,\" . $_SESSION[\"ODOUserO\"]->GetHashMode() . \",NULL)\";\n			}\n			\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			//get last UID created\n			$query = \"select * from ODOUsers where user=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\'\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->CurUser = $row[\"UID\"];\n				$Comment = \"User: \" . $row[\"user\"] . \" has been created by Admin: \" . $_SESSION[\"ODOUserO\"]->getUID();\n				$GLOBALS[\'globalref\'][4]->LogEvent(\"USERCREATED\", $Comment, 1);\n			} else {\n				$this->Content = $this->Content . \"<br><B>ERROR CREATING USER!</b></center>\";\n				return;\n			}\n\n			//Now update groups\n			\n			\n						\n			if (isset($_POST[\"GROUPS\"])) {\n				\n				$glist = $_POST[\"GROUPS\"];\n				\n	 			foreach ( $glist as $newgroup)\n				{\n					$query = \"insert into ODOUserGID (GID, UID) values(\" . $GLOBALS[\'globalref\'][1]->EscapeMe($newgroup) . \", \" . $this->CurUser . \")\";\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n			}\n					\n			//email user\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"sendmail\"])) {\n\n				$message = \"Your account has been created at \" . SERVERNAME . \" for userid: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\\nYour new password to login is: \" . $tempPass;\n\n				if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]) < 3) || (!mail($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"], \"Password Reset\", $message))) {\n					$this->Content = $this->Content . \"<B>E-MAIL FAILED TO BE SENT!!!!</B><br>Temp password is: \" . $tempPass;\n				} else {\n					$this->Content = $this->Content . \"<br>The password has been e-mailed to: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\n				}\n			} else {\n				\n				$this->Content = $this->Content . \"<br>No e-mail sent. Temporary password is: \" . $tempPass;\n			}\n\n			$this->Content = $this->Content . \"<br><B>User Created.</B></center>\";\n\n		} else {\n			$this->Content= $this->Content . \"<H3><b>Create New User</B></H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewUser\\\">\\n<table border=1>\\n<tr><td>UserName: </td><td><input type=\\\"text\\\" name=\\\"username\\\" size=\\\"12\\\" maxlength=\\\"20\\\"></td></tr>\\n\";\n\n			$this->Content = $this->Content . \"<tr><td>First Name: </td><td><input type=\\\"text\\\" name=\\\"fname\\\" size=\\\"15\\\" maxlength=\\\"100\\\"></td></tr>\\n<tr><td>Last Name: </td><td><input type=\\\"text\\\" name=\\\"lname\\\" size=\\\"15\\\" maxlength=\\\"100\\\"></td></tr>\\n<tr><td>E-Mail: </td><td><input type=\\\"text\\\" name=\\\"email\\\" size=\\\"25\\\" maxlength=\\\"100\\\"></td></tr>\";\n			\n			$this->Content = $this->Content . \"</TD></TR>\\n<TR><TD>Encryption enabled for user?</TD><TD>\";\n			\n			\n			if($_SESSION[\"ODOUtil\"]->isMcryptAvailable()) {\n				\n				$this->Content = $this->Content . \"<SELECT name=\\\"Encrypted\\\">\\n<option value=\\\"OnKeep\\\" disabled=\\\"disabled\\\">On (Keep current IV)</option>\\n<option value=\\\"On\\\" selected>On (Generate new IV)</option>\\n<option value=\\\"Off\\\">Off</option>\\n</select>\\n</TD></TR>\\n\";\n	\n			} else {\n				\n				$this->Content = $this->Content . \"Encryption is not available on server. <BR><sub>(install mcrypt on server and/or set ENCRYPTODOUSER constant)</sub></TD></TR>\\n\";\n				\n			}\n			\n			\n			//get reset questions available\n			$query = \"SELECT * FROM ResetQuestions\";\n			\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\n						\n			$this->Content = $this->Content . \"<TR><TD>Password Reset Question:</TD><TD>\\n<SELECT NAME=\\\"RQuestion\\\">\\n<OPTION value=\\\"0\\\" selected></OPTION>\\n\";\n			\n			while($row = mysqli_fetch_assoc($result)) {\n				\n				$this->Content = $this->Content . \"<OPTION value=\\\"\" . $row[\"ResetQID\"] . \"\\\">\" . $row[\"ResetQ\"] . \"</OPTION>\";\n\n			}\n\n			$this->Content = $this->Content . \"</SELECT></TD></TR>\\n<tr><td>Reset Answer:</td><td><input type=\\\"text\\\" name=\\\"ResetA\\\" size=\\\"25\\\" maxlength=\\\"100\\\"></td></tr></table><br><br><SELECT name=\\\"GROUPS[]\\\" multiple>\";\n\n			//load full group list\n			$query = \"select * from ODOGroups\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n		\n			while ($row = mysqli_fetch_assoc($TempRecords)) {\n	\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"GID\"] . \"\\\"\" . \">\" . $row[\"GroupName\"] . \"</option>\";\n			}\n		\n			$this->Content = $this->Content . \"</SELECT><br><INPUT TYPE=CHECKBOX NAME=\\\"sendmail\\\">Mail user temp password?<br><br><input type=\\\"submit\\\" name=\\\"Create\\\" value=\\\"Create\\\"></form></center>\";	\n		}\n	}\n\n',0,0,3),(10,'DeleteUser',_binary '\n	function DeleteUser() {\n		\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\n\n		$this->LoadUserMenus();\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"DeleteMe\"])) {\n			\n			$query = \"select * from ODOUsers where UID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"];\n			\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n			\n			if(mysqli_num_rows($TempRecords) < 1) {\n			\n				$this->Content = $this->Content . \"<H3>Username does not exist!</H3><br></center>\";\n\n			} else {\n				\n				//remove user from ODOUsers\n				\n				//delete from user/group table and user table\n				$this->Content = $this->Content . \"<h3>Removing User. Please wait...</h3><br><br>\";\n\n				$query = \"delete from ODOUsers where UID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"];\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n				if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\n					$this->Content = $this->Content . \"<B>Error removing user!</B></center>\";\n					return;\n				}\n				\n				$this->Content = $this->Content . \"<B>User removed! Removing groups please wait....</B><br><br>\";\n				$query = \"delete from ODOUserGID where UID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"];\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n				if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\n					$this->Content = $this->Content . \"<B>Error removing groups!</B></center>\";\n					return;\n				}\n	\n				$this->Content = $this->Content . \"<B>Groups removed from user.</B><br><br><H3>USER REMOVED!</H3></center>\";\n				$Comment = \"User removed from system: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"user\"];\n				$GLOBALS[\'globalref\'][4]->LogEvent(\"USERDELETED\", $Comment, 1);\n				$this->CurUserLogCount = 0;\n				$this->CurUser = 0;\n			}\n\n		} else {\n			//Confirm the deleting...\n			$this->Content = $this->Content . \"<H3>Are you sure you want to delete user: <BR><B>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"user\"] . \"</B></H3><br><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"user\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"DeleteMe\\\" value=\\\"true\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></form>&nbsp;&nbsp;&nbsp;&nbsp;\";\n\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"lstUsers\\\"><input type=\\\"submit\\\" name=\\\"Cancel\\\" value=\\\"Cancel\\\"></form></center>\";\n		}\n\n	}\n\n	',0,0,3),(11,'EditUser',_binary '\n	function EditUser() {\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"])) {\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\n			\n			$this->CurUser = 0;\n			\n			$this->LoadUserMenus();\n			$this->Content = $this->Content . \"<br><H3>User not selected?</H3></center>\";\n			return;\n		}\n\n		\n		$this->CurUser = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"userid\"];\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\n\n		$this->LoadUserMenus();\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n\n			//check if username has changed\n			$query = \"select * from ODOUsers where UID=\" . $this->CurUser;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(mysqli_num_rows($TempRecords) < 1) { \n				$this->Content = $this->Content . \"<br><H3>User not found in database!</H3></center>\";\n				return;\n			}\n\n			$row = mysqli_fetch_assoc($TempRecords);\n	\n			if($row[\"user\"] != $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"]) {\n				//check if new username is already used. \n				$query = \"select * from ODOUsers where user=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\\\"\";\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				if(mysqli_num_rows($TempRecords) > 0) { \n					$this->Content = $this->Content . \"<br><H3>Username is already defined!</H3></center>\";\n					return;\n				}\n			}\n\n			//update database\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"]))&&(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"] == \"On\")||($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"] == \"OnKeep\"))&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\n				\n				//Create EncryptedData container\n				//@TODO add reset question\n				$encData = new EncryptedData();\n				$encData->decArray[\"rnameLast\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"rnameLast\"];\n				$encData->decArray[\"rnameFirst\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"rnameFirst\"];\n				$encData->decArray[\"emailadd\"] = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"emailadd\"];\n				\n				if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Encrypted\"] == \"OnKeep\") {\n					$encData->iv = $this->iv;\n				} \n				\n				$encData = $_SESSION[\"ODOUtil\"]->ODOEncrypt($encData);\n				//@TODO update Question encryption\n				$query = \"UPDATE ODOUsers SET user=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\\\", rnameLast=\\\"\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameLast\"]) . \"\\\", rnameFirst=\\\"\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameFirst\"]) . \"\\\", emailadd=\\\"\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"emailadd\"]) . \"\\\", IsEncrypted=1, EncIV=\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->iv) . \"\', Pistemp=\";\n			\n			} else {\n				\n				$query = \"UPDATE ODOUsers SET user=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"\\\", rnameLast=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"rnameLast\"] . \"\\\", rnameFirst=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"rnameFirst\"] . \"\\\", emailadd=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"emailadd\"] . \"\\\", IsEncrypted=0, EncIV=NULL, Pistemp=\";\n			\n			}\n			\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pistemp\"]) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pistemp\"] == \"Yes\")) {\n				$query = $query . \"1, \";\n			} else {\n				$query = $query . \"0, \";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsLocked\"]) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsLocked\"] == \"Yes\")) {\n				$query = $query . \"IsLocked=1, \";\n			} else {\n				$query = $query . \"IsLocked=0, \";\n			}\n\n			if(is_numeric($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FailedLogins\"])) {\n				$query = $query . \"FailedLogins=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FailedLogins\"];\n			} else {\n				$query = $query . \"FailedLogins=0\";\n			}\n\n			$query = $query . \" WHERE UID=\" . $this->CurUser;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) { \n				$this->Content = $this->Content . \"<H3><b>User has been updated.</b></H3></center>\";\n			} else {\n				$this->Content = $this->Content . \"<H3><B>Unspecified error trying to update user!</B></h3></center>\";\n			}\n\n		} else {\n			$query = \"select IsEncrypted, Pistemp, IsLocked, FailedLogins from ODOUsers WHERE UID=\" . $this->CurUser;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n		\n			if(mysqli_num_rows($TempRecords) < 1) { \n				$this->Content = $this->Content . \"<br><H3>User not found in database!</H3></center>\";\n				return;\n			}\n		\n			$row = mysqli_fetch_assoc($TempRecords);\n		\n			$this->Content = $this->Content . \"<br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $this->CurUser . \"\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditUser\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\">\\n\\n<table border=1>\\n<tr><td>UserID:</td><td>\" . $this->CurUser . \"</td></tr>\\n<tr><td>User Name:</td>\";\n\n			$this->Content = $this->Content . \"<td><input type=\\\"text\\\" name=\\\"username\\\" value=\\\"\" . $this->UserName . \"\\\" maxsize=\\\"20\\\" size=\\\"12\\\"></td></tr>\\n<tr><td>First Name:</td><td><input type=\\\"text\\\" name=\\\"rnameFirst\\\" value=\\\"\" . $this->FName . \"\\\" maxsize=\\\"100\\\" size=\\\"25\\\"></td></tr>\\n<tr><td>Last Name:</td><td><input type=\\\"text\\\" name=\\\"rnameLast\\\" value=\\\"\" . $this->LName . \"\\\" maxsize=\\\"100\\\" size=\\\"25\\\"></td></tr>\\n<tr><td>E-Mail:</td><td><input type=\\\"text\\\" name=\\\"emailadd\\\" value=\\\"\" . $this->email . \"\\\" maxsize=\\\"100\\\" size=\\\"25\\\"></td></tr>\\n<tr><td>Password is Temp?</td><td><select name=\\\"pistemp\\\"><option value=\\\"Yes\\\"\";\n\n			if($row[\"Pistemp\"]) {\n				$this->Content = $this->Content . \" selected>Yes</option><option value=\\\"No\\\">No</option></select>\";\n			} else {\n				$this->Content = $this->Content . \">Yes</option><option value=\\\"No\\\" selected>No</option></select>\";\n			}\n	\n			$this->Content = $this->Content . \"</td></tr>\\n<tr><td>Is Locked</td><td><select name=\\\"IsLocked\\\"><option value=\\\"Yes\\\"\";\n\n			if($row[\"IsLocked\"]) {\n				$this->Content = $this->Content . \" selected>Yes</option><option value=\\\"No\\\">No</option></select>\";\n			} else {\n				$this->Content = $this->Content . \">Yes</option><option value=\\\"No\\\" selected>No</option></select>\";\n			}\n\n			$this->Content = $this->Content . \"</TD></TR>\\n<TR><TD>Encryption enabled for user?</TD><TD>\";\n			\n			\n			if($_SESSION[\"ODOUtil\"]->isMcryptAvailable()) {\n				\n				$this->Content = $this->Content . \"<SELECT name=\\\"Encrypted\\\">\\n<option value=\\\"OnKeep\\\"\";\n				\n				$selectOption = 0;\n				\n				if(isset($row[\"IsEncrypted\"])&&($row[\"IsEncrypted\"]==1)) {\n					\n					if(strlen($this->iv)>0) {\n						$selectOption = 1;\n					} else {\n						$selectOption = 2;\n					}\n										\n				} else {\n					$selectOption = 3;\n				}\n				\n				switch($selectOption) {\n					case 1:\n						$this->Content = $this->Content . \" selected\";\n						break;\n					case 2:\n						$this->Content = $this->Content . \" disabled=\\\"disabled\\\"\";\n						break;\n				}\n				\n				$this->Content = $this->Content . \">On (Keep current IV)</option>\\n<option value=\\\"On\\\"\";\n				\n				switch($selectOption) {\n					case 2:\n						$this->Content = $this->Content . \" selected\";\n						break;\n				}\n				\n				$this->Content = $this->Content . \">On (Generate new IV)</option>\\n<option value=\\\"Off\\\"\";\n				\n				switch($selectOption) {\n					case 3:\n						$this->Content = $this->Content . \" selected\";\n						break;\n				}\n				\n				$this->Content = $this->Content . \">Off</option>\\n</select>\\n\";\n				\n			} else {\n				\n				$this->Content = $this->Content . \"Encryption is not available on server. <BR><sub>(install mcrypt on server and/or set ENCRYPTODOUSER constant)</sub>\";\n				\n			}\n			\n			$this->Content = $this->Content . \"</td></tr><tr><td>Failed Logins</td><td><input type=\\\"text\\\" name=\\\"FailedLogins\\\" value=\\\"\" . $row[\"FailedLogins\"] . \"\\\"></td></tr></table><br><br><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form></center>\";\n		}\n	}\n\n	',0,0,3),(12,'ChangeUserPassword',_binary '	function ChangeUserPassword() {\r\n		\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		if($this->CurUser == 0) {\r\n			$this->Content = $this->Content . \"<br><br><h3><b>You must select a user before you can change their password!</b></h3></center>\";	\r\n			return;\r\n		}\r\n		\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) && (isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"newpass\"])) && (isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"confirmpass\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"newpass\"] == $_SESSION[\"ODOSessionO\"]->EscapedVars[\"confirmpass\"])) {\r\n			//confirm uid exists then update\r\n			$query = \"select * from ODOUsers where UID=\" . $this->CurUser;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($TempRecords) < 1) { \r\n				$this->Content = $this->Content . \"<br><H3>User not found in database!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"UPDATE ODOUsers SET pass=\\\"\" . $GLOBALS[\'globalref\'][1]->EscapeMe($_SESSION[\"ODOUserO\"]->ODOHash($_SESSION[\"ODOSessionO\"]->EscapedVars[\"newpass\"], $_SESSION[\"ODOUserO\"]->GetHashMode())) . \"\\\", Pistemp=1, IsLocked=0, FailedLogins=0, HashedMode=\" . $_SESSION[\"ODOUserO\"]->GetHashMode() . \" where UID=\" . $this->CurUser;\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) { \r\n				$this->Content = $this->Content . \"<br><H3><b>User password updated.</b></h3>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<br><H3><b>User password could not be updated!</b></H3></center>\";\r\n				return;\r\n			}\r\n	\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"sendmail\"])) {\r\n\r\n				$message = \"Your account password has been updated at \" . SERVERNAME . \" for userid: \" . $this->UserName . \"\\nYour new password to login is: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"newpass\"];\r\n\r\n				if((strlen($this->email) < 3) || (!mail($this->email, \"Password Reset\", $message))) {\r\n					$this->Content = $this->Content . \"<B>E-MAIL FAILED TO BE SENT!!!!</B><br>Temp password is: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"newpass\"];\r\n				} else {\r\n					$this->Content = $this->Content . \"<br>The password has been e-mailed to: \" . $this->email;\r\n				}\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</center>\";\r\n\r\n		} else {\r\n		\r\n			$this->Content = $this->Content . \"<br><br><H3><B>Change user password:</B></H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $this->CurUser . \"\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ChangeUserPassword\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\">New Password:<input type=\\\"text\\\" name=\\\"newpass\\\" value=\\\"\";\r\n\r\n			$newpass = $_SESSION[\"ODOUtil\"]->randomstring(10);\r\n\r\n			$this->Content = $this->Content . $newpass . \"\\\" size=12 maxlength=10><br>Confirm New Password:<input type=\\\"text\\\" name=\\\"confirmpass\\\" value=\\\"\" . $newpass . \"\\\" size=12 maxlength=10><br><INPUT TYPE=CHECKBOX NAME=\\\"sendmail\\\">Mail user temp password?<br><br><input type=\\\"submit\\\" name=\\\"Change\\\" value=\\\"Change\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,3),(13,'EditGroups',_binary '\r\n	function EditGroups() {\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		if($this->CurUser == 0) {\r\n			$this->Content = $this->Content . \"<br><br><h3><b>You must select a user before you can change their groups!</b></h3></center>\";	\r\n			return;\r\n		}\r\n		\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) && (isset($_POST[\"GROUPS\"]))) {\r\n			//Now update groups\r\n			$glist = $_POST[\"GROUPS\"];\r\n						\r\n			if ($glist){\r\n				//clear out groups first\r\n				$query = \"DELETE FROM ODOUserGID WHERE UID=\" . $this->CurUser;\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n	 			foreach ( $glist as $newgroup)\r\n				{\r\n					$query = \"insert into ODOUserGID (GID, UID) values(\" . $GLOBALS[\'globalref\'][1]->EscapeMe($newgroup) . \", \" . $this->CurUser . \")\";\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				}\r\n				$this->Content = $this->Content . \"<br><br><H3><b>User groups updated.</b></H3></center>\";\r\n			}\r\n		} else {\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n				//update is true but no groups defined. So we just delete the current groups.\r\n				//clear out groups first\r\n				$query = \"DELETE FROM ODOUserGID WHERE UID=\" . $this->CurUser;\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$this->Content = $this->Content . \"<br><br><H3><b>User groups updated.</b></H3></center>\";\r\n				return;\r\n			}\r\n\r\n			//output form.\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditGroups\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $this->CurUser . \"\\\"><BR><BR><H4>Select your groups for user:</H4><br><sub>Ctrl+click to unselect</sub><br><br><SELECT name=\\\"GROUPS[]\\\" multiple>\";\r\n\r\n			\r\n			//load full group list\r\n			$query = \"select ODOGroups.GID, ODOGroups.GroupName, ODOUserGID.UID from ODOGroups left join ODOUserGID on ODOGroups.GID = ODOUserGID.GID and ODOUserGID.UID=\" . $this->CurUser;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		\r\n			while ($row = mysqli_fetch_assoc($TempRecords)) {\r\n	\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"GID\"] . \"\\\" \";\r\n				if($row[\"UID\"] == $this->CurUser) {\r\n					$this->Content = $this->Content . \"selected\";\r\n				}\r\n				$this->Content = $this->Content . \">\" . $row[\"GroupName\"] . \"</option>\";\r\n			}\r\n		\r\n			$this->Content = $this->Content . \"</SELECT><Br><br><input type=\\\"submit\\\" name=\\\"Change Groups\\\" value=\\\"Change Groups\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n',0,0,3),(14,'ShowUserLogs',_binary '\r\n	function ShowUserLogs() {\r\n	\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		if($this->CurUser != 0){\r\n			\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n			\r\n			if($this->CurUserLogCount==0) {\r\n				$query = \"SELECT count(*) as ULogs FROM ODOLogs WHERE UID=\" . $this->CurUser;\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				if(mysqli_num_rows($TempRecords) > 0) {\r\n					$row = mysqli_fetch_assoc($TempRecords);\r\n					$this->CurUserLogCount = $row[\"ULogs\"];\r\n				} else {\r\n					trigger_error(\"Error: NO LOGS FOR USER!\", E_USER_NOTICE);\r\n					$this->Content = $this->Content . \"<B>NO USER LOGS!</B>\";\r\n					return;\r\n				}\r\n			}\r\n			\r\n			$LimitStart = 0;\r\n			\r\n			if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]  > 1) {\r\n				$LimitStart = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]*20;\r\n			}				\r\n			\r\n			//check bounds first\r\n			$NumofPages = $this->CurUserLogCount / 20;\r\n			$Count = 0;\r\n\r\n			if( ($this->CurUserLogCount % 20 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			\r\n			} else {\r\n			\r\n				$query = \"select * from ODOLogs where UID=\" . $this->CurUser . \" order by TimeStamp DESC LIMIT \" . $LimitStart . \",20\";\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				//simple table format\r\n				$this->Content = $this->Content . \"<table border=1><th>Time Stamp</th><th>Action</th><th>Comment</th><th>Severity</th><th>IP</th>\";\r\n\r\n				while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n					$this->Content = $this->Content . \"<tr><td>\" . $row[\"TimeStamp\"] . \"</td><td>\" . $row[\"ActionDone\"] . \"</td><td>\" . $row[\"Comment\"] . \"</td><td>\" . $row[\"Severity\"] . \"</td><td>\" . $row[\"IP\"] . \"</td></tr>\";\r\n				\r\n					$Count = $Count + 1;\r\n				}\r\n\r\n\r\n				$this->Content = $this->Content . \"</table><BR><BR>\";\r\n				\r\n				\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=ShowUserLogs&userid=\" . $this->CurUser . \"&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=ShowUserLogs&userid=\" . $this->CurUser . \"&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=ShowUserLogs&userid=\" . $this->CurUser . \"&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n			\r\n			}\r\n			\r\n		}\r\n	}\r\n\r\n',0,0,3),(15,'Search',_binary '\r\n	function Search() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSUser\");\r\n\r\n		$this->LoadUserMenus();\r\n\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Search\"])) {\r\n			\r\n			//build query\r\n			$FirstFlag = false;\r\n\r\n			//link url is built if Search was set so when we reach the page links at the bottom\r\n			//everything will be filled in already that needs to be.\r\n			$LinkURL = \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=Search&Search=true\";\r\n\r\n			$query = \"select * from ODOUsers WHERE \";\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"uid\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"uid\"]) > 0)) {\r\n				//Do additional check for isalpha\r\n				if(!(is_numeric($_SESSION[\"ODOSessionO\"]->EscapedVars[\"uid\"]))) {\r\n					trigger_error(\"Invalid userid! UID must be numeric!\");\r\n					return;\r\n				}\r\n\r\n				$query = $query . \"UID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"uid\"] . \" \";\r\n				$LinkURL = $LinkURL . \"&uid=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"uid\"];\r\n				$FirstFlag = true;\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"user LIKE \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"] . \"%\' \";\r\n				$LinkURL = $LinkURL . \"&username=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"username\"];\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"rnameFirst LIKE \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"] . \"%\' \";\r\n\r\n				$LinkURL = $LinkURL . \"&fname=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fname\"];\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"rnameLast LIKE \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"] . \"%\' \";\r\n				$LinkURL = $LinkURL . \"&lname=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"lname\"];\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"emailadd LIKE \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"] . \"%\' \";\r\n				$LinkURL = $LinkURL . \"&email=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\r\n			}\r\n\r\n			$query = $query . \" ORDER BY user\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n			\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n\r\n			if($RecordCount < 1) {\r\n				$this->Content = $this->Content . \"<br><H3>No records match search query...</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<br><br><table border=1><TH>User ID</TH><th>User Name</th><th>User\'s Real Name</th><th>User\'s e-mail address</th><th>Select User</th><th>Delete User</th>\";\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = \"<center><h4>Page number is out of bounds!</h4><br><br></center>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n				while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$rnameL = \"\";\r\n					$rnameF = \"\";\r\n					$email = \"\";\r\n					\r\n					if(($row[\"IsEncrypted\"] == 1)&&($_SESSION[\"ODOUtil\"]->isMcryptAvailable())) {\r\n						$encData = new EncryptedData();\r\n					\r\n						$encData->encArray[\"rnameLast\"] = $row[\"rnameLast\"];\r\n						$encData->encArray[\"rnameFirst\"] = $row[\"rnameFirst\"];\r\n						$encData->encArray[\"emailadd\"] = $row[\"emailadd\"];\r\n						$encData->iv = $row[\"EncIV\"];\r\n\r\n						$encData = $_SESSION[\"ODOUtil\"]->ODODecrypt($encData);\r\n						\r\n						$rnameL = $encData->decArray[\"rnameLast\"];\r\n						$rnameF = $encData->decArray[\"rnameFirst\"];\r\n						$email = $encData->decArray[\"emailadd\"];\r\n						\r\n					} else {\r\n						$rnameL = $row[\"rnameLast\"];\r\n						$rnameF = $row[\"rnameFirst\"];\r\n						$email = $row[\"emailadd\"];\r\n					}\r\n					\r\n					$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td>\" . $row[\"UID\"] . \"</td><td>\" . $row[\"user\"] . \"</td><td>\" . $rnameL . \", \" . $rnameF . \"</td><td>\" . $email . \"</td><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n					$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $row[\"user\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n			\r\n					$Count = $Count + 1;\r\n				}\r\n			\r\n				$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . $LinkURL . \"&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n						//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . $LinkURL . \"&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;\" . $LinkURL . \"&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n			}\r\n	\r\n			$this->Content = $this->Content . \"</center>\";\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<br><H4>Search For User</H4><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Search\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"Search\\\"><table border=1><TR><TD>By UID: </td><td><input type=\\\"text\\\" name=\\\"uid\\\" maxsize=\\\"10\\\" size=\\\"5\\\"></td></tr><tr><TD>User Name:</td><td><input type=\\\"text\\\" name=\\\"username\\\" maxsize=\\\"10\\\" size=\\\"10\\\"></td></tr><tr><td>First Name:</td><td><input type=\\\"text\\\" name=\\\"fname\\\" maxsize=\\\"100\\\" size=\\\"25\\\"></td></tr>\";\r\n\r\n			$this->Content = $this->Content . \"<tr><td>Last Name:</td><td><input type=\\\"text\\\" name=\\\"lname\\\" maxsize=\\\"100\\\" size=\\\"25\\\"></td></tr><tr><td>E-mail Addr:</td><td><input type=\\\"text\\\" name=\\\"email\\\" maxsize=\\\"100\\\" size=\\\"50\\\"></td></tr></table><br><br><input type=\\\"submit\\\" name=\\\"Submit\\\" value=\\\"Search\\\"></form></center>\";\r\n\r\n\r\n		}\r\n\r\n	}\r\n\r\n',0,0,3),(16,'ODOMenuHead',_binary '\r\nclass ODOMenu {\r\n\r\n	var $Position;\r\n	var $NameArray;\r\n	var $URLArray;\r\n	var $ChildrenArray;\r\n	var $ParentArray;\r\n	var $IsHeadArray;\r\n	var $PrevUID;\r\n	var $DepVarArray;\r\n\r\n	function  __construct() {\r\n		//check if UID is set\r\n		$this->Position = 0;\r\n		$this->NameArray = array();\r\n		$this->URLArray = array();\r\n		$this->ChildrenArray = array(array());\r\n		$this->IsHeadArray = array();\r\n		$this->ParentArray = array();\r\n		$this->DepVarArray = array();\r\n\r\n		if($_SESSION[\"ODOUserO\"]->getLoggedIn()) {\r\n			$this->PrevUID = $_SESSION[\"ODOUserO\"]->getUID();\r\n			$this->LoadMenu();\r\n\r\n		}\r\n\r\n	}\r\n\r\n	private function LoadMenu() {\r\n		//first get UID\'s groups\r\n		//next pull all menus group has access rights to\r\n		//filter out duplicates. \r\n		$query = \"SELECT DISTINCT ODOTree.URL, ODOTree.LinkName, ODOTree.ParentID, ODOTree.HeadTag, ODOTree.PriKey, ODOTree.ChildPos, ODOTree.DependVar FROM ODOTree, ODOMenus, ODOUserGID WHERE ODOUserGID.UID = \" . $this->PrevUID . \" AND ODOUserGID.GID = ODOMenus.GID AND ODOMenus.StaticLinkID = ODOTree.PriKey\";\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n	\r\n		while($row = mysqli_fetch_assoc($result)) \r\n		{\r\n			if(strlen($row[\"HeadTag\"]) > 0) {\r\n				$this->IsHeadArray[$row[\"HeadTag\"]] = $row[\"PriKey\"];\r\n			}\r\n			\r\n			$this->NameArray[$row[\"PriKey\"]] = $row[\"LinkName\"];\r\n			$this->URLArray[$row[\"PriKey\"]] = $row[\"URL\"];\r\n			\r\n			if((!is_null($row[\"ParentID\"]))&&($row[\"ParentID\"] != 0)) {\r\n				$this->ChildrenArray[$row[\"ParentID\"]][$row[\"PriKey\"]] = $row[\"ChildPos\"];\r\n				$this->ParentArray[$row[\"PriKey\"]] = $row[\"ParentID\"];\r\n			}\r\n			\r\n			if(isset($row[\"DependVar\"]) ) {\r\n				$this->DepVarArray[$row[\"PriKey\"]] = $row[\"DependVar\"];\r\n			}\r\n			\r\n		}\r\n		\r\n		//sort all children arrays\r\n		foreach($this->NameArray as $ID=>$Value) {\r\n			if(isset($this->ChildrenArray[$ID])) {\r\n				asort($this->ChildrenArray[$ID], SORT_NUMERIC);\r\n			}\r\n		}\r\n		\r\n		\r\n	}\r\n\r\n\r\n\r\n	function GetMenu($LinkID, $Levels, $ChildFlag = false) {\r\n\r\n		if($Levels > 99) {\r\n			//per the PHP documentation: Recursive functions that are called 100 times or more\r\n			//can crash the stack.\r\n			return \"Error building tree\";\r\n		}\r\n\r\n		$RValue = \"\";\r\n\r\n		if(isset($this->NameArray[$LinkID])) {\r\n		\r\n			\r\n			if($Levels == 0) {\r\n				$RValue = \"<li><a href=\\\"\" . $this->URLArray[$LinkID] . \"\\\">\" . $this->NameArray[$LinkID] . \"</a></li>\\n\";\r\n				return $RValue;\r\n			} else {\r\n				if(!$ChildFlag) {\r\n					$RValue = \"<ul>\";\r\n				}\r\n			\r\n				if(strlen($this->URLArray[$LinkID]) > 0) {\r\n					$RValue = $RValue . \"<li><a href=\\\"\" . $this->URLArray[$LinkID] . \"\\\">\" . $this->NameArray[$LinkID] . \"</a></li>\";\r\n				} else {\r\n					$RValue = $RValue . \"<li>\" . $this->NameArray[$LinkID] . \"</li>\";\r\n				}\r\n				\r\n				if(isset($this->ChildrenArray[$LinkID])) {\r\n					$RValue = $RValue . \"<ul>\";\r\n\r\n					foreach($this->ChildrenArray[$LinkID] as $ID=>$Value){\r\n						$RValue = $RValue . $this->GetMenu($ID, ($Levels-1), 1);\r\n					}\r\n					\r\n					$RValue = $RValue . \"</ul>\";\r\n				}\r\n\r\n				if(!$ChildFlag) {\r\n					$RValue = $RValue . \"</ul>\";\r\n				}\r\n			}\r\n		} else {\r\n			return $RValue;\r\n		}			\r\n		\r\n		return $RValue;\r\n	}\r\n\r\n	function GetPathFromLastPosition() {\r\n		$RValue = \"\";\r\n		$tempPos = $this->Position;\r\n		while(isset($this->ParentArray[$tempPos])) {\r\n\r\n			if(strlen($this->NameArray[$tempPos]) > 0) {\r\n				\r\n				$RValue = $this->NameArray[$tempPos] . $RValue;	\r\n				if(strlen($this->URLArray[$LinkID]) > 0) {\r\n					$RValue = \"<a href=\\\"\" . $this->URLArray[$LinkID] . \"\\\">\" . $RValue . \"</a>\";\r\n				}\r\n				$RValue = \">\" . $RValue;\r\n\r\n			} //else we do nothing since only Tag is set then\r\n			$tempPos = $this->ParentArray[$tempPos];\r\n		}\r\n		\r\n		return $RValue;\r\n	}\r\n\r\n	function SetPosition($NewPos) {\r\n		\r\n		if(is_numeric($NewPos)) {\r\n			$this->Position = $NewPos;\r\n		}\r\n\r\n	}\r\n\r\n	function FullMenu($HeadTag) {\r\n		$RValue = \"\";\r\n		//get position\r\n		$Pos = 0;\r\n		$tempArray = array();\r\n		$LevelCount = 0;\r\n		$LevelArray = array();\r\n\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n			$RValue = \"<ul>\";\r\n			$Pos = $this->IsHeadArray[$HeadTag];\r\n			array_push($tempArray, $Pos);\r\n			$LevelArray[$LevelCount] = 0;\r\n\r\n			while(count($tempArray) > 0) {\r\n				$Pos = array_pop($tempArray);\r\n				$RValue = $RValue . \"<li>\";\r\n				if(strlen($this->URLArray[$Pos]) > 0) {\r\n					$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$Pos] . \"\\\">\" . $this->NameArray[$Pos] . \"</a>\";\r\n				} else {\r\n					$RValue = $RValue . $this->NameArray[$Pos];\r\n				}\r\n			\r\n				if(isset($this->ChildrenArray[$Pos])) {\r\n					$RValue = $RValue . \"<UL>\";\r\n					$LevelCount = $LevelCount + 1;\r\n					foreach($this->ChildrenArray[$Pos] as $ID=>$Value){\r\n						array_push($tempArray, $ID);\r\n						$LevelArray[$LevelCount] = $LevelArray[$LevelCount] + 1;\r\n					}\r\n\r\n				} else {\r\n					if($LevelArray[$LevelCount] > 1) {\r\n						$RValue = $RValue . \"</LI>\";\r\n						$LevelArray[$LevelCount] = $LevelArray[$LevelCount] - 1;\r\n					} else {\r\n						$LevelArray[$LevelCount] = $LevelArray[$LevelCount] - 1;\r\n						$LevelCount = $LevelCount - 1;\r\n						$RValue = $RValue . \"</LI></UL>\";\r\n					}\r\n				}\r\n\r\n			}\r\n			\r\n			return $RValue;\r\n\r\n		} else {\r\n			return $RValue;\r\n		}\r\n		\r\n		\r\n	}\r\n\r\n	function OneLevel($PageID) {\r\n		$RValue = GetMenu($PageID, 1);\r\n		return $RValue;\r\n	}\r\n\r\n	function GetODOLeftMenu($HeadTag) {\r\n\r\n		$i = 0;\r\n		$RValue = \"<div class=\\\"ODOmenuLeft\\\">\\n<ul>\";\r\n	\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n			foreach($this->ChildrenArray[$this->IsHeadArray[$HeadTag]] as $ID=>$Value) {\r\n				if($i == 0) {\r\n					$RValue = $RValue . \"\\n<li class=\\\"menuLeftHead\\\">\";\r\n				} else {\r\n					$RValue = $RValue . \"\\n<li>\";\r\n				}\r\n				\r\n				$RValue = $RValue . \"<a id=\\\"leftsubmenu\" . $i . \"a\\\" href=\\\"javascript:leftmOpenClose(\'leftsubmenu\" . $i . \"\', \'leftsubmenu\" . $i . \"a\')\\\">\" . $this->NameArray[$ID] . \"</a>\";\r\n				\r\n				\r\n				if(isset($this->ChildrenArray[$ID])) {\r\n					$RValue = $RValue . \"\\n<ul id=\\\"leftsubmenu\" . $i . \"\\\">\";\r\n					foreach($this->ChildrenArray[$ID] as $Child=>$CValue) {\r\n						$RValue = $RValue . \"\\n<li>\";\r\n						if(isset($this->URLArray[$Child])) {\r\n							$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$Child] . \"\\\">\" . $this->NameArray[$Child] . \"</a>\\n\";\r\n						} else {\r\n							$RValue = $RValue . $this->NameArray[$Child];\r\n						}\r\n						$RValue = $RValue . \"\\n</li>\";\r\n					}\r\n					$RValue = $RValue . \"\\n</ul>\";\r\n				}\r\n				$RValue = $RValue . \"</li>\";\r\n				$i++;\r\n			}\r\n\r\n		}\r\n		\r\n		$RValue = $RValue . \"</ul></div>\\n\";\r\n\r\n		//check if user is logged in. If they are then post logout and admin function link\r\n		//if they aren\'t then post link to login if on admin page? If not on Admin page then check for flag\r\n		if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (!$_SESSION[\"ODOUserO\"]->getIsGuest())) {\r\n			$RValue = $RValue . \"<br><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"DefaultLogOut\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOUserO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"LogoutPublic\\\"><input type=\\\"hidden\\\" name=\\\"ObjectOnlyOutput\\\" value=\\\"1\\\"><input type=\\\"hidden\\\" name=\\\"PromptUser\\\" value=\\\"1\\\"><input type=\\\"submit\\\" name=\\\"Logout\\\" value=\\\"Logout\\\"></form><br>\";\r\n		} elseif((!$_SESSION[\"ODOPageO\"]->IsAdmin) && (ALLOWUSERANYPAGELOGIN)) {\r\n			$RValue = $RValue . \"<br><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"\" . $_SESSION[\"ODOPageO\"]->PageID . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOUserO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"Login\\\"><input type=\\\"hidden\\\" name=\\\"ObjectOnlyOutput\\\" value=\\\"1\\\"><input type=\\\"submit\\\" name=\\\"Login\\\" value=\\\"Login\\\"></form>\";\r\n		} else {\r\n			//we don\'t want to do anything otherwise\r\n		}\r\n\r\n		return $RValue;\r\n	}\r\n\r\n	function GetODOTopMenu($HeadTag) {\r\n\r\n		$RValue = \"<B>MENU TAG NOT FOUND</B>\";		\r\n		$DepVar = false;\r\n		$DepVarSet = false;\r\n		\r\n		\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n\r\n			$RValue = \"<div class=\\\"ODOmenuTopSt\\\">\\n<ul>\\n\";\r\n			//level 1\r\n			foreach($this->ChildrenArray[$this->IsHeadArray[$HeadTag]] as $ID=>$Value) {\r\n				//reset\r\n				$DepVar = false;\r\n				$DepVarSet = false;\r\n				$DepVar2 = false;\r\n				$DepVarSet2 = false;\r\n				$DepVar3 = false;\r\n				$DepVarSet3 = false;\r\n				\r\n				//check for conditional var\r\n				if(isset($this->DepVarArray [$ID])) {\r\n						$DepVar = true;\r\n				} \r\n				\r\n				if($DepVar) {\r\n			\r\n					if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$ID]])) {\r\n						$DepVarSet = true;\r\n					}\r\n					\r\n				}\r\n					\r\n				if((!$DepVar)||(($DepVar)&&($DepVarSet))) {\r\n					\r\n					$RValue = $RValue . \"<li>\";\r\n					\r\n				\r\n					if(strlen($this->URLArray[$ID]) > 0) {\r\n						$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$ID];\r\n						if($DepVarSet) {\r\n							$RValue = $RValue . \"&\" . $this->DepVarArray[$ID] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$ID]);\r\n						}\r\n						$RValue = $RValue . \"\\\">\" . $this->NameArray[$ID] . \"</a>\";\r\n					} else {\r\n						$RValue = $RValue . \"<a href=\\\"#\\\" >\" . $this->NameArray[$ID] . \"</a>\";\r\n					}\r\n\r\n					if(isset($this->ChildrenArray[$ID])) {\r\n						$RValue = $RValue . \"\\n<ul>\";\r\n						//level 2\r\n						foreach($this->ChildrenArray[$ID] as $Child=>$CValue) {\r\n							//reset this level\r\n							$DepVar2 = false;\r\n							$DepVarSet2 = false;\r\n								\r\n							//check for conditional var\r\n							if(isset($this->DepVarArray [$Child])) {\r\n								$DepVar2 = true;\r\n							} \r\n				\r\n							if($DepVar2) {\r\n			\r\n								if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$Child]])) {\r\n									$DepVarSet2 = true;\r\n								}\r\n					\r\n							}\r\n					\r\n							if((!$DepVar2)||(($DepVar2)&&($DepVarSet2))) {\r\n								$RValue = $RValue . \"\\n<li>\";\r\n								if(isset($this->URLArray[$Child])) {\r\n									$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$Child];\r\n									if($DepVarSet2) {\r\n										$RValue = $RValue . \"&\" . $this->DepVarArray[$Child] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$Child]);\r\n									}\r\n									$RValue = $RValue . \"\\\">\" . $this->NameArray[$Child] . \"</a>\";\r\n								} else {\r\n									$RValue = $RValue . \"<a href=\\\"#\\\">\" . $this->NameArray[$Child] . \"</a>\" ;\r\n								}\r\n						\r\n								if(isset($this->ChildrenArray[$Child])) {\r\n									$RValue = $RValue . \"\\n<ul>\";\r\n									//level 3\r\n									foreach($this->ChildrenArray[$Child] as $ChildThree=>$CValueThree) {\r\n										//reset this level\r\n										$DepVar3 = false;\r\n										$DepVarSet3 = false;\r\n										\r\n										//check for conditional var\r\n										if(isset($this->DepVarArray [$ChildThree])) {\r\n											$DepVar3 = true;\r\n										} \r\n				\r\n										if($DepVar3) {\r\n			\r\n											if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[$this->DepVarArray[$ChildThree]])) {\r\n												$DepVarSet3 = true;\r\n											}\r\n					\r\n										}\r\n					\r\n										if((!$DepVar3)||(($DepVar3)&&($DepVarSet3))) {\r\n			\r\n											$RValue = $RValue . \"\\n<li>\";\r\n											if(isset($this->URLArray[$ChildThree])) {\r\n												$RValue = $RValue . \"<a href=\\\"\" . $this->URLArray[$ChildThree];\r\n												if($DepVarSet3) {\r\n													$RValue = $RValue . \"&\" . $this->DepVarArray[$ChildThree] . \"=\" . $_SESSION[\"ODOUtil\"]->ODOUrlEncode($this->DepVarArray[$ChildThree]);\r\n												}\r\n												$RValue = $RValue . \"\\\">\" . $this->NameArray[$ChildThree] . \"</a>\";\r\n											} else {\r\n												$RValue = $RValue . \"<a href=\\\"#\\\">\" . $this->NameArray[$ChildThree] . \"</a>\" ;\r\n											}\r\n						\r\n											$RValue = $RValue . \"</li>\";\r\n										}\r\n									}\r\n									\r\n									$RValue = $RValue . \"\\n</ul>\";\r\n								}\r\n								$RValue = $RValue . \"</li>\";\r\n							}\r\n						}\r\n						$RValue = $RValue . \"\\n</ul>\";\r\n					}\r\n					$RValue = $RValue . \"</li>\";\r\n				}\r\n				\r\n			\r\n			}\r\n			\r\n			$RValue = $RValue . \"</ul></div>\\n\";\r\n		}\r\n		\r\n		return $RValue;\r\n		\r\n	}\r\n\r\n//header\r\n\r\n',1,0,2),(17,'ODOMenuFoot',_binary '\r\n//footer\r\n	function __wakeup() {\r\n		if(!$_SESSION[\"ODOUserO\"]->getLoggedIn()) {\r\n			//then unset everything\r\n			\r\n			unset($this->Position);\r\n			unset($this->NameArray);\r\n			unset($this->URLArray);\r\n			unset($this->ChildrenArray);\r\n			unset($this->IsHeadArray);\r\n			unset($this->PrevUID);\r\n			unset($this->ParentArray);\r\n\r\n		} else {\r\n			\r\n			if($this->PrevUID != $_SESSION[\"ODOUserO\"]->getUID()) {\r\n				unset($this->Position);\r\n				unset($this->NameArray);\r\n				unset($this->URLArray);\r\n				unset($this->ChildrenArray);\r\n				unset($this->IsHeadArray);\r\n				unset($this->PrevUID);\r\n				unset($this->ParentArray);\r\n\r\n				$this->Position = 0;\r\n				$this->NameArray = array();\r\n				$this->URLArray = array();\r\n				$this->ChildrenArray = array(array());\r\n				$this->IsHeadArray = array();\r\n				$this->ParentArray = array();\r\n\r\n				$this->PrevUID = $_SESSION[\"ODOUserO\"]->getUID();\r\n				$this->LoadMenu();\r\n			}\r\n\r\n		}\r\n\r\n	}\r\n\r\n\r\n\r\n}\r\n\r\n',0,1,2),(18,'ODOCMSPagesHead',_binary '\r\nclass ODOCMSPages {\r\n	var $Content;\r\n	var $SelectedPage;\r\n	var $PageName;\r\n	var $Author;\r\n	var $CreateDate;\r\n	var $LastMod;\r\n	var $LastModDate;\r\n	var $IsDynamic;\r\n	var $IsAdmin;\r\n	var $ModID;\r\n	\r\n	\r\n	function  __construct() {\r\n		$this->Content = \"\";\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"])) {\r\n			$this->SelectedPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"];\r\n			$this->SelectPage($this->SelectedPage); \r\n			\r\n		} else {\r\n			$this->ClearPage();\r\n		}\r\n	\r\n	}\r\n\r\n	private function ClearPage() {\r\n		$this->SelectedPage = 0;\r\n		$this->PageName = \"\";\r\n		$this->Author = \"\";\r\n		$this->CreateDate = \"\";\r\n		$this->LastMod = \"\";\r\n		$this->LastModDate = \"\";\r\n		$this->IsDynamic = 0;\r\n		$this->IsAdmin = 0;\r\n		$this->ModID = 0;\r\n		\r\n	}\r\n\r\n	private function SelectPage($PageID) {\r\n		//sets info for this object\r\n		$query = \"select * from ODOPages where PageID=\" . $GLOBALS[\'globalref\'][1]->EscapeMe($PageID);\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!mysqli_num_rows($result)) {\r\n			ClearPage();\r\n			return false;\r\n		} else {\r\n\r\n			$row = mysqli_fetch_assoc($result);\r\n			\r\n			$this->SelectedPage = $PageID;\r\n			$this->PageName = $row[\"PageName\"];\r\n			$this->Author = $row[\"Author\"];\r\n			$this->CreateDate = $row[\"CreatedDate\"];\r\n			$this->LastMod = $row[\"LastModBy\"];\r\n			$this->LastModDate = $row[\"LastModDate\"];\r\n			$this->IsDynamic = $row[\"IsDynamic\"];\r\n			$this->IsAdmin = $row[\"IsAdmin\"];\r\n			$this->ModID = $row[\"ModID\"];\r\n			return true;\r\n		}\r\n\r\n	}\r\n\r\n	//******************************************************************************//\r\n	//Function: ODOCMSPages::LoadODOMenus($MenuType)				//\r\n	//Parameters: MenuType-integer: simple select statement choses the menu 	//\r\n	//type to output								//\r\n	//Description: Used by every ODO Object to create content to be displayed	//\r\n	//for menus only								//\r\n	//******************************************************************************//\r\n	function LoadODOMenus() {\r\n		\r\n		//menu Page Selection\r\n		//New Page\r\n		//->Edit Page\r\n		//->List Pages\r\n		//->Pages By Category\r\n		//->Search\r\n		\r\n		//menu Categories\r\n		//Categories\r\n		//->New Category\r\n		//->Delete a Category\r\n		//->List All Categories\r\n		\r\n		//Permissions\r\n		//Menu Placement\r\n		if($this->SelectedPage != 0)\r\n		{\r\n			\r\n			$this->Content = $this->Content . \"<br><table border=1><TR><TH><B>Selected Page</B></TR></TH><TR><TD>Page Name: \" . $this->PageName . \"</TD><TD>PageID: \" . $this->SelectedPage . \"</td></tr>\\n\";\r\n			$this->Content = $this->Content . \"<TR><TD>Author: \" . $this->Author . \"</td><td>Created Date: \" . $this->CreateDate . \"</td></tr>\\n\";\r\n			$this->Content = $this->Content . \"<TR><TD>Last Modified By (UID): \" . $this->LastMod . \"</td><td>Last Mod Date: \" . $this->LastModDate . \"</td></tr>\\n</table>\\n\";\r\n\r\n		}\r\n\r\n		\r\n\r\n	}\r\n\r\n//end header\r\n\r\n',1,0,4),(19,'ODOCMSPagesFoot',_binary '\r\n//footer\r\n\r\n	function __sleep() {\r\n		$this->Content = \"\";\r\n		$this->PageName = \"\";\r\n		$this->Author = \"\";\r\n		$this->CreateDate = \"\";\r\n		$this->LastMod = \"\";\r\n		$this->LastModDate = \"\";\r\n		$this->IsDynamic = 0;\r\n		$this->IsAdmin = 0;\r\n		$this->ModID = 0;\r\n			\r\n		return( array_keys( get_object_vars( $this ) ) );\r\n	}\r\n	\r\n	function __wakeup() {\r\n		\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"] != 0)) {\r\n			$this->SelectedPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"];\r\n			$this->SelectPage($this->SelectedPage); \r\n			\r\n		} else {\r\n			$this->ClearPage();\r\n		}\r\n	\r\n	}\r\n\r\n}\r\n\r\n',0,1,4),(22,'ListCat',_binary '\r\n	//*******************************************************\r\n	//Name: ListCat\r\n	//Desc: This will allow a user to add pages to a Category or remove\r\n	//a page from a Category. \r\n	function ListCat() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if($this->SelectedPage == 0) {\r\n			$this->Content = $this->Content . \"<Center><H3>You need to select a page first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			\r\n			$glist = $_POST[\'Cats\'];\r\n						\r\n			$query = \"DELETE FROM PagesIsOfCats WHERE PageID=\" . $this->SelectedPage;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			\r\n			if ($glist){\r\n	 			foreach ( $glist as $newcat)\r\n				{\r\n					\r\n					$query = \"insert into PagesIsOfCats (CatID, PageID) values(\" . $newcat . \",\" . $this->SelectedPage . \")\";\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				}\r\n			}\r\n						\r\n			$this->Content = $this->Content . \"<center><H3>Categories for page updated!</H3></center>\";\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<center><br>\\n<H3>Categories Page Is In</H3><br>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $this->SelectedPage . \"\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ListCat\\\"><SELECT name=\\\"Cats[]\\\" multiple>\";\r\n\r\n			$query = \"SELECT PageCategories.CatID, PageCategories.Name, PagesIsOfCats.PageID FROM PageCategories LEFT JOIN PagesIsOfCats ON PageCategories.CatID=PagesIsOfCats.CatID AND PagesIsOfCats.PageID=\" . $this->SelectedPage;\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"\\n<option value=\\\"\" . $row[\"CatID\"] . \"\\\"\";\r\n				if($row[\"PageID\"] == $this->SelectedPage) {\r\n					$this->Content = $this->Content . \" selected\";\r\n				}\r\n				$this->Content = $this->Content . \">\" . $row[\"Name\"] . \"</option>\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"\\n</SELECT><br>\\n<input type=\\\"submit\\\" name=\\\"ChgCat\\\" value=\\\"Update\\\"></form></center>\";\r\n		}\r\n		\r\n	}\r\n\r\n',0,0,4),(23,'DeleteCat',_binary 'function DeleteCat() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$CatID = 0;\r\n		if (isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n			$CatID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n		} \r\n\r\n		//if no cat is selected then show a list of cats and number of pages in.\r\n		if($CatID == 0) {\r\n			//output cats in pages.\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n\r\n			//load UserRecords\r\n			$query = \"SELECT PageCategories.CatID, PageCategories.Name, PageCategories.Description, count(*) from PageCategories LEFT JOIN PagesIsOfCats ON PageCategories.CatID = PagesIsOfCats.CatID group by PageCategories.CatID\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			if($RecordCount == 0) {\r\n				$this->Content = $this->Content . \"<BR><H3>No Categories Found!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n\r\n				$this->Content = $this->Content . \"<br>\\n<H2>Page Category List</H2><br><br><table border=1><TH>Category Name</TH><TH>Category Description</TH><TH>Number of Pages</TH><TH>Delete Category</TH>\";\r\n				while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$this->Content = $this->Content . \"\\n<TR><td>\" . $row[\"Name\"]. \"</td><td>\" . $row[\"Description\"] . \"</td><td>\" . $row[\"count(*)\"] . \"</td><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteCat\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $row[\"CatID\"] . \"\\\"><td><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></form></TR>\";\r\n\r\n					$Count = $Count + 1;\r\n				}\r\n				\r\n				$this->Content = $this->Content . \"</table>\\n\\n<br><br>\";\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=DeleteCat&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=DeleteCat&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=DeleteCat&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n			}\r\n\r\n		} else {\r\n			//data validation\r\n			$query = \"SELECT * FROM PageCategories WHERE CatID=\" . $CatID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($TempRecords) > 0) {\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConfirmDel\"])) {\r\n					$query = \"DELETE FROM PageCategories WHERE CatID=\" . $CatID;\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		\r\n					$query = \"DELETE FROM PagesIsOfCats WHERE CatID=\" . $CatID;\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n					$this->Content = $this->Content . \"<BR><H3>Category has been deleted!</H3></center>\";\r\n				} else {\r\n					$row = mysqli_fetch_assoc($TempRecords);\r\n					$this->Content = $this->Content . \"<BR><H3>Are you sure you want to delete Category <B>\" . $row[\"Name\"] . \"</B></H3><br><br><table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteCat\\\"><input type=\\\"hidden\\\" name=\\\"ConfirmDel\\\" value=\\\"1\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $row[\"CatID\"] . \"\\\"><td><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteCat\\\"><TD><input type=\\\"submit\\\" name=\\\"No\\\" value=\\\"No\\\"></TD></form></TR></table></center>\";\r\n\r\n				}\r\n			} else {\r\n				$this->Content = $this->Content . \"<H3>Category ID does not exist!</H3></center>\";\r\n			}\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,4),(24,'NewCat',_binary '\n	function NewCat() {\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateNew\"])) {\n			//check to make sure Cat Doesn\'t exist.\n			$query = \"SELECT * FROM PageCategories WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatName\"] . \"\'\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(mysqli_num_rows($TempRecords) > 0) {\n				$this->Content = $this->Content . \"<br>\\n<H3>Category already exists.</H3>\\n<br>\";\n				return;\n			} \n\n			$query = \"INSERT INTO PageCategories (Name, Description) values (\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatName\"] . \"\', \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatDesc\"] . \"\')\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\n				$this->Content = $this->Content . \"<center><br>\\n<B>Category added</B></center>\";\n				\n				$query = \"SELECT * FROM PageCategories WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatName\"] . \"\'\";\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				$row = mysqli_fetch_assoc($TempRecords);\n						\n			\n				\n			} else {\n				trigger_error(\"There was an error adding the new Category...\", E_USER_ERROR);\n			}\n			\n\n		} else {\n			$this->Content = $this->Content . \"<center><br>\\n<H3>Create New Category</H3><br>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"CreateNew\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewCat\\\"><table border=1>\\n<TR><TD>Category Name:</TD><TD><input type=\\\"text\\\" name=\\\"CatName\\\" maxlength=\\\"254\\\" size=\\\"10\\\"></TD></TR>\\n<TR><TD>Category Description: </TD><TD><input type=\\\"text\\\" name=\\\"CatDesc\\\" maxlength=\\\"254\\\" size=\\\"20\\\"></TD></TR>\\n</table><br>\\n<input type=\\\"submit\\\" name=\\\"Create\\\" value=\\\"Create\\\"></form></center>\";\n\n		}\n\n	}\n\n	',0,0,4),(25,'SearchPages',_binary '\r\n	function SearchPages() {\r\n\r\n		$this->ClearPage();\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Search\"])) {\r\n			\r\n			//build query\r\n			$FirstFlag = false;\r\n\r\n			//link url is built if Search was set so when we reach the page links at the bottom\r\n			//everything will be filled in already that needs to be.\r\n			$LinkURL = \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=SearchPages&Search=true\";\r\n\r\n			$query = \"select * from ODOPages WHERE \";\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageID\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageID\"]) > 0)) {\r\n				$query = $query . \"PageID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageID\"] . \" \";\r\n				$LinkURL = $LinkURL . \"&PageID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageID\"];\r\n				$FirstFlag = true;\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"PageName LIKE \'%\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"%\' \";\r\n				$LinkURL = $LinkURL . \"&PageName=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"];\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"PageDesc LIKE \'%\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"] . \"%\' \";\r\n				$LinkURL = $LinkURL . \"&PageDesc=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"];\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"] != \"DoNotCheck\")) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"IsDynamic=\";\r\n				$LinkURL = $LinkURL . \"&IsDynamic=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"];\r\n				//we\'re doing a string comparison here because the variable should not contain more\r\n				//than one type int/string. The variable has to be string because of the DoNotCheck value.\r\n				if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"] == \"1\") {\r\n					$query = $query . \"1 \";\r\n					\r\n				} else {\r\n					$query = $query . \"0 \";\r\n					\r\n				}\r\n\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"] != \"DoNotCheck\")) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"IsAdmin=\";\r\n				$LinkURL = $LinkURL . \"&IsAdmin=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"];\r\n				//we\'re doing a string comparison here because the variable should not contain more\r\n				//than one type int/string. The variable has to be string because of the DoNotCheck value.\r\n				if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"] == \"1\") {\r\n					$query = $query . \"1 \";\r\n					\r\n				} else {\r\n					$query = $query . \"0 \";\r\n					\r\n				}\r\n\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"ModID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"] . \" \";\r\n				$LinkURL = $LinkURL . \"&ModID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"];\r\n			} else {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"ModID<>100 \";\r\n			}\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Author\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Author\"]) > 0)) {\r\n				if($FirstFlag) {\r\n					$query = $query . \"AND \";\r\n				} else { \r\n					$FirstFlag = true;\r\n				}\r\n				$query = $query . \"Author=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Author\"] . \" \";\r\n				$LinkURL = $LinkURL . \"&Author=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Author\"];\r\n			}\r\n\r\n			if(!$FirstFlag) {\r\n				$this->Content = $this->Content . \"<B>You must select a search value to search by! Please try again!</B></center>\";\r\n				\r\n				return;	\r\n			}\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n			\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n\r\n			if($RecordCount < 1) {\r\n				$this->Content = $this->Content . \"<br><H3>No records match search query...</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<br><br><table border=1><TH>Page ID</TH><th>Page Name</th><th>Page Description</th><TH>Mod ID</TH><th>Page Author ID</th><th>Created Date</th><TH>Edit Page</TH><th>Delete Page</th>\";\r\n\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n				while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPage\\\"><input type=\\\"hidden\\\" name=\\\"PageID\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><TD>\" . $row[\"PageID\"] . \"</TD><td>\" . $row[\"PageName\"] . \"</td><td>\" . $row[\"PageDesc\"] . \"</td><td>\" . $row[\"ModID\"] . \"</td><td>\" . $row[\"Author\"] . \"</td><td>\" . $row[\"CreatedDate\"] . \"</TD><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n					$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePage\\\"><input type=\\\"hidden\\\" name=\\\"PageID\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n			\r\n					$Count = $Count + 1;\r\n				}\r\n			\r\n				$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . $LinkURL . \"&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n						//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . $LinkURL . \"&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;\" . $LinkURL . \"&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n			}\r\n			\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<br><H3>Search For Pages</H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Search\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"SearchPages\\\"><table border=1><TR><TD>By PageID: </td><td><input type=\\\"text\\\" name=\\\"PageID\\\" maxsize=\\\"10\\\" size=\\\"5\\\"></td></tr><tr><TD>Page Name:</td><td><input type=\\\"text\\\" name=\\\"PageName\\\" maxsize=\\\"254\\\" size=\\\"10\\\"></td></tr><tr><td>Page Description Has:</td><td><input type=\\\"text\\\" name=\\\"PageDesc\\\" maxsize=\\\"254\\\" size=\\\"25\\\"></td></tr><tr><td>Dynamic flag:</td><td><SELECT name=\\\"IsDynamic\\\"><option value=\\\"1\\\">Yes</option>&nbsp;<option value=\\\"0\\\">No</option><option value=\\\"DoNotCheck\\\" selected>Do Not Check</option></SELECT></td></tr>\";\r\n\r\n			$this->Content = $this->Content . \"<tr><td>Admin flag:</td><td><SELECT name=\\\"IsAdmin\\\"><option value=\\\"1\\\">Yes</option>&nbsp;<option value=\\\"0\\\">No</option><option value=\\\"DoNotCheck\\\" selected>Do Not Check</option></SELECT></td></tr><tr><td>Module ID:</td><td><input type=\\\"text\\\" name=\\\"ModID\\\" maxsize=\\\"10\\\" size=\\\"5\\\"></td></tr><tr><td>Author ID:</td><td><input type=\\\"text\\\" name=\\\"Author\\\" maxsize=\\\"10\\\" size=\\\"5\\\"></td></tr></table><br><br><input type=\\\"submit\\\" name=\\\"Submit\\\" value=\\\"Search\\\"></form></center>\";\r\n\r\n\r\n		}\r\n	}\r\n	\r\n	',0,0,4),(26,'CatView',_binary '	//************************************************************\r\n	//ob: ODOMCSPages\r\n	//fn: CatView\r\n	//Description: This will list all Pages in the system grouped\r\n	//by their categories. \r\n	//*************************************************************\r\n	function CatView() {\r\n\r\n		$this->ClearPage();\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$CatID = 0;\r\n\r\n		if (isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n			$CatID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n		} \r\n\r\n		//if no cat is selected then show a list of cats and number of pages in.\r\n		if($CatID == 0) {\r\n			//output cats in pages.\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n\r\n			//load UserRecords\r\n			$query = \"SELECT PageCategories.CatID, PageCategories.Name, PageCategories.Description, count(*) from PageCategories, PagesIsOfCats where PageCategories.CatID = PagesIsOfCats.CatID group by PageCategories.CatID\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n\r\n				$this->Content = $this->Content . \"<BR><H2>Category View</H2><br>\\n<table border=1><TR><TH>Category Name</TH><TH>Category Description</TH><TH>Number of Pages</TH><TH>View List</TH></TR>\";\r\n				while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$this->Content = $this->Content . \"\\n<TR><td>\" . $row[\"Name\"]. \"</td><td>\" . $row[\"Description\"] . \"</td><td>\" . $row[\"count(*)\"] . \"</td><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"CatView\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $row[\"CatID\"] . \"\\\"><td><input type=\\\"submit\\\" name=\\\"View\\\" value=\\\"View\\\"></td></form></TR>\";\r\n\r\n					$Count = $Count + 1;\r\n				}\r\n				\r\n				$this->Content = $this->Content . \"</table>\\n\\n<br><br>\";\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n			if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . ($i+5) . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . $NumofPages . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n			}\r\n\r\n		} else {\r\n			//provide a link at the top for listing all cats again\r\n			$this->Content = $this->Content . \"<br>\\n<center><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&ClearCat=True\\\">Go Back To Category List</a><br><br>\\n\\n\";\r\n\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n\r\n			//load UserRecords\r\n			$query = \"SELECT * FROM ODOPages, PagesIsOfCats WHERE PagesIsOfCats.CatID = \" . $CatID . \" AND PagesIsOfCats.PageID = ODOPages.PageID\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<center><h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n\r\n				$this->Content = $this->Content . \"<BR>\\n<H2>Page List</H2>\\n<br><table border=1><TH>Page ID</TH><th>Page Name</th><th>Page Description</th><TH>Mod ID</TH><th>Page Author ID</th><th>Created Date</th><TH>Edit Page</TH><th>Delete Page</th>\";\r\n				while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n\r\n					$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPage\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><td>\" . $row[\"PageID\"] . \"</td><td>\" . $row[\"PageName\"] . \"</td><td>\" . $row[\"PageDesc\"] . \"</td><td>\" . $row[\"ModID\"] . \"</td><td>\" . $row[\"Author\"] . \"</td><td>\" . $row[\"CreatedDate\"] . \"<td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n					$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePage\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n			\r\n					$Count = $Count + 1;\r\n				}\r\n				\r\n				$this->Content = $this->Content . \"</table>\\n\\n<br><br>\";\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . ($i+5) . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=CatView&PageNum=\" . $NumofPages . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n			}\r\n			\r\n		}\r\n		\r\n\r\n	}\r\n\r\n	',0,0,4),(27,'DeletePage',_binary '\r\n	function DeletePage() {\r\n		\r\n		if($this->SelectedPage == 0) {\r\n			$this->Content = $this->Content . \"<Center><H3>You need to select a page first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"validate\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"validate\"]==\"Yes\")) {\r\n			$PageID = $this->SelectedPage;\r\n			$this->ClearPage();\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n			$this->LoadODOMenus();\r\n			\r\n			//First log delete.\r\n			$Comment = \"User has deleted a page in the system.\";\r\n			$GLOBALS[\'globalref\'][4]->LogEvent(\"DELETEPAGE\", $Comment, 1);\r\n			\r\n			$query = \"DELETE FROM ODOPages WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM ODOGACL WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM ODOPageObject WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM PagesIsOfCats WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"SELECT * FROM ODOTree WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n	\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $row[\"PriKey\"];\r\n				$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			}\r\n\r\n			$query = \"DELETE FROM ODOTree WHERE PageID=\" . $PageID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"<br><br><H3><B>Page Deleted!</B></H3></center>\";\r\n\r\n		} else {\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"] != $this->SelectedPage)) {\r\n				$this->SelectPage($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageID\"]);\r\n			}\r\n\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n			$this->LoadODOMenus();\r\n\r\n			$this->Content = $this->Content . \"<h3><B>Are you sure you want to delete this page?</B></H3><BR>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePage\\\"><input type=\\\"hidden\\\" name=\\\"validate\\\" value=\\\"Yes\\\"><table><tr><td><input type=\\\"submit\\\" name=\\\"Yes\\\" value=\\\"Yes\\\">&nbsp;&nbsp;</td><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\". $this->SelectedPage . \"\\\"></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $this->SelectedPage . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPage\\\"><td>&nbsp;&nbsp;<input type=\\\"submit\\\" name=\\\"No\\\" value=\\\"No\\\"></td></tr></table></form></center>\";\r\n		}\r\n\r\n	}\r\n\r\n\r\n	',0,0,4),(28,'ListPages',_binary '\r\n	function ListPages() {\r\n		//check count and starting point\r\n		$this->ClearPage();\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		//load UserRecords\r\n		$query = \"select * from ODOPages where ModID != 100 ORDER BY PageName ASC\";\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 15;\r\n		$Count = 0;\r\n\r\n		if( ($RecordCount % 15 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n		} else {\r\n			$this->Content = $this->Content . \"<br><B><H2>Page List</H2></B><br><table border=1><TH>Page ID</TH><th>Page Name</th><th>Page Description</th><TH>Mod ID</TH><th>Page Author ID</th><th>Created Date</th><TH>Edit Page</TH><th>Delete Page</th>\";\r\n\r\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n			mysqli_data_seek($TempRecords, $ChangeToRow);\r\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPage\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><td>\" . $row[\"PageID\"] . \"</td><td>\" . $row[\"PageName\"] . \"</td><td>\" . $row[\"PageDesc\"] . \"</td><td>\" . $row[\"ModID\"] . \"</td><td>\" . $row[\"Author\"] . \"</td><td>\" . $row[\"CreatedDate\"] . \"<td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form>\";\r\n\r\n				$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePage\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $row[\"PageID\"] . \"\\\"><td align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></td></tr></form>\";\r\n			\r\n			\r\n				$Count = $Count + 1;\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n			} else {\r\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages&PageNum=\" . ($i+5) . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSPagesO&fn=ListPages&PageNum=\" . $NumofPages . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</center>\";\r\n		}\r\n\r\n	}\r\n\r\n\r\n	',0,0,4),(29,'NewPage',_binary '	//Function: ODOCMSPages::NewPage()\r\n	//Desc: This will setup and create a new entry for a page. It will not create the content\r\n	//of the page. Depending on what the user selected it will place a call to EditPage to create\r\n	//or insert the data for the content.\r\n	function NewPage() {\r\n		$this->Content = \"\";\r\n		$this->ClearPage();\r\n\r\n		\r\n\r\n		//check for flag. We need to call the EditPage after \r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"NewFlag\"])) {\r\n			//We have data so insert and update local vars then call Edit function\r\n			$query = \"insert into ODOPages (PageName,PageDesc,PageContent,IsDynamic,IsAdmin,ModID,Author,CreatedDate,LastModBy,LastModDate) values (\'\";\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"]) > 0)) {\r\n				$query2 = \"select * from ODOPages where PageName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"\'\";\r\n				$Result = $GLOBALS[\'globalref\'][1]->Query($query2);\r\n				if(mysqli_num_rows($Result) > 0) {\r\n					trigger_error(\"Page Name already defined!\");\r\n					exit();\r\n				}\r\n\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"\',\'\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page Name Passed!\");\r\n				exit();\r\n			}\r\n		\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"]) > 0)) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"] . \"\',\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page Description Passed!\");\r\n				$query = $query . \"\',\";\r\n			}\r\n\r\n			\r\n			if((isset($_FILES[\'userfile\']))&&($_FILES[\'userfile\'][\'size\']>0)) {\r\n				if($_FILES[\'userfile\'][\'error\'] != UPLOAD_ERR_OK) {\r\n					trigger_error(\"File Upload Error: \" . $_FILES[\'userfile\'][\'error\']);\r\n					exit();\r\n				} else {\r\n					if(is_uploaded_file($_FILES[\'userfile\'][\'tmp_name\'])) {\r\n						$fileoutput = file_get_contents($_FILES[\'userfile\'][\'tmp_name\']);\r\n						$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($fileoutput) . \"\',\";\r\n					} else {\r\n						trigger_error(\"File Upload Name not valid!: \" . $_FILES[\'userfile\'][\'tmp_name\'], E_USER_ERROR);\r\n					}	\r\n				}\r\n				\r\n			} else {\r\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"]) > 0)) {\r\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"] . \"\',\";\r\n				} else {\r\n					$query = $query . \"\'Placeholder\',\";\r\n				}\r\n\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"] . \",\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page type selected!\");\r\n				exit();\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"] . \",\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Admin value selected!\");\r\n				exit();\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"] . \",\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Module type selected!\");\r\n				exit();\r\n			}\r\n	\r\n			$query = $query . $_SESSION[\"ODOUserO\"]->getUID() . \",\'\" . date( \'Y-m-d H:i:s\', time() ) . \"\',\";\r\n			$query = $query . $_SESSION[\"ODOUserO\"]->getUID() . \",\'\" . date( \'Y-m-d H:i:s\', time() ) . \"\')\";\r\n$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$query = \"select * from ODOPages where PageName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"\'\";\r\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$row = mysqli_fetch_assoc($Result);\r\n			$this->SelectedPage = $row[\"PageID\"];\r\n			$this->PageName = $row[\"PageName\"];\r\n			$this->Author = $row[\"Author\"];\r\n			$this->CreateDate = $row[\"CreatedDate\"];\r\n			$this->LastMod = $row[\"LastModBy\"];\r\n			$this->LastModDate = $row[\"LastModDate\"];\r\n	\r\n			//before we call to load menus we must update our escaped vars\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedPage\"] = $this->SelectedPage;\r\n			$_POST[\"SelectedPage\"] = $this->SelectedPage;\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n			$this->LoadODOMenus();\r\n			$this->Content = $this->Content . \"<br><B>Page Created</B></center>\";\r\n			\r\n			\r\n		} else {\r\n			$this->Content = \"<Center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n			$this->LoadODOMenus();\r\n\r\n			$this->Content = $this->Content . \"<H2><B>New Page</B></H2>\\n<br><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewPage\\\"><input type=\\\"hidden\\\" name=\\\"NewFlag\\\" value=\\\"1\\\"><table border=1><TR><TD><B>Page Name:</B></TD><TD><input type=\\\"text\\\" name=\\\"PageName\\\"></TD></TR><TR>\\n<TD><B>Page Description:</B></TD><TD><input type=\\\"text\\\" name=\\\"PageDesc\\\"></TD></TR>\\n<TR><TD><B>Page is Dynamic:</B></TD><TD><select name=\\\"IsDynamic\\\"><option value=\\\"0\\\" selected>Static</option><option value=\\\"1\\\">Dynamic</option></select></TD></TR>\\n\";\r\n\r\n			$this->Content = $this->Content . \"<TR><TD><B>Page is Administrative:</B></TD><TD><select name=\\\"IsAdmin\\\"><option value=\\\"1\\\">Yes</option><option value=\\\"0\\\" selected>No</option></select></TD></TR>\\n<TR><TD><B>Page is in Module:</B></TD><TD><select name=\\\"ModID\\\">\";\r\n\r\n			//Load ModId\'s\r\n			$query = \"select * from Modules\";\r\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			while($row = mysqli_fetch_assoc($Result)){\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ModID\"] . \"\\\">\" . $row[\"ModName\"] . \"</option>\\n\";\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</select></TD></TR></TABLE><br>Upload File?<input type=\\\"checkbox\\\" value=\\\"false\\\" name=\\\"UploadFile\\\" onclick=\\\"ShowUpload()\\\"><br>\\n<input type=\\\"hidden\\\" name=\\\"MAX_FILE_SIZE\\\" value=\\\"5000000\\\" />File To Upload (Max 5MB): <input id=\\\"imafile\\\" name=\\\"userfile\\\" type=\\\"file\\\" disabled/><br><textarea id=\\\"imnotafile\\\" NAME=\\\"pagecontent\\\" COLS=120 ROWS=40></textarea><br>\\n<input type=\\\"submit\\\" name=\\\"AddNew\\\" value=\\\"Add New\\\"></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,4),(30,'EditPage',_binary '	//Function: ODOCMSPages::EditPage()\r\n	//Params: Type= 0-We are creating a dynamic PHP page, 1-We are creating a static PHP page,\r\n	//2-We are uploading a file\r\n	//Description: This function uploads files to the database and edits pages of the system\r\n	//it can not create new entries.\r\n	function EditPage() {\r\n		\r\n\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if($this->SelectedPage == 0) {\r\n			$this->Content = $this->Content . \"<br><H3>You must select a page to edit a page!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"EditFlag\"])) {\r\n			$query = \"UPDATE ODOPages SET PageName=\'\";\r\n			//,PageDesc,PageContent,IsDynamic,IsAdmin,ModID,Author,CreatedDate,LastModBy,LastModDate\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"]) > 0)) {\r\n				if( $this->PageName != $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] ) {\r\n					$query2 = \"select * from ODOPages where PageName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"\'\";\r\n					$Result = $GLOBALS[\'globalref\'][1]->Query($query2);\r\n					if(mysqli_num_rows($Result) > 0) {\r\n						trigger_error(\"Page Name already defined!\");\r\n						exit();\r\n					} else {\r\n						$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageName\"] . \"\', PageDesc=\'\";	\r\n					}\r\n\r\n				} else {\r\n\r\n					$query = $query . $this->PageName . \"\', PageDesc=\'\";	\r\n				}\r\n\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page Name Passed!\");\r\n				exit();\r\n			}\r\n			\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"]) > 0)) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageDesc\"] . \"\', PageContent=\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page Description Passed!\");\r\n				$query = $query . \"\', PageContent=\";\r\n			}\r\n\r\n			$NewPageContent = \"\";\r\n			if((isset($_FILES[\'userfile\']))&&($_FILES[\'userfile\'][\'size\']>0)) {\r\n				\r\n				if($_FILES[\'userfile\'][\'error\'] != UPLOAD_ERR_OK) {\r\n					trigger_error(\"File Upload Error: \" . $_FILES[\'userfile\'][\'error\']);\r\n					exit();\r\n				} else {\r\n					if(is_uploaded_file($_FILES[\'userfile\'][\'tmp_name\'])) {\r\n						$fileoutput = file_get_contents($_FILES[\'userfile\'][\'tmp_name\']);\r\n						$NewPageContent = $GLOBALS[\'globalref\'][1]->EscapeMe($fileoutput);\r\n						\r\n					} else {\r\n						trigger_error(\"File Upload Name not valid!: \" . $_FILES[\'userfile\'][\'tmp_name\'], E_USER_ERROR);\r\n						exit();\r\n					}	\r\n				}\r\n				\r\n			} else {\r\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"]) > 0)) {\r\n					$NewPageContent = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"];\r\n				} else {\r\n					$NewPageContent = \"PLACE HOLDER\";\r\n				}\r\n			}\r\n			\r\n			$query = $query . \"\'\" . $NewPageContent . \"\', IsDynamic=\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsDynamic\"] . \", IsAdmin=\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Page type selected!\");\r\n				exit();\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"] . \", ModID=\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Admin value selected!\");\r\n				exit();\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ModID\"] . \", LastModBy=\";	\r\n			} else {\r\n				//throw error\r\n				trigger_error(\"No Module type selected!\");\r\n				exit();\r\n			}\r\n	\r\n			$mysqldate = date( \'Y-m-d H:i:s\', time() );\r\n			\r\n			$query = $query . $_SESSION[\"ODOUserO\"]->getUID() . \", LastModDate=\'\" . $mysqldate . \"\' WHERE PageID=\" . $this->SelectedPage;\r\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$tempPageID = $this->SelectedPage;\r\n			\r\n			$this->ClearPage();\r\n			$this->SelectPage($tempPageID);\r\n\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n			$this->LoadODOMenus();\r\n\r\n			$this->Content = $this->Content . \"<br><H3>Page has been updated.</H3></center>\";\r\n	\r\n\r\n		} else {\r\n\r\n			$query = \"SELECT * FROM ODOPages WHERE PageID=\" . $this->SelectedPage;\r\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$row = mysqli_fetch_assoc($Result);\r\n			$Description = $row[\"PageDesc\"];\r\n			$MyContent = $row[\"PageContent\"];\r\n			$this->Content = $this->Content . \"<center><B><H2>Edit Page</H2></B>\\n<br><table border=1><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPage\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\". $this->SelectedPage . \"\\\"><input type=\\\"hidden\\\" name=\\\"EditFlag\\\" value=\\\"1\\\"><TR><TD><B>Page Name:</B></TD><TD><input type=\\\"text\\\" name=\\\"PageName\\\" maxlength=\\\"254\\\" value=\\\"\" . $this->PageName . \"\\\"></TD></TR>\";\r\n\r\n			$this->Content = $this->Content . \"<TR><TD><B>Page Description:</B></TD><TD><textarea rows=\\\"4\\\" cols=\\\"40\\\" maxlength=\\\"254\\\" name=\\\"PageDesc\\\">\" . $Description . \"</textarea>\\n</TD></TR><TR><TD><B>Page is Dynamic:</B></TD><TD><select name=\\\"IsDynamic\\\"><option value=\\\"0\\\"\";\r\n\r\n			if($this->IsDynamic) {\r\n				$this->Content = $this->Content . \">Static</option><option value=\\\"1\\\" selected>Dynamic</option></select>\\n</TD></TR>\";\r\n			} else {\r\n				$this->Content = $this->Content . \" selected>Static</option><option value=\\\"1\\\">Dynamic</option></select>\\n</TD></TR>\";\r\n			}\r\n\r\n			\r\n			$this->Content = $this->Content . \"<TR><TD><B>Page is Administrative:</B></TD><TD><select name=\\\"IsAdmin\\\"><option value=\\\"1\\\"\";\r\n\r\n			if($this->IsAdmin) {\r\n				$this->Content = $this->Content . \" selected>Yes</option><option value=\\\"0\\\">No</option></select>\\n</TD></TR><TR><TD><B>Module:</B></TD><TD><select name=\\\"ModID\\\">\";\r\n			} else {\r\n				$this->Content = $this->Content . \">Yes</option><option value=\\\"0\\\" selected>No</option></select>\\n</TD></TR><TR><TD><B>Module:</B></TD><TD><select name=\\\"ModID\\\">\";\r\n			}\r\n\r\n				\r\n\r\n			//Load ModId\'s\r\n			$query = \"select * from Modules\";\r\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			while($row = mysqli_fetch_assoc($Result)){\r\n				if($this->ModID == $row[\"ModID\"]) {\r\n					$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ModID\"] . \"\\\" selected>\" . $row[\"ModName\"] . \"</option>\\n\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ModID\"] . \"\\\">\" . $row[\"ModName\"] . \"</option>\\n\";\r\n				}\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</select></TD></TR></table><br>Upload File?<input type=\\\"checkbox\\\" value=\\\"false\\\" name=\\\"UploadFile\\\" onclick=\\\"ShowUpload()\\\"><br>\\n<input type=\\\"hidden\\\" name=\\\"MAX_FILE_SIZE\\\" value=\\\"5000000\\\" />File To Upload (Max 5MB): <input id=\\\"imafile\\\" name=\\\"userfile\\\" type=\\\"file\\\" disabled/><br><textarea id=\\\"imnotafile\\\" NAME=\\\"pagecontent\\\" COLS=120 ROWS=40>\" . htmlspecialchars($MyContent) . \"</textarea><br><br><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></center>\";\r\n		}\r\n\r\n	}\r\n\r\n\r\n\r\n',0,0,4),(31,'AddRemoveGroups',_binary '\n	function AddRemoveGroups() {\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n			$query = \"DELETE FROM ODOGACL WHERE PageID=\" . $this->SelectedPage;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"SELECT * FROM ODOGroups\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"read\" . $row[\"GID\"]])) {\n					$query = \"insert into ODOGACL(GID,PageID,WriteOK) values(\" . $row[\"GID\"] . \",\" . $this->SelectedPage . \",\";\n					if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"write\" . $row[\"GID\"]])) {\n						$query = $query . \"1)\";\n					} else {\n						$query = $query . \"0)\";\n					}\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n			\n			}\n\n			$this->Content = $this->Content . \"<CENTER><H3>All groups updated.</H3></center>\";\n\n		} else {\n			$this->Content = $this->Content . \"<center><BR><H2>Groups Access Control for Page</H2><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"AddRemoveGroups\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $this->SelectedPage . \"\\\"><table border=1><TR><TH>Group Name</TH><TH>Read</TH><TH>Write</TH></TR>\";\n\n			$query = \"SELECT ODOGroups.GID, ODOGroups.GroupName, ODOGACL.PageID, ODOGACL.WriteOK FROM ODOGroups LEFT JOIN ODOGACL on ODOGroups.GID = ODOGACL.GID AND ODOGACL.PageID=\" . $this->SelectedPage;\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n			$i = 0;\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"><TD>\" . $row[\"GroupName\"] . \"</TD><TD><input id=\\\"read\" . $row[\"GID\"] . \"\\\" type=\\\"checkbox\\\" name=\\\"read\" . $row[\"GID\"] . \"\\\" value=\\\"true\\\" onclick=\\\"GroupReadClick(\" . $row[\"GID\"] . \")\\\" \";\n				if($row[\"PageID\"] == $this->SelectedPage) {\n					$this->Content = $this->Content . \"checked></TD><TD><input id=\\\"write\" . $row[\"GID\"] . \"\\\" type=\\\"checkbox\\\" value=\\\"true\\\" name=\\\"write\" . $row[\"GID\"] . \"\\\" \";\n					if($row[\"WriteOK\"] == 1) {\n						$this->Content = $this->Content . \"checked\";\n					}\n					$this->Content = $this->Content . \">\";\n				} else {\n					$this->Content = $this->Content . \"></TD><TD><input id=\\\"write\" . $row[\"GID\"] . \"\\\" type=\\\"checkbox\\\" value=\\\"true\\\" name=\\\"write\" . $row[\"GID\"] . \"\\\" disabled>\";\n					\n				}\n				$i = $i + 1;\n				$this->Content = $this->Content . \"</TD></TR>\";\n			}\n\n			$this->Content = $this->Content . \"</TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Group Rights\\\" value=\\\"Update Group Rights\\\"></FORM></CENTER>\";\n		}\n\n	}\n\n	',0,0,4),(32,'AddRemoveObjects',_binary '\r\n	function AddRemoveObjects() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSPage\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(!$this->IsDynamic) {\r\n			$this->Content = $this->Content . \"<BR><BR><center><H3>This page is not dynamic. Please Choose a dynamic page to add Objects to.</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n\r\n			//first delete\r\n			$query = \"DELETE FROM ODOPageObject WHERE PageID=\" . $this->SelectedPage;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$query=\"SELECT * FROM ObjectNames\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Object\" . $row[\"ObjID\"]])) {\r\n					$query=\"INSERT INTO ODOPageObject(PageID, ObjID) values(\" . $this->SelectedPage . \",\" . $row[\"ObjID\"] . \")\";\r\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n				}\r\n			}\r\n				\r\n			$this->Content = $this->Content . \"<CENTER><H3>All Objects updated.</H3></center>\";\r\n\r\n		} else {\r\n			$ModArray = array();\r\n			$query = \"select * from Modules\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$ModArray[$row[\"ModID\"]] = $row[\"ModName\"];\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<center><BR><H2>Object Access Control for Page</H2><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSPagesO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"AddRemoveObjects\\\"><input type=\\\"hidden\\\" name=\\\"SelectedPage\\\" value=\\\"\" . $this->SelectedPage . \"\\\"><table border=1><TR><TH>Object ID</TH><TH>Object Name</TH><TH>Object Description</TH><TH>Is Administrative Object</TH><TH>Part of Module</TH><TH>Loaded For Page</TH></TR>\";\r\n\r\n			$query = \"SELECT ObjectNames.ObjID, ObjectNames.Name, ObjectNames.Description, ObjectNames.IsAdmin, ObjectNames.ModID, ODOPageObject.PageID FROM ObjectNames LEFT JOIN ODOPageObject on ObjectNames.ObjID = ODOPageObject.ObjID AND ODOPageObject.PageID=\" . $this->SelectedPage . \" group by ObjID\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<TR><TD>\" . $row[\"ObjID\"] . \"</TD><TD>\" . $row[\"Name\"] . \"</TD><TD>\" . $row[\"Description\"] . \"</TD><TD>\" . $row[\"IsAdmin\"] . \"</TD><TD>\" . $ModArray[$row[\"ModID\"]] . \"</TD><TD><input type=\\\"checkbox\\\" name=\\\"Object\" . $row[\"ObjID\"] . \"\\\" value=\\\"\" . $row[\"ObjID\"] . \"\\\" \";\r\n				if($row[\"PageID\"] == $this->SelectedPage) {\r\n					$this->Content = $this->Content . \"checked></TD></TR>\";\r\n				} else {\r\n					$this->Content = $this->Content . \"></TD></TR>\";\r\n				}\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Objects\\\" value=\\\"Update Objects\\\"></FORM></CENTER>\";\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,4),(33,'ODOCMSGroupsHead',_binary '\r\n\r\nclass ODOCMSGroups {\r\n\r\n	var $GID;\r\n	var $GroupName;\r\n	var $GroupDesc;\r\n	var $Content;\r\n\r\n	function  __construct() {\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"])) {\r\n			$this->GID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"];\r\n			$this->SelectGroup($this->GID);\r\n			\r\n		} else {\r\n			$this->ClearSelected();\r\n		}\r\n		\r\n		$this->Content = \"\";\r\n\r\n	}\r\n\r\n	\r\n	//******************************************************************************//\r\n	//Function: ODOCMSPages::LoadODOMenus($MenuType)				//\r\n	//Parameters: MenuType-integer: simple select statement choses the menu 	//\r\n	//type to output								//\r\n	//Description: Used by every ODO Object to create content to be displayed	//\r\n	//for menus only								//\r\n	//******************************************************************************//\r\n	private function LoadODOMenus() {\r\n		\r\n		//menu Group selection\r\n		//Groups\r\n		//->New Groups\r\n		//->List Groups\r\n		//->Edit Group Name\r\n		\r\n		//menu Permissions\r\n		//Permissions\r\n		//->Update users in group\r\n		//->Update pages in group\r\n		//->Update Objects in group\r\n		\r\n		\r\n		//Permissions\r\n		//Menu Placement\r\n		if($this->GID != 0)\r\n		{\r\n			\r\n			$this->Content = $this->Content . \"<br><table border=1><TH><B>Selected Group</B></TH><TR><TD>GroupID: </TD><TD>\" . $this->GID . \"</TD></TR><TR><TD>Group Name: </TD><TD>\" . $this->GroupName . \"</td></tr>\\n</table>\\n\";\r\n\r\n		}\r\n		\r\n\r\n	}\r\n\r\n	private function SelectGroup($NewGID) {\r\n		$query = \"select * from ODOGroups WHERE GID=\" . $NewGID;\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if($row = mysqli_fetch_assoc($TempRecords)) {\r\n\r\n			$this->GID = $row[\"GID\"];\r\n			$this->GroupName = $row[\"GroupName\"];\r\n			$this->GroupDesc = $row[\"GroupDesc\"];\r\n			\r\n		} else {\r\n			trigger_error(\"Group ID not found!\", E_USER_ERROR);\r\n		}\r\n\r\n	}\r\n\r\n	private function ClearSelected() {\r\n		$this->GID = 0;\r\n		$this->GroupName = \"\";\r\n		$this->GroupDesc = \"\";\r\n	}\r\n\r\n//end header\r\n\r\n',1,0,5),(34,'ODOCMSGroupsFoot',_binary '\r\n//begin footer\r\n\r\n	function __wakeup() {\r\n		$this->Content = \"\";\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"])) {\r\n			$this->GID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"];\r\n			$this->SelectGroup($this->GID);\r\n			\r\n		} \r\n	}\r\n	\r\n	\r\n	function __sleep() {\r\n		$this->Content = \"\";\r\n		return( array_keys( get_object_vars( $this ) ) );\r\n	}\r\n	\r\n}\r\n\r\n',0,1,5),(35,'NewGroup',_binary '\r\n	function NewGroup() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if($this->GID != 0 ) {\r\n			$this->ClearSelected();\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateGroup\"])) {\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"]) < 1)) {\r\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>You need to enter a name for the group!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"select * from ODOGroups WHERE GroupName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"] . \"\'\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>Group Name <I>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"] . \"</I> already exists! Please choose a new name.</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"INSERT INTO ODOGroups (GroupName, GroupDesc) values(\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"] . \"\',\'\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupDesc\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupDesc\"];\r\n			} else {\r\n				$query = $query . \"NO DESCRIPTION\";\r\n			}\r\n\r\n			$query = $query . \"\')\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"SELECT * FROM ODOGroups WHERE GroupName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GName\"] . \"\'\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(!($row = mysqli_fetch_assoc($TempRecords))) {\r\n				trigger_error(\"Error adding group!\", E_USER_ERROR);\r\n			} else {\r\n				$this->SelectGroup($row[\"GID\"]);\r\n				$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n				$this->LoadODOMenus();\r\n		\r\n				$this->Content = $this->Content . \"<BR><BR><H2><B>Group Added!</B></H2></CENTER>\";\r\n\r\n			}\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<br>\\n<center><H2><B>Create Group</B></H2><br><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewGroup\\\"><input type=\\\"hidden\\\" name=\\\"CreateGroup\\\" value=\\\"CreateGroup\\\"><table border=1><TR><TD>Group Name:</TD><TD><input type=\\\"text\\\" name=\\\"GName\\\" size=\\\"20\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Group Description:</TD><TD><textarea rows=\\\"4\\\" cols=\\\"40\\\" maxlength=\\\"254\\\" name=\\\"GroupDesc\\\"></textarea></TD></TR></Table><br><br><input type=\\\"submit\\\" name=\\\"Create\\\" value=\\\"Create\\\"></FORM></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,5),(36,'ListGroups',_binary '\r\n	function ListGroups() {\r\n		if($this->GID != 0 ) {\r\n			$this->ClearSelected();\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n	\r\n		//output cats in pages.\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		$query = \"SELECT * FROM ODOGroups\";\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 15;\r\n		$Count = 0;\r\n\r\n		if( ($RecordCount % 15 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = $this->Content . \"<center><h3>Page number is out of bounds!</h3><br><br></center>\";\r\n		} else {\r\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n			mysqli_data_seek($TempRecords, $ChangeToRow);\r\n\r\n			$this->Content = $this->Content . \"<center><br>\\n<table border=1><TR><TH>Group ID</TH><TH>Group Name</TH><TH>Group Description</TH><TH>Edit Group</TH><TH>Delete Group</TH></TR>\";\r\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				$this->Content = $this->Content . \"\\n<TR><TD>\" . $row[\"GID\"] . \"</TD><TD>\" . $row[\"GroupName\"] . \"</TD><TD>\" . $row[\"GroupDesc\"] . \"</TD>\";\r\n	\r\n				$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditGroup\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $row[\"GID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></FORM><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteGroup\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $row[\"GID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></FORM></TR>\";\r\n\r\n				$Count = $Count + 1;\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=ListGroups&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n			} else {\r\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=ListGroups&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if($i > $NumofPages) {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSGroupsO&fn=ListGroups&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</center>\";\r\n		}\r\n	}\r\n\r\n	',0,0,5),(37,'DeleteGroup',_binary '\r\n	function DeleteGroup() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"])) {\r\n\r\n			if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"] != $this->GID) {\r\n				$this->ClearSelected();\r\n				$this->SelectGroup($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GID\"]);\r\n			}\r\n		} else {\r\n			$this->Content = $this->Content . \"<center><BR><H3>Incorrect Parameters passed to function. Please call this function from a valid area of ODOCMS.</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConfirmDelete\"])) {\r\n			$query = \"DELETE FROM ODOUserGID WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM ODOGACL WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM ODOMenus WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"DELETE FROM ODOGroups WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->ClearSelected();\r\n			$this->Content = $this->Content . \"<center><BR><H2><B>Group Deleted!</B></H2></center>\";\r\n			\r\n		} else {\r\n			$this->Content = $this->Content . \"\\n<center><br><br><H2>Delete Group?</H2><br><table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteGroup\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $this->GID . \"\\\"><input type=\\\"hidden\\\" name=\\\"ConfirmDelete\\\" value=\\\"Yes\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Yes\\\" value=\\\"Yes\\\"></TD></FORM><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ListGroups\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"No\\\" value=\\\"No\\\"></TD></FORM></TR></table></center>\";	\r\n\r\n		}\r\n\r\n\r\n	}\r\n\r\n	',0,0,5),(38,'EditGroup',_binary '\r\n	function EditGroup() {\r\n		\r\n		if($this->GID == 0) {\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n			$this->LoadODOMenus();\r\n\r\n			$this->Content = $this->Content . \"<BR><BR>\\n<H3>Please select a group to edit!</H3></center>\";\r\n			return;\r\n			\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			if((!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupName\"])) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupName\"]) < 1)) {\r\n				$this->Content = $this->Content . \"<br><BR><center><br>\\n<H3>Group Name is not valid!</H3></center>\";\r\n				return;\r\n			} \r\n	\r\n			$query = \"SELECT * FROM ODOGroups WHERE GroupName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupName\"] . \"\'\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if($row[\"GID\"] != $this->GID) {\r\n					$this->Content = $this->Content . \"<BR><BR><CENTER><BR>\\n<H3>Group Name already exists!</H3></center>\";\r\n					return;\r\n				}\r\n			}\r\n\r\n			$query = \"UPDATE ODOGroups SET GroupName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupName\"] . \"\', GroupDesc=\'\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupDesc\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"GroupDesc\"] . \"\' \";\r\n			} else {\r\n				$query = $query . \"NO DESCRIPTION\' \";\r\n			}\r\n\r\n			$query = $query . \"WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n			$this->LoadODOMenus();\r\n		\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Group Updated.</H3></center>\";\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<BR><CENTER><H2><B>Edit Group</B></H2><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditGroup\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $this->GID . \"\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"Yes\\\">\\n<table border=1><TR><TD>GID:</TD><TD>\" . $this->GID . \"</TD></TR>\\n<TR><TD>Group Name:</TD><TD><input type=\\\"text\\\" name=\\\"GroupName\\\" value=\\\"\" . $this->GroupName . \"\\\" size=\\\"20\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Group Description:</TD><TD><textarea rows=\\\"4\\\" cols=\\\"40\\\" maxlength=\\\"254\\\" name=\\\"GroupDesc\\\">\" . $this->GroupDesc . \"</textarea></TD></TR></TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Group\\\" value=\\\"Update Group\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,5),(39,'UpdateUsers',_binary '\r\n	function UpdateUsers() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if($this->GID == 0) {\r\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select a Group first.</B></H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			\r\n			$query = \"DELETE FROM ODOUserGID WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"SELECT UID FROM ODOUsers\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"is\" . $row[\"UID\"]])) {\r\n					$query = \"insert into ODOUserGID(GID,UID) values(\" . $this->GID . \",\" . $row[\"UID\"] . \")\";\r\n					\r\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				}\r\n			\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<CENTER><H3>All Users Selected Added to Group.</H3></center>\";\r\n			\r\n		} else {\r\n\r\n			$query = \"SELECT ODOUsers.UID,ODOUsers.user,ODOUsers.emailadd, ODOUsers.rnameLast,ODOUsers.rnameFirst,ODOUserGID.GID FROM ODOUsers LEFT JOIN ODOUserGID ON ODOUsers.UID=ODOUserGID.UID AND ODOUserGID.GID=\" . $this->GID . \" ORDER BY ODOUsers.user\";\r\n\r\n			$this->Content = $this->Content . \"<center><BR><H2><B>Update Users</B></H2><br><br>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"UpdateUsers\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"Update\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $this->GID . \"\\\"><table border=1><TR><TH>UID</TH><TH>Username</TH><TH>e-mail</TH><TH>First Name</TH><TH>Last Name</TH><TH>In Group</TH></TR>\\n\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$i = 0;\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$NumofPages = intval($NumofPages);\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"\";\r\n\r\n				if($i > 14) {\r\n					$this->Content = $this->Content . \" style=display:none\";\r\n				}\r\n		\r\n				$this->Content = $this->Content . \"><TD>\" . $row[\"UID\"] . \"</TD><TD>\" . $row[\"user\"] . \"</TD><TD>\" . $row[\"emailadd\"] . \"</TD><TD>\" . $row[\"rnameFirst\"] . \"</TD><TD>\" . $row[\"rnameLast\"] . \"</TD><TD><input id=\\\"is\" . $row[\"UID\"] . \"\\\" type=\\\"checkbox\\\" name=\\\"is\" . $row[\"UID\"] . \"\\\" value=\\\"true\\\" \";\r\n				if($row[\"GID\"] == $this->GID) {\r\n					$this->Content = $this->Content . \"checked></TD>\";\r\n				} else {\r\n					$this->Content = $this->Content . \"></TD>\";\r\n					\r\n				}\r\n				$i = $i + 1;\r\n				$this->Content = $this->Content . \"</TR>\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Group Users\\\" value=\\\"Update Group Users\\\"></FORM></CENTER>\";\r\n			//ODOWeb javascript page view\r\n			if($NumofPages > 1) {\r\n				$i = 1;\r\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				while($i <= $NumofPages) {\r\n					if($i%10 == 0) {\r\n							$this->Content = $this->Content . \"<BR>\";\r\n					}\r\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\r\n					$i = $i + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\r\n			}	\r\n			\r\n		}\r\n	}\r\n\r\n	',0,0,5),(40,'UpdatePages',_binary '\r\n	function UpdatePages() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if($this->GID == 0) {\r\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select a Group first.</B></H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			$query = \"DELETE FROM ODOGACL WHERE GID=\" . $this->GID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"SELECT PageID FROM ODOPages\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"read\" . $row[\"PageID\"]])) {\r\n					$query = \"insert into ODOGACL(GID,PageID,WriteOK) values(\" . $this->GID . \",\" . $row[\"PageID\"] . \",\";\r\n					if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"write\" . $row[\"PageID\"]])) {\r\n						$query = $query . \"1)\";\r\n					} else {\r\n						$query = $query . \"0)\";\r\n					}\r\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				}\r\n			\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<CENTER><H3>All Pages updated.</H3></center>\";\r\n\r\n		} else {\r\n\r\n			$this->Content = $this->Content . \"<center><BR><H2>Update Pages</H2><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"UpdatePages\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $this->GID . \"\\\"><table border=1><TR><TH>PageID</TH><TH>Page Name</TH><TH>Page Description</TH><TH>Is Admin</TH><TH>Is Dynamic</TH><TH>ModID</TH><TH>Read</TH><TH>Write</TH></TR>\";\r\n\r\n			$query = \"SELECT ODOPages.PageID, ODOPages.PageName, ODOPages.PageDesc, ODOPages.IsDynamic, ODOPages.IsAdmin, ODOPages.ModID, ODOGACL.GID, ODOGACL.WriteOK FROM ODOPages LEFT JOIN ODOGACL on ODOPages.PageID = ODOGACL.PageID AND ODOGACL.GID=\" . $this->GID;\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$i = 0;\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$NumofPages = intval($NumofPages);\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"\";\r\n\r\n				if($i > 14) {\r\n					$this->Content = $this->Content . \" style=display:none\";\r\n				}\r\n		\r\n				$this->Content = $this->Content . \"><TD>\" . $row[\"PageID\"] . \"</TD><TD>\" . $row[\"PageName\"] . \"</TD><TD>\" . $row[\"PageDesc\"] . \"</TD><TD>\" . $row[\"IsAdmin\"] . \"</TD><TD>\" . $row[\"IsDynamic\"] . \"</TD><TD>\" . $row[\"ModID\"] . \"</TD><TD><input id=\\\"read\" . $row[\"PageID\"] . \"\\\" type=\\\"checkbox\\\" name=\\\"read\" . $row[\"PageID\"] . \"\\\" value=\\\"true\\\" onclick=\\\"GroupReadClick(\" . $row[\"PageID\"] . \")\\\" \";\r\n				if($row[\"GID\"] == $this->GID) {\r\n					$this->Content = $this->Content . \"checked></TD><TD><input id=\\\"write\" . $row[\"PageID\"] . \"\\\" type=\\\"checkbox\\\" value=\\\"true\\\" name=\\\"write\" . $row[\"PageID\"] . \"\\\" \";\r\n					if($row[\"WriteOK\"] == 1) {\r\n						$this->Content = $this->Content . \"checked\";\r\n					}\r\n					$this->Content = $this->Content . \">\";\r\n				} else {\r\n					$this->Content = $this->Content . \"></TD><TD><input id=\\\"write\" . $row[\"PageID\"] . \"\\\" type=\\\"checkbox\\\" value=\\\"true\\\" name=\\\"write\" . $row[\"PageID\"] . \"\\\" disabled>\";\r\n					\r\n				}\r\n				$i = $i + 1;\r\n				$this->Content = $this->Content . \"</TD></TR>\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Group Rights\\\" value=\\\"Update Group Rights\\\"></FORM></CENTER>\";\r\n			//ODOWeb javascript page view\r\n			if($NumofPages > 1) {\r\n				$i = 1;\r\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				while($i <= $NumofPages) {\r\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\r\n					$i = $i + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\r\n			}	\r\n		}\r\n	}\r\n\r\n	',0,0,5),(41,'UpdateObjects',_binary '\r\n	function UpdateObjects() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSGroups\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n		\r\n		if($this->GID == 0) {\r\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select a Group first.</B></H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			$ObjectArray = array();\r\n			$CodeSegArray = array();\r\n			$IsWhole = array();\r\n\r\n			$query = \"SELECT * FROM ObjectNames\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Allow\" . $row[\"ObjID\"]])) {\r\n					$ObjectArray[$row[\"ObjID\"]] = true;\r\n				} else {\r\n					$ObjectArray[$row[\"ObjID\"]] = false;\r\n				}\r\n				if($row[\"IsWhole\"]==1) {\r\n					$IsWhole[$row[\"ObjID\"]] = true;\r\n				} else {\r\n					$IsWhole[$row[\"ObjID\"]] = false;\r\n				}\r\n			}\r\n\r\n			//clear out \r\n			$query = \"delete from ODOObjectACL WHERE GID=\" . $this->GID;\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n\r\n			$query = \"SELECT CodeSegID, IsHeader, IsFooter, ObjID FROM Objects\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"code\" . $row[\"CodeSegID\"]])) {\r\n					$CodeSegArray[$row[\"CodeSegID\"]] = true;\r\n					\r\n				} else {\r\n					if((isset($IsWhole[$row[\"ObjID\"]]))&&($IsWhole[$row[\"ObjID\"]])&&($ObjectArray[$row[\"ObjID\"]])) {\r\n						\r\n						$CodeSegArray[$row[\"CodeSegID\"]] = true;\r\n					} else {\r\n						\r\n						$CodeSegArray[$row[\"CodeSegID\"]] = false;\r\n					}\r\n\r\n					if((($row[\"IsHeader\"])||($row[\"IsFooter\"]))&&($ObjectArray[$row[\"ObjID\"]])) {\r\n						$CodeSegArray[$row[\"CodeSegID\"]] = true;\r\n					}\r\n				}\r\n				\r\n			}\r\n\r\n			\r\n			foreach( $CodeSegArray as $CodeSeg=>$Value) {\r\n				if($Value) {\r\n					$query=\"INSERT INTO ODOObjectACL (CodeSegID,GID) values(\" . $CodeSeg . \",\" . $this->GID . \")\";\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				}\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<center><H3>Objects Added to Group!</H3></center>\";\r\n			\r\n			\r\n		} else {\r\n			\r\n			$ObjectArray = array();\r\n			$ObjectIsWhole = array();\r\n			$ObjectDesc = array();\r\n			$ObjectIsSet = array();\r\n			$ObjectNameIsSet = array();\r\n			$RecordCount=0;\r\n			$NumofPages=0;\r\n\r\n			$query = \"SELECT * FROM ObjectNames\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$NumofPages = intval($NumofPages);\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			//prime array\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$ObjectArray[$row[\"ObjID\"]]=$row[\"Name\"];\r\n				$ObjectDesc[$row[\"ObjID\"]]=$row[\"Description\"];\r\n				if($row[\"IsWhole\"]==1) {\r\n					$ObjectIsWhole[$row[\"ObjID\"]]=true;\r\n				} else {\r\n					$ObjectIsWhole[$row[\"ObjID\"]]=false;\r\n				}\r\n			}\r\n\r\n			$query = \"SELECT Objects.CodeSegID, ObjID FROM Objects, ODOObjectACL WHERE Objects.CodeSegID=ODOObjectACL.CodeSegID AND ODOObjectACL.GID=\" . $this->GID;\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$ObjectIsSet[$row[\"CodeSegID\"]]=$row[\"ObjID\"];\r\n				\r\n				$ObjectNameIsSet[$row[\"ObjID\"]]=true;\r\n			}\r\n\r\n			$query= \"SELECT Objects.CodeSegID, Objects.fnName, Objects.ObjID, Objects.IsFooter, Objects.IsHeader, ODOObjectACL.GID FROM Objects LEFT JOIN ODOObjectACL on Objects.CodeSegID=ODOObjectACL.CodeSegID AND ODOObjectACL.GID=\" . $this->GID . \" ORDER BY ObjID\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"<center><BR><H2><B>Update Objects</B></H2><br><br>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSGroupsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"UpdateObjects\\\"><input type=\\\"hidden\\\" name=\\\"GID\\\" value=\\\"\" . $this->GID . \"\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"Update\\\"><table border=1><TR><TH>Object Name</TH><TH>Object Description</TH><TH>Grant Access</TH><TH>Function Access</TH></TR>\";\r\n	\r\n			$TempObjID=-1;\r\n			$i=0;\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				if($TempObjID != $row[\"ObjID\"]) {\r\n					//then we are on a new row. Generate\r\n					if($TempObjID != -1) {\r\n						if((!isset($ObjectArray[$TempObjID])) || (isset($ObjectIsWhole[$TempObjID]))&&(!$ObjectIsWhole[$TempObjID])) {\r\n							$this->Content = $this->Content . \"</TABLE>\";\r\n						} \r\n						$this->Content = $this->Content . \"</td></TR>\";\r\n					} \r\n					\r\n					if($i > 14) {\r\n						$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\" style=display:none>\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\">\";\r\n					}\r\n\r\n					$this->Content = $this->Content . \"\\n<TD>\";\r\n\r\n					if(isset($ObjectArray[$row[\"ObjID\"]])) {\r\n						$this->Content = $this->Content . $ObjectArray[$row[\"ObjID\"]];\r\n					} else {\r\n						$this->Content = $this->Content . \"NO OBJECT FOUND!\";\r\n					}\r\n\r\n					$this->Content = $this->Content . \"</td><TD>\";\r\n\r\n					if(isset($ObjectDesc[$row[\"ObjID\"]])) {\r\n						$this->Content = $this->Content . $ObjectDesc[$row[\"ObjID\"]];\r\n					} else {\r\n						$this->Content = $this->Content . \"NO OBJECT FOUND! You should run a check on linking in your database.\";\r\n					}\r\n\r\n					$this->Content = $this->Content . \"</TD><TD><input type=\\\"checkbox\\\" id=\\\"Allow\" . $row[\"ObjID\"] . \"\\\" name=\\\"Allow\" . $row[\"ObjID\"] . \"\\\" value=\\\"true\\\"\";\r\n\r\n					if((isset($ObjectIsWhole[$row[\"ObjID\"]]))&&($ObjectIsWhole[$row[\"ObjID\"]])) {\r\n						if(isset($ObjectNameIsSet[$row[\"ObjID\"]])) {\r\n							$this->Content = $this->Content . \" checked\";\r\n						}\r\n\r\n						$this->Content = $this->Content . \"></TD><TD>Object is whole and can not be selected per method.\";\r\n						\r\n					} else {\r\n						\r\n						$this->Content = $this->Content . \" onclick=\\\"ObjectReadClick(\" . $row[\"ObjID\"] . \")\\\"\";\r\n\r\n						if(isset($ObjectNameIsSet[$row[\"ObjID\"]])) {\r\n							$this->Content = $this->Content . \" checked></TD><TD><table id=\\\"ObjTbl\" . $row[\"ObjID\"] . \"\\\" border=0>\";\r\n						} else {\r\n							$this->Content = $this->Content . \"></TD><TD><table id=\\\"ObjTbl\" . $row[\"ObjID\"] . \"\\\" border=0 style=display:none>\";\r\n						}\r\n\r\n					}\r\n\r\n					\r\n					$i=$i+1;\r\n				}\r\n\r\n				$TempObjID = $row[\"ObjID\"];\r\n				if((!isset($ObjectArray[$row[\"ObjID\"]]))||((isset($ObjectIsWhole[$row[\"ObjID\"]]))&&(!$ObjectIsWhole[$row[\"ObjID\"]]))) {\r\n\r\n					$this->Content = $this->Content . \"<TR><TD>\" . $row[\"fnName\"] . \"()</TD><TD><input type=\\\"checkbox\\\" name=\\\"code\" . $row[\"CodeSegID\"] . \"\\\" value=\\\"true\\\"\";\r\n					if(isset($ObjectIsSet[$row[\"CodeSegID\"]])) {\r\n						$this->Content = $this->Content . \" checked\";\r\n					}\r\n					$this->Content = $this->Content . \"></TD></TR>\\n\";\r\n					\r\n				}\r\n			}\r\n			\r\n			if((isset($ObjectIsWhole[$TempObjID]))&&(!$ObjectIsWhole[$TempObjID])) {\r\n				$this->Content = $this->Content . \"</TABLE>\";\r\n			}\r\n \r\n			$this->Content = $this->Content . \"</TD></TR></TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Group Rights\\\" value=\\\"Update Group Rights\\\"></FORM></CENTER>\";\r\n			//ODOWeb javascript page view\r\n			if($NumofPages > 1) {\r\n				$i = 1;\r\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				while($i <= $NumofPages) {\r\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\r\n					$i = $i + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\r\n			}\r\n\r\n\r\n		}\r\n	}\r\n\r\n',0,0,5),(42,'ODOCMSObjectsHead',_binary '\r\n\r\nclass ODOCMSObjects {\r\n	\r\n	var $ObjectSel;\r\n	var $ObjectName;\r\n	var $ObjectDesc;\r\n	var $ObjectIsWhole;\r\n	var $ObjectIsAdmin;\r\n	var $ModID;\r\n	var $CodeSegSel;\r\n	var $CodeSegName;\r\n	var $IsHeader;\r\n	var $IsFooter;\r\n	var $CodeContent;\r\n	var $Content;\r\n\r\n	function  __construct() {\r\n		$this->ObjectSel=0;\r\n		$this->ObjectName=\"\";\r\n		$this->ObjectDesc=\"\";\r\n		$this->ObjectIsWhole=false;\r\n		$this->ObjectIsAdmin=false;\r\n		$this->ModID=0;\r\n		$this->CodeSegSel=0;\r\n		$this->CodeSegName=\"\";\r\n		$this->IsHeader=false;\r\n		$this->IsFooter=false;\r\n		$this->CodeContent=\"\";\r\n		$this->Content = \"\";\r\n\r\n	}\r\n\r\n\r\n	//******************************************************************************//\r\n	//Function: ODOCMSPages::LoadODOMenus($MenuType)				//\r\n	//Parameters: MenuType-integer: simple select statement choses the menu 	//\r\n	//type to output								//\r\n	//Description: Used by every ODO Object to create content to be displayed	//\r\n	//for menus only								//\r\n	//******************************************************************************//\r\n	function LoadODOMenus() {\r\n		\r\n		//menu Object Selection\r\n		//->New Object\r\n		//->List Objects\r\n		//\r\n		\r\n		\r\n		//menu Object Permissions\r\n		//->Add/Remove Pages\r\n		//->Add/Remove Groups\r\n		//\r\n		\r\n		//object menu \r\n		//->Edit Object\r\n		//->List function\r\n		//->Edit Functions\r\n		//->New Function\r\n		\r\n		if($this->ObjectSel != 0)\r\n		{\r\n			\r\n			$this->Content = $this->Content . \"<br><table border=1><TR><TH colspan=\\\"2\\\"><B>Selected Object</B></TH></TR><TR><TD>Object Name: \" . $this->ObjectName . \"</TD><TD>ObjectID: \" . $this->ObjectSel . \"</td></tr>\\n\";\r\n			$this->Content = $this->Content . \"<TR><TD>ModID: </TD><TD>\" . $this->ModID . \"</td></TR></table>\\n\";\r\n\r\n			if($this->CodeSegSel != 0) {\r\n				$this->Content = $this->Content . \"<BR><TABLE border=1><TR><TH><B>Selected function</B></TH></TR><TR><TD>Function Name:</TD><TD>\" . $this->CodeSegName . \"</TD></TR><TR><TD>Function ID:</TD><TD>\" . $this->CodeSegSel . \"</TD></TR></TABLE>\\n\";\r\n			}\r\n\r\n		}\r\n\r\n	}\r\n\r\n	function Select($ObjID) {\r\n		if($this->ObjectSel != 0 ) {\r\n			$this->ClearSelected();\r\n		}\r\n\r\n		if($ObjID < 1) {\r\n			return false;\r\n		}\r\n\r\n		$query = \"SELECT * FROM ObjectNames WHERE ObjID=\" . $ObjID;\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if($row = mysqli_fetch_assoc($TempRecords)) {\r\n			$this->ObjectSel=$row[\"ObjID\"];\r\n			$this->ObjectName=$row[\"Name\"];\r\n			$this->ObjectDesc=$row[\"Description\"];\r\n			if($row[\"IsWhole\"]==1) {\r\n				$this->ObjectIsWhole=true;\r\n			} else {\r\n				$this->ObjectIsWhole=false;\r\n			}\r\n\r\n			if($row[\"IsAdmin\"]==1) {\r\n				$this->ObjectIsAdmin=true;\r\n			} else {\r\n				$this->ObjectIsAdmin=false;\r\n			}\r\n\r\n			$this->ModID=$row[\"ModID\"];\r\n			\r\n			return true;\r\n		} else {\r\n			trigger_error(\"Object ID not found!\", E_USER_ERROR);\r\n			return false;\r\n		}\r\n\r\n\r\n	}\r\n\r\n	function ClearSelected() {\r\n		\r\n		$this->ObjectSel=0;\r\n		$this->ObjectName=\"\";\r\n		$this->ObjectDesc=\"\";\r\n		$this->ObjectIsWhole=false;\r\n		$this->ObjectIsAdmin=false;\r\n		$this->ModID=0;\r\n		$this->ClearCode();\r\n	}\r\n\r\n	function ClearCode() {\r\n		$this->CodeSegSel=0;\r\n		$this->CodeSegName=\"\";\r\n		$this->IsHeader=false;\r\n		$this->IsFooter=false;\r\n		$this->CodeContent=\"\";\r\n	}\r\n\r\n	function SelectCode($CodeID) {\r\n		$this->ClearCode();\r\n\r\n		if($CodeID < 1) {\r\n			return false;\r\n		}\r\n\r\n		$query = \"SELECT * FROM Objects WHERE CodeSegID=\" . $CodeID;\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!($row = mysqli_fetch_assoc($TempRecords))) {\r\n			return false;\r\n		} \r\n\r\n		$this->CodeSegSel=$row[\"CodeSegID\"];\r\n		$this->CodeSegName=$row[\"fnName\"];\r\n		$this->IsHeader=$row[\"IsHeader\"];\r\n		$this->IsFooter=$row[\"IsFooter\"];\r\n		$this->CodeContent=$row[\"Code\"];\r\n\r\n		return true;\r\n	}\r\n//end header\r\n\r\n',1,0,6),(43,'ListObjects',_binary '\n	function ListObjects() {\n	\n		if($this->ObjectSel != 0 ) {\n			$this->ClearSelected();\n		}\n\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\n		}\n\n		$query = \"SELECT * FROM ObjectNames ORDER BY Name ASC\";\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n		$RecordCount = mysqli_num_rows($TempRecords);\n		$NumofPages = $RecordCount / 15;\n		$Count = 0;\n\n		if( ($RecordCount % 15 > 0) ) {\n			$NumofPages = $NumofPages + 1;\n		}\n\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\n			$this->Content = $this->Content . \"<center><h3>Page number is out of bounds!</h3><br><br></center>\";\n		} else {\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\n			mysqli_data_seek($TempRecords, $ChangeToRow);\n\n			$this->Content = $this->Content . \"<center><br>\\n<table border=1><TR><TH>Object ID</TH><TH>Object Name</TH><TH>Object Description</TH><TH>Edit Object</TH><TH>Delete Object</TH></TR>\";\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\n				$this->Content = $this->Content . \"\\n<TR><TD>\" . $row[\"ObjID\"] . \"</TD><TD>\" . $row[\"Name\"] . \"</TD><TD>\" . $row[\"Description\"] . \"</TD>\";\n	\n				$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditObject\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $row[\"ObjID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></FORM><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteObject\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $row[\"ObjID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></FORM></TR>\";\n\n				$Count = $Count + 1;\n			}\n\n			$this->Content = $this->Content . \"</table><br><br>\";\n\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\n		\n			//we want to count down the Pages\n			$NumberofLinks = 1;\n			//$i is the current position\n			$i = $CurPage - 4;\n			if($i < 1) {\n				$i = 1;\n			}\n\n			if(($CurPage > 5)) {\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListObjects&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\n					//Not counted in number of page links\n			} else {\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\n			}\n\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\n				if($CurPage == $i) {\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\n				} else {\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListObjects&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\n\n				}\n				$i = $i + 1;\n				$NumberofLinks = $NumberofLinks + 1;\n			}\n\n			if($i > $NumofPages) {\n				$this->Content = $this->Content . \"&nbsp;Next->\";\n			} else {\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=ListObjects&PageNum=\" . $i . \"\\\">Next-></a>\";\n			}\n\n			$this->Content = $this->Content . \"</center>\";\n		}\n\n\n	}\n\n	',0,0,6),(44,'NewObject',_binary '\n	function NewObject() {\n\n		\n		if($this->ObjectSel != 0 ) {\n			$this->ClearSelected();\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateNew\"])) {\n			if((!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"]))&&(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"])<1)) {\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>You need to enter a name for the Object!</H3></center>\";\n				return;\n			}\n\n			$query = \"SELECT * FROM ObjectNames WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\'\";\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>Object Name <I>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"</I> already exists! Please choose a new name.</H3></center>\";\n				return;\n			}\n			\n			\n			$query = \"INSERT INTO ObjectNames (Name, IsWhole, Description, IsAdmin, ModID) values(\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\',\";\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsWhole\"])) {\n				$query = $query . \"1,\'\";\n			} else {\n				$query = $query . \"0,\'\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODesc\"])) {\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODesc\"] . \"\',\";\n			} else {\n				$query = $query . \"NO DESCRIPTION\',\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"])) {\n				$query = $query . \"1,\";\n			} else {\n				$query = $query . \"0,\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"MODS\"])) {\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"MODS\"] . \")\";\n			} else {\n				$query = $query . \"NULL)\";\n			}\n			\n			\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"SELECT * FROM ObjectNames WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\'\";\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(!($row = mysqli_fetch_assoc($TempRecords))) {\n				trigger_error(\"Error adding object!\", E_USER_ERROR);\n			} else {\n				$this->ObjectSel=$row[\"ObjID\"];\n				$this->ObjectName=$row[\"Name\"];\n				$this->ModID=$row[\"ModID\"];\n				$this->ObjectDesc=$row[\"Description\"];\n				if($row[\"IsWhole\"] == 1) {\n					$this->ObjectIsWhole=true;\n				} else {\n					$this->ObjectIsWhole=false;\n				}\n				\n				if($row[\"IsAdmin\"] == 1) {\n					$this->ObjectIsAdmin=true;\n				} else {\n					$this->ObjectIsAdmin=false;\n				}\n	\n				\n				$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n				$this->LoadODOMenus();\n		\n				$this->Content = $this->Content . \"<BR><BR><H3><B>Object Added!</B></H3><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSObjectsO&fn=EditObject&ObjID=\" . $this->ObjectSel . \"\\\">Edit Object</a></CENTER>\";\n\n			}\n\n		} else {\n\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><CENTER><TABLE id=\\\"NewObjTable\\\" border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewObject\\\"><input type=\\\"hidden\\\" name=\\\"CreateNew\\\" value=\\\"true\\\"><TD>Object Name: </TD><TD><input type=\\\"text\\\" name=\\\"OName\\\" size=\\\"20\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Object Description: </TD><TD><textarea rows=\\\"4\\\" cols=\\\"40\\\" maxlength=\\\"254\\\" name=\\\"ODesc\\\"></textarea></TD></TR><TR><TD>Is Whole?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsWhole\\\" value=\\\"true\\\"></TD></TR><TR><TD>Is Admin Object?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsAdmin\\\" value=\\\"true\\\"></TD></TR><TR><TD>Part of Module:</TD><TD><SELECT name=\\\"MODS\\\">\";\n\n			$query = \"SELECT ModID, ModName FROM Modules\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ModID\"] . \"\\\"> \" . $row[\"ModName\"] . \"</option>\\n\";\n\n			}\n			\n			$this->Content = $this->Content . \"</SELECT></TD></TR></TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Create Object\\\" value=\\\"Create Object\\\"></FORM></CENTER>\";\n		}\n\n\n	}\n\n	',0,0,6),(45,'AddRemovePages',_binary '\n	function AddRemovePages() {\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n	\n		if($this->ObjectSel == 0) {\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select an Object first.</B></H3></center>\";\n			return;\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateByMod\"])) {\n			$query = \"SELECT PageID, ModID FROM ODOPages\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				if($row[\"ModID\"] == $this->ModID) {\n					$query = \"insert into ODOPageObject(ObjID,PageID) values(\" . $this->ObjectSel . \",\" . $row[\"PageID\"] . \")\";\n					\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n			\n			}\n\n			$this->Content = $this->Content . \"<CENTER><H3>All Pages updated.</H3></center>\";\n\n			return;\n\n		} elseif(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n			$query = \"DELETE FROM ODOPageObject WHERE ObjID=\" . $this->ObjectSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"SELECT PageID FROM ODOPages\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"read\" . $row[\"PageID\"]])) {\n					$query = \"insert into ODOPageObject(ObjID,PageID) values(\" . $this->ObjectSel . \",\" . $row[\"PageID\"] . \")\";\n					\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n			\n			}\n\n			$this->Content = $this->Content . \"<CENTER><H3>All Pages updated.</H3></center>\";\n\n			return;\n\n		} else {\n\n			//add all with ModuleID\n			//use checkbox\n			$this->Content = $this->Content . \"<center><BR><H2>Update Pages</H2><br><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"AddRemovePages\\\"><br>Add Objects to all Pages in Module?:&nbsp;<input id=\\\"chkModUpdate\\\" type=\\\"checkbox\\\" name=\\\"UpdateByMod\\\" value=\\\"true\\\" ><br><br><table border=1 id=\\\"tblpages\\\"><TR><TH>PageID</TH><TH>Page Name</TH><TH>Page Description</TH><TH>Is Admin</TH><TH>Is Dynamic</TH><TH>ModID</TH><TH>Add to Page?</TH></TR>\";\n\n			$query = \"SELECT ODOPages.PageID, ODOPages.PageName, ODOPages.PageDesc, ODOPages.IsDynamic, ODOPages.IsAdmin, ODOPages.ModID, ODOPageObject.ObjID FROM ODOPages LEFT JOIN ODOPageObject on ODOPages.PageID = ODOPageObject.PageID AND ODOPageObject.ObjID=\" . $this->ObjectSel . \" ORDER BY PageName\";\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n			$i = 0;\n			$RecordCount = mysqli_num_rows($TempRecords);\n			$NumofPages = $RecordCount / 15;\n			$NumofPages = intval($NumofPages);\n\n			if( ($RecordCount % 15 > 0) ) {\n				$NumofPages = $NumofPages + 1;\n			}\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"\";\n\n				if($i > 14) {\n					$this->Content = $this->Content . \" style=display:none\";\n				}\n		\n				$this->Content = $this->Content . \"><TD>\" . $row[\"PageID\"] . \"</TD><TD>\" . $row[\"PageName\"] . \"</TD><TD>\" . $row[\"PageDesc\"] . \"</TD><TD>\" . $row[\"IsAdmin\"] . \"</TD><TD>\" . $row[\"IsDynamic\"] . \"</TD><TD>\" . $row[\"ModID\"] . \"</TD><TD><input id=\\\"read\" . $i . \"\\\" type=\\\"checkbox\\\" name=\\\"read\" . $row[\"PageID\"] . \"\\\" value=\\\"true\\\" \";\n				if($row[\"ObjID\"] == $this->ObjectSel) {\n					$this->Content = $this->Content . \"checked\";\n				} \n				$i = $i + 1;\n				$this->Content = $this->Content . \"></TD></TR>\";\n			}\n\n			$this->Content = $this->Content . \"</TABLE><BR><BR><input type=\\\"button\\\" name=\\\"ClearMe\\\" value=\\\"Uncheck All\\\" onclick=\\\"ClearChecksinTable(\" . $RecordCount . \")\\\">&nbsp;&nbsp;<input type=\\\"submit\\\" name=\\\"Update Objects In Pages\\\" value=\\\"Update Objects In Pages\\\"></FORM></CENTER>\";\n\n			//ODOWeb javascript page view\n			if($NumofPages > 1) {\n				$i = 1;\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\n				while($i <= $NumofPages) {\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\n					$i = $i + 1;\n				}\n\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\n			}	\n		}\n\n\n	}\n\n	',0,0,6),(46,'AddRemoveGroups',_binary '\n	function AddRemoveGroups() {\n		\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		if($this->ObjectSel == 0) {\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select an Object first.</B></H3></center>\";\n			return;\n		}\n\n		if($this->CodeSegSel == 0) {\n			$this->Content = $this->Content . \"<center><BR><H3><B>Please select a Function first.</B></H3></center>\";\n			return;\n		}\n\n		//add flag to change for all functions in object.\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"AllFunctions\"])) {\n				$MyArray = array();\n\n				$query = \"Select CodeSegID FROM Objects WHERE ObjID=\" . $this->ObjectSel;\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				while($row = mysqli_fetch_assoc($TempRecords)) {\n					$MyArray[$row[\"CodeSegID\"]] = 1;\n					$query = \"DELETE FROM ODOObjectACL WHERE CodeSegID=\" . $row[\"CodeSegID\"];\n					$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n				if(isset($_POST[\'Groups\'])) {\n					$Groups = $_POST[\'Groups\'];\n					//go through each code seg and update groups\n					foreach($MyArray as $ID=>$Value) {\n						if ($Groups){\n	 						foreach ( $Groups as $newg)\n							{\n					\n								$query = \"insert into ODOObjectACL (GID, CodeSegID) values(\" . $newg . \",\" . $ID . \")\";\n								$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n							}\n						}\n					}\n				}\n\n				$this->Content = $this->Content . \"<BR><center><H3><B>All Groups Updated for <I>ALL</I> Functions in this object.</B></H3></center>\";\n			\n\n			} else {\n				$query = \"DELETE FROM ODOObjectACL WHERE CodeSegID=\" . $this->CodeSegSel;\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				if(isset($_POST[\'Groups\'])) {\n					$Groups = $_POST[\'Groups\'];\n					foreach ( $Groups as $newg)\n					{\n					\n						$query = \"insert into ODOObjectACL (GID, CodeSegID) values(\" . $newg . \",\" . $this->CodeSegSel . \")\";\n						$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n					}\n				}\n		\n				$this->Content = $this->Content . \"<BR><center><H3><B>All Groups Updated for Function.</B></H3></center>\";\n			\n			}\n			\n		} else {\n\n			$query = \"SELECT ODOGroups.GID, ODOGroups.GroupName, ODOObjectACL.CodeSegID FROM ODOGroups LEFT JOIN ODOObjectACL on ODOGroups.GID=ODOObjectACL.GID AND ODOObjectACL.CodeSegID=\" . $this->CodeSegSel;\n\n			$this->Content = $this->Content . \"<center><BR><BR><H3>Select Groups for Function</H3><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"AddRemoveGroups\\\"><SELECT name=\\\"Groups[]\\\" multiple>\";\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"\\n<option value=\\\"\" . $row[\"GID\"] . \"\\\"\";\n				\n				if($row[\"CodeSegID\"] == $this->CodeSegSel) {\n					$this->Content = $this->Content . \" selected\";\n				}\n				$this->Content = $this->Content . \">\" . $row[\"GroupName\"] . \"</option>\";\n		\n			}\n\n			\n			$this->Content = $this->Content . \"\\n</SELECT><br>Make change for all Functions in group? <input type=\\\"checkbox\\\" name=\\\"AllFunctions\\\"><BR>\\n<input type=\\\"submit\\\" name=\\\"ChgCat\\\" value=\\\"Update\\\"></form></center>\";\n		}\n		\n	}\n\n	',0,0,6),(47,'EditObject',_binary '\n	function EditObject() {\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"])) {\n			if($this->ObjectSel != $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"]) {\n				if(!($this->Select($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"]))) {\n					$this->Content = \"<center><H3>Object ID not found!</H3></center>\";\n				}\n			}\n		} else {\n			if($this->ObjectSel == 0) {\n				$this->Content = \"<center><H3>You must select an Object to edit first!</H3></center>\";\n				return;\n			} \n			//else we use the currently selected Object\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n			if((!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"]))&&(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"])<1)) {\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>You need to enter a name for the Object!</H3></center>\";\n				return;\n			}\n\n\n			$query = \"SELECT * FROM ObjectNames WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\' AND ObjID !=\" . $this->ObjectSel;\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>Object Name <I>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"</I> already exists! Please choose a new name.</H3></center>\";\n				return;\n			}\n			\n			\n			$query = \"UPDATE ObjectNames SET Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\', IsWhole=\";\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsWhole\"])) {\n				$query = $query . \"1,\";\n			} else {\n				$query = $query . \"0,\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODesc\"])) {\n				$query = $query . \" Description=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODesc\"] . \"\',\";\n			} else {\n				$query = $query . \" Description=\'NO DESCRIPTION\',\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsAdmin\"])) {\n				$query = $query . \" IsAdmin=1,\";\n			} else {\n				$query = $query . \" IsAdmin=0,\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"MODS\"])) {\n				$query = $query . \" ModID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"MODS\"];\n			} else {\n				$query = $query . \" ModID=NULL\";\n			}\n			\n			$query = $query . \" WHERE ObjID=\" . $this->ObjectSel;\n			\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"SELECT * FROM ObjectNames WHERE Name=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"OName\"] . \"\'\";\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(!($row = mysqli_fetch_assoc($TempRecords))) {\n				trigger_error(\"Error updating object!\", E_USER_ERROR);\n			} else {\n				$this->ObjectSel=$row[\"ObjID\"];\n				$this->ObjectName=$row[\"Name\"];\n				$this->ModID=$row[\"ModID\"];\n				$this->ObjectDesc=$row[\"Description\"];\n				if($row[\"IsWhole\"]==1) {\n					$this->ObjectIsWhole=true;\n				} else {\n					$this->ObjectIsWhole=false;\n				}\n\n				if($row[\"IsAdmin\"]==1) {\n					$this->ObjectIsAdmin=true;\n				} else {\n					$this->ObjectIsAdmin=false;\n				}\n\n				$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n				$this->LoadODOMenus();\n		\n				$this->Content = $this->Content . \"<BR><BR><H3><B>Object Updated!</B></H3></CENTER>\";\n\n			}\n\n		} else {\n\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><CENTER><TABLE border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditObject\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><TD>Object Name: </TD><TD>\";\n\n			$this->Content = $this->Content . \"<input type=\\\"text\\\" name=\\\"OName\\\" size=\\\"20\\\" maxlength=\\\"254\\\" value=\\\"\" . $this->ObjectName . \"\\\"></TD></TR><TR><TD>Object Description: </TD><TD><textarea rows=\\\"4\\\" cols=\\\"40\\\" maxlength=\\\"254\\\" name=\\\"ODesc\\\">\" . $this->ObjectDesc . \"</textarea></TD></TR><TR><TD>Is Whole?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsWhole\\\" value=\\\"true\\\" \";\n\n			if($this->ObjectIsWhole) {\n				$this->Content = $this->Content . \"checked\";\n			}\n\n			$this->Content = $this->Content . \"></TD></TR><TR><TD>Is Admin Object?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsAdmin\\\" value=\\\"true\\\" \";\n\n			if($this->ObjectIsAdmin) {\n				$this->Content = $this->Content . \"checked\";\n			}\n\n			$this->Content = $this->Content . \"></TD></TR><TR><TD>Part of Module:</TD><TD><SELECT name=\\\"MODS\\\">\";\n\n			$query = \"SELECT ModID, ModName FROM Modules\";\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			while($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ModID\"] . \"\\\" \";\n	\n				if($this->ModID==$row[\"ModID\"]) {\n					$this->Content = $this->Content . \"selected\";\n				}\n\n				$this->Content = $this->Content . \"> \" . $row[\"ModName\"] . \"</option>\\n\";\n			}\n			\n			$this->Content = $this->Content . \"</SELECT></TD></TR></TABLE><BR><BR><input type=\\\"submit\\\" name=\\\"Update Object\\\" value=\\\"Update Object\\\"></FORM></CENTER>\";\n		}\n	}\n\n	',0,0,6),(48,'DeleteObject',_binary '\n	function DeleteObject() {\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"] != $this->ObjectSel)) {\n			if(!($this->Select($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"]))) {\n				$this->Content = \"<center><H3>Error selecting Object!</H3></center>\";\n				return;\n			}\n		}\n\n		if($this->ObjectSel == 0) {\n			$this->Content = \"<center><H3>You must select an Object to delete!</H3></center>\";\n			return;\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Confirm\"])) {\n			$query = \"DELETE FROM ObjectNames WHERE ObjID=\" . $this->ObjectSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"SELECT CodeSegID FROM Objects WHERE ObjID=\" . $this->ObjectSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(mysqli_num_rows($TempRecords) > 0) {\n				while($row = mysqli_fetch_assoc($TempRecords)) {\n					$query = \"DELETE FROM ODOObjectACL WHERE CodeSegID=\" . $row[\"CodeSegID\"];\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n				}\n			}\n\n			$query = \"DELETE FROM ODOPageObject WHERE ObjID=\" . $this->ObjectSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"DELETE FROM Objects WHERE ObjID=\" . $this->ObjectSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$this->ClearSelected();\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><Center><H3><B>Object Deleted!</B></H3></center>\";\n\n		} else {\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><CENTER><Table border=0><TR><TD>Are you sure you want to delete Object?&nbsp;</TD><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteObject\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ObjID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Confirm\\\" value=\\\"Delete\\\"></TD></FORM></TR></TABLE></CENTER>\";\n		}\n	}\n\n	',0,0,6),(49,'ListFunctions',_binary '\n	function ListFunctions() {\n		if($this->ObjectSel == 0) {\n			$this->Content = \"<CENTER><H3>You must select an object before viewing the Objects functions!</H3></center>\";\n			return;	\n		}\n\n		if($this->CodeSegSel != 0) {\n			$this->ClearCode();\n		}\n\n		\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		$query = \"SELECT CodeSegID, fnName, IsHeader, IsFooter FROM Objects WHERE ObjID=\" . $this->ObjectSel;\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n		$this->Content = $this->Content . \"<center><br>\\n<table border=1><TR><TH>Function ID</TH><TH>Function Name</TH><TH>Is Header</TH><TH>Is Footer</TH><TH>Edit Function</TH><TH>Delete Object</TH></TR>\";\n		while($row = mysqli_fetch_assoc($TempRecords)) {\n			$this->Content = $this->Content . \"\\n<TR><TD>\" . $row[\"CodeSegID\"] . \"</TD><TD>\" . $row[\"fnName\"] . \"</TD><TD>\" . $row[\"IsHeader\"] . \"</TD><TD>\" . $row[\"IsFooter\"] . \"</TD>\";\n	\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditFunctions\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $this->ObjectSel . \"\\\"><input type=\\\"hidden\\\" name=\\\"fnid\\\" value=\\\"\" . $row[\"CodeSegID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></FORM><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteFunction\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $this->ObjectSel . \"\\\"><input type=\\\"hidden\\\" name=\\\"fnid\\\" value=\\\"\" . $row[\"CodeSegID\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></FORM></TR>\";\n\n		}\n\n		$this->Content = $this->Content . \"</table><br><br></CENTER>\";\n\n	}\n\n	',0,0,6),(50,'DeleteFunction',_binary '\n	function DeleteFunction() {\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"] != $this->CodeSegSel)) {\n			if(!($this->SelectCode($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"]))) {\n				$this->Content = \"<center><H3>Error selecting Code!</H3></center>\";\n				return;\n			}\n		}\n\n		if($this->CodeSegSel == 0) {\n			$this->Content = \"<center><H3>You must select a function to delete!</H3></center>\";\n			return;\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Confirm\"])) {\n			$query = \"DELETE FROM Objects WHERE CodeSegID=\" . $this->CodeSegSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"DELETE FROM ODOObjectACL WHERE CodeSegID=\" . $this->CodeSegSel;\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$this->ClearCode();\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><Center><H3>Function Deleted!</H3></center>\";\n\n		} else {\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			$this->Content = $this->Content . \"<BR><BR><CENTER><Table border=0><TR><TD>Are you sure you want to delete function?&nbsp;</TD><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"Confirm\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $this->ObjectSel . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteFunction\\\"><input type=\\\"hidden\\\" name=\\\"fnid\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"] . \"\\\"><TD align=\\\"center\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></FORM></TR></TABLE></CENTER>\";\n		}\n	}\n\n	',0,0,6),(51,'NewFunction',_binary '\n	function NewFunction() {\n\n		if($this->ObjectSel == 0) {\n			$this->Content = $this->Content . \"<CENTER><H3>You must select an Object to edit first!</H3></center>\";\n			return;\n		}\n\n		if($this->CodeSegSel != 0) {\n			$this->ClearCode();\n		}\n\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"NewFun\"])) {\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"])) {\n				if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"])<1)) {\n					$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>You need to enter a name for the Function!</H3></center>\";\n					return;\n				}\n			}\n\n			$query = \"SELECT * FROM Objects WHERE fnName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"\' AND ObjID=\" . $this->ObjectSel;\n\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if($row = mysqli_fetch_assoc($TempRecords)) {\n				$this->Content = $this->Content . \"<BR>\\n<BR><CENTER><H3>Function Name <I>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"</I> already exists! Please choose a new name.</H3></center>\";\n				return;\n			}\n			\n			$query = \"INSERT INTO Objects (fnName, Code, IsHeader, IsFooter, ObjID) values(\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"\',\";\n\n			if((isset($_FILES[\'userfile\']))&&($_FILES[\'userfile\'][\'size\']>0)) {\n				if($_FILES[\'userfile\'][\'error\'] != UPLOAD_ERR_OK) {\n					trigger_error(\"File Upload Error: \" . $_FILES[\'userfile\'][\'error\']);\n					exit();\n				} else {\n					if(is_uploaded_file($_FILES[\'userfile\'][\'tmp_name\'])) {\n						$fileoutput = file_get_contents($_FILES[\'userfile\'][\'tmp_name\']);\n						$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($fileoutput) . \"\'\";\n					} else {\n						trigger_error(\"File Upload Name not valid!: \" . $_FILES[\'userfile\'][\'tmp_name\'], E_USER_ERROR);\n					}	\n				}\n					\n			} else {\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"]) > 0)) {\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"] . \"\'\";\n				} else {\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"(){\\n//place holder\\n}\\n\'\";\n				}\n			}\n			\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsHeader\"])) {\n				$query = $query . \",1,\";\n			} else {\n				$query = $query . \",0,\";\n			}\n\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsFooter\"])) {\n				$query = $query . \"1,\" . $this->ObjectSel . \")\";\n			} else {\n				$query = $query . \"0,\" . $this->ObjectSel . \")\";\n			}\n				\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			$query = \"Select CodeSegID FROM Objects WHERE fnName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"\'\";\n			$Result = $GLOBALS[\'globalref\'][1]->Query($query);\n\n			if(!($row = mysqli_fetch_assoc($Result))) {\n				trigger_error(\"Error adding function!\", E_USER_ERROR);\n			} else {\n				$this->ClearCode();\n				$this->SelectCode($row[\"CodeSegID\"]);\n				$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n				$this->LoadODOMenus();\n\n				$this->Content = $this->Content . \"<br><H3><B>Function has been created.</B></H3></center>\";\n			}	\n\n		} else {\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n			$this->LoadODOMenus();\n		\n			$this->Content = $this->Content . \"</center>\";\n\n			if($this->ObjectIsWhole) {\n				//check if function already exists\n				$query = \"SELECT fnName FROM Objects WHERE ObjID=\" . $this->ObjectSel;\n				\n				$Result = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				if(mysqli_num_rows($Result) > 0) {\n						$this->Content = $this->Content . \"<BR><BR><Center><B>You already have a function for this object and the object is set to be a whole object. You may place your entire class definition in your previously created function or uncheck the IsWhole option for the object.</B></CENTER>\";\n						return;\n				}\n			} 	\n			\n			$this->Content = $this->Content . \"<BR><BR><CENTER><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewFunction\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $this->ObjectSel . \"\\\"><input type=\\\"hidden\\\" name=\\\"NewFun\\\" value=\\\"true\\\"><TABLE border=0><TR><TD>Function Name: </TD><TD><input type=\\\"text\\\" name=\\\"FName\\\" size=\\\"20\\\" maxlength=\\\"254\\\"></TD></TR>\";\n\n			if($this->ObjectIsWhole) {\n				$this->Content = $this->Content . \"<TR><TD>Header of Object:</TD><TD><B>Object is Whole!</B></TD></TR><TR><TD>Footer of Object:</TD><TD><B>Object is Whole!</B></TD></TR>\";\n			} else {\n				$this->Content = $this->Content . \"<TR><TD>Is Header?:</TD><TD><input id=\\\"imaheader\\\" onclick=\\\"HeadFootClick()\\\" type=\\\"checkbox\\\" name=\\\"IsHeader\\\" value=\\\"true\\\"></TD></TR><TR><TD>Is Footer?:</TD><TD><input id=\\\"imafooter\\\" onclick=\\\"HeadFootClick()\\\" type=\\\"checkbox\\\" name=\\\"IsFooter\\\" value=\\\"true\\\"></TD></TR>\";\n			}\n\n			$this->Content = $this->Content . \"</TD></TR>\\n</Table><BR><BR>\\nUpload File?<input type=\\\"checkbox\\\" value=\\\"false\\\" name=\\\"UploadFile\\\" onclick=\\\"ShowUpload()\\\"><br>\\n<input type=\\\"hidden\\\" name=\\\"MAX_FILE_SIZE\\\" value=\\\"5000000\\\" />File To Upload (Max 5MB): <input id=\\\"imafile\\\" name=\\\"userfile\\\" type=\\\"file\\\" disabled/><br><textarea id=\\\"imnotafile\\\" NAME=\\\"pagecontent\\\" COLS=120 ROWS=40></textarea><br><br><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form></center>\";\n\n		}\n\n	}\n\n	',0,0,6),(52,'EditFunctions',_binary '\n	function EditFunctions() {\n\n		if($this->ObjectSel == 0) {\n			$this->Content = $this->Content . \"<CENTER><H3>You must select an Object to edit first!</H3></center>\";\n			return;\n		}\n\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"]!=$this->CodeSegSel)) {\n			if(!($this->SelectCode($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"]))) {\n				$this->Content = $this->Content . \"<CENTER><H3>Error selecting function!</H3></center>\";\n				return;\n			}\n		}\n\n\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n		$this->LoadODOMenus();\n		\n		$this->Content = $this->Content . \"</center>\";\n\n		if($this->CodeSegSel==0) {\n			//not selected - list\n			//new\n			//delete function\n			$this->Content = $this->Content . \"<CENTER><H3>You must select a Function to edit first!</H3></center>\";\n			return;\n		} else {\n			\n			\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\n				//update only, don\'t loose the CodeSegID\n				\n				$query = \"UPDATE Objects SET fnName=\'\";\n\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FunctionName\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FunctionName\"]) > 0)) {\n					$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FunctionName\"] . \"\', IsHeader=\";\n				} else {\n					$this->Content = $this->Content . \"<CENTER><H3>You can not have a function with no name!</H3></center>\";\n					return;\n				}\n\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsHeader\"])) {\n					$query = $query . \"1, IsFooter=\";\n				} else {\n					$query = $query . \"0, IsFooter=\";\n				}\n\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsFooter\"])) {\n					$query = $query . \"1, Code=\";\n				} else {\n					$query = $query . \"0, Code=\";\n				}\n\n				\n			if((isset($_FILES[\'userfile\']))&&($_FILES[\'userfile\'][\'size\']>0)) {\n				if($_FILES[\'userfile\'][\'error\'] != UPLOAD_ERR_OK) {\n					trigger_error(\"File Upload Error: \" . $_FILES[\'userfile\'][\'error\']);\n					exit();\n				} else {\n					if(is_uploaded_file($_FILES[\'userfile\'][\'tmp_name\'])) {\n						$fileoutput = file_get_contents($_FILES[\'userfile\'][\'tmp_name\']);\n						$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($fileoutput) . \"\'\";\n					} else {\n						trigger_error(\"File Upload Name not valid!: \" . $_FILES[\'userfile\'][\'tmp_name\'], E_USER_ERROR);\n					}	\n				}\n					\n			} else {\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"])) && (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"]) > 0)) {\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pagecontent\"] . \"\'\";\n				} else {\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] . \"(){\\n//place holder\\n}\\n\'\";\n				}\n			}\n			\n				\n				$query = $query . \" WHERE CodeSegID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"];\n				$Result = $GLOBALS[\'globalref\'][1]->Query($query);\n\n				$this->ClearCode();\n				$this->SelectCode($_SESSION[\"ODOSessionO\"]->EscapedVars[\"fnid\"]);\n\n				$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSObjects\");\n\n				$this->LoadODOMenus();\n\n				$this->Content = $this->Content . \"<br><H3><B>Function has been updated.</B></H3></center>\";\n				\n			} else {\n				$this->Content = $this->Content . \"<BR><BR><CENTER><TABLE border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSObjectsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditFunctions\\\"><input type=\\\"hidden\\\" name=\\\"ObjID\\\" value=\\\"\" . $this->ObjectSel . \"\\\"><input type=\\\"hidden\\\" name=\\\"Update\\\" value=\\\"true\\\"><input type=\\\"hidden\\\" name=\\\"fnid\\\" value=\\\"\" . $this->CodeSegSel . \"\\\"><TD>Function Name: </TD><TD>\";\n\n				$this->Content = $this->Content . \"<input type=\\\"text\\\" name=\\\"FunctionName\\\" size=\\\"20\\\" maxlength=\\\"254\\\" value=\\\"\" . $this->CodeSegName . \"\\\"></TD></TR>\\n\";\n\n				if($this->ObjectIsWhole) {\n					$this->Content = $this->Content . \"<TR><TD>Is Header?</TD><TD><B>Object is Whole!</B></TD></TR><TR><TD>Is Footer?</TD><TD><B>Object is Whole!</B>\";\n			\n				} else {\n\n					$this->Content = $this->Content . \"<TR><TD>Is Header?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsHeader\\\" value=\\\"true\\\" id=\\\"imaheader\\\" onclick=\\\"HeadFootClick()\\\"\";\n\n					if($this->IsHeader) {\n						$this->Content = $this->Content . \" checked></TD></TR>\\n<TR><TD>Is Footer?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsFooter\\\" id=\\\"imafooter\\\" value=\\\"true\\\" onclick=\\\"HeadFootClick()\\\" disabled>\";\n					} elseif($this->IsFooter) {\n						$this->Content = $this->Content . \" disabled></TD></TR>\\n<TR><TD>Is Footer?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsFooter\\\" id=\\\"imafooter\\\" value=\\\"true\\\" onclick=\\\"HeadFootClick()\\\" checked>\";\n					} else {\n						$this->Content = $this->Content . \"></TD></TR>\\n<TR><TD>Is Footer?</TD><TD><input type=\\\"checkbox\\\" name=\\\"IsFooter\\\" id=\\\"imafooter\\\" value=\\\"true\\\" onclick=\\\"HeadFootClick()\\\">\";\n					}\n\n				}\n\n				$this->Content = $this->Content . \"</TD></TR>\\n</Table><BR><BR>\\nUpload File?<input type=\\\"checkbox\\\" value=\\\"false\\\" name=\\\"UploadFile\\\" onclick=\\\"ShowUpload()\\\"><br>\\n<input type=\\\"hidden\\\" name=\\\"MAX_FILE_SIZE\\\" value=\\\"5000000\\\" />File To Upload (Max 5MB): <input id=\\\"imafile\\\" name=\\\"userfile\\\" type=\\\"file\\\" disabled/><br><textarea id=\\\"imnotafile\\\" NAME=\\\"pagecontent\\\" COLS=120 ROWS=40>\" . htmlspecialchars($this->CodeContent) . \"</textarea><br><br><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form></center>\";\n			}\n		}\n	}\n\n\n',0,0,6),(53,'ODOCMSObjectsFooter',_binary '\n//begin footer\n	function __wakeup() {\n		$this->Content = \"\";\n	}\n\n}\n',0,1,6),(58,'ODOCMSMenuHead',_binary '\r\n\r\nclass ODOCMSMenus {\r\n	\r\n	var $Position;\r\n	var $NameArray;\r\n	var $URLArray;\r\n	var $ChildrenArray;\r\n	var $ParentArray;\r\n	var $IsHeadArray;\r\n	var $Content;\r\n	var $SelectedHead;\r\n	var $SelectedMenuItem;\r\n\r\n	function  __construct() {\r\n		//check if UID is set\r\n		$this->SelectedHead = \"\";\r\n		$this->SelectedMenuItem = 0;\r\n		$this->Position = 0;\r\n		$this->NameArray = array();\r\n		$this->URLArray = array();\r\n		$this->ChildrenArray = array(array());\r\n		$this->IsHeadArray = array();\r\n		$this->ParentArray = array();\r\n		$this->Content = \"\";\r\n		$this->LoadMenus();\r\n\r\n	}\r\n\r\n	\r\n	//******************************************************************************//\r\n	//Function: ODOCMSPages::LoadODOMenus($MenuType)				//\r\n	//Parameters: MenuType-integer: simple select statement choses the menu 	//\r\n	//type to output								//\r\n	//Description: Used by every ODO Object to create content to be displayed	//\r\n	//for menus only								//\r\n	//******************************************************************************//\r\n	private function LoadODOMenus() {\r\n		\r\n		//menu MENU Selection\r\n		//->List Menus\r\n		//->New Head\r\n		//->Edit Tree\r\n		//->Clone Tree\r\n		\r\n		\r\n		//menu Permissions\r\n		//->Build Group Menus\r\n		\r\n		\r\n		\r\n		\r\n\r\n	}\r\n\r\n	private function ResetArrays() {\r\n\r\n		//Clear NameArray\r\n		$MyRValue = \"Nothing\";\r\n\r\n		while(!is_null($MyRValue)) {\r\n			$MyRValue = array_pop($this->NameArray);\r\n		}\r\n\r\n		$MyRValue = \"Nothing\";\r\n\r\n		while(!is_null($MyRValue)) {\r\n			$MyRValue = array_pop($this->URLArray);\r\n		}\r\n\r\n		$MyRValue = \"Nothing\";\r\n	\r\n		while(!is_null($MyRValue)) {\r\n			$MyRValue = array_pop($this->IsHeadArray);\r\n		}\r\n		\r\n		$MyRValue = \"Nothing\";\r\n	\r\n		while(!is_null($MyRValue)) {\r\n			$MyRValue = array_pop($this->ParentArray);\r\n		}\r\n\r\n		$MyRValue = array();\r\n\r\n		while(!is_null($MyRValue)) {\r\n			$MyRValue = array_pop($this->ChildrenArray);\r\n			$MyInnerValue = \"Nothing\";\r\n			while((!is_null($MyInnerValue))&&(!is_null($MyRValue))) {\r\n				$MyInnerValue = array_pop($MyRValue);\r\n			}\r\n		}\r\n\r\n		$this->NameArray = array();\r\n		$this->URLArray = array();\r\n		$this->ChildrenArray = array(array());\r\n		$this->IsHeadArray = array();\r\n		$this->ParentArray = array();\r\n\r\n		$this->LoadMenus();\r\n\r\n	}\r\n\r\n	private function LoadMenus() {\r\n		\r\n		$query = \"SELECT * FROM ODOTree\";\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n	\r\n		while($row = mysqli_fetch_assoc($result)) \r\n		{\r\n			if(strlen($row[\"HeadTag\"]) > 0) {\r\n				$this->IsHeadArray[$row[\"HeadTag\"]] = $row[\"PriKey\"];\r\n			}\r\n			\r\n			$this->NameArray[$row[\"PriKey\"]] = $row[\"LinkName\"];\r\n			$this->URLArray[$row[\"PriKey\"]] = $row[\"URL\"];\r\n			\r\n			if($row[\"ParentID\"] != 0) {\r\n				$this->ChildrenArray[$row[\"ParentID\"]][$row[\"ChildPos\"]] = $row[\"PriKey\"];\r\n				$this->ParentArray[$row[\"PriKey\"]] = $row[\"ParentID\"];\r\n			}\r\n			\r\n		}\r\n\r\n		//sort all children arrays\r\n		foreach($this->NameArray as $ID=>$Value) {\r\n			if(isset($this->ChildrenArray[$ID])) {\r\n				//we are sorting in reverse because we push and pop below.\r\n				krsort($this->ChildrenArray[$ID], SORT_NUMERIC);\r\n			}\r\n		}\r\n		\r\n		\r\n	}\r\n\r\n\r\n	function FullMenu($HeadTag, $SelectedID = 0) {\r\n		$RValue = \"\";\r\n		//get position\r\n		$Pos = 0;\r\n		$tempArray = array();\r\n		$LevelCount = 0;\r\n		$LevelArray = array();\r\n\r\n		if(isset($this->IsHeadArray[$HeadTag])) {\r\n			$RValue = \"<UL>\";\r\n			$Pos = $this->IsHeadArray[$HeadTag];\r\n			array_push($tempArray, $Pos);\r\n			$LevelArray[$LevelCount] = 0;\r\n\r\n			while(count($tempArray) > 0) {\r\n				$Pos = array_pop($tempArray);\r\n				$RValue = $RValue . \"\\n<li>\";\r\n				if($Pos == $SelectedID) {\r\n					if(isset($this->NameArray[$Pos])) {\r\n						$RValue = $RValue . \"<B>\" . $this->NameArray[$Pos] . \"</B>\\n\";\r\n					} else {\r\n						$RValue = $RValue . \"<B>NONAME</B>\\n\";\r\n					}\r\n\r\n				} elseif(strlen($this->URLArray[$Pos]) > 0) {\r\n					$RValue = $RValue . \"<a href=\\\"javascript:SelectMenuItem(\" . $Pos . \")\\\" id=\\\"\" . $Pos . \"\\\">\" . $this->NameArray[$Pos] . \"</a>\\n\";\r\n				} elseif(strlen($this->NameArray[$Pos]) > 0) {\r\n					$RValue = $RValue . \"<a href=\\\"javascript:SelectMenuItem(\" . $Pos . \")\\\" id=\\\"\" . $Pos . \"\\\" style=\\\"text-decoration : none\\\">\" . $this->NameArray[$Pos] . \"</a>\\n\";\r\n				} else {\r\n					$RValue = $RValue . \"<a href=\\\"javascript:SelectMenuItem(\" . $Pos . \")\\\" id=\\\"\" . $Pos . \"\\\" style=\\\"text-decoration : none\\\">\" . $HeadTag . \"</a>\\n\";\r\n				}\r\n			\r\n				if(isset($this->ChildrenArray[$Pos])) {\r\n					$RValue = $RValue . \"\\n<UL>\";\r\n					$LevelCount = $LevelCount + 1;\r\n					foreach($this->ChildrenArray[$Pos] as $ID=>$Value){\r\n						array_push($tempArray, $Value);\r\n						if(isset($LevelArray[$LevelCount])) {\r\n							$LevelArray[$LevelCount] = $LevelArray[$LevelCount] + 1;\r\n						} else {\r\n							$LevelArray[$LevelCount] = 1;\r\n						}\r\n					}\r\n\r\n				} else {\r\n					if($LevelArray[$LevelCount] > 1) {\r\n						$RValue = $RValue . \"\\n</LI>\";\r\n						$LevelArray[$LevelCount] = $LevelArray[$LevelCount] - 1;\r\n					} else {\r\n						$LevelArray[$LevelCount] = $LevelArray[$LevelCount] - 1;\r\n						$LevelCount = $LevelCount - 1;\r\n						if($LevelCount >= 0) {\r\n							$LevelArray[$LevelCount] = $LevelArray[$LevelCount] - 1;\r\n							$RValue = $RValue . \"\\n</LI></UL></LI>\";\r\n							if($LevelArray[$LevelCount] == 0) {\r\n								$RValue = $RValue . \"\\n</UL></LI>\\n\";\r\n							}\r\n						}\r\n					}\r\n				}\r\n\r\n			}\r\n			$RValue = $RValue . \"\\n</UL>\";\r\n			return $RValue;\r\n\r\n		} else {\r\n			$RValue = \"No Head Found!\";\r\n			return $RValue;\r\n		}\r\n		\r\n	}\r\n\r\n	Private function MoveMenuItem($MoveItem, $NewParent) {\r\n		//change parentID and ChildPosition\r\n		//first find current child max\r\n	\r\n		\r\n		$query = \"SELECT MAX(ChildPos) FROM ODOTree WHERE ParentID=\" . $NewParent;\r\n			\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!$result) {\r\n			return false;\r\n		}\r\n\r\n		if(!($row = mysqli_fetch_row($result))) {\r\n			return false;\r\n		}\r\n\r\n		$MyChildPos = $row[0] + 1;\r\n\r\n		$query = \"UPDATE ODOTree SET ChildPos=\" . $MyChildPos . \", ParentID=\" . $NewParent . \" WHERE PriKey=\" . $MoveItem;\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n			$this->ResetArrays();\r\n			return true;\r\n		} else {\r\n			return false;\r\n		}\r\n\r\n		\r\n\r\n	}\r\n\r\n	//returns an array of all Primary keys of all Children under Parent\r\n	function GetAllChildren($Parent) {\r\n		$MyArray = array();\r\n		$MyinnerArray = array();\r\n\r\n		if(isset($this->ChildrenArray[$Parent])) {\r\n			foreach($this->ChildrenArray[$Parent] as $ID=>$Value){\r\n				array_push($MyArray, $Value);\r\n				if(isset($this->ChildrenArray[$Value])) {\r\n					$MyinnerArray = $this->GetAllChildren($Value);\r\n					while(count($MyinnerArray) > 0) {\r\n						array_push($MyArray, array_pop($MyinnerArray));\r\n					}\r\n				}\r\n			}\r\n\r\n		}\r\n\r\n		return $MyArray;\r\n	}\r\n\r\n	function GetGroupsForObjects($Objects) {\r\n\r\n		$MyArray = array();\r\n\r\n		foreach($Objects as $ID=>$Value){\r\n			\r\n			$query = \"SELECT DISTINCT ODOGroups.GID, ODOGroups.GroupName FROM Objects, ODOObjectACL, ODOGroups WHERE Objects.ObjID=\" . $ID . \" AND Objects.CodeSegID=ODOObjectACL.CodeSegID AND ODOObjectACL.GID=ODOGroups.GID\";\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($result)) \r\n			{\r\n				$MyArray[$row[\"GID\"]] = $row[\"GroupName\"];\r\n			}\r\n			\r\n		}\r\n\r\n		return $MyArray;\r\n\r\n	}\r\n\r\n	function GetGroupsInPage($PageID) {\r\n		$MyArray = array();\r\n\r\n		$query = \"SELECT ODOGroups.GID, ODOGroups.GroupName FROM ODOGroups, ODOGACL WHERE ODOGACL.PageID=\" . $PageID . \" AND ODOGACL.GID=ODOGroups.GID\";\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		while($row = mysqli_fetch_assoc($result)) \r\n		{\r\n			$MyArray[$row[\"GID\"]] = $row[\"GroupName\"];\r\n		}\r\n\r\n		return $MyArray;\r\n	}\r\n\r\n	function GetObjectsInPage($PageID) {\r\n		\r\n		$MyArray = array();\r\n\r\n		$query = \"SELECT ObjectNames.ObjID, ObjectNames.Name FROM ODOPageObject, ObjectNames WHERE ODOPageObject.PageID=\" . $PageID. \" AND ODOPageObject.ObjID=ObjectNames.ObjID\";\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		while($row = mysqli_fetch_assoc($result)) \r\n		{\r\n			$MyArray[$row[\"ObjID\"]] = $row[\"Name\"];\r\n		}\r\n\r\n		return $MyArray;\r\n\r\n	}\r\n\r\n//end head\r\n',1,0,12),(59,'ODOCMSMenuFoot',_binary '\r\n//begin footer\r\n	function __wakeup() {\r\n		$this->Content = \"\";\r\n	}\r\n\r\n\r\n}\r\n\r\n',0,1,12),(60,'ListHeads',_binary '\r\n	function ListHeads() {\r\n\r\n		if(strlen($this->SelectedHead) > 0 ) {\r\n			$this->SelectedHead = \"\";\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"<BR><BR><H3>Select Menu Head to Edit</H3><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditTree\\\"><SELECT name=\\\"TreeHead\\\">\";\r\n\r\n		foreach( $this->IsHeadArray as $ID=>$Value) {\r\n			$this->Content = $this->Content . \"\\n<option value=\\\"\" . $ID . \"\\\">\" . $ID . \"</option>\";\r\n		}\r\n		\r\n		$this->Content = $this->Content . \"\\n</select>\\n<BR><BR><input type=\\\"submit\\\" name=\\\"Edit Tree\\\" value=\\\"Edit Tree\\\"><BR></form></center>\";\r\n\r\n	}\r\n\r\n	',0,0,12),(61,'EditTree',_binary '\r\n	function EditTree() {\r\n		//3 types 1-Head 2-Link no URL 3-Link with URL\r\n		//functions: Move under new location. New Under. Delete. \r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		$this->Content = $this->Content . \"<BR><BR><CENTER><H3><B>Select Menu Item to Edit/Move</B></H3><BR><BR>\";\r\n\r\n		//check if this is our first load\r\n		\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PreviousMenuItemSel\"])) {\r\n				if($this->MoveMenuItem($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PreviousMenuItemSel\"], $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n					$this->Content = $this->Content . \"<H3>Move completed</H3><BR><BR>\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<H3>Move Failed!</H3><BR><BR>\";\r\n				}\r\n\r\n				$TempRVal = $this->FullMenu($this->SelectedHead, (int)$_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"]);\r\n\r\n				$this->Content = $this->Content . \"<TABLE><TR><TD>\" . $TempRVal . \"</TD></TR></TABLE>\";\r\n\r\n				return;\r\n			}\r\n\r\n			$TempRVal = $this->FullMenu($this->SelectedHead, (int)$_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"]);\r\n\r\n			$this->Content = $this->Content . \"<TABLE><TR><TD>\" . $TempRVal . \"</TD></TR></TABLE>\";\r\n\r\n\r\n			//recall edit tree to select what menu item to move it under\r\n			$this->Content = $this->Content . \"<BR><BR><B>Please select a location to move the menu item under. All children of this menu item will be moved as well.</B><BR><BR><center><Table border=0><TR>\";\r\n\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"MoveMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditTree\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"PreviousMenuItemSel\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Move Under New\\\" value=\\\"Move Under New\\\"></td></form></TR></TABLE></center>\";\r\n\r\n		} else { \r\n			$TempRVal = $this->FullMenu($this->SelectedHead);\r\n\r\n			$this->Content = $this->Content . \"<center><TABLE><TR><TD>\" . $TempRVal . \"</TD></TR></TABLE>\";\r\n\r\n\r\n			//recall edit tree to select what menu item to move it under\r\n			$this->Content = $this->Content . \"<BR><BR><table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"MoveMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditTree\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Move Under New\\\" value=\\\"Move Under New\\\"></td></form>\";\r\n\r\n			\r\n			//New item, on submit check value if selectedmenuitem is 0 then fail\r\n			//if not 0 then create new item under selectedmenuitem calling new function\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"NewMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"New Item\\\" value=\\\"New Item\\\">\\n</TD></form>\";\r\n\r\n		\r\n			//Edit Item\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"EditMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Edit Item\\\" value=\\\"Edit Item\\\"></TD></form>\";\r\n\r\n			//Delete Item \r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"DeleteMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Delete Item\\\" value=\\\"Delete Item\\\"></TD></form>\";\r\n\r\n\r\n			//on submit check value then call seperate moveup function\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"UpMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"MoveUp\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Move Up\\\" value=\\\"Move Up\\\">\\n</TD></form>\";\r\n\r\n			//on submit check value then call seperate movedown function\r\n			$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"DownMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"MoveDown\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Move Down\\\" value=\\\"Move Down\\\">\\n</TD></form></TR></TABLE></CENTER>\";\r\n\r\n\r\n		}\r\n\r\n		\r\n	}\r\n\r\n\r\n	',0,0,12),(62,'ODOCMSLogsHead',_binary '\r\n\r\nclass ODOCMSLogs {\r\n\r\n	var $SelectedReport;\r\n	var $Content;\r\n	var $OurDataLogLength;\r\n\r\n\r\n	function  __construct() {\r\n		$Content = \"\";\r\n		$SelectedReport = 0;\r\n		$this->OurDataLogLength = 0;\r\n		\r\n	}\r\n	\r\n	private function LoadODOMenus() {\r\n		\r\n		//LOGS\r\n		//->View By Types\r\n		//->View By Severity\r\n		//->View IPs\r\n		//->Search\r\n		\r\n		\r\n		//Reports\r\n		//->Login Logout Report\r\n		//->Access Violations\r\n		//->Website errors\r\n		//->Manage Reports\r\n		\r\n		//Cleanup\r\n		//->Remove Old Logs\r\n		//->Remove Logs by...\r\n\r\n		//IP Lists\r\n		//Black/White List\r\n		//IP tools\r\n\r\n	\r\n		\r\n\r\n	}\r\n//header\r\n',1,0,13),(63,'ViewByType',_binary '\r\n	function ViewByType() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSLogs\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"])) {\r\n			$query = \"SELECT * FROM ODOLogs WHERE ActionDone=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"\' ORDER BY TimeStamp DESC\";\r\n	\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			//use old school PHP page viewer because of the amount of data that could be here\r\n			//will use MySQL LIMIT in future versions\r\n\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 20;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 20 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				\r\n				$this->Content = $this->Content . \"<center><br><H3><B>Log List</B></H3><br><H3>Type: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"</H3><BR><BR><table border=1><TR><TH>Time Stamp</TH><th>UserID</th><th>Severity</th><TH>IP Add</TH><th>Description</th></TR>\";\r\n\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 20;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n				\r\n				while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$this->Content = $this->Content . \"<tr><TD>\" . $row[\"TimeStamp\"] . \"</TD><td><center><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditUser&userid=\" . $row[\"UID\"] . \"\\\">\" . $row[\"UID\"] . \"</a></center></td><td>\" . $row[\"Severity\"] . \"</td><td><center><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=IPTools&IP=\" . $row[\"IP\"] . \"\\\">\" . $row[\"IP\"] . \"</a></center></td>\";\r\n\r\n					$this->Content = $this->Content . \"<td>\" . $row[\"Comment\"] . \"</td></TR>\\n\";\r\n			\r\n			\r\n					$Count = $Count + 1;\r\n				}\r\n			\r\n				$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByType&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByType&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByType&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n\r\n			}\r\n\r\n		} else {\r\n		\r\n			$this->Content = $this->Content . \"<BR><BR><center><H3>Please select a type of log to view.</H3><BR>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSLogsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ViewByType\\\"><SELECT name=\\\"SelectedType\\\">\";\r\n\r\n			$query = \"SELECT ActionDone FROM ODOLogs Group by ActionDone\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"ActionDone\"] . \"\\\">\" . $row[\"ActionDone\"] . \"</option>\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</SELECT>\\n<BR><BR><input type=\\\"submit\\\" name=\\\"View\\\" value=\\\"View\\\"></form></center>\";\r\n\r\n		}\r\n	}\r\n\r\n\r\n	',0,0,13),(64,'ODOCMSLogsFoot',_binary '\r\n//footer\r\n	function __wakeup() {\r\n		$this->Content = \"\";\r\n	}\r\n\r\n}\r\n\r\n',0,1,13),(65,'ViewBySeverity',_binary '\r\n	function ViewBySeverity() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSLogs\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"])) {\r\n			$query = \"SELECT * FROM ODOLogs WHERE Severity=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \" ORDER BY TimeStamp DESC\";\r\n	\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			//use old school PHP page viewer because of the amount of data that could be here\r\n			//will use MySQL LIMIT in future versions\r\n\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			}\r\n\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 20;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 20 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			} else {\r\n				\r\n				$this->Content = $this->Content . \"<center><br><H3><B>Log List</B></H3><br><H3>Type: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"</H3><BR><BR><table border=1><TR><TH>Time Stamp</TH><th>UserID</th><th>Action</th><TH>IP Add</TH><th>Description</th></TR>\";\r\n\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 20;\r\n				mysqli_data_seek($TempRecords, $ChangeToRow);\r\n				\r\n				while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n					$this->Content = $this->Content . \"<tr><TD>\" . $row[\"TimeStamp\"] . \"</TD><td><center><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditUser&userid=\" . $row[\"UID\"] . \"\\\">\" . $row[\"UID\"] . \"</a></center></td><td>\" . $row[\"ActionDone\"] . \"</td><td><center><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=IPTools&IP=\" . $row[\"IP\"] . \"\\\">\" . $row[\"IP\"] . \"</a></center></td>\";\r\n\r\n					$this->Content = $this->Content . \"<td>\" . $row[\"Comment\"] . \"</td></TR>\\n\";\r\n			\r\n			\r\n					$Count = $Count + 1;\r\n				}\r\n			\r\n				$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewBySeverity&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewBySeverity&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewBySeverity&SelectedType=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedType\"] . \"&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n\r\n			}\r\n\r\n		} else {\r\n		\r\n			$this->Content = $this->Content . \"<BR><BR><center><H3>Please select a Severity to view.</H3><BR>\\n<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSLogsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ViewBySeverity\\\"><SELECT name=\\\"SelectedType\\\">\";\r\n\r\n			$query = \"SELECT Severity FROM ODOLogs Group by Severity\";\r\n\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"Severity\"] . \"\\\">\" . $row[\"Severity\"] . \"</option>\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</SELECT>\\n<BR><BR><input type=\\\"submit\\\" name=\\\"View\\\" value=\\\"View\\\"></form></center>\";\r\n\r\n		}\r\n	}\r\n\r\n	',0,0,13),(67,'ODOCMSNewsHead',_binary '\r\n\r\nclass ODOCMSNews {\r\n\r\n	var $Content;\r\n	var $PostID;\r\n	var $CatID;\r\n	var $CatName;\r\n	var $Topic;\r\n\r\n	function  __construct() {\r\n		$this->Content = \"\";\r\n		$this->PostID = 0;\r\n		$this->CatID = 0;\r\n		$this->Topic = \"\";\r\n		$this->CatName = \"\";\r\n	}\r\n\r\n	private function ClearPost() {\r\n		$this->PostID = 0;\r\n		$this->Topic = \"\";\r\n	}\r\n\r\n	private function ClearCat() {\r\n		$this->CatID = 0;\r\n		$this->CatName = \"\";\r\n	}\r\n	//******************************************************************************//\r\n	//Function: ODOCMSPages::LoadODOMenus($MenuType)				//\r\n	//Parameters: MenuType-integer: simple select statement choses the menu 	//\r\n	//type to output								//\r\n	//Description: Used by every ODO Object to create content to be displayed	//\r\n	//for menus only								//\r\n	//******************************************************************************//\r\n	function LoadODOMenus() {\r\n		\r\n		//menu Object Selection\r\n		//Posts\r\n		//->New Post\r\n		//->List Postings\r\n		//->Edit Post\r\n		//->Delete Post\r\n		\r\n		//Categories\r\n		//Add Remove Groups\r\n		//New Category\r\n		//List Categories\r\n		$this->Content = $this->Content . \"<BR><BR>\";\r\n		\r\n		if($this->PostID != 0) {\r\n			$this->Content = $this->Content . \"<table border=1><TR><TD>PostID:</TD><TD>\" . $this->PostID . \"</TD></TR><TR><TD>Title:</TD><TD>\" . $this->Topic . \"</TD></TR></TABLE><BR><BR>\";\r\n		}\r\n		\r\n		if($this->CatID !=0 ) {\r\n			$this->Content = $this->Content . \"<TABLE border=1><TR><TD>CatID:</TD><TD>\" . $this->CatID . \"</TD></TR><TR><TD>Category Name:</TD><TD>\" . $this->CatName . \"</TD></TR></TABLE><BR><BR>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n',1,0,14),(68,'ODOCMSNewsFoot',_binary '\r\n//begin footer\r\n	function __wakeup() {\r\n		$this->Content = \"\";\r\n	}\r\n\r\n\r\n}\r\n',0,1,14),(69,'NewPost',_binary '\r\n	function NewPost() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateNew\"])) {\r\n			$this->Content = $this->Content . \"<BR><h3>Please wait while we add posting...</h3><br><br>\";\r\n\r\n			$query = \"insert into news (Title, Article, CatID, AllowGuest) values (\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Title\"] . \"\', \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"article\"] . \"\', \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CATS\"] . \"\',\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"allowguest\"])) {\r\n				$query = $query . \"1)\";\r\n			} else {\r\n				$query = $query . \"0)\";\r\n			}\r\n			\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$this->PostID = $GLOBALS[\'globalref\'][1]->LastInsertID();\r\n			$this->Topic = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Title\"];\r\n			$this->Content = $this->Content . \"<H4>Created Post</H4><br><br></center>\";\r\n\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"<BR><H3>Add New Article</H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewPost\\\">\";\r\n		\r\n			$this->Content = $this->Content . \"Title:&nbsp;<INPUT type=\\\"text\\\" name=\\\"Title\\\" size=\\\"50\\\" maxlength=\\\"254\\\" value=\\\"\\\"><br>Allow Guests to view?&nbsp;<input type=\\\"checkbox\\\" name=\\\"allowguest\\\" value=\\\"true\\\"><br>\";\r\n\r\n			$query = \"select * from newsCats\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"News Category:<br><SELECT name=\\\"CATS\\\">\";\r\n\r\n			while ($row = mysqli_fetch_assoc($TempRecords)) {\r\n	\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"PriKey\"] . \"\\\">\" . $row[\"CatName\"] . \"</option>\";\r\n			}\r\n		\r\n			$this->Content = $this->Content . \"</SELECT><br>Article:<br><textarea NAME=\\\"article\\\" id=\\\"article\\\" COLS=80 ROWS=35></textarea><br>\";\r\n			$this->Content = $this->Content . \"<input type=\\\"submit\\\" name=\\\"CreateNew\\\" value=\\\"Post Article\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n',0,0,14),(70,'ListPosts',_binary '\r\n	function ListPosts() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if($this->PostID != 0) {\r\n			$this->ClearPost();\r\n		}\r\n\r\n		$this->Content = $this->Content . \"<center><table border=1><TR><TH>Art ID</TH><th>Date Posted</th><th>Article Title</th><th>Edit</th><th>Remove</th></TR>\";\r\n\r\n		$query = \"select * from news\";\r\n\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		$i = 0;\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 20;\r\n		$NumofPages = intval($NumofPages);\r\n\r\n		if( ($RecordCount % 20 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(!mysqli_num_rows($TempRecords))\r\n		{\r\n			//do nothing since no news arts are available\r\n		} else {\r\n			\r\n			while ($row = mysqli_fetch_assoc($TempRecords)) {\r\n\r\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"\";\r\n\r\n				if($i > 19) {\r\n					$this->Content = $this->Content . \" style=display:none\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPost\\\"><input type=\\\"hidden\\\" name=\\\"PostID\\\" value=\\\"\" . $row[\"PriKey\"] . \"\\\"><td>\" . $row[\"PriKey\"] . \"</td><td>\" . $row[\"Date\"] . \"</td><TD>\" . $row[\"Title\"] . \"</td><td><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePost\\\"><input type=\\\"hidden\\\" name=\\\"PostID\\\" value=\\\"\" . $row[\"PriKey\"] . \"\\\"><td><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></form></tr>\";\r\n\r\n				$i = $i + 1;\r\n			}\r\n			\r\n		}\r\n\r\n		$this->Content = $this->Content . \"</table><br>\";\r\n		//ODOWeb javascript page view\r\n			if($NumofPages > 1) {\r\n				$i = 1;\r\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				while($i <= $NumofPages) {\r\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\r\n					$i = $i + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\r\n			}\r\n	}\r\n\r\n	',0,0,14),(71,'EditPost',_binary '\r\n	function EditPost() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n			\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"])) {\r\n			if($this->PostID != 0) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"] = $this->PostID;\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>Please select a Post to edit.</H3></center>\";\r\n				return;\r\n			}\r\n		}\r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			$this->Content = $this->Content . \"<BR><h3>Please wait while we update post...</h3><br><br>\";\r\n\r\n			$query = \"UPDATE news SET Title=\'\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Title\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Title\"] . \"\',\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<H3>Error. No Title!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = $query . \" Article=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"article\"] . \"\', CatID=\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CATS\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CATS\"] . \", AllowGuest=\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<H3>Error. No Category!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"allowguest\"])) {\r\n				$query = $query . \"1\";\r\n			} else {\r\n				$query = $query . \"0\";\r\n				\r\n			}\r\n\r\n			$query = $query . \" WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n			\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->PostID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n			$this->Topic = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Title\"];\r\n\r\n			$this->Content = $this->Content . \"<H4>Updated Post</H4><br><br></center>\";\r\n\r\n		} else {\r\n			\r\n			$query = \"Select * from news WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$row = mysqli_fetch_assoc($TempRecords);\r\n\r\n			$this->Content = $this->Content . \"<BR><H3>Update Article</H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPost\\\"><input type=\\\"hidden\\\" name=\\\"PostID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"] . \"\\\">\";\r\n		\r\n			$this->Content = $this->Content . \"Title:&nbsp;<INPUT type=\\\"text\\\" name=\\\"Title\\\" size=\\\"50\\\" maxlength=\\\"254\\\" value=\\\"\" . $row[\"Title\"] . \"\\\"><br>Allow Guests to view?&nbsp;<input type=\\\"checkbox\\\" name=\\\"allowguest\\\" value=\\\"true\\\" \";\r\n\r\n			if($row[\"AllowGuest\"] == 1) {\r\n				$this->Content = $this->Content . \" checked><BR>\";\r\n			} else {\r\n				$this->Content = $this->Content . \" value=\\\"false\\\"><BR>\";\r\n			} \r\n\r\n			$query2 = \"select * from newsCats\";\r\n			$TempRecords2 = $GLOBALS[\'globalref\'][1]->Query($query2);\r\n\r\n			$this->Content = $this->Content . \"News Category:<br><SELECT name=\\\"CATS\\\">\";\r\n\r\n			while ($row2 = mysqli_fetch_assoc($TempRecords2)) {\r\n	\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row2[\"PriKey\"] . \"\\\"\";\r\n				if($row[\"CatID\"] == $row2[\"PriKey\"]) {\r\n					$this->Content = $this->Content . \" selected\";\r\n				}\r\n				$this->Content = $this->Content . \">\" . $row2[\"CatName\"] . \"</option>\";\r\n			}\r\n		\r\n			$this->Content = $this->Content . \"</SELECT><br>Article:<br><textarea NAME=\\\"article\\\" id=\\\"article\\\" COLS=80 ROWS=35>\" . htmlspecialchars($row[\"Article\"]) . \"</textarea><br>\";\r\n			$this->Content = $this->Content . \"<input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,14),(72,'DeletePost',_binary '\r\n	function DeletePost() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"])) {\r\n			if($this->PostID != 0) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"] = $this->PostID;\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>Please select a Post to delete.</H3></center>\";\r\n				return;\r\n			}\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Confirm\"])) {\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Deleting...</H3>\";\r\n\r\n			$query = \"DELETE FROM news WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"];\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"<BR><BR>Deleted</center>\";\r\n\r\n		} else {\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Are you sure you want to Delete this post?</H3><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeletePost\\\"><input type=\\\"hidden\\\" name=\\\"Confirm\\\" value=\\\"Confirm\\\"><input type=\\\"hidden\\\" name=\\\"PostID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PostID\"] . \"\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></form>\";\r\n		}\r\n\r\n	}\r\n\r\n	',0,0,14),(73,'ListCategories',_binary '\r\n	function ListCategories() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if($this->CatID != 0) {\r\n			$this->ClearCat();\r\n		}\r\n\r\n		$this->Content = $this->Content . \"<center><table border=1><TR><TH>CatID</TH><th>Category Name</th><th>Edit</th><th>Remove</th></TR>\";\r\n\r\n		$query = \"select * from newsCats\";\r\n\r\n		$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		$i = 0;\r\n		$RecordCount = mysqli_num_rows($TempRecords);\r\n		$NumofPages = $RecordCount / 20;\r\n		$NumofPages = intval($NumofPages);\r\n\r\n		if( ($RecordCount % 20 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(!mysqli_num_rows($TempRecords))\r\n		{\r\n			//do nothing since no news arts are available\r\n		} else {\r\n			\r\n			while ($row = mysqli_fetch_assoc($TempRecords)) {\r\n\r\n				$this->Content = $this->Content . \"<TR id=\\\"rownum\" . $i . \"\\\"\";\r\n\r\n				if($i > 19) {\r\n					$this->Content = $this->Content . \" style=display:none\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditCategory\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $row[\"PriKey\"] . \"\\\"><td>\" . $row[\"PriKey\"] . \"</td><td>\" . $row[\"CatName\"] . \"</td><td><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteCategory\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $row[\"PriKey\"] . \"\\\"><td><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></form></tr>\";\r\n\r\n				$i = $i + 1;\r\n			}\r\n			\r\n		}\r\n\r\n		$this->Content = $this->Content . \"</table><br>\";\r\n		//ODOWeb javascript page view\r\n			if($NumofPages > 1) {\r\n				$i = 1;\r\n				$this->Content = $this->Content . \"<center><BR><BR><a href=\\\"javascript:ChangePage(-1, \" . $RecordCount . \", \" . $NumofPages . \")\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				while($i <= $NumofPages) {\r\n					$this->Content = $this->Content . \"<a id=\\\"LinkID\" . $i . \"\\\" href=\\\"javascript:ChangePage(\" . $i . \", \" . $RecordCount . \", \" . $NumofPages . \")\\\">\" . $i . \"</a>&nbsp;\";\r\n					$i = $i + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"&nbsp;<a href=\\\"javascript:ChangePage(-2, \" . $RecordCount . \", \" . $NumofPages . \")\\\">Next-></a><center>\";\r\n			}\r\n\r\n	}\r\n\r\n	',0,0,14),(74,'NewCategory',_binary '\r\n	function NewCategory() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateNew\"])) {\r\n			$this->Content = $this->Content . \"<BR><h3>Please wait while we create Category...</h3><br><br>\";\r\n\r\n			//check if exists first\r\n			$query = \"select * from newsCats WHERE CatName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"] . \"\'\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($TempRecords) != 0) {\r\n				$this->Content = $this->Content . \"<H3>Category name already exists!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"insert into newsCats (CatName) values (\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"] . \"\')\";\r\n			\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$query = \"select * from newsCats WHERE CatName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"] . \"\'\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($TempRecords) != 0) {\r\n				$this->Content = $this->Content . \"<H3>Category could not be created</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$row = mysqli_fetch_assoc($TempRecords);\r\n			$this->CatID = $row[\"CatID\"];\r\n			$this->CatName = $row[\"CatName\"];\r\n\r\n			$this->Content = $this->Content . \"<H4>Created Category</H4><br><br></center>\";\r\n\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"<BR><H3>Add New Category</H3><br><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewCategory\\\">\";\r\n		\r\n			$this->Content = $this->Content . \"Name:&nbsp;<INPUT type=\\\"text\\\" name=\\\"Name\\\" size=\\\"50\\\" maxlength=\\\"50\\\" value=\\\"\\\"><br>\";\r\n\r\n			$this->Content = $this->Content . \"<input type=\\\"submit\\\" name=\\\"CreateNew\\\" value=\\\"Create New\\\"></form></center>\";\r\n\r\n		}\r\n	}\r\n\r\n	',0,0,14),(75,'EditCategory',_binary '\r\n	function EditCategory() {\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n			if($this->CatID != 0) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"] = $this->CatID;\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>Please select a Category to edit.</H3></center>\";\r\n				return;\r\n			}\r\n		} \r\n		\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateCat\"])) {\r\n\r\n			if((!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"])) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"]) < 1)) {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>You need to select a Name to update the Category to!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"UPDATE newsCats SET catName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"] . \"\' WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->CatID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n			$this->CatName = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"Name\"];\r\n\r\n			$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n			$this->LoadODOMenus();\r\n			\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Category updated</H3></center>\";\r\n	\r\n		} else {\r\n\r\n			$query = \"SELECT * FROM newsCats WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			if($row = mysqli_fetch_assoc($TempRecords)) {\r\n			\r\n				$this->CatID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n				$this->CatName = $row[\"CatName\"];\r\n\r\n				$this->Content = $this->Content . \"<H3>Edit Category</H3><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditCategory\\\"><input type=\\\"hidden\\\" name=\\\"UpdateCat\\\" value=\\\"UpdateCat\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"] . \"\\\"><input type=\\\"text\\\" name=\\\"Name\\\" value=\\\"\" . $row[\"CatName\"] . \"\\\" size=\\\"50\\\" maxlength=\\\"50\\\"><BR><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<H3>CatID not found!</H3></center>\";\r\n			}\r\n		}\r\n		\r\n	}\r\n\r\n	',0,0,14),(76,'AddRemoveGroups',_binary '\r\n	function AddRemoveGroups() {\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if($this->CatID == 0) {\r\n			$this->Content = $this->Content . \"<BR><BR><H3>You must select a Category to update!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateGroups\"])) {\r\n\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Updating groups...</H3><BR>\";\r\n\r\n			$query = \"DELETE FROM newsGACL WHERE NewsGID=\" . $this->CatID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			$this->Content = $this->Content . \"<B>Cleared previous groups asigned</B><BR><BR>\";\r\n\r\n			if(isset($_POST[\'GROUPS\'])) {\r\n				$Groups = $_POST[\'GROUPS\'];\r\n				foreach ( $Groups as $newg)\r\n				{\r\n					\r\n					$query = \"insert into newsGACL (NewsGID, GID) values(\" . $this->CatID . \",\" . $newg . \")\";\r\n					$this->Content = $this->Content . \"<BR>\" . $query . \"<BR>\";\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				\r\n				}\r\n			}\r\n	\r\n			$this->Content = $this->Content . \"<B>Groups Updated</B></center>\";\r\n		\r\n			\r\n		} else {\r\n\r\n			$query = \"SELECT ODOGroups.GID, ODOGroups.GroupName, ODOGroups.GroupDesc, newsGACL.NewsGID FROM ODOGroups LEFT JOIN newsGACL on ODOGroups.GID=newsGACL.GID and newsGACL.NewsGID=\" . $this->CatID;\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Please select groups.</H3><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"AddRemoveGroups\\\"><input type=\\\"hidden\\\" name=\\\"UpdateGroups\\\" value=\\\"UpdateGroups\\\"><SELECT name=\\\"GROUPS[]\\\" multiple>\";\r\n\r\n			while($row = mysqli_fetch_assoc($TempRecords)) {\r\n				$this->Content = $this->Content . \"\\n<option value=\\\"\" . $row[\"GID\"] . \"\\\"\";\r\n				\r\n				if($row[\"NewsGID\"] == $this->CatID) {\r\n					$this->Content = $this->Content . \" selected\";\r\n				}\r\n				$this->Content = $this->Content . \">\" . $row[\"GroupName\"] . \"</option>\";\r\n		\r\n			}\r\n			$this->Content = $this->Content . \"</SELECT>\\n<BR><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form>\";\r\n			\r\n		}\r\n	\r\n	}\r\n\r\n	',0,0,14),(77,'DeteletCategory',_binary '\r\n	function DeteletCategory() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSNews\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"])) {\r\n			if($this->CatID != 0) {\r\n				$_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"] = $this->CatID;\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>Please select a Category to delete.</H3></center>\";\r\n				return;\r\n			}\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Confirm\"])) {\r\n			$query = \"DELETE FROM newsCats WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"];\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Category Deleted.</H3></center>\";\r\n\r\n		} else {\r\n	\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Are you sure you want to delete this Category?</H3><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"CMSNews\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSNewsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteCategory\\\"><input type=\\\"hidden\\\" name=\\\"CatID\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CatID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"Confirm\\\" value=\\\"Confirm\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></form></center>\";\r\n\r\n\r\n		}\r\n\r\n\r\n	}\r\n\r\n	',0,0,14),(81,'EditMenuItem',_binary '\r\n	function EditMenuItem() {\r\n\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a menu item to edit!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateMe\"])) {\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadTag\"])) {\r\n	\r\n				if(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadTag\"]) < 1) {\r\n					$this->Content = $this->Content . \"<BR><Center><B>You must enter a valid Tag name!</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n					return;\r\n				}\r\n			\r\n				$query = \"SELECT * FROM ODOTree WHERE HeadTag=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadTag\"] . \"\'\";\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				if(mysqli_num_rows($result) > 0) {\r\n					$this->Content = $this->Content . \"<BR><Center><B>This Head Tag Name already exists in the system! We can not change the name to this.</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n					return;\r\n				}\r\n\r\n				$query = \"UPDATE ODOTree SET HeadTag=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadTag\"] . \"\' WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n					$this->ResetArrays();\r\n				\r\n					$this->Content = $this->Content . \"<BR><Center><B>Update Completed</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n\r\n					return;\r\n\r\n				} else {\r\n				\r\n					$this->Content = $this->Content . \"<BR><Center><B>Update FAILED!</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n		\r\n					return;\r\n				}\r\n\r\n			} else {\r\n				if((!(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"])))||(!(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsObject\"])))||(!(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"])))||(!(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"MyURL\"])))) {\r\n					$this->Content = $this->Content . \"<BR><Center><B>One or more varialbes are missing!</B></center>\";\r\n					return;\r\n				}\r\n\r\n				$query = \"UPDATE ODOTree SET PageID=\";\r\n				\r\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"] != 0)) {\r\n				\r\n					$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"];\r\n					\r\n				} else {\r\n					\r\n					$query = $query . \"NULL\";\r\n					\r\n				}\r\n				\r\n				$query = $query . \", IsObject=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsObject\"] . \", URL=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"MyURL\"] . \"\', LinkName=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"] . \"\', DependVar=\";\r\n				\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"])&&strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"])) {\r\n					$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"] . \"\'\";\r\n				} else {\r\n					$query = $query . \"NULL\";\r\n				}\r\n				\r\n				$query = $query . \" WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n					$this->ResetArrays();\r\n				\r\n					$this->Content = $this->Content . \"<BR><Center><B>Update Completed</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n\r\n					return;\r\n\r\n				} else {\r\n				\r\n					$this->Content = $this->Content . \"<BR><Center><B>Update FAILED!</B><BR><BR>\\n\\n<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n		\r\n					return;\r\n				}\r\n			}\r\n\r\n\r\n		} else {\r\n\r\n\r\n			$query = \"SELECT * FROM ODOTree WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(!($row = mysqli_fetch_assoc($result))) {\r\n				$this->Content = \"\\n<center><BR><H3>No menu item found!</H3><BR><BR>\";\r\n				return;\r\n			}\r\n\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>Please update the menu item info...</H3><BR><BR><table border=1><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"\\\">\\n<input type=\\\"hidden\\\" name=\\\"UpdateMe\\\" value=\\\"true\\\">\";\r\n\r\n			if(isset($row[\"HeadTag\"]) && (strlen($row[\"HeadTag\"]) > 0)) {\r\n				$this->Content = $this->Content . \"\\n<TR><sub>Please note: Changing tag name may break menus that depend on it. Please update your pages before making this change.</sub></TR><TR><TD>Menu Item ID:</TD><TD>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"</TD></TR><TR><TD>Head Tag Name:</TD><TD><input type=\\\"text\\\" name=\\\"HeadTag\\\" vaule=\\\"\" . $row[\"HeadTag\"] . \"\\\"></TD></TR></Table>\";\r\n\r\n			} else {\r\n			\r\n				\r\n\r\n				$this->Content = $this->Content . \"<TR><TD>Menu Item ID: </TD><TD>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"</TD></TR><TR><TD>Link Name:</TD><TD><input type=\\\"text\\\" name=\\\"LName\\\" value=\\\"\" . $row[\"LinkName\"] . \"\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Is Object:</TD><TD><select name=\\\"IsObject\\\"><option value=\\\"1\\\"\";\r\n\r\n\r\n				if($row[\"IsObject\"] == 1) {\r\n				\r\n					$this->Content = $this->Content . \"selected>Yes</option><option value=\\\"0\\\" >No</option></select>\";\r\n\r\n				} else {\r\n				\r\n					$this->Content = $this->Content . \">Yes</option><option value=\\\"0\\\" selected>No</option></select>\";\r\n\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</TD></TR><TR><TD>PageID:</TD><TD><select name=\\\"pgid\\\"><option value=\\\"0\\\"\";\r\n\r\n				if(is_null($row[\"PageID\"])) {\r\n					$this->Content = $this->Content . \" selected>NOPAGEID</OPTION>\";\r\n				} else {\r\n					$this->Content = $this->Content . \">NOPAGEID</OPTION>\";\r\n				}\r\n\r\n				//load up page names\r\n				$query = \"SELECT PageID, PageName FROM ODOPages\";\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n				while($row2 = mysqli_fetch_assoc($result)) \r\n				{\r\n					$this->Content = $this->Content . \"<option value=\\\"\" . $row2[\"PageID\"] . \"\\\" \";\r\n\r\n					if($row2[\"PageID\"] == $row[\"PageID\"]) {\r\n						$this->Content = $this->Content . \"selected\";\r\n					}\r\n\r\n					$this->Content = $this->Content . \">\" . $row2[\"PageName\"] . \"</option>\";\r\n\r\n				}\r\n		\r\n\r\n				$this->Content = $this->Content . \"</select></TR><TR><TD>URL: </TD><TD><input type=\\\"text\\\" name=\\\"MyURL\\\" value=\\\"\";\r\n\r\n				if((isset($row[\"URL\"]))&&(strlen($row[\"URL\"])>0)) {\r\n\r\n					$this->Content = $this->Content . $row[\"URL\"];\r\n				}\r\n\r\n				$this->Content = $this->Content . \"\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Conditional Var:</TD><TD><input type=\\\"text\\\" name=\\\"ConVar\\\" value=\\\"\";\r\n				\r\n				if((isset($row[\"DependVar\"]))&&(strlen($row[\"DependVar\"])>0)) {\r\n					$this->Content = $this->Content . $row[\"DependVar\"];\r\n					}\r\n				\r\n				$this->Content = $this->Content . \"\\\" maxlength=\\\"20\\\"></TD></TR></table>\";\r\n			\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<BR><BR>\\n\\n<input type=\\\"submit\\\" name=\\\"Update Item\\\" value=\\\"Update Item\\\">\\n</form>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n	\r\n	',0,0,12),(82,'NewMenuItem',_binary '	\r\n	function NewMenuItem() {\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a location in the tree to place the new item!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CreateNew\"])) {\r\n\r\n			//find childid number\r\n			$query = \"SELECT MAX(ChildPos) FROM ODOTree WHERE ParentID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n			\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$MyChildPos = 1;\r\n\r\n			if(($row = mysqli_fetch_row($result))) {\r\n				$MyChildPos = $row[0] + 1;\r\n			}\r\n\r\n			$query = \"INSERT INTO ODOTree(PageID, ParentID, IsObject, URL, LinkName, ChildPos, DependVar) values(\";\r\n\r\n			if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"] != 0)) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"pgid\"] . \", \";\r\n			} else {\r\n				$query = $query . \"NULL, \";\r\n			}\r\n\r\n\r\n			$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \", \";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsObject\"])) {\r\n				$query = $query . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"IsObject\"] . \", \";\r\n			} else {\r\n				$query = $query . \"0, \";\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"MyURL\"])) {\r\n				$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"MyURL\"] . \"\', \";\r\n			} else {\r\n				$query = $query . \"NULL, \";\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"])) {\r\n				$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"] . \"\', \";\r\n			} else {\r\n				$query = $query . \"NULL, \";\r\n			}	\r\n			\r\n			$query = $query . $MyChildPos . \",\";\r\n\r\n				\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"])&&strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"])) {\r\n				$query = $query . \"\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConVar\"] . \"\') \";\r\n		\r\n			} else {\r\n				$query = $query . \"NULL)\";\r\n			}\r\n		\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n				$this->ResetArrays();\r\n\r\n				$this->Content = $this->Content . \"\\n<center><BR><H3>New Menu Item added...</H3><BR><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to view tree?</a><BR>\";\r\n\r\n			} else {\r\n				$this->Content = $this->Content . \"\\n<center><BR><H3>We could not add new menu item!!!</H3><BR><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to view tree?</a><BR>\";\r\n			}\r\n			\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>Please enter the new menu item info...</H3><BR><BR><table border=1><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"NewMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"\\\">\\n<input type=\\\"hidden\\\" name=\\\"CreateNew\\\" value=\\\"true\\\">\";\r\n\r\n			$this->Content = $this->Content . \"<table border=1><TR><TD>Parent ID: </TD><TD>\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"</TD></TR><TR><TD>Link Name:</TD><TD><input type=\\\"text\\\" name=\\\"LName\\\" value=\\\"Name shown on pages...\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Is Object:</TD><TD><select name=\\\"IsObject\\\"><option value=\\\"1\\\">Yes</option><option value=\\\"0\\\" selected>No</option></select></TD></TR><TR><TD>PageID:</TD><TD><select name=\\\"pgid\\\"><option value=\\\"0\\\">NOPAGEID</OPTION>\";\r\n\r\n			//load up page names\r\n			$query = \"SELECT PageID, PageName FROM ODOPages\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			while($row = mysqli_fetch_assoc($result)) \r\n			{\r\n				$this->Content = $this->Content . \"<option value=\\\"\" . $row[\"PageID\"] . \"\\\">\" . $row[\"PageName\"] . \"</option>\";\r\n\r\n			}\r\n		\r\n\r\n			$this->Content = $this->Content . \"</select></TR><TR><TD>URL: </TD><TD><input type=\\\"text\\\" name=\\\"MyURL\\\" value=\\\"index.php?pg=\\\" maxlength=\\\"254\\\"></TD></TR><TR><TD>Conditional Var:</TD><TD><input type=\\\"text\\\" name=\\\"ConVar\\\" maxlength=\\\"20\\\"></TD></TR></table><BR><BR><input type=\\\"submit\\\" name=\\\"Create Item\\\" value=\\\"Create Item\\\">\\n</form>\";\r\n			\r\n		}\r\n\r\n\r\n	}\r\n\r\n	\r\n	',0,0,12),(83,'DeleteMenuItem',_binary '\r\n	function DeleteMenuItem() {\r\n\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n	\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a menu item to edit!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		$SelectedItem = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"DeleteMe\"])) {\r\n			\r\n			$MyTempArray = array();\r\n			$MyChild = \"\";\r\n			$DelPermLink = 0;\r\n			$DelMenuItems = 0;\r\n			$CDelPermLink = 0;\r\n			$CDelMenuItems = 0;\r\n			$MyTempArray = $this->GetAllChildren($SelectedItem);\r\n\r\n			while(count($MyTempArray)>0) {\r\n				$MyChild = array_pop($MyTempArray);\r\n				$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $MyChild;\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$CDelPermLink = $CDelPermLink + $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n				$query = \"DELETE FROM ODOTree WHERE PriKey=\" . $MyChild;\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$CDelMenuItems = $CDelMenuItems + $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n			}\r\n\r\n			//delete item\r\n			$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $SelectedItem;\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$DelPermLink = $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n			$query = \"DELETE FROM ODOTree WHERE PriKey=\" . $SelectedItem;\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			$DelMenuItems = $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n			$this->ResetArrays();\r\n			$this->Content = $this->Content . \"<BR><BR><center><H3>We have deleted \" . $DelPermLink . \" Permission links and \" . $DelMenuItems . \" Menu Item. From the children of this menu item we have deleted \" . $CDelPermLink . \" permission links and \" . $CDelMenuItems . \" menu items.</H3><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n\r\n		} else {\r\n\r\n			$this->Content = $this->Content . \"<BR><center><H3>Are you sure you want to delete this menu item?</H3><BR>\";\r\n\r\n			//find out if the menu item has children.\r\n			if(isset($this->ChildrenArray[$SelectedItem])) {\r\n				$this->Content = $this->Content . \"<BR><H4>This menu item has children. All children will be deleted as well!</H4><BR>\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"DeleteMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"DeleteMe\\\" value=\\\"DeleteMe\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteMenuItem\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Delete Item\\\" value=\\\"Delete Item\\\"></TD></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditTree\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Cancel\\\" value=\\\"Cancel\\\"></TD></form></TR></table></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n\r\n\r\n	',0,0,12),(84,'MoveDown',_binary '\r\n	function MoveDown() {\r\n\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a menu item to edit!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		//find current childpos and swap with whatever is above it. \r\n		//if childpos == 1 then exit\r\n		\r\n		$query = \"SELECT ParentID, ChildPos FROM ODOTree WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!(mysqli_num_rows($result) > 0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We could not locate the menu item in the database!</H3></center>\";\r\n			return;\r\n		}\r\n		\r\n		$row = mysqli_fetch_assoc($result);\r\n		$MyChildPos = $row[\"ChildPos\"];\r\n		$MyParentID = $row[\"ParentID\"];\r\n\r\n		$query = \"SELECT MAX(ChildPos) as MaxChild FROM ODOTree WHERE ParentID=\" . $row[\"ParentID\"];\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!$result) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We could not get the last child of this menu item\'s parent!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(!($row = mysqli_fetch_row($result))) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We could not get the last child of this menu item\'s parent!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		//check max with current\r\n		$ParentMax = $row[0];\r\n		\r\n		if($ParentMax <= $MyChildPos) {\r\n			//do nothing since we are already at the bottom\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>The menu item is already at the bottom of the list.</H3></CENTER>\";\r\n			return;\r\n		}\r\n\r\n		$MyNewChildPos = $MyChildPos + 1;\r\n		\r\n		\r\n		$query = \"UPDATE ODOTree SET ChildPos=\" . $MyChildPos . \" WHERE ParentID=\" . $MyParentID . \" AND ChildPos=\" . $MyNewChildPos;\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected()>0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We seam to have a missing Child!!! AMBER ALERT! But we\'ll pretend it wasn\'t there anyway.</H3></CENTER>\";\r\n		}\r\n\r\n		$query = \"UPDATE ODOTree SET ChildPos=\" . $MyNewChildPos . \" WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected()>0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>For some reason we could not update the child position of the selected menu item?</H3></center>\";\r\n		} else {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We have updated the child position to \" . $MyNewChildPos . \".</H3><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n		\r\n			$this->ResetArrays();\r\n\r\n		}\r\n\r\n	}\r\n\r\n\r\n	',0,0,12),(85,'MoveUp',_binary '\r\n	function MoveUp() {\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"] != $this->SelectedHead)) {\r\n			$this->SelectedHead = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"TreeHead\"];\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			$this->Content = $this->Content . \"\\n<center><BR><H3>You must select a menu item to edit!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		//find current childpos and swap with whatever is above it. \r\n		//if childpos == 1 then exit\r\n		\r\n		$query = \"SELECT ParentID, ChildPos FROM ODOTree WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!(mysqli_num_rows($result) > 0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We could not locate the menu item in the database!</H3></center>\";\r\n			return;\r\n		}\r\n		\r\n		$row = mysqli_fetch_assoc($result);\r\n\r\n		if($row[\"ChildPos\"] <= 1) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We are already at the first position!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		$MyChildPos = $row[\"ChildPos\"];\r\n		$MyNewChildPos = $row[\"ChildPos\"] - 1;\r\n		\r\n		$query = \"UPDATE ODOTree SET ChildPos=\" . $MyChildPos . \" WHERE ParentID=\" . $row[\"ParentID\"] . \" AND ChildPos=\" . $MyNewChildPos;\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected()>0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We seam to have a missing Child!!! AMBER ALERT! But we\'ll pretend it wasn\'t there anyway.</H3></CENTER>\";\r\n		}\r\n\r\n		$query = \"UPDATE ODOTree SET ChildPos=\" . $MyNewChildPos . \" WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected()>0)) {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>For some reason we could not update the child position of the selected menu item?</H3></center>\";\r\n		} else {\r\n			$this->Content = $this->Content . \"\\n<CENTER><BR><H3>We have updated the child position to \" . $MyNewChildPos . \".</H3><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditTree\\\"><-Go back to Tree</a></center>\";\r\n		\r\n			$this->ResetArrays();\r\n\r\n		}\r\n		\r\n\r\n	}\r\n\r\n\r\n	',0,0,12),(86,'NewHead',_binary '\r\n	\r\n	function NewHead() {\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"NewFlag\"])) {\r\n		\r\n			if((!(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadName\"]))) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadName\"]) < 1)) {\r\n				$this->Content = $this->Content . \"<H3>You need to enter a longer name!</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"SELECT * FROM ODOTree WHERE HeadTag=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadName\"] . \"\'\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($result) > 0) {\r\n				$this->Content = $this->Content . \"<H3>This head name already exists. We need unique names.</H3></center>\";\r\n				return;\r\n			}\r\n\r\n			$query = \"INSERT INTO ODOTree(PageID, ParentID, IsObject, HeadTag) values(null, null, 0, \'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"HeadName\"] . \"\')\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n\r\n				$this->ResetArrays();\r\n				$this->Content = $this->Content . \"<H3>Added Head Name!</H3></center>\";\r\n\r\n			} else {\r\n\r\n				$this->Content = $this->Content . \"<H3>We had an error adding the head!</H3></center>\";\r\n\r\n			}\r\n\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"<H3>Enter new head info...</H3><BR><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"NewHead\\\"><input type=\\\"hidden\\\" name=\\\"NewFlag\\\" value=\\\"1\\\"><input type=\\\"text\\\" name=\\\"HeadName\\\" maxlength=\\\"254\\\"><br><input type=\\\"submit\\\" name=\\\"submit\\\" value=\\\"submit\\\"></form></center>\";\r\n\r\n		}\r\n\r\n	}\r\n\r\n\r\n	',0,0,12),(87,'DeleteTree',_binary '\r\n	function DeleteTree() {\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<BR><H3>You must select a tree to delete first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"DeleteMe\"])) {\r\n\r\n			$MyTempArray = array();\r\n			$MyChild = \"\";\r\n			$DelPermLink = 0;\r\n			$DelMenuItems = 0;\r\n			$MyTempArray = $this->GetAllChildren($this->IsHeadArray[$this->SelectedHead]);\r\n			array_push($MyTempArray, $this->IsHeadArray[$this->SelectedHead]);\r\n\r\n			while(count($MyTempArray)>0) {\r\n				$MyChild = array_pop($MyTempArray);\r\n				$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $MyChild;\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$DelPermLink = $DelPermLink + $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n				$query = \"DELETE FROM ODOTree WHERE PriKey=\" . $MyChild;\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$DelMenuItems = $DelMenuItems + $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n				\r\n			}\r\n\r\n			$this->Content = $this->Content . \"<H3>We have deleted \" . $DelPermLink . \" Permission links and \" . $DelMenuItems . \" Menu Items</H3></center>\";\r\n\r\n		} else {\r\n			\r\n			$this->Content = $this->Content . \"<H3>Are you sure you want to delete the Tree: \" . $this->SelectedHead . \"?</H3><BR><B>All children of this Tree will be deleted and all permission links to this Tree will be removed from the database.</B><BR><BR>\";\r\n			\r\n			$this->Content = $this->Content . \"<table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteTree\\\"><input type=\\\"hidden\\\" name=\\\"DeleteMe\\\" value=\\\"1\\\"><TD><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></TD></form><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditTree\\\"><TD><input type=\\\"submit\\\" name=\\\"Cancel\\\" value=\\\"Cancel\\\"></TD></form></TR></Table></center>\";\r\n\r\n		}\r\n	\r\n	}\r\n\r\n',0,0,12),(88,'EditPermissions',_binary '\r\n	function EditPermissions() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSMenus\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if(strlen($this->SelectedHead) < 1) {\r\n			$this->Content = $this->Content . \"\\n<BR><H3>You must select a tree to edit first!</H3></center>\";\r\n			return;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"])) {\r\n			\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateGroups\"])) {\r\n\r\n				$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				$NumDynDel=0;\r\n\r\n				$NumDynDel = $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n\r\n				$MyChildren = array();\r\n\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"AllChildren\"])) {\r\n					$MyChildren = $this->GetAllChildren($_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"]);\r\n\r\n					foreach($MyChildren as $Value) {\r\n						\r\n						$query = \"DELETE FROM ODOMenus WHERE StaticLinkID=\" . $Value;\r\n						$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n						$NumDynDel = $NumDynDel + $GLOBALS[\'globalref\'][1]->GetNumRowsAffected();\r\n					}\r\n				}\r\n\r\n				//now add\r\n				$AddedItems = 0;\r\n\r\n				$glist = $_POST[\'Groups\'];\r\n\r\n				if ($glist){\r\n	 				foreach ( $glist as $newgroup)\r\n					{\r\n						$query = \"INSERT INTO ODOMenus(StaticLinkID, GID) values(\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \", \" . $newgroup . \")\";\r\n					\r\n						$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n					\r\n						$AddedItems = $AddedItems + 1;\r\n					}\r\n\r\n					foreach($MyChildren as $Value) {\r\n\r\n						foreach($glist as $newgroup) {\r\n							$query = \"INSERT INTO ODOMenus(StaticLinkID, GID) values(\" . $Value . \", \" . $newgroup . \")\";\r\n							$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n					\r\n							$AddedItems = $AddedItems + 1;\r\n						}\r\n					}\r\n				}\r\n\r\n				$this->Content = $this->Content . \"<BR><H3>We have removed \" . $NumDynDel . \" dynamic menu links and added \" . $AddedItems . \" dynamic menu items.</H3><BR><BR><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSMenusO&fn=EditPermissions\\\"><-Go back to Tree</a></center>\";\r\n\r\n			} else {\r\n		\r\n				$query = \"SELECT * FROM ODOTree WHERE PriKey=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"];\r\n\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				if(!(mysqli_num_rows($result)>0)) {\r\n					$this->Content = $this->Content . \"\\n<BR><H3>You have somehow selected an invalid menu item. We have reloaded the menu lists to try and avoid this error in the future. Please try and select another menu item.</H3></center>\";\r\n					$this->ResetArrays();\r\n					return;\r\n				}\r\n\r\n				$row = mysqli_fetch_assoc($result);\r\n				//get Objects assigned to page\r\n				$MyObjects = array();\r\n\r\n				//get groups assigned to page\r\n				$MyGroups = array();\r\n\r\n				if($row[\"PageID\"] != 0) {\r\n					$MyObjects = $this->GetObjectsInPage($row[\"PageID\"]);\r\n					$MyGroups = $this->GetGroupsInPage($row[\"PageID\"]);\r\n				}\r\n\r\n				//show groups granted on each object in page\r\n				$MyObjectGroups = array();\r\n				$MyObjectGroups = $this->GetGroupsForObjects($MyObjects);\r\n\r\n				$this->Content = $this->Content . \"<BR><H3>Select the groups for this menu item...</H3><BR><BR><H4>Groups needed for page to work...</H4><BR><Table border=1><TR>\";\r\n\r\n				$MyCounter = 0;\r\n				foreach($MyGroups as $ID=>$Value) {\r\n			\r\n					if($MyCounter > 3) {\r\n						$this->Content = $this->Content . \"</TR><TR>\";\r\n						$MyCounter = 0;\r\n					}\r\n\r\n					$this->Content = $this->Content . \"<TD>\" . $Value . \"</TD>\";\r\n					$MyCounter = $MyCounter + 1;\r\n\r\n				}\r\n\r\n				while($MyCounter < 4) {\r\n					$this->Content = $this->Content . \"<TD></TD>\";\r\n					$MyCounter = $MyCounter + 1;\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</TR></Table><BR><BR>\";\r\n\r\n\r\n				//show all groups needed to be allowed for menu item\r\n				$this->Content = $this->Content . \"<H4>Groups needed for Objects on page to work...</H4><BR><Table border=1><TR>\";\r\n\r\n				$MyCounter = 0;\r\n				foreach($MyObjectGroups as $ID=>$Value) {\r\n			\r\n					if($MyCounter > 3) {\r\n						$this->Content = $this->Content . \"</TR><TR>\";\r\n						$MyCounter = 0;\r\n					}\r\n\r\n					$this->Content = $this->Content . \"<TD>\" . $Value . \"</TD>\";\r\n					$MyCounter = $MyCounter + 1;\r\n\r\n				}\r\n\r\n				while($MyCounter < 4) {\r\n					$this->Content = $this->Content . \"<TD></TD>\";\r\n					$MyCounter = $MyCounter + 1;\r\n				}\r\n			\r\n				$this->Content = $this->Content . \"</TR></Table><BR><BR>\";\r\n\r\n\r\n				//show all groups needed to be allowed for menu item\r\n				$this->Content = $this->Content . \"<H4>Select Groups to add.</H4><BR><form action=\\\"index.php\\\" enctype=\\\"multipart/form-data\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPermissions\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \"\\\">\\n<input type=\\\"hidden\\\" name=\\\"UpdateGroups\\\" value=\\\"true\\\"><SELECT name=\\\"Groups[]\\\" multiple>\";\r\n\r\n				$query = \"SELECT ODOGroups.GroupName as GroupName, ODOGroups.GID as GID, t1.StaticLinkID as LinkID FROM ODOGroups LEFT JOIN (SELECT * FROM ODOMenus WHERE StaticLinkID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"SelectedMenuItem\"] . \") as t1 on ODOGroups.GID=t1.GID\";\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				while($row = mysqli_fetch_assoc($result)) \r\n				{\r\n					$this->Content = $this->Content . \"<Option value=\" . $row[\"GID\"];\r\n\r\n					if((isset($row[\"LinkID\"]))&&($row[\"LinkID\"] != null)) {\r\n	\r\n						$this->Content = $this->Content . \" selected\";\r\n\r\n					} \r\n\r\n					$this->Content = $this->Content . \" >\" . $row[\"GroupName\"] . \"</option>\\n\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</SELECT>\\n<BR>Make changes to all children too?:&nbsp;<input type=\\\"checkbox\\\" name=\\\"AllChildren\\\"><BR><input type=\\\"submit\\\" name=\\\"Update Groups\\\" value=\\\"Update Groups\\\"></form></CENTER>\";\r\n				\r\n		\r\n			}\r\n			\r\n\r\n		} else {\r\n			\r\n			$TempRVal = $this->FullMenu($this->SelectedHead);\r\n\r\n			$this->Content = $this->Content . \"<BR><H3>Edit Permissions</H3><BR><BR><TABLE><TR><TD>\" . $TempRVal . \"</TD></TR></TABLE>\";\r\n\r\n\r\n			//recall edit tree to select what menu item to move it under\r\n			$this->Content = $this->Content . \"<BR><BR><table border=0><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" name=\\\"MoveMenu\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSMenusO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditPermissions\\\"><input type=\\\"hidden\\\" name=\\\"TreeHead\\\" value=\\\"\" . $this->SelectedHead . \"\\\"><input type=\\\"hidden\\\" name=\\\"SelectedMenuItem\\\" value=\\\"0\\\">\\n<TD><input type=\\\"submit\\\" name=\\\"Edit Permissions\\\" value=\\\"Edit Permissions\\\"></td></form></center>\";\r\n\r\n\r\n		}\r\n\r\n\r\n	}\r\n\r\n	',0,0,12),(93,'ODORegisterHead',_binary 'class ODORegister {\r\n\r\n	var $OKCaptcha;\r\n	var $UNameok;\r\n	var $emailok;\r\n	var $RQestionOK;\r\n	var $RAnswerOK;\r\n	var $Content;\r\n	var $MissingText;\r\n	var $MyUID;\r\n	var $ApplicationFields; //used in later versions\r\n	var $ODOStore; //to decide what complete URL we use\r\n\r\n	function __construct() {\r\n\r\n		$this->OKCaptcha = true;\r\n		$this->UNameok = true;\r\n		$this->emailok = true;\r\n		$this->RQuestionOK = true;\r\n		$this->RAnswerOK = true;\r\n		$this->MyUID = 0;\r\n		$this->Content = \"\";\r\n		$this->MissingText = \"\";\r\n		$this->ApplicationFields = array();\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODOStore\"])) {\r\n			$this->ODOStore = true;\r\n		} else {\r\n			$this->ODOStore = false;\r\n		}\r\n\r\n	}\r\n\r\n\r\n	private function randomstring($len)\r\n	{\r\n		$chars = \'aZb1cAdQKeYB2JfhjC8k9mX3DLnToRME0rNsF4tuUPvG5wHVx6yS7z\';\r\n		$str = \"\";\r\n		$i = 0;\r\n		date_default_timezone_set(\'UTC\');\r\n\r\n    		while($i<$len)\r\n     		{\r\n			//0-55\r\n        		$str.=$chars[mt_rand(0,53)];\r\n        		$i++;\r\n    		}\r\n 		return $str;\r\n	}\r\n\r\n\r\n	private function UserRegisterCompleted($RegID, $UID) {\r\n		$query = \"INSERT INTO RegisteredUsers(RegID, UID) values(\" . $RegID . \",\" . $UID . \")\";\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		if(($GLOBALS[\'globalref\'][1]->GetNumRowsAffected())>0) {\r\n			return true;\r\n		} else {\r\n			return false;\r\n		}\r\n\r\n	}\r\n\r\n	public function CheckUserIsRegisteredForRegID($RegID, $UID) {\r\n\r\n		$query = \"SELECT * FROM RegisteredUsers WHERE UID=\" . $UID . \" AND RegID=\" . $RegID;\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n				return true;\r\n			} else {\r\n				return false;\r\n			}\r\n\r\n	}\r\n\r\n	public function GetCompleteURLForReg($RegID) {\r\n		$query = \"SELECT AfterRegCompleteURL, ODOStoreAfterRegURL FROM RegistrationTypes WHERE RegID=\" . $RegID;\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n			$row = mysqli_fetch_assoc($result);\r\n\r\n			if($this->ODOStore) {\r\n\r\n				if((!is_null($row[\"ODOStoreAfterRegURL\"]))&&(strlen($row[\"ODOStoreAfterRegURL\"])>0)) {\r\n					return $row[\"ODOStoreAfterRegURL\"];\r\n				} else {\r\n					return DEFAULTODOSTOREREGCOMPLETEURL;\r\n				}\r\n\r\n			} else {\r\n				if((!is_null($row[\"AfterRegCompleteURL\"]))&&(strlen($row[\"AfterRegCompleteURL\"])>0)) {\r\n					return $row[\"AfterRegCompleteURL\"];\r\n				} else {\r\n					return DEFAULTREGCOMPLETEURL;\r\n				}\r\n			}\r\n\r\n		} else {\r\n			if($this->ODOStore) {\r\n				return DEFAULTODOSTOREREGCOMPLETEURL;\r\n			} else {\r\n				return DEFAULTREGCOMPLETEURL;\r\n			}\r\n		}\r\n	}\r\n\r\n\r\n\r\n//end header\r\n\r\n',1,0,18),(94,'ODORegisterFooter',_binary '\r\n//begin footer\r\n	function __wakeup() {\r\n\r\n		$this->OKCaptcha = true;\r\n		$this->UNameok = true;\r\n		$this->emailok = true;\r\n		$this->RQuestionOK = true;\r\n		$this->RAnswerOK = true;\r\n		$this->MyUID = 0;\r\n		$this->Content = \"\";\r\n		$this->MissingText = \"\";\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ODOStore\"])) {\r\n			$this->ODOStore = true;\r\n		}\r\n		\r\n	}\r\n\r\n}\r\n',0,1,18),(95,'LoadRegisterPage',_binary '\r\n	function LoadRegisterPage($mobile = FALSE) {\r\n\r\n\r\n		$this->Content = \"<form action=\\\"index.php\\\" name=\\\"registration\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"Register\\\"><input type=\\\"hidden\\\" name=\\\"RegMe\\\" value=\\\"true\\\">\";\r\n\r\n\r\n		//if user is not set then register for standard user\r\n		if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (!($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n\r\n			//username firstname lastname\r\n			$this->Content = \"<table id=\\\"regcontenttable\\\"><TR id=\\\"regcontentusernametr\\\"><TD id=\\\"regcontentusernamelabeltd\\\"><div id=\\\"regcontentusernamelabel\\\" class=\\\"regcontentlabel\\\">UserName:</div></TD><TD id=\\\"regcontentusernametd\\\"><div id=\\\"regcontentusername\\\" class=\\\"regcontentinput\\\">\" . $_SESSION[\"ODOUserO\"]->getusername() . \"</div></TD></TR><TR id=\\\"regcontentfirstnametr\\\"><TD id=\\\"regcontentfirstnamelabeltd\\\"><div id=\\\"regcontentfirstnamelabel\\\" class=\\\"regcontentlabel\\\">First Name:</div></TD><TD id=\\\"regcontentfirstnametd\\\"><div id=\\\"regcontentfirstname\\\" class=\\\"regcontentinput\\\">\" . $_SESSION[\"ODOUserO\"]->getfirstname() . \"</div></TD></TR><TR id=\\\"regcontentlastnametr\\\"><TD id=\\\"regcontentlastnamelabeltd\\\"><div id=\\\"regcontentlastnamelabel\\\" class=\\\"regcontentlabel\\\">Last Name:</div></TD><TD id=\\\"regcontentlastnametd\\\"><div id=\\\"regcontentlastname\\\" class=\\\"regcontentinput\\\">\" . $_SESSION[\"ODOUserO\"]->getlastname() . \"</div></TD></TR>\";\r\n\r\n			//email\r\n			$this->Content .= \"<TR id=\\\"regcontentemailtr\\\"><TD id=\\\"regcontentemaillabeltd\\\"><div id=\\\"regcontentemaillabel\\\" class=\\\"regcontentlabel\\\">E-mail Address:</div><div id=\\\"regcontentemailsublabel\\\"><sub>(will be verified)</sub></div></TD><TD id=\\\"regcontentemailtd\\\"><div id=\\\"regcontentemail\\\" class=\\\"regcontentinput\\\">\" . $_SESSION[\"ODOUserO\"]->getemail() . \"</div></TD></TR>\";\r\n\r\n			$url = $this->GetCompleteURLForReg($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"]);\r\n			$this->Content = $this->Content . \"<TR><TD colspan=\\\"2\\\"><div id=\\\"regcontentmsg\\\">It looks like you are already registered. Please wait while we redirect you. If you are not redirected in a few seconds please click <a href=\\\"\" . $url . \"\\\">here</a> to continue.</div></TD></TR></table><script>\\nfunction OnLoadRefresh(){\\nwindow.location=\'\" . $url . \"\';\\n}\\ntimer=setTimeout(\'OnLoadRefresh()\',5000)\\n  </script>\";\r\n			return true;\r\n\r\n\r\n\r\n\r\n		} else {\r\n\r\n			if(!ALLOWGUESTSTANDARDREG) {\r\n				//Guests can not use the public registration object to register. Admins can only enter a request.\r\n				//prompt them to login\r\n				$this->Content = \"<div id=\\\"regcontentmsg\\\">This site does not allow guests to register. Please contact the Website owner or login below.</div>\";\r\n\r\n				//check if login failed. Login is called before this at page loadup. params are still set check for last function call\r\n				$RValue = $_SESSION[\"ODOUserO\"]->Login();\r\n				if($RValue == false) {\r\n					$this->Content = $this->Content . \"Login Failed\";\r\n				} else {\r\n					$this->Content = $this->Content . $RValue;\r\n				}\r\n\r\n\r\n				return true;\r\n			}\r\n\r\n\r\n			$this->Content = $this->Content . \"<table id=\\\"regtable\\\">\\n<TR>\\n<TD>\\n<div class=\\\"regboxed\\\" id=\\\"regboxid\\\">\\n<div id=\\\"regcontent\\\" class=\\\"regcontent\\\">\\n<table id=\\\"regcontenttable\\\">\\n<TR id=\\\"regcontentusernametr\\\"><TD id=\\\"regcontentusernamelabeltd\\\"><div id=\\\"regcontentusernamelabel\\\" class=\\\"regcontentlabel\\\">UserName:</div></TD><TD id=\\\"regcontentusernametd\\\"><div id=\\\"regcontentusername\\\" class=\\\"regcontentinput\\\"><INPUT type=\\\"text\\\" id=\\\"regcontentusernametext\\\" name=\\\"UName\\\" size=\\\"10\\\" maxlength=\\\"20\\\"\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"])) {\r\n				$this->Content = $this->Content . \" value=\\\"\" . htmlentities($_POST[\"UName\"]) . \"\\\"\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"></div></TD></TR>\\n<TR id=\\\"regcontentfirstnametr\\\">\r\n						<TD id=\\\"regcontentfirstnamelabeltd\\\"><div id=\\\"regcontentfirstnamelabel\\\" class=\\\"regcontentlabel\\\">First Name:</div></TD><TD id=\\\"regcontentfirstnametd\\\"><div id=\\\"regcontentfirstname\\\" class=\\\"regcontentinput\\\"><input type=\\\"text\\\" id=\\\"regcontentfirstnametext\\\" name=\\\"FName\\\" size=\\\"20\\\" maxlength=\\\"100\\\"\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"])) {\r\n				$this->Content = $this->Content . \" value=\\\"\" . htmlentities($_POST[\"FName\"]) . \"\\\"\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"></div></TD></TR>\\n<TR id=\\\"regcontentlastnametr\\\">\r\n						<TD id=\\\"regcontentlastnamelabeltd\\\"><div id=\\\"regcontentlastnamelabel\\\" class=\\\"regcontentlabel\\\">Last Name:</div></TD><TD id=\\\"regcontentlastnametd\\\"><div id=\\\"regcontentlastname\\\" class=\\\"regcontentinput\\\"><input type=\\\"text\\\" id=\\\"regcontentlastnametext\\\" name=\\\"LName\\\" size=\\\"20\\\" maxlength=\\\"100\\\"\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"])) {\r\n				$this->Content = $this->Content . \" value=\\\"\" . htmlentities($_POST[\"LName\"]) . \"\\\"\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"></div></TD></TR>\\n<TR id=\\\"regcontentemailtr\\\">\r\n						<TD id=\\\"regcontentemaillabeltd\\\"><div id=\\\"regcontentemaillabel\\\" class=\\\"regcontentlabel\\\">E-mail Address:</div><div id=\\\"regcontentemailsublabel\\\"><sub>(will be verified)</sub></div></TD>\r\n						<TD id=\\\"regcontentemailtd\\\"><div id=\\\"regcontentemail\\\" class=\\\"regcontentinput\\\"><input type=\\\"text\\\" id=\\\"regcontentemailtext\\\" name=\\\"email\\\" size=\\\"25\\\" maxlength=\\\"100\\\"\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"])) {\r\n				$this->Content = $this->Content . \" value=\\\"\" . htmlentities($_POST[\"email\"]) . \"\\\"\";\r\n\r\n			}\r\n\r\n			$query = \"SELECT * FROM ResetQuestions\";\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n\r\n\r\n			$this->Content = $this->Content . \"></div></TD></TR>\\n<TR id=\\\"regcontentresetquestiontr\\\"><TD id=\\\"regcontentresetquestionlabeltd\\\"><div id=\\\"regcontentresetquestionlabel\\\" class=\\\"regcontentlabel\\\">Password Reset Question:</div></TD><TD id=\\\"regcontentresetquestiontd\\\"><div id=\\\"regcontentresetquestion\\\"><SELECT id=\\\"regcontentresetquestiontext\\\" NAME=\\\"RQuestion\\\"><OPTION value=\\\"0\\\" \";\r\n\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"])) {\r\n				$this->Content = $this->Content . \" selected\";\r\n			} elseif($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"]==\"0\") {\r\n				$this->Content = $this->Content . \" selected\";\r\n			}\r\n\r\n			$this->Content = $this->Content . \"></OPTION>\\n\";\r\n\r\n			while($row = mysqli_fetch_assoc($result)) {\r\n\r\n				$this->Content = $this->Content . \"<OPTION value=\\\"\" . $row[\"ResetQID\"] . \"\\\"\";\r\n\r\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"]))&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"]==$row[\"ResetQID\"])) {\r\n\r\n					$this->Content = $this->Content . \" selected\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \">\" . $row[\"ResetQ\"] . \"</OPTION>\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"</div></TD></TR>\\n<TR id=\\\"regcontentresetanswertr\\\"><TD id=\\\"regcontentresetanswerlabeltd\\\"><div id=\\\"regcontentresetanswerlabel\\\" class=\\\"regcontentlabel\\\">Password Reset Answer:</div><div id=\\\"regcontentresetanswersublabel\\\"><sub>(case sensitive)</sub></div></TD><TD id=\\\"regcontentresetanswertd\\\"><div id=\\\"regcontentresetanswer\\\"><input type=\\\"text\\\" name=\\\"RAnswer\\\" size=\\\"25\\\" maxlength=\\\"100\\\"\";\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"])) {\r\n\r\n				$this->Content = $this->Content . \" value=\\\"\" . htmlentities($_POST[\"RAnswer\"]) . \"\\\"\";\r\n\r\n			}\r\n\r\n			$this->Content = $this->Content . \"></div></TD></TR>\\n\";\r\n\r\n		}\r\n\r\n		//check registration type passed\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"])) {\r\n			$query = \"SELECT RegID, UserInputCode FROM RegistrationTypes WHERE RegID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"];\r\n\r\n			if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n			 	$query = $query . \" AND AllowGuest=1\";\r\n			}\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n				//invalid RegID type, just exit\r\n				return false;\r\n			} else {\r\n				$row = mysqli_fetch_assoc($result);\r\n				$RValue = \"\";\r\n				$MyFunc = $row[\"UserInputCode\"];\r\n				if(is_callable(array(&$this, $MyFunc))) {\r\n					$RValue = call_user_func(array(&$this, $MyFunc));\r\n					if($RValue == false) {\r\n						trigger_error(\"REGISTER ERROR:We could not call the function name \" . $row[\"UserInputCode\"], E_USER_ERROR);\r\n						exit();\r\n					}\r\n					$this->Content = $this->Content . \"<input type=\\\"hidden\\\" name=\\\"RegID\\\" value=\\\"\" . $row[\"RegID\"] . \"\\\">\" . $RValue;\r\n				}\r\n\r\n\r\n			}\r\n\r\n		} else {\r\n\r\n			$query = \"SELECT * FROM RegistrationTypes WHERE RegID>1\";\r\n\r\n			if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n			 	$query = $query . \" AND AllowGuest=1\";\r\n			}\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			//assign different row names for each type\r\n			//first row is drop down combo\r\n\r\n			if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n\r\n				$this->Content = $this->Content . \"<BR><BR><center>Register as:<SELECT id=\\\"RegType\\\" name=\\\"RegID\\\" onChange=\\\"ShowOtherTableRows(this)\\\"><OPTION value=\\\"1\\\" SELECTED>Standard User</Option>\";\r\n\r\n				$RestofRows = \"\";\r\n\r\n				while($row = mysqli_fetch_assoc($result)) {\r\n\r\n					$this->Content = $this->Content . \"<OPTION value=\\\"\" . $row[\"RegID\"] . \"\\\">\" . $row[\"Name\"] . \"</OPTION>\\n\";\r\n					//make sure it is callable\r\n					//call function to load user input values\r\n					$RValue = \"\";\r\n					$MyFunc = $row[\"UserInputCode\"];\r\n					if(is_callable(array(&$this, $MyFunc))) {\r\n						$RValue = call_user_func(array(&$this, $MyFunc));\r\n						if($RValue == false) {\r\n							trigger_error(\"REGISTER ERROR:We could not call the function name \" . $row[\"UserInputCode\"], E_USER_ERROR);\r\n							exit();\r\n						}\r\n\r\n					} else {\r\n						trigger_error(\"REGISTER ERROR:We could not call the function name \" . $row[\"UserInputCode\"], E_USER_ERROR);\r\n						exit();\r\n					}\r\n					$RestofRows = $RestofRows . $RValue;\r\n\r\n				}\r\n\r\n				$this->Content = $this->Content . $RestofRows;\r\n			}\r\n\r\n		}\r\n\r\n		$this->Content = $this->Content . \"<TR><TD colspan=\\\"2\\\"><div id=\\\"regcontentspamlabel\\\"><sub>Enter the text you see in the image.</sub></div><div id=\\\"regcontentspam\\\"><span id=\\\"regcontentspamimage\\\"><img src=\\\"NoSpam.php\\\"\";\r\n\r\n		if($mobile) {\r\n			$this->Content .= \"width=\\\"200px\\\" height=\\\"50\\\"\";\r\n		}\r\n\r\n		$this->Content .= \"></span><span id=\\\"regcontentspamanswer\\\"><input type=\\\"text\\\" id=\\\"regcontentspamanswertext\\\" name=\\\"chanswer\\\" size=\\\"10\\\" maxsize=\\\"10\\\"></span></div>\\n\";\r\n\r\n		if(TOSONREGISTER) {\r\n			$this->Content = $this->Content . \"<div id=\\\"regcontenttos\\\"><label><input type=\\\"checkbox\\\" id=\\\"regcontenttoscheckbox\\\" name=\\\"TOS\\\">&nbsp;<span id=\\\"regcontenttoslabel\\\">I agree to the terms of service.</span></label></div>\";\r\n			$this->Content .= \"<div><span id=\\\"regcontenttoslink\\\"><a href=\\\"#\\\" onclick=\\\"window.open(\'index.php?pg=Legal\', \'Legal\')\\\">View Terms of Service</a></span></div>\";\r\n		}\r\n\r\n		$this->Content = $this->Content . \"<div id=\\\"regcontentsubmitdiv\\\"><input type=\\\"submit\\\" id=\\\"regcontentsubmit\\\" name=\\\"submit\\\" value=\\\"Submit\\\"></div></div></div></TD></TR></TABLE></TD></TR></TABLE></form>\";\r\n\r\n		return true;\r\n	}\r\n//custom functions\r\n',0,0,18),(96,'ProcRegisterPage',_binary '\r\n\r\n	function ProcRegisterPage() {\r\n\r\n		$ErrorWithData = false;\r\n		$NeedVerify = false;\r\n\r\n		//**********************************************************\r\n		//Start Validation\r\n		//**********************************************************\r\n\r\n		$MyID = 0; //check if logged in as standard user and set ID\r\n		if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (!($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n			$MyID = $_SESSION[\"ODOUserO\"]->getUID();\r\n			$this->MyUID = $_SESSION[\"ODOUserO\"]->getUID();\r\n		} else {\r\n			//if we are not logged in then make check for standard registration user checks\r\n			//only make check if we are allowed to do standard user registration\r\n			if(ALLOWGUESTSTANDARDREG) {\r\n				if(!($this->RunStandardUserChecks())) {\r\n					$ErrorWithData = true;\r\n				}\r\n			} else {\r\n				$this->MissingText = \"This site does not allow Standard User Registration. You must be logged in to Register for features of this site. Please contact the system Administrator\"; //we can not continue so exit\r\n				return false;\r\n			}\r\n\r\n		}\r\n\r\n\r\n		//add check for TOS\r\n		if(TOSONREGISTER) {\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"TOS\"])) {\r\n				$this->MissingText = $this->MissingText . \" You must accept the Terms of Service to continue. \";\r\n				$ErrorWithData = true;\r\n			}\r\n\r\n		}\r\n\r\n\r\n		//run check for RegID\r\n		$RegName = \"\";\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"]!=1)) {\r\n			$query = \"SELECT Name, DataCheckCode, AllowGuest FROM RegistrationTypes WHERE RegID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"];\r\n\r\n			if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (!($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n			 	$query = $query . \" AND AllowGuest=1\";\r\n			}\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n\r\n			if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n				//invalid RegID type, just exit\r\n				$this->MissingText = $this->MissingText . \"An invalid Registration type was passed. \";\r\n				return false;\r\n			} else {\r\n				$row = mysqli_fetch_assoc($result);\r\n				$RegName = $row[\"Name\"];\r\n\r\n				$MyFunc = $row[\"DataCheckCode\"];\r\n				if(is_callable(array(&$this, $MyFunc))) {\r\n					$RValue = call_user_func(array(&$this, $MyFunc));\r\n					if($RValue === \"ERROR\") {\r\n						$ErrorWithData = true;\r\n						return false;\r\n					}\r\n				} else {\r\n					trigger_error(\"REGISTER ERROR:We could not call the function name \" . $row[\"DataCheckCode\"], E_USER_ERROR);\r\n					exit();\r\n				}\r\n			}\r\n		}\r\n\r\n		//*****************************************************************\r\n		//END Check of validation\r\n		//*****************************************************************\r\n\r\n		//*****************************************************************\r\n		//*****************************************************************\r\n		//Start Registration\r\n		//*****************************************************************\r\n		//*****************************************************************\r\n\r\n		//*****************************************************************\r\n		//Start Standard User Registration\r\n		//*****************************************************************\r\n		//if we don\'t already have a standard user then we need to create one.\r\n\r\n        //start transaction\r\n        if(!$ErrorWithData) {\r\n            $GLOBALS[\'globalref\'][1]->startTransaction();\r\n        }\r\n\r\n		if((!$ErrorWithData) && (ALLOWGUESTSTANDARDREG) && ((!$_SESSION[\"ODOUserO\"]->getLoggedIn()) || ($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n\r\n			//we\'ve already made all our checks so just insert\r\n\r\n			$query = \"INSERT INTO ODOUsers(User,Pistemp,IsLocked,rnameFirst,rnameLast,ResetQID,ResetA,emailadd,FailedLogins, IsEncrypted, HashedMode, EncIV) values(\'\" . htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"]) . \"\',1,\";\r\n\r\n			//Create EncryptedData container\r\n			$encData = new EncryptedData();\r\n\r\n			//temp vars needed\r\n			//Setup DB vars based on encryption status\r\n			$RegName = \"\";\r\n			$encData->decArray[\"emailadd\"] = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"]);\r\n\r\n			$LName = \"\";\r\n\r\n			if((!is_null($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"]))||(strlen(trim($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"])) > 0)) {\r\n				$encData->decArray[\"rnameLast\"] = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"]);\r\n\r\n			}\r\n\r\n			$FName = \"\";\r\n\r\n			if((!is_null($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"]))||(strlen(trim($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"])) > 0)) {\r\n				$encData->decArray[\"rnameFirst\"] = htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"]);\r\n			}\r\n\r\n\r\n			$FullName = $encData->decArray[\"rnameFirst\"] . \" \" . $encData->decArray[\"rnameLast\"];\r\n\r\n			//run encryption\r\n			$encData = $_SESSION[\"ODOUtil\"]->ODOEncrypt($encData);\r\n\r\n			//Lock the account if we have to have an admin verify it\r\n			if(ADMINVERIFYSTANDARDUSERREG) {\r\n				$NeedVerify = true;\r\n				$query = $query . \"1,\";\r\n			} else {\r\n				$query = $query . \"0,\";\r\n			}\r\n\r\n			//Add First name and last name encrypted values\r\n			if(isset($encData->encArray[\"rnameFirst\"])) {\r\n				$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameFirst\"]) . \"\',\";\r\n			} else {\r\n				$query = $query . \"NULL,\";\r\n			}\r\n\r\n			if(isset($encData->encArray[\"rnameLast\"])) {\r\n				$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"rnameLast\"]) . \"\',\";\r\n			} else {\r\n				$query = $query . \"NULL,\";\r\n			}\r\n\r\n\r\n			//confirm and set reset Q ID\r\n			$QID = 0;\r\n			$questionquery = \"SELECT * FROM ResetQuestions WHERE ResetQID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"];\r\n			$questionresult = $GLOBALS[\'globalref\'][1]->Query($questionquery);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n				$QID = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"];\r\n			}\r\n\r\n			$query = $query . $QID . \",\";\r\n\r\n			//if an Admin needs to verify standard user regs then do not set the reset answer\r\n			if(ADMINVERIFYSTANDARDUSERREG) {\r\n\r\n				$query = $query . \"NULL\";\r\n\r\n			} else {\r\n				//if answer was set then go ahead and hash it and set to the database\r\n				if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]))&&(strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"])>0)) {\r\n					$query = $query . \"\'\" . $_SESSION[\"ODOUserO\"]->ODOHash(htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]), $_SESSION[\"ODOUserO\"]->GetHashMode()) . \"\'\";\r\n				} else {\r\n					$query = $query . \"NULL\";\r\n				}\r\n\r\n			}\r\n\r\n			//set encrypted e-mail db\r\n\r\n			$query = $query . \",\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->encArray[\"emailadd\"]) . \"\',0,\";\r\n\r\n			//set encrypted mode\r\n			if($_SESSION[\"ODOUtil\"]->isMcryptAvailable()) {\r\n				$query = $query . \"1,\";\r\n			} else {\r\n				$query = $query . \"0,\";\r\n			}\r\n\r\n			//set hashed mode\r\n			$query = $query . $_SESSION[\"ODOUserO\"]->GetHashMode() . \",\";\r\n\r\n			if(strlen($encData->iv)>0) {\r\n				$query = $query . \"\'\" . $GLOBALS[\'globalref\'][1]->EscapeMe($encData->iv) . \"\')\";\r\n			} else {\r\n				$query = $query . \"NULL)\";\r\n			}\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$MyID = 0;\r\n			$MyID = $GLOBALS[\'globalref\'][1]->LastInsertID();\r\n			$this->MyUID = $MyID;\r\n\r\n			$_SESSION[\"ODOUserO\"]->setGENUID($MyID); // set for ODOStore\r\n\r\n			if($MyID == 0) {\r\n				trigger_error(\"RegisterObject:ProcRegisterPage:Error getting UID for new user!\", E_USER_ERROR);\r\n				return false;\r\n				//not recoverable error\r\n			}\r\n\r\n			$Comment = \"UserID: \" . $MyID . \":\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"] . \" was created by public registration.\";\r\n			$GLOBALS[\'globalref\'][4]->LogEvent(\"USERCREATEDPUB\", $Comment, 1);\r\n\r\n			//get UID and set to AdminVerify entry if required\r\n			if(ADMINVERIFYSTANDARDUSERREG) {\r\n\r\n\r\n				//standard user is always 1 for regid\r\n				$query = \"INSERT INTO AdminVerify(RegID, UID, RAnswer) values(1,\" . $MyID . \",\";\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"])) {\r\n					$query = $query . \"\'\" . $_SESSION[\"ODOUserO\"]->ODOHash(htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]), $_SESSION[\"ODOUserO\"]->GetHashMode()) . \"\')\";\r\n				} else {\r\n					$query = $query . \"NULL)\";\r\n				}\r\n\r\n\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				$MyVID = 0;\r\n				$MyVID = $GLOBALS[\'globalref\'][1]->LastInsertID();\r\n				if($MyVID == 0) {\r\n					trigger_error(\"RegisterObject:ProcRegisterPage:Error getting VID for new user!\", E_USER_ERROR);\r\n					return false;\r\n					//not recoverable error\r\n				}\r\n\r\n			} else {\r\n				//else set groups now\r\n				$query = \"SELECT * FROM RegAssignedToGroups WHERE RegID=1\";\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				while($row = mysqli_fetch_assoc($result)) {\r\n\r\n					$query = \"INSERT INTO ODOUserGID(GID,UID) values(\" . $row[\"GID\"] . \",\" . $MyID . \")\";\r\n					$result2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n				}\r\n\r\n			}\r\n\r\n\r\n			//now create password\r\n			$newpass = $this->randomstring(10);\r\n\r\n\r\n			$query = \"SELECT Name, emailMsg FROM RegistrationTypes WHERE RegID=1\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$message = \"\";\r\n			$message = \"<html>\\n<head>\\n<TITLE>Welcome to [[ServerName]]</TITLE>\\n</head>\";\r\n			\r\n			$message .= \"\\n<body bgcolor=\\\"Gray\\\" text=\\\"White\\\">\\n[[Logo]]<br>\\n<H3>Your Registration at [[ServerName]] has been accepted!</H3><Hr>\\n<P>The Administrator at [[ServerName]] has accepted your request to register for [[RegName]]. To access your account please login <a href=\\\"http://[[ServerAddress]]/login.php\\\">here</a>. Or simply visit <B>http://[[ServerAddress]]/login.php</B> .</P>\\n\\n[[LoginInfo]]<BR><BR><B>Thank You!</B><br>\\n[[ServerName]]\\n</body>\\n</html></body>\\n</html>\";\r\n\r\n				//create custom html here.\r\n				//[[ServerName]] - server name replaced by constant\r\n				//[[CustEmail]] - replaced with customer\'s e-mail\r\n				//[[CustName]] - replaced with customer\'s name\r\n				//[[CustFirstName]] - replaced with customer\'s first name\r\n				//[[CustLastName]] - replaced with customer\'s last name\r\n				//[[CustUserName]] - replaced with customer\'s username\r\n				//[[Logo]] - replaced with img tag http://SERVERADDRESS/images/GetImage.php?Name=Logo\r\n				//[[RegName]] - replaced with registration name for given regID\r\n				//[[ServerAddress]] - domain name of server\r\n				//[[LoginInfo]] - replaced with username and password\r\n\r\n				if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n					$row = mysqli_fetch_assoc($result);\r\n\r\n					$RegName = $row[\"Name\"];\r\n\r\n					if((!is_null($row[\"emailMsg\"]))&&(strlen(trim($row[\"emailMsg\"]))>0)) {\r\n						$message = $row[\"emailMsg\"];\r\n					}\r\n\r\n				}\r\n\r\n				//e-mail the user of their new access\r\n				// To send HTML mail, the Content-type header must be set\r\n				$headers  = \'MIME-Version: 1.0\' . \"\\n\";\r\n				$headers .= \'Content-type: text/html; charset=iso-8859-1\' . \"\\n\";\r\n                $headers .= \'From: \' . REGREPLYEMAIL . \"\\n\";\r\n				$headers .= \'Reply-To:  \' . REGREPLYEMAIL . \"\\n\";\r\n				$headers .= \'X-Mailer: ODOWeb\' . \"\\n\";\r\n\r\n				$message = str_replace(\"[[ServerName]]\", SERVERNAME, $message);\r\n				$message = str_replace(\"[[CustEmail]]\", $encData->decArray[\"emailadd\"], $message);\r\n				$message = str_replace(\"[[CustName]]\", $FullName, $message);\r\n				$message = str_replace(\"[[CustFirstName]]\", $encData->decArray[\"rnameFirst\"], $message);\r\n				$message = str_replace(\"[[CustLastName]]\", $encData->decArray[\"rnameLast\"], $message);\r\n				$message = str_replace(\"[[CustUserName]]\", htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"]), $message);\r\n				$LogoURL = \"<img src=\\\"http://\" . SERVERADDRESS . \"/\" . GETIMAGEURLPATH . \"?Name=Logo\\\">\";\r\n				$message = str_replace(\"[[Logo]]\", $LogoURL, $message);\r\n				$message = str_replace(\"[[RegName]]\", $RegName, $message);\r\n				$message = str_replace(\"[[ServerAddress]]\", SERVERADDRESS, $message);\r\n\r\n				$LoginInfo = \"<BR>Your username is: \" . htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"]) . \"<BR>\\nYour new password is: \" . $newpass . \"<BR><BR>\\n\\n\";\r\n\r\n				if($NeedVerify) {\r\n\r\n					$LoginInfo = $LoginInfo . \"<p>Your account requires verification from an Administrator before you will be able to login. Please wait to login until you receive a confirmation e-mail from an administrator.</p>\";\r\n\r\n				}\r\n\r\n			$message = str_replace(\"[[LoginInfo]]\", $LoginInfo, $message);\r\n\r\n			$query = \"UPDATE ODOUsers SET pass=\'\" . $_SESSION[\"ODOUserO\"]->ODOHash($newpass, $_SESSION[\"ODOUserO\"]->GetHashMode()) . \"\' WHERE UID=\" . $MyID;\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n				//error updating. We will need to notify the user that the admin will have to resolve this issue.\r\n				trigger_error(\"ODOWEBERROR:RegisterObject:Could not update password for UID:\" . $MyID, E_USER_WARNING);\r\n				$message = $message . \"<B>There was an error trying to update your temporary password. The admin has been notified of this error.</B><BR>\";\r\n\r\n			}\r\n\r\n            $EmailMsg = new ODOMailMessage();\r\n\r\n            $EmailMsg->to = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\r\n            $EmailMsg->subject = \"Registered at \" . SERVERNAME;\r\n            $EmailMsg->message = $message;\r\n            $EmailMsg->headers = $headers;\r\n\r\n            $GLOBALS[\'globalref\'][4]->TransactionAwareEmail($EmailMsg);\r\n\r\n			$this->Content = $this->Content . \"<br>The password has been e-mailed to: \" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"];\r\n\r\n\r\n\r\n		}\r\n\r\n		//********************************************************\r\n		//END Standard User Registration\r\n		//********************************************************\r\n\r\n		//********************************************************\r\n		//START Specific Registration Type code\r\n		//********************************************************\r\n		//check registration type passed\r\n		//if RegType is 1 then ignore as we already registered above if allowed for standard users\r\n		\r\n		//override registration passed if BET90 is set\r\n		if((isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"promo\"]))&&\r\n				($_SESSION[\"ODOSessionO\"]->EscapedVars[\"promo\"] == \"BET90\")) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"] = 5;\r\n		}\r\n		\r\n		if((!$ErrorWithData)&&(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"])) && ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"]!=1)) {\r\n			$query = \"SELECT Name, InsertDataCode, AllowGuest, NeedVerify, AfterRegCompleteURL FROM RegistrationTypes WHERE RegID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"];\r\n\r\n			if(($_SESSION[\"ODOUserO\"]->getLoggedIn()) && (!($_SESSION[\"ODOUserO\"]->getIsGuest()))) {\r\n			 	$query = $query . \" AND AllowGuest=1\";\r\n			}\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$RegName = \"\";\r\n			if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n				//invalid RegID type, just exit\r\n				$this->MissingText = $this->MissingText . \"An invalid Registration type was passed. \";\r\n				return false;\r\n			} else {\r\n				$row = mysqli_fetch_assoc($result);\r\n				$RegName = $row[\"Name\"];\r\n\r\n				$RValue = \"\";\r\n				$MyFunc = $row[\"InsertDataCode\"];\r\n				if(is_callable(array(&$this, $MyFunc))) {\r\n					$RValue = call_user_func(array(&$this, $MyFunc));\r\n					if(($RValue === \"ERROR\") || ($RValue === FALSE)) {\r\n						$ErrorWithData = true;\r\n						return false;\r\n					}\r\n				} else {\r\n					trigger_error(\"REGISTER ERROR:We could not call the function name \" . $row[\"InsertDataCode\"], E_USER_ERROR);\r\n					exit();\r\n				}\r\n\r\n				//setup verify if needed by reg type\r\n				if($row[\"NeedVerify\"] == 1) {\r\n					$NeedVerify = true;\r\n					//we might not have a UID here check for errors before inserting anything\r\n					if((!$ErrorWithData) && ($MyID != 0)) {\r\n						//RQuestion is always null for non standard user verifies\r\n						$query = \"INSERT INTO AdminVerify(RegID, UID, RAnswer) values(\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"] . \",\" . $MyID . \",NULL)\";\r\n						$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n						if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n							trigger_error(\"REGISTER ERROR:We could not create verification entry for new user.\" . $MyID, E_USER_ERROR);\r\n							exit();\r\n						}\r\n					}\r\n\r\n				} else {\r\n\r\n					//add user groups\r\n					//else set groups now\r\n					//we might not have a UID here check for errors before inserting anything\r\n					if((!$ErrorWithData) && ($MyID != 0)) {\r\n\r\n						$query = \"SELECT * FROM RegAssignedToGroups WHERE RegID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"];\r\n						$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n						while($row = mysqli_fetch_assoc($result)) {\r\n							//first remove in case of duplicates\r\n							//we don\'t know if creator of reg type checked for previous registrations\r\n							$query = \"SELECT * FROM ODOUserGID WHERE GID=\" . $row[\"GID\"] . \" AND UID=\" . $MyID;\r\n							$result2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n							if(!($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0)) {\r\n								$query = \"INSERT INTO ODOUserGID(GID,UID) values(\" . $row[\"GID\"] . \",\" . $MyID . \")\";\r\n								$result2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n							}\r\n						}\r\n					}\r\n\r\n					$Comment = \"Userid:\" . $MyID . \" Registered for \" . $RegName . \".\";\r\n					$GLOBALS[\'globalref\'][4]->LogEvent(\"USERREGISTEREDPUB\", $Comment, 1);\r\n				}\r\n\r\n			}\r\n\r\n		}\r\n\r\n		//*******************************************************\r\n		//END Specific Registration type\r\n		//*******************************************************\r\n\r\n		//*******************************************************\r\n		//*******************************************************\r\n		//END of Registration\r\n		//*******************************************************\r\n		//*******************************************************\r\n\r\n		//*******************************************************\r\n		//Start of Forwarding onto Registration complete url\r\n		//*******************************************************\r\n		if($ErrorWithData) {\r\n\r\n            $GLOBALS[\'globalref\'][1]->rollBack();\r\n\r\n			return false;\r\n\r\n        } else {\r\n\r\n            $GLOBALS[\'globalref\'][1]->commit();\r\n\r\n			$this->Content = $this->Content . \"<BR>\\n<B>\";\r\n			if($NeedVerify) {\r\n				$this->Content = $this->Content . \"This Registration Type requires a site Admin to verify your account before you will have access. You will be notified by e-mail once this access has been granted. \";\r\n\r\n\r\n				$this->Content = $this->Content . \"Registration is complete.</B></BR><BR>\";\r\n			} else {\r\n				//should replace this with one query at the top of the function\r\n				$localReg = 1;\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"])) {\r\n					$localReg = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"RegID\"];\r\n				}\r\n\r\n\r\n				$this->Content = $this->Content . \"Registration is complete.</B></BR><BR>\";\r\n\r\n				$rURL = $this->GetCompleteURLForReg($localReg);\r\n\r\n					if(strlen($rURL) > 0) {\r\n						$this->Content = $this->Content . \"Please wait...<BR><BR>If you are not forwared in a few seconds you may click <a href=\\\"\" . $rURL . \"\\\">here</a> to continue.<BR><BR><script>\\nfunction OnLoadRefresh(){\\nwindow.location=\\\"\" . $rURL . \"\\\"\\n}\\ntimer=setTimeout(\'OnLoadRefresh()\',5000)\\n  </script>\";\r\n					}\r\n\r\n				}\r\n\r\n		}\r\n\r\n		//**************************************************\r\n		//END forwarding onto Registration complete URL\r\n		//**************************************************\r\n\r\n			return true;\r\n	}\r\n\r\n\r\n',0,0,18),(97,'RunStandardUserChecks',_binary '\r\n\r\n	private function RunStandardUserChecks() {\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"chanswer\"])) {\r\n			$this->MissingText = \"You need to enter the challenge fields on the form! Please hit your browser\'s back button and try again.\";\r\n			return false;\r\n			//if spammer then don\'t bother checking the rest\r\n		} else {\r\n\r\n			$this->OKCaptcha = false;\r\n\r\n			$query = \"SELECT * FROM NoSpam WHERE SessionID=\'\" . session_id() . \"\'\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n				$row = mysqli_fetch_assoc($result);\r\n				if($row[\"txtSpam\"] == $_SESSION[\"ODOSessionO\"]->EscapedVars[\"chanswer\"]) {\r\n					$this->OKCaptcha = true;\r\n				} else {\r\n					$this->OKCaptcha = false;\r\n					$this->MissingText = \"You have entered the wrong CAPTCHA text. Please enter the correct letters in the box at the bottom of this page. \";\r\n					return false;\r\n				}\r\n			}\r\n\r\n		}\r\n\r\n		$ErrorWithData = false;\r\n		//continue checking\r\n		//check if user is already setup\r\n		//if user is not set then register for standard user\r\n		if((!($_SESSION[\"ODOUserO\"]->getLoggedIn())) || ($_SESSION[\"ODOUserO\"]->getIsGuest())) {\r\n\r\n			//first check to see if we allow standard users (always RegID=1)\r\n\r\n			//check UName\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"])) {\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"You have not entered a username! \";\r\n			}\r\n\r\n			if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"]) > 20) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"]) < 3)) {\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"Your username is not between 3 and 20 characters! \";\r\n			}\r\n\r\n			$query = \"SELECT User FROM ODOUsers WHERE User=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"UName\"] . \"\'\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"The username you selected is already chosen. Please select another. \";\r\n			}\r\n\r\n\r\n			//check e-mail address\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"])) {\r\n\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"You are missing the e-mail address! \";\r\n\r\n			} else {\r\n\r\n				$trans = array(\"\\n\" => \"newline\", \"\\r\" => \"newline\", \":\" => \"COLON\");\r\n				$from = strtr($_SESSION[\"ODOSessionO\"]->EscapedVars[\"email\"], $trans);\r\n				if(!(preg_match(\'/^[^0-9][a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[@][a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)*[.][a-zA-Z]{2,4}$/\',$from))) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"There is an error with your e-mail address. Please check the format. \";\r\n				} else {\r\n					$query = \"SELECT UID FROM ODOUsers WHERE emailadd=\'\" . $from . \"\'\";\r\n					$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n					if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n						$ErrorWithData = true;\r\n						$this->MissingText = $this->MissingText . \"This e-mail address already exists. Please choose another to register with or login to your account. \";\r\n\r\n					}\r\n\r\n				}\r\n			}\r\n\r\n\r\n			//check for name\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"])) {\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"Please enter your first name. \";\r\n\r\n			} else {\r\n\r\n				if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"]) < 1) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"FName\"] > 100))) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"Your first name is not between 1 and 100 characters. \";\r\n				}\r\n\r\n			}\r\n\r\n			if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"])) {\r\n				$ErrorWithData = true;\r\n				$this->MissingText = $this->MissingText . \"Please enter your last name. \";\r\n\r\n			} else {\r\n\r\n				if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"]) < 1) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"LName\"] > 100))) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"Your last name is not between 1 and 100 characters. \";\r\n				}\r\n\r\n			}\r\n\r\n\r\n			//check Q and A for Password reset\r\n			if(REQUIREQARESETONREGISTRATION) {\r\n				if((!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"])) || (!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]))) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"You are missing either the Reset Question or Answer. \";\r\n				}\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"])) {\r\n				if(!is_numeric($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"])) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"Your Reset Question is not between 3 and 100 characters. \";\r\n				} elseif((REQUIREQARESETONREGISTRATION)&&($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RQuestion\"]==0)) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"Your must select a Reset Question. \";\r\n\r\n				}\r\n			}\r\n\r\n			if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"])) {\r\n				if((strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]) < 3) || (strlen($_SESSION[\"ODOSessionO\"]->EscapedVars[\"RAnswer\"]) > 100)) {\r\n					$ErrorWithData = true;\r\n					$this->MissingText = $this->MissingText . \"Your Reset Answer is not between 3 and 100 characters. \";\r\n				}\r\n			}\r\n\r\n			if($ErrorWithData) {\r\n				return false;\r\n			} else {\r\n				return true;\r\n			}\r\n\r\n		} else {\r\n			//standard user is already setup. Just return\r\n			return true;\r\n		}\r\n\r\n	}\r\n\r\n\r\n',0,0,18),(98,'ODOCMSRegisterHead',_binary '\r\nclass ODOCMSRegister {\r\n\r\n	var $Content;\r\n	var $OurDataLogLength;\r\n	\r\n	function  __construct() {\r\n		\r\n		$this->Content = \"\";\r\n		$this->OurDataLogLength = 0;\r\n		\r\n	}\r\n\r\n',1,0,19),(99,'ODOCMSRegisterFoot',_binary '\r\n//begin footer\r\n	function __wakeup() {\r\n		$this->Content = \"\";\r\n\r\n	}\r\n\r\n}\r\n\r\n',0,1,19),(100,'VerifyReg',_binary '\r\n	function VerifyReg() {\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"])) {\r\n			$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified!</B></H3></center>\";\r\n			//no error reporting done as this is likely just someone playing with the code\r\n			return;\r\n		} \r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"VERIFYOK\"])) {\r\n			$query = \"SELECT AdminVerify.UID, AdminVerify.RegID, AdminVerify.RAnswer, ODOUsers.User, ODOUsers.emailadd, ODOUsers.rnameFirst as First, ODOUsers.rnameLast as Last, ODOUsers.IsEncrypted as Encrypted, ODOUsers.EncIV as IV FROM AdminVerify LEFT JOIN ODOUsers on AdminVerify.UID=ODOUsers.UID WHERE VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"];\r\n			\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($result) < 1) {\r\n				$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified! VID value passed was not found.</B></H3></center>\";\r\n				//no error reporting as this should only happen in the case of a user playing with post/get vars.\r\n\r\n				return;\r\n			}\r\n\r\n			$row = mysqli_fetch_assoc($result);\r\n			//temp vars needed\r\n			$MyRegID = $row[\"RegID\"];\r\n			$MyID = $row[\"UID\"];\r\n			$MyUName = $row[\"User\"];\r\n			$RAnswer = \"FALSE\";\r\n			$RegName = \"\";\r\n			$Myemail = $row[\"emailadd\"];\r\n			$IsEncrypted = $row[\"Encrypted\"];\r\n			$IV = $row[\"IV\"];\r\n						\r\n			$LName = \"\";\r\n			if((!is_null($row[\"Last\"]))||(strlen(trim($row[\"Last\"])) > 0)) {\r\n				$LName = $row[\"Last\"];\r\n			} \r\n			\r\n			$FName = \"\";\r\n			if((!is_null($row[\"First\"]))||(strlen(trim($row[\"First\"])) > 0)) {\r\n				$FName = $row[\"First\"];\r\n			} \r\n			\r\n			$FullName = $FName . \" \" . $LName;\r\n\r\n			if((isset($row[\"RAnswer\"])) && (!is_null($row[\"RAnswer\"]))) {\r\n				$RAnswer = $row[\"RAnswer\"];\r\n			}\r\n			\r\n			if($IsEncrypted == 1) {\r\n				if($GLOBALS[\'globalref\'][7]->isMcryptAvailable()) {\r\n					$encData = new EncryptedData();\r\n					$encData->iv = $IV;\r\n					$encData->encArray[\"emailadd\"] = $Myemail;\r\n					$encData->encArray[\"rnameLast\"] = $LName;\r\n					$encData->encArray[\"rnameFirst\"] = $FName;\r\n								\r\n					$encData = $GLOBALS[\'globalref\'][7]->ODODecrypt($encData);\r\n					$Myemail = $encData->decArray[\"emailadd\"];\r\n					$LName = $encData->decArray[\"rnameLast\"];\r\n					$FName = $encData->decArray[\"rnameFirst\"];\r\n				} else {\r\n					$Myemail = \"\";\r\n					$LName = \"\";\r\n					$FName = \"\";\r\n					$GLOBALS[\'globalref\'][4]->LogEvent(\"DECRYPTERROR\", \"User info for \" . $UID . \" is encrypted but mcrypt is not available on server.\", 3);\r\n				}\r\n			} \r\n						\r\n			//set groups first\r\n			$query = \"SELECT RegistrationTypes.Name, RegAssignedToGroups.GID FROM RegAssignedToGroups LEFT JOIN RegistrationTypes on RegAssignedToGroups.RegID=RegistrationTypes.RegID WHERE RegAssignedToGroups.RegID=\" . $MyRegID;\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n\r\n			while($row = mysqli_fetch_assoc($result)) {\r\n					\r\n				if(strlen($RegName) < 1) {\r\n					$RegName = $row[\"Name\"];\r\n				}\r\n				//check for existing group before doing an insert\r\n				\r\n				$query = \"INSERT INTO ODOUserGID(GID,UID) values(\" . $row[\"GID\"] . \",\" . $MyID . \")\";\r\n				$result2 = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				\r\n			}\r\n\r\n			$MyErrorFlag = false;\r\n			if($MyRegID == 1) {\r\n				//if regid is standard user then move QAnswer over to UID and set IsLocked to 0\r\n				//check if RAnswer was set\r\n				if($RAnswer != \"FALSE\") {\r\n					$query = \"UPDATE ODOUsers SET ResetA=\'\" . $RAnswer . \"\', IsLocked=0 WHERE UID=\" . $MyID;\r\n				} else {\r\n					$query = \"UPDATE ODOUsers SET IsLocked=0 WHERE UID=\" . $MyID;\r\n				}\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n				\r\n				if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() < 1) {\r\n					trigger_error(\"ODOCMSRegister:VerifyReg:UID not found in ODOUsers.\", E_USER_WARNING);\r\n					$MyErrorFlag=true;\r\n				} else {\r\n\r\n					$Comment = \"UserID: \" . $MyID . \":\" . $MyUName . \" was created by Admin Verify Registration.\";\r\n					$GLOBALS[\'globalref\'][4]->LogEvent(\"USERREGISTEREDADMINV\", $Comment, 1);\r\n\r\n				}\r\n\r\n			} else {\r\n\r\n				$Comment = \"UserID: \" . $MyID . \":\" . $MyUName . \" was registered for \" . $RegName . \" by Admin Verify.\";\r\n					\r\n				$GLOBALS[\'globalref\'][4]->LogEvent(\"USERREGISTEREDADMINV\", $Comment, 1);\r\n				\r\n			}\r\n\r\n			//remove from AdminVerify\r\n			if(!$MyErrorFlag) {\r\n				$query = \"DELETE FROM AdminVerify WHERE VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"];\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n				$this->Content = $this->Content . \"<BR><H3>We have registered user \" . $MyUName . \" for registration type \";\r\n\r\n				if(strlen($RegName)>0) {\r\n					$this->Content = $this->Content . $RegName . \".\";\r\n				} else {\r\n					$this->Content = $this->Content . \"[No Name for Reg type!].\";\r\n				}\r\n	\r\n				$this->Content = $this->Content . \"</H3><BR></CENTER>\";\r\n\r\n				$query = \"SELECT emailMsg FROM RegistrationTypes WHERE RegID=\" . $MyRegID;\r\n				$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n				$message = \"\";\r\n				\r\n					//create custom html here.\r\n				//[[ServerName]] - server name replaced by constant\r\n				//[[CustEmail]] - replaced with customer\'s e-mail\r\n				//[[CustName]] - replaced with customer\'s name\r\n				//[[CustFirstName]] - replaced with customer\'s first name\r\n				//[[CustLastName]] - replaced with customer\'s last name\r\n				//[[CustUserName]] - replaced with customer\'s username\r\n				//[[Logo]] - replaced with img tag http://SERVERADDRESS/images/GetImage.php?Name=Logo\r\n				//[[RegName]] - replaced with registration name for given regID\r\n				//[[ServerAddress]] - domain name of server\r\n				//[[LoginInfo]] - replaced with username and password\r\n		\r\n				$row = mysqli_fetch_assoc($result);\r\n				\r\n				if((!is_null($row[\"emailMsg\"]))&&(strlen(trim($row[\"emailMsg\"]))>0)) {\r\n						$message = $row[\"emailMsg\"];\r\n										\r\n				} else {\r\n				\r\n					$message = \"<html>\\n<head>\\n<TITLE>Welcome to [[ServerName]]</TITLE>\\n</head>\\n<body bgcolor=\\\"Gray\\\" text=\\\"White\\\">\\n[[Logo]]<br>\\n<H3>Your Registration at [[ServerName]] has been accepted!</H3><Hr>\\n<P>The Administrator at [[ServerName]] has accepted your request to register for [[RegName]]. To access your account please login <a href=\\\"http://[[ServerAddress]]/login.php\\\">here</a>. Or simply visit <B>http://[[ServerAddress]]/login.php</B> .</P>\\n\\n</body>\\n</html>\";\r\n					\r\n				}\r\n				\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"emailuser\"])){\r\n					\r\n					//e-mail the user of their new access\r\n					// To send HTML mail, the Content-type header must be set\r\n					$headers  = \'MIME-Version: 1.0\' . \"\\n\";\r\n					$headers .= \'Content-type: text/html; charset=iso-8859-1\' . \"\\n\";\r\n					$headers .= \'From: \' . REGREPLYEMAIL . \"\\n\";\r\n					$headers .= \'Reply-To: \' . REGREPLYEMAIL . \"\\n\";\r\n					$headers .= \'X-Mailer: ODOWeb\' . \"\\n\";\r\n\r\n					$message = str_replace(\"[[ServerName]]\", SERVERNAME, $message);\r\n					$message = str_replace(\"[[CustEmail]]\", $Myemail, $message);\r\n					$message = str_replace(\"[[CustName]]\", $FullName, $message);\r\n					$message = str_replace(\"[[CustFirstName]]\", $FName, $message);\r\n					$message = str_replace(\"[[CustLastName]]\", $LName, $message);\r\n					$message = str_replace(\"[[CustUserName]]\", $MyUName, $message);\r\n					$LogoURL = \"<img src=\\\"http://\" . SERVERADDRESS . \"/\" . GETIMAGEURLPATH . \"?Name=Logo\\\">\";\r\n					$message = str_replace(\"[[Logo]]\", $LogoURL, $message);\r\n					$message = str_replace(\"[[RegName]]\", $RegName, $message);\r\n					$message = str_replace(\"[[ServerAddress]]\", SERVERADDRESS, $message);\r\n				\r\n					if(!mail($Myemail, \"Registered at \" . SERVERNAME . \".\", $message, $headers)) {\r\n						trigger_error(\"ODOWEBERROR:ODOCMSRegister:VerifyReg:Could not e-mail user:\" . $MyID, E_USER_WARNING);\r\n						$this->Content = $this->Content . \"<BR><h3>We had an error trying to e-mail the user the update of their Registration status.</H3></center>\\n\";\r\n					}\r\n\r\n				\r\n				}\r\n				\r\n\r\n			} else {\r\n\r\n				$this->Content = $this->Content . \"<BR><H3>We had an error registering the user. Some groups may have been updated for user \" . $MyUName . \" but there was an error trying to find the userid after adding these groups. We should never get this error, and yet we have.!?</H3></center>\";\r\n\r\n			}\r\n\r\n		} else {\r\n\r\n			$query = \"SELECT AdminVerify.VID, ODOUsers.UID, ODOUsers.User, ODOUsers.EncIV, ODOUsers.IsEncrypted, ODOUsers.rnameFirst, ODOUsers.rnameLast, ODOUsers.emailadd, RegistrationTypes.Name FROM RegistrationTypes, AdminVerify, ODOUsers WHERE AdminVerify.VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"] . \" AND AdminVerify.RegID=RegistrationTypes.RegID AND AdminVerify.UID=ODOUsers.UID\";\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($result) < 1) {\r\n				$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified! VID value passed was not found.</B></H3></center>\";\r\n				//no error reporting as this should only happen in the case of a user playing with post/get vars.\r\n				return;\r\n			}\r\n\r\n			$row = mysqli_fetch_assoc($result);\r\n			\r\n			$Myemail = $row[\"emailadd\"];\r\n			\r\n			$LName = \"\";\r\n			if((!is_null($row[\"rnameLast\"]))||(strlen(trim($row[\"rnameLast\"])) > 0)) {\r\n				$LName = $row[\"rnameLast\"];\r\n			} \r\n			\r\n			$FName = \"\";\r\n			if((!is_null($row[\"rnameFirst\"]))||(strlen(trim($row[\"rnameFirst\"])) > 0)) {\r\n				$FName = $row[\"rnameFirst\"];\r\n			} \r\n			\r\n			if($row[\"IsEncrypted\"] == 1) {\r\n				if($GLOBALS[\'globalref\'][7]->isMcryptAvailable()) {\r\n					$encData = new EncryptedData();\r\n					$encData->iv = $row[\"EncIV\"];\r\n					$encData->encArray[\"emailadd\"] = $Myemail;\r\n					$encData->encArray[\"rnameLast\"] = $LName;\r\n					$encData->encArray[\"rnameFirst\"] = $FName;\r\n								\r\n					$encData = $GLOBALS[\'globalref\'][7]->ODODecrypt($encData);\r\n					$Myemail = $encData->decArray[\"emailadd\"];\r\n					$LName = $encData->decArray[\"rnameLast\"];\r\n					$FName = $encData->decArray[\"rnameFirst\"];\r\n				} else {\r\n					$Myemail = \"MCrypt not enabled\";\r\n					$LName = \"MCrypt not enabled\";\r\n					$FName = \"\";\r\n					$GLOBALS[\'globalref\'][4]->LogEvent(\"DECRYPTERROR\", \"User info for \" . $UID . \" is encrypted but mcrypt is not available on server.\", 3);\r\n				}\r\n			} \r\n			\r\n				//show all register requests for this user. accept all at once and e-mail once for group.\r\n			$this->Content = $this->Content . \"<BR><H3><B>Are you sure you want to accept this request?</B></H3><BR>\";\r\n			\r\n			$this->Content .= \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\">\";\r\n			\r\n			$this->Content .= \"<table border=0><TR><TD>User Name:</TD><TD>\" . $row[\"User\"] . \"</TD></TR><TR><TD>Name:</TD><TD>\" . $LName . \",\" . $FName . \"</TD></TR><TR><TD>Email:</TD><TD>\" . $Myemail . \"</TD></TR><TR><TD>Register Type:</TD><TD>\" . $row[\"Name\"] . \"</TD></TR>\";\r\n			\r\n			$this->Content .= \"<TR><TD>E-mail user:</TD><TD><input type=\\\"checkbox\\\" name=\\\"emailuser\\\" value=\\\"true\\\"></TD></TR>\";\r\n			\r\n			$this->Content .= \"<TR><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"VID\\\" value=\\\"\" . $row[\"VID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"VerifyReg\\\"><input type=\\\"hidden\\\" name=\\\"VERIFYOK\\\" value=\\\"VERIFYOK\\\"><TD><input type=\\\"submit\\\" name=\\\"Accept\\\" value=\\\"Accept\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ListPending\\\"><TD><input type=\\\"submit\\\" name=\\\"Back To List\\\" value=\\\"Back To List\\\"></td></form></TR></Table></center>\";\r\n			\r\n		}\r\n	}\r\n\r\n',0,0,19),(101,'DeleteRegRequest',_binary '	\r\n	function DeleteRegRequest() {\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n\r\n\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"])) {\r\n			$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified!</B></H3></center>\";\r\n			//no error reporting done as this is likely just someone playing with the code\r\n			return;\r\n		} \r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"DELETEOK\"])) {\r\n			$query = \"SELECT AdminVerify.UID, AdminVerify.RegID, ODOUsers.User FROM AdminVerify LEFT JOIN ODOUsers on AdminVerify.UID=ODOUsers.UID WHERE AdminVerify.VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"];\r\n			\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($result) < 1) {\r\n				$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified!</B></H3></center>\";\r\n				//no error reporting done as this is likely just someone playing with the code\r\n				return;\r\n			}\r\n\r\n			$row = mysqli_fetch_assoc($result);\r\n\r\n			$MyRegID = $row[\"RegID\"];\r\n			$MyUID = $row[\"UID\"];\r\n			$MyUserName = \"\";\r\n			if(!is_null($row[\"User\"])) {\r\n				$MyUserName = $row[\"User\"];\r\n			}\r\n\r\n			//now delete Verify\r\n			$query = \"DELETE FROM AdminVerify WHERE VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"];\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if($MyRegID == 1) {\r\n				//Standard User Reg so delete User. \r\n				$this->Content = $this->Content . \"<BR><H3><B>We have removed the Registration Request. This was a Standard User Registration. \";\r\n\r\n				if(strlen($MyUserName) < 1) {\r\n					$this->Content = $this->Content . \"We could not find a valid username listed in the User table. The User may have already been deleted.</B></H3></center>\"; \r\n\r\n				} else {\r\n\r\n					$this->Content = $this->Content . \"Please click the Delete User button below to remove the user fromt he system as well.</B></H3><BR><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSUsersO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteUser\\\"><input type=\\\"hidden\\\" name=\\\"userid\\\" value=\\\"\" . $MyUID . \"\\\"><input type=\\\"hidden\\\" name=\\\"user\\\" value=\\\"\" . $MyUserName . \"\\\"><input type=\\\"hidden\\\" name=\\\"DeleteMe\\\" value=\\\"true\\\"><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\"></form><br></center>\";\r\n\r\n				}\r\n			} else {\r\n	\r\n				$this->Content = $this->Content . \"<BR><H3><B>We have removed the Registration Request.</B></H3></center>\";\r\n\r\n			}\r\n\r\n		} else {\r\n\r\n			$query = \"SELECT AdminVerify.VID, ODOUsers.UID, ODOUsers.User, ODOUsers.rnameFirst, ODOUsers.rnameLast, ODOUsers.emailadd, RegistrationTypes.Name FROM RegistrationTypes, AdminVerify, ODOUsers WHERE AdminVerify.VID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"VID\"] . \" AND AdminVerify.RegID=RegistrationTypes.RegID AND AdminVerify.UID=ODOUsers.UID\";\r\n\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			if(mysqli_num_rows($result) < 1) {\r\n				$this->Content = $this->Content . \"<BR><H3><B>Error: You must call the Verify Registration System with a valid verification specified! VID value passed was not found.</B></H3></center>\";\r\n				//no error reporting as this should only happen in the case of a user playing with post/get vars.\r\n				return;\r\n			}\r\n\r\n			$row = mysqli_fetch_assoc($result);\r\n\r\n			$this->Content = $this->Content . \"<BR><H3><B>Are you sure you want to deny this request?</B></H3><BR><table border=0><TR><TD>User Name:</TD><TD>\" . $row[\"User\"] . \"</TD></TR><TR><TD>Name:</TD><TD>\" . $row[\"rnameLast\"] . \",\" . $row[\"rnameFirst\"] . \"</TD></TR><TR><TD>Register Type:</TD><TD>\" . $row[\"Name\"] . \"</TD></TR><TR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"VID\\\" value=\\\"\" . $row[\"VID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteRegRequest\\\"><input type=\\\"hidden\\\" name=\\\"DELETEOK\\\" value=\\\"DELETEOK\\\"><TD><input type=\\\"submit\\\" name=\\\"Deny\\\" value=\\\"Deny\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"ListPending\\\"><TD><input type=\\\"submit\\\" name=\\\"Back To List\\\" value=\\\"Back To List\\\"></td></form></TR></Table></center>\";\r\n\r\n		}\r\n	}\r\n\r\n\r\n	',0,0,19),(102,'ListPending',_binary '\r\n	function ListPending() {\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n		\r\n		$query = \"SELECT AdminVerify.VID, ODOUsers.UID, ODOUsers.User, ODOUsers.IsEncrypted, ODOUsers.EncIV, ODOUsers.rnameFirst, ODOUsers.rnameLast, ODOUsers.emailadd, RegistrationTypes.Name FROM RegistrationTypes, AdminVerify, ODOUsers WHERE RegistrationTypes.RegID=AdminVerify.RegID AND AdminVerify.UID=ODOUsers.UID\";\r\n\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($result);\r\n		\r\n		$NumofPages = $RecordCount / 30;\r\n		$Count = 0;\r\n\r\n		if($RecordCount == 0) {\r\n			$this->Content = $this->Content . \"<BR><h3>There are no pending requests.</h3><br><br></center>\";\r\n			return;\r\n		} elseif ($RecordCount % 30 > 0) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n		} else {\r\n			$this->Content = $this->Content . \"<br><B><H3>Registrations to Verify</H3></B><br><table border=1><TR><th>UserName</TH><TH>LastName,FirstName</TH><TH>E-mail Address</TH><TH>Registration Type</TH><TH>Allow</TH><TH>Deny</TH></TR>\";\r\n\r\n			if($RecordCount < 1) {\r\n				$this->Content = $this->Content . \"\\n<TR><TD><center><B>THERE ARE NO REQUESTS AT THIS TIME.</B></center></TD></TR>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 30;\r\n				mysqli_data_seek($result, $ChangeToRow);\r\n				while(($Count < 30) && ($row = mysqli_fetch_assoc($result))) {\r\n					\r\n					$LName = \"\";\r\n					if((!is_null($row[\"rnameLast\"]))||(strlen(trim($row[\"rnameLast\"])) > 0)) {\r\n						$LName = $row[\"rnameLast\"];\r\n					} \r\n			\r\n					$FName = \"\";\r\n					if((!is_null($row[\"rnameFirst\"]))||(strlen(trim($row[\"rnameFirst\"])) > 0)) {\r\n						$FName = $row[\"rnameFirst\"];\r\n					} \r\n	\r\n					$email = $row[\"emailadd\"];\r\n					\r\n					if($row[\"IsEncrypted\"] == 1) {\r\n						\r\n						if($GLOBALS[\'globalref\'][7]->isMcryptAvailable()) {\r\n							$encData = new EncryptedData();\r\n							$encData->iv = $row[\"EncIV\"];\r\n							$encData->encArray[\"emailadd\"] = $email;\r\n							$encData->encArray[\"rnameLast\"] = $LName;\r\n							$encData->encArray[\"rnameFirst\"] = $FName;\r\n								\r\n							$encData = $GLOBALS[\'globalref\'][7]->ODODecrypt($encData);\r\n							$email = $encData->decArray[\"emailadd\"];\r\n							$LName = $encData->decArray[\"rnameLast\"];\r\n							$FName = $encData->decArray[\"rnameFirst\"];\r\n						} else {\r\n							$email = \"\";\r\n							$LName = \"\";\r\n							$FName = \"\";\r\n							$GLOBALS[\'globalref\'][4]->LogEvent(\"DECRYPTERROR\", \"User info for \" . $UID . \" is encrypted but mcrypt is not available on server.\", 3);\r\n						}\r\n						\r\n					} \r\n			\r\n					$this->Content = $this->Content . \"\\n<TR><TD><a href=\\\"index.php?pg=ODOCMS&ob=ODOUserO&fn=EditUser&userid=\" . $row[\"UID\"] . \"\\\">\" . $row[\"User\"] . \"</a></TD><TD>\" . $LName . \",\" . $FName . \"</TD><TD>\" . $email . \"</TD><TD>\" . $row[\"Name\"] . \"</TD><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"VID\\\" value=\\\"\" . $row[\"VID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"VerifyReg\\\"><TD><input type=\\\"submit\\\" name=\\\"Accept\\\" value=\\\"Accept\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"VID\\\" value=\\\"\" . $row[\"VID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteRegRequest\\\"><TD><input type=\\\"submit\\\" name=\\\"Deny\\\" value=\\\"Deny\\\"></TD></form></TR>\";\r\n		\r\n\r\n				}\r\n\r\n				\r\n				$this->Content = $this->Content . \"</Table>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ListPending&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ListPending&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ListPending&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n\r\n			}\r\n\r\n			\r\n		}\r\n\r\n	}\r\n\r\n     ',0,0,19),(103,'ViewRegTypes',_binary '\r\n	function ViewRegTypes() {\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n		}\r\n\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n\r\n\r\n\r\n		$query = \"SELECT * FROM RegistrationTypes\";\r\n		$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n		$RecordCount = mysqli_num_rows($result);\r\n		$NumofPages = $RecordCount / 30;\r\n		$Count = 0;\r\n\r\n		if( ($RecordCount % 30 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n			$this->Content = $this->Content . \"<BR><BR><h3>Page number is out of bounds!</h3><br><br></center>\";\r\n		} else {\r\n\r\n			$this->Content = $this->Content . \"<br><BR>Note: For this version of ODOWeb only 1 registration type is available.<BR><BR><B><H3>Registration Types</H3></B><br><table border=1><TR><th>ID</TH><TH>Name</TH><TH>Is Public</TH><TH>Edit</TH><TH>Delete</TH></TR>\";\r\n\r\n			if($RecordCount < 1) {\r\n				$this->Content = $this->Content . \"\\n<TR><TD><center><B>THERE ARE NO REQUESTS AT THIS TIME.</B></center></TD></TR></table></center>\";\r\n			} else {\r\n				$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 30;\r\n				mysqli_data_seek($result, $ChangeToRow);\r\n				while(($Count < 30) && ($row = mysqli_fetch_assoc($result))) {\r\n					$this->Content = $this->Content . \"\\n<TR><TD>\" . $row[\"RegID\"] . \"</TD><TD>\" . $row[\"Name\"] . \"</TD><TD>\";\r\n\r\n					if($row[\"AllowGuest\"] == 1) {\r\n						$this->Content = $this->Content . \"Yes\";\r\n					} else {\r\n						$this->Content = $this->Content . \"No\";\r\n					}\r\n\r\n					$this->Content = $this->Content . \"</TD><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"RegID\\\" value=\\\"\" . $row[\"RegID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditReg\\\"><TD><input type=\\\"submit\\\" name=\\\"Edit\\\" value=\\\"Edit\\\" disabled=\\\"true\\\"></td></form><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"RegID\\\" value=\\\"\" . $row[\"RegID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"DeleteReg\\\"><TD><input type=\\\"submit\\\" name=\\\"Delete\\\" value=\\\"Delete\\\" disabled=\\\"true\\\"></TD></form></TR>\";\r\n		\r\n\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</Table>\";\r\n\r\n				$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n				//we want to count down the Pages\r\n				$NumberofLinks = 1;\r\n				//$i is the current position\r\n				$i = $CurPage - 4;\r\n				if($i < 1) {\r\n					$i = 1;\r\n				}\r\n\r\n				if(($CurPage > 5)) {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewRegTypes&PageNum=\" . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n				} else {\r\n					$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n				}\r\n\r\n				while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n					if($CurPage == $i) {\r\n						$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n					} else {\r\n						$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewRegTypes&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n					}\r\n					$i = $i + 1;\r\n					$NumberofLinks = $NumberofLinks + 1;\r\n				}\r\n\r\n				if($i > $NumofPages) {\r\n					$this->Content = $this->Content . \"&nbsp;Next->\";\r\n				} else {\r\n					$this->Content = $this->Content . \"&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=ViewRegTypes&PageNum=\" . $i . \"\\\">Next-></a>\";\r\n				}\r\n\r\n				$this->Content = $this->Content . \"</center>\";\r\n\r\n			}\r\n\r\n\r\n		}\r\n		\r\n	}\r\n\r\n\r\n	',0,0,19),(145,'ODOCMSConstantsHead',_binary '\r\nclass ODOCMSConstants {\r\n	\r\n		var $Content;\r\n		\r\n		function  __construct() {\r\n			$this->Content = \"\";\r\n			\r\n		}\r\n	\r\n',1,0,27),(146,'ODOCMSConstantsFoot',_binary '	\r\n	//footer\r\n	\r\n	function __sleep() {\r\n		$this->Content = \"\";\r\n		return( array_keys( get_object_vars( $this ) ) );\r\n	}\r\n	\r\n}\r\n\r\n',0,1,27),(147,'ViewConstants',_binary '		\r\n		function ViewConstants() {\r\n			$query = \"SELECT ConstID, ConstName, Value, Constants.Description as CDesc, Constants.ModID as ModID, Modules.ModName as ModName FROM Constants LEFT JOIN Modules on Constants.ModID = Modules.ModID ORDER BY Constants.ModID ASC\";\r\n				\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$CurModID = 0;\r\n			\r\n				if(mysqli_num_rows($TempRecords)>0) {\r\n					$this->Content = \"<center>\\n<H4>Constants</H4>\\n<br>\\n<Table border=\\\"2\\\">\\n<TR>\\n\\t<TH>ConstID</TH><TH>Constant Name</TH><TH>Description</TH><TH>Value</TH><TH>Mod ID</TH><TH>Module Name</TH><TH>Edit</TH>\\n</TR>\\n\";\r\n					while($row = mysqli_fetch_assoc($TempRecords)){\r\n			\r\n						//check to see if we need to show a divider\r\n						if((isset($row[\"ModID\"]))&&($CurModID != $row[\"ModID\"])) {\r\n							$CurModID = $row[\"ModID\"];\r\n							$this->Content = $this->Content . \"<TR>\\n\\t<TD colspan=\\\"7\\\" align=\\\"center\\\"><B>\";\r\n							if(isset($row[\"ModName\"])) {\r\n								$this->Content = $this->Content . $row[\"ModName\"];\r\n							} else {\r\n								$this->Content = $this->Content . \"Unknown Module\";\r\n							}\r\n\r\n							$this->Content = $this->Content . \"</B></TD>\\n</TR>\\n\";\r\n						}\r\n						\r\n						$this->Content = $this->Content . \"<TR>\\n\\t<TD>\" . $row[\"ConstID\"] . \"</TD><TD>\" . $row[\"ConstName\"] . \"</TD><TD>\" . $row[\"Value\"] . \"</TD><TD>\" . $row[\"CDesc\"] . \"</TD><TD>\";\r\n						\r\n						if(isset($row[\"ModID\"])) {\r\n							$this->Content = $this->Content . $row[\"ModID\"] . \"</TD><TD>\";\r\n							\r\n							if(isset($row[\"ModName\"])) {\r\n								$this->Content = $this->Content . $row[\"ModName\"] . \"</TD>\";\r\n							} else {\r\n								$this->Content = $this->Content . \"Default</TD>\";\r\n							}\r\n							\r\n						} else {\r\n							$this->Content = $this->Content . \"Not Assigned</TD><TD>Not Assigned</TD>\";\r\n						}\r\n						\r\n						$this->Content = $this->Content . \"<TD><input type=\\\"button\\\" name=\\\"Edit\\\" value=\\\"Edit\\\" onclick=\\\"window.location.href=\'index.php?pg=ODOCMS&ob=ODOCMSConstantsO&fn=EditConstants&ConstID=\" . $row[\"ConstID\"] . \"\'\\\"/></TD>\\n</TR>\\n\";\r\n						\r\n					}\r\n					\r\n					$this->Content = $this->Content . \"</table>\";\r\n					\r\n				} else {\r\n						$this->Content = \"<center><B>There was an error retreiving the Constants.</B></center>\";\r\n				}\r\n		}\r\n	\r\n	',0,0,27),(148,'EditConstants',_binary '	\r\n		function EditConstants() {\r\n				if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConstID\"])) {\r\n						$this->Content = \"<center><H4>You must select a constant to edit first!</H4></center>\";\r\n						return;\r\n				}\r\n				\r\n				if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UpdateConst\"])) {\r\n						if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"UValue\"])) {\r\n							$this->Content = \"<center><H4>You must set a value to update this constant to!</H4></center>\";\r\n							return;\r\n						}\r\n						\r\n						$query = \"UPDATE Constants SET Value=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"UValue\"] . \"\' WHERE ConstID=\" .  $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConstID\"];\r\n						$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n					\r\n						if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected() > 0) {\r\n							$this->Content = \"<center><H4>Constant has been updated.</H4></center>\";\r\n						} else {\r\n							$this->Content = \"<center><H4>The Constant was NOT updated. Please verify the table structure.</H4></center>\";\r\n						}\r\n						\r\n				} else {\r\n				\r\n					$query = \"SELECT ConstID, ConstName, Value, Constants.Description as CDesc, Constants.ModID as ModID, Modules.ModName as ModName FROM Constants LEFT JOIN Modules on Constants.ModID = Modules.ModID WHERE ConstID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"ConstID\"];\r\n					$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n					\r\n					if(mysqli_num_rows($TempRecords)>0) {\r\n						$row = mysqli_fetch_assoc($TempRecords);\r\n						$this->Content = \"<center>\\n<H4>Edit Constant</H4>\\n<BR><BR>\\n\\n<table border=\\\"2\\\">\\n<TR>\\n\\t<TD>ConstantID:</TD><TD>\" . $row[\"ConstID\"] . \"</TD>\\n</TR>\\n<TR>\\n\\t<TD>ModID:</TD><TD>\" . $row[\"ModID\"] . \"</TD>\\n</TR>\\n<TR>\\n\\t<TD>Module name:</TD><TD>\" . $row[\"ModName\"] . \"</TD>\\n</TR>\\n<TR>\\n\\t<TD>Constnt Name:</TD><TD>\" . $row[\"ConstName\"] . \"</TD>\\n</TR>\\n<TR>\\n\\t<TD>Constant <BR>Description:</TD><TD>\" . $row[\"CDesc\"] . \"</TD>\\n</TR>\\n<TR>\\n\\t<TD>Value:</TD>\";\r\n						\r\n						$this->Content = $this->Content . \"<form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSConstantsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditConstants\\\"><input type=\\\"hidden\\\" name=\\\"ConstID\\\" value=\\\"\" . $row[\"ConstID\"] . \"\\\"><input type=\\\"hidden\\\" name=\\\"UpdateConst\\\" value=\\\"UpdateConst\\\"><TD><input type=\\\"text\\\" size=\\\"50\\\" name=\\\"UValue\\\" value=\\\"\" . $row[\"Value\"] . \"\\\"></TD>\\n</TR>\\n</TABLE>\\n<br>\\n<input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\">\\n</form>\\n</CENTER>\";\r\n						\r\n					} else {\r\n						$this->Content = \"<center><H4>Constant not found!</H4></center>\";\r\n					}\r\n				\r\n				}\r\n		}\r\n		\r\n	',0,0,27),(149,'ViewByTimeStamp',_binary '\r\n	function ViewByTimeStamp() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSLogs\");\r\n\r\n		$this->LoadODOMenus();\r\n		\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			//reset our data length\r\n			$this->OurDataLogLength=0;\r\n		}\r\n			\r\n		if($this->OurDataLogLength==0) {\r\n			$query = \"SELECT count(*) as ULogs FROM ODOLogs\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			if(mysqli_num_rows($TempRecords) > 0) {\r\n				$row = mysqli_fetch_assoc($TempRecords);\r\n				$this->OurDataLogLength = $row[\"ULogs\"];\r\n			} else {\r\n				trigger_error(\"Error: NO LOGS FOUND!\", E_USER_NOTICE);\r\n				$this->Content = $this->Content . \"<B>NO LOGS WERE FOUND!</B>\";\r\n				return;\r\n			}\r\n		}\r\n			\r\n		$LimitStart = 0;\r\n			\r\n		if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]  > 1) {\r\n			$LimitStart = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]-1)*20;\r\n		}				\r\n			\r\n		//check bounds first\r\n		$NumofPages = $this->OurDataLogLength / 20;\r\n		$Count = 0;\r\n\r\n		if( ($this->OurDataLogLength % 20 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				\r\n			$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			\r\n		} else {\r\n			\r\n			$query = \"select * from ODOLogs order by TimeStamp DESC, PriKey DESC LIMIT \" . $LimitStart . \",20\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			//simple table format\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Logs By TimeStamp</H3><BR><table border=1><TR><TH>TimeStamp</TH><TH>UID</TH><TH>Action</TH><TH>Comment</TH><TH>Severity</TH><TH>IP</TH></TR>\";\r\n	\r\n			while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n				$this->Content = $this->Content . \"<tr><td>\" . $row[\"TimeStamp\"] . \"</td><TD><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditUser&userid=\" . $row[\"UID\"] . \"\\\">\" . $row[\"UID\"] . \"</a></td><td>\" . $row[\"ActionDone\"] . \"</td><td>\" . $row[\"Comment\"] . \"</td><td>\" . $row[\"Severity\"] . \"</td><td>\" . $row[\"IP\"] . \"</td></tr>\";\r\n				\r\n					$Count = $Count + 1;\r\n			}\r\n\r\n\r\n			$this->Content = $this->Content . \"</table><BR><BR>\";\r\n				\r\n				\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage - 5) . \"\\\"><<</a>&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				//Not counted in number of page links\r\n			} elseif($CurPage > 1) {\r\n				$this->Content = $this->Content . \"<<&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<<&nbsp;<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if(($CurPage+5) <= $NumofPages) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage+1) . \"\\\">Next-></a>&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage+5) . \"\\\">>></a>\";\r\n			} elseif($CurPage < $NumofPages) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=ViewByTimeStamp&PageNum=\" . ($CurPage+1) . \"\\\">Next-></a>&nbsp;>>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"Next->&nbsp;>>\";\r\n			}\r\n			\r\n		}\r\n		\r\n	}\r\n		\r\n	',0,0,13),(150,'UserLoginLogoutReport',_binary '\r\n	function UserLoginLogoutReport() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSLogs\");\r\n\r\n		$this->LoadODOMenus();\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			//reset our data length only used for user logs\r\n			$this->OurDataLogLength=0;\r\n		}\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CurUser\"])) {\r\n			$this->BuildUserLoginLogOutReport();\r\n		} else {\r\n			$this->BuildUserListForLoginLogOutReporting() ;\r\n		}\r\n		\r\n		$this->Content = $this->Content . \"</center>\";\r\n		\r\n	}\r\n		\r\n	private function BuildUserListForLoginLogOutReporting() {\r\n			//load UserRecords\r\n			$query = \"select * from ODOUsers ORDER BY user\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			$RecordCount = mysqli_num_rows($TempRecords);\r\n			$NumofPages = $RecordCount / 15;\r\n			$Count = 0;\r\n\r\n			if( ($RecordCount % 15 > 0) ) {\r\n				$NumofPages = intval($NumofPages) + 1;\r\n			}\r\n			\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				$this->Content = $this->Content . \"<center><h4>Page number is out of bounds!</h4><br><br></center>\";\r\n				return;\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"<br><br><table border=1><TR><TH>User ID</TH><th>User Name</th><th>User\'s Real Name</th><th>User\'s e-mail address</th><th>View Report</th></TR><TR><TD>N/A</TD><TD>View All Users</TD><TD>View All Users</TD><TD>N/A</TD><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSLogsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"UserLoginLogoutReport\\\"><input type=\\\"hidden\\\" name=\\\"CurUser\\\" value=\\\"0\\\"><TD><input type=\\\"submit\\\" name=\\\"ViewAll\\\" value=\\\"View All\\\"></TD></form></TR>\";\r\n\r\n			$ChangeToRow = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] - 1) * 15;\r\n			mysqli_data_seek($TempRecords, $ChangeToRow);\r\n			while(($Count < 15) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				$this->Content = $this->Content . \"<tr><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSLogsO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"UserLoginLogoutReport\\\"><input type=\\\"hidden\\\" name=\\\"CurUser\\\" value=\\\"\" . $row[\"UID\"] . \"\\\"><TD>\" . $row[\"UID\"] . \"</TD><TD>\" . $row[\"user\"] . \"</TD><TD>\" . $row[\"rnameLast\"] . \", \" . $row[\"rnameFirst\"] . \"</TD><TD>\" . $row[\"emailadd\"] . \"</TD><TD><input type=\\\"submit\\\" name=\\\"ViewReport\\\" value=\\\"View Report\\\"></TD></form></TR>\";\r\n			\r\n			\r\n				$Count = $Count + 1;\r\n			}\r\n			\r\n			$this->Content = $this->Content . \"</table><br><br>\";\r\n\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			$link = \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=UserLoginLogoutReport&PageNum=\";\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . $link . ($CurPage - 5) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n					//Not counted in number of page links\r\n			} else {\r\n				$this->Content = $this->Content . \"<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . $link . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if($NumofPages >= ($i+5)) {\r\n				$this->Content = $this->Content . \"&nbsp;\" . $link . ($i+5) . \"\\\">Next-></a>\";\r\n			} elseif($NumofPages > $i) {\r\n				$this->Content = $this->Content . \"&nbsp;\" . $link . $NumofPages . \"\\\">Next-></a>\";\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"&nbsp;Next->\";\r\n			}\r\n		\r\n	}\r\n	\r\n	private function BuildUserLoginLogOutReport() {\r\n		\r\n			//build query\r\n			//separate out to use two different queries. \r\n			$querySelectColumns = \"SELECT * \";\r\n			$querySelectCount = \"SELECT count(*) as ULogs \";\r\n			$query = \"FROM ODOLogs WHERE (ActionDone = \'LOGIN\' OR ActionDone=\'LOGOUT\')\";\r\n				\r\n			if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CurUser\"] != 0) {\r\n				$query = $query . \" AND UID=\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"CurUser\"];\r\n			}\r\n				\r\n			$query = $query . \" ORDER BY TimeStamp DESC\";\r\n			\r\n			if($this->OurDataLogLength==0) {\r\n\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($querySelectCount . $query);\r\n				if(mysqli_num_rows($TempRecords) > 0) {\r\n					$row = mysqli_fetch_assoc($TempRecords);\r\n					if($row[\"ULogs\"] > 0) {\r\n						$this->OurDataLogLength = $row[\"ULogs\"];\r\n					} else {\r\n						$this->Content = $this->Content . \"<BR><BR><B>NO LOGS WERE FOUND!</B>\";\r\n						return;\r\n					}\r\n				}\r\n			}\r\n			\r\n			$LimitStart = 0;\r\n			\r\n			if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]  > 1) {\r\n				$LimitStart = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]-1)*20;\r\n			}				\r\n			\r\n			//check bounds first\r\n			$NumofPages = $this->OurDataLogLength / 20;\r\n			$Count = 0;\r\n\r\n			if( ($this->OurDataLogLength % 20 > 0) ) {\r\n				$NumofPages = $NumofPages + 1;\r\n			}\r\n			\r\n			if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				\r\n				$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			\r\n			} else {\r\n			\r\n				$TempRecords = $GLOBALS[\'globalref\'][1]->Query($querySelectColumns . $query . \" LIMIT \" . $LimitStart . \",20\");\r\n\r\n			//simple table format\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Login/Logout Report</H3><BR><table border=1><TR><TH>TimeStamp</TH><TH>UID</TH><TH>Action</TH><TH>Comment</TH><TH>Severity</TH><TH>IP</TH></TR>\";\r\n	\r\n			while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n				$this->Content = $this->Content . \"<tr><td>\" . $row[\"TimeStamp\"] . \"</td><TD><a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSUsersO&fn=EditUser&userid=\" . $row[\"UID\"] . \"\\\">\" . $row[\"UID\"] . \"</a></td><td>\" . $row[\"ActionDone\"] . \"</td><td>\" . $row[\"Comment\"] . \"</td><td>\" . $row[\"Severity\"] . \"</td><td>\" . $row[\"IP\"] . \"</td></tr>\";\r\n				\r\n					$Count = $Count + 1;\r\n			}\r\n\r\n\r\n			$this->Content = $this->Content . \"</table><BR><BR>\";\r\n				\r\n				\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			$link = \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSLogsO&fn=UserLoginLogoutReport&CurUser=\" . htmlentities($_SESSION[\"ODOSessionO\"]->EscapedVars[\"CurUser\"]) . \"&PageNum=\";\r\n			\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . $link . ($CurPage - 5) . \"\\\"><<</a>&nbsp;\" . $link . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				//Not counted in number of page links\r\n			} elseif($CurPage > 1) {\r\n				$this->Content = $this->Content . \"<<&nbsp;\" . $link . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<<&nbsp;<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . $link . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if(($CurPage+5) <= $NumofPages) {\r\n				$this->Content = $this->Content . $link . ($CurPage+1) . \"\\\">Next-></a>&nbsp;\" . $link . ($CurPage+5) . \"\\\">>></a>\";\r\n			} elseif(($CurPage+1) < $NumofPages) {\r\n				$this->Content = $this->Content . $link . ($CurPage+1) . \"\\\">Next-></a>&nbsp;>>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"Next->&nbsp;>>\";\r\n			}\r\n			\r\n		}\r\n\r\n		\r\n	}\r\n	\r\n',0,0,13),(151,'EditEmail',_binary '\r\n	function EditEmail() {\r\n		\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n\r\n\r\n		if(isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"Update\"])) {\r\n			\r\n			$query = \"UPDATE RegistrationTypes SET emailMsg=\'\" . $_SESSION[\"ODOSessionO\"]->EscapedVars[\"emailMsg\"] . \"\' WHERE RegID=1\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n		\r\n			if($GLOBALS[\'globalref\'][1]->GetNumRowsAffected()>0) {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>Update complete.</H3></center>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><BR><H3>We had an error updating the e-mail message.</H3></center>\";\r\n			}\r\n			\r\n		} else {\r\n			\r\n			//on first release we only have 1 registration type\r\n			$query = \"SELECT emailMsg FROM RegistrationTypes WHERE RegID=1\";\r\n			$result = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			if(mysqli_num_rows($result)>0)\r\n			{\r\n				$row = mysqli_fetch_assoc($result);\r\n	\r\n				if((!is_null($row[\"emailMsg\"]))&&(strlen($row[\"emailMsg\"]) > 0)) {\r\n					$message = $row[\"emailMsg\"];\r\n				} else {\r\n					$message = \"\";\r\n				}\r\n				\r\n				$tagsDesc = \"<table><TR><TD><UL><LI>[[ServerName]] - server name replaced by constant</LI>\r\n				<LI>[[CustEmail]] - replaced with customer\'s e-mail</LI>\r\n				<LI>[[CustName]] - replaced with customer\'s name</LI>\r\n				<LI>[[CustFirstName]] - replaced with customer\'s first name</LI>\r\n				<LI>[[CustLastName]] - replaced with customer\'s last name</LI>\r\n				<LI>[[CustUserName]] - replaced with customer\'s username</LI>\r\n				<LI>[[Logo]] - replaced with img tag http://SERVERADDRESS/images/GetImage.php?Name=Logo</LI>\r\n				<LI>[[RegName]] - replaced with registration name for given regID</LI>\r\n				<LI>[[ServerAddress]] - domain name of server</LI>\r\n				<LI>[[LoginInfo]] - replaced with username and password</LI></UL></TD></TR></TABLE>\";\r\n				\r\n				$this->Content = $this->Content . \"<BR><BR><B>The following tags are replaced with the corresponding content.</B><BR>\" . $tagsDesc . \"<BR><BR><form action=\\\"index.php\\\" enctype=\\\"application/x-www-form-urlencoded\\\" method=\\\"POST\\\"><input type=\\\"hidden\\\" name=\\\"pg\\\" value=\\\"ODOCMS\\\"><input type=\\\"hidden\\\" name=\\\"ob\\\" value=\\\"ODOCMSRegisterO\\\"><input type=\\\"hidden\\\" name=\\\"fn\\\" value=\\\"EditEmail\\\"><input type=\\\"hidden\\\" name=\\\"UPDATE\\\" value=\\\"UPDATE\\\"><TEXTAREA name=\\\"emailMsg\\\" COLS=75 ROWS=20>\" . $message . \"</TEXTAREA><BR><BR><input type=\\\"submit\\\" name=\\\"Update\\\" value=\\\"Update\\\"></form></center>\";\r\n				\r\n			} else {\r\n				\r\n				$this->Content = $this->Content . \"<BR><BR><H3>The default registration type is not setup. You will need to recover the table RegistrationTypes from the original sql install.</H3><BR></center>\";\r\n				\r\n			}\r\n			\r\n		}\r\n				\r\n	}\r\n		\r\n',0,0,19),(152,'PrevVerified',_binary '\r\n	function PrevVerified() {\r\n		$this->Content = \"<center>\" . $_SESSION[\"ODOSessionO\"]->UserObjectArray[\"ODOMenuO\"]->GetODOTopMenu(\"AdminCMSRegister\");\r\n\r\n		if(!isset($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"])) {\r\n			$_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] = 1;\r\n			//reset our data length\r\n			$this->OurDataLogLength=0;\r\n		}\r\n			\r\n		if($this->OurDataLogLength==0) {\r\n			$query = \"SELECT count(*) as ULogs FROM ODOLogs WHERE ActionDone=\'USERREGISTEREDADMINV\'\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n			\r\n			if(mysqli_num_rows($TempRecords) > 0) {\r\n				$row = mysqli_fetch_assoc($TempRecords);\r\n				$this->OurDataLogLength = $row[\"ULogs\"];\r\n				\r\n				if($this->OurDataLogLength==0) {\r\n					$this->Content = $this->Content . \"<BR><B>NO LOGS WERE FOUND!</B>\";\r\n					return;\r\n				}\r\n				\r\n			} else {\r\n				$this->Content = $this->Content . \"<BR><B>NO LOGS WERE FOUND!</B>\";\r\n				return;\r\n			}\r\n		}\r\n			\r\n		$LimitStart = 0;\r\n			\r\n		if($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]  > 1) {\r\n			$LimitStart = ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"]-1)*20;\r\n		}				\r\n			\r\n		//check bounds first\r\n		$NumofPages = $this->OurDataLogLength / 20;\r\n		$Count = 0;\r\n\r\n		if( ($this->OurDataLogLength % 20 > 0) ) {\r\n			$NumofPages = $NumofPages + 1;\r\n		}\r\n\r\n		if(($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] > $NumofPages) || ($_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"] < 1)) {\r\n				\r\n			$this->Content = $this->Content . \"<h3>Page number is out of bounds!</h3><br><br></center>\";\r\n			\r\n		} else {\r\n			\r\n			$query = \"select * from ODOLogs WHERE ActionDone=\'USERREGISTEREDADMINV\' order by TimeStamp DESC LIMIT \" . $LimitStart . \",20\";\r\n			$TempRecords = $GLOBALS[\'globalref\'][1]->Query($query);\r\n\r\n			//simple table format\r\n			$this->Content = $this->Content . \"<BR><BR><H3>Logs By TimeStamp</H3><BR><table border=1><TR><TH>TimeStamp</TH><TH>Action</TH><TH>Comment</TH><TH>Severity</TH><TH>IP</TH></TR>\";\r\n	\r\n			while(($Count < 20) && ($row = mysqli_fetch_assoc($TempRecords))) {\r\n				\r\n				$this->Content = $this->Content . \"<tr><td>\" . $row[\"TimeStamp\"] . \"</td><td>\" . $row[\"ActionDone\"] . \"</td><td>\" . $row[\"Comment\"] . \"</td><td>\" . $row[\"Severity\"] . \"</td><td>\" . $row[\"IP\"] . \"</td></tr>\";\r\n				\r\n					$Count = $Count + 1;\r\n			}\r\n\r\n\r\n			$this->Content = $this->Content . \"</table><BR><BR>\";\r\n				\r\n				\r\n			$CurPage = $_SESSION[\"ODOSessionO\"]->EscapedVars[\"PageNum\"];\r\n		\r\n			//we want to count down the Pages\r\n			$NumberofLinks = 1;\r\n			//$i is the current position\r\n			$i = $CurPage - 4;\r\n			if($i < 1) {\r\n				$i = 1;\r\n			}\r\n\r\n			if(($CurPage > 5)) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage - 5) . \"\\\"><<</a>&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n				//Not counted in number of page links\r\n			} elseif($CurPage > 1) {\r\n				$this->Content = $this->Content . \"<<&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage - 1) . \"\\\"><-Previous</a>&nbsp;&nbsp;\";\r\n			} else {\r\n				$this->Content = $this->Content . \"<<&nbsp;<-Previous&nbsp;&nbsp;\";\r\n			}\r\n\r\n			while(($NumberofLinks < 11) && ($i <= $NumofPages)) {\r\n				if($CurPage == $i) {\r\n					$this->Content = $this->Content . \"<B>\" . $i . \"</B>&nbsp;\";\r\n				} else {\r\n					$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . $i . \"\\\">\" . $i . \"</a>&nbsp;\";\r\n\r\n				}\r\n				$i = $i + 1;\r\n				$NumberofLinks = $NumberofLinks + 1;\r\n			}\r\n\r\n			if(($CurPage+5) <= $NumofPages) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage+1) . \"\\\">Next-></a>&nbsp;<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage+5) . \"\\\">>></a>\";\r\n			} elseif($CurPage < $NumofPages) {\r\n				$this->Content = $this->Content . \"<a href=\\\"index.php?pg=ODOCMS&ob=ODOCMSRegisterO&fn=PrevVerified&PageNum=\" . ($CurPage+1) . \"\\\">Next-></a>&nbsp;>>\";\r\n			} else {\r\n				$this->Content = $this->Content . \"Next->&nbsp;>>\";\r\n			}\r\n			\r\n		}\r\n		\r\n	}\r\n\r\n	',0,0,19),(156,'NewsItem',_binary '\r\nclass NewsItem {\r\n\r\n	var $PostID;\r\n	var $PostDate;\r\n	var $Title;\r\n	var $Article;\r\n	var $CatID;\r\n	var $CategoryName;\r\n	var $AllowGuest;\r\n	\r\n	function  __construct() {\r\n		\r\n		\r\n	}\r\n	\r\n	\r\n}\r\n\r\n',0,0,31),(157,'NewsDB',_binary '\r\nclass NewsDB {\r\n\r\n	function  __construct() {\r\n		\r\n	}\r\n	\r\n	function GetLastPost() {\r\n		$Post = new NewsItem();\r\n		global $ODODBO;\r\n		\r\n		\r\n		if($_SESSION[\"ODOUserO\"]->getIsGuest()) {\r\n			\r\n			$query = \"SELECT news.PriKey, Date, Title, Article, CatID, CatName, AllowGuest FROM news LEFT JOIN newsCats on news.CatID=newsCats.PriKey WHERE AllowGuest=1 ORDER BY Date Desc LIMIT 1\";\r\n			\r\n		} else {\r\n			$query = \"SELECT news.PriKey, Date, Title, Article, news.CatID, newsCats.CatName, AllowGuest FROM news, newsCats, ODOUserGID, newsGACL WHERE ODOUserGID.UID=? AND ODOUserGID.GID=newsGACL.GID AND newsGACL.newsGID=news.CatID and news.CatID=newsCats.PriKey ORDER BY Date Desc LIMIT 1\";\r\n		}\r\n		\r\n		//prepare\r\n		if(!($MyStm = $ODODBO->prepare($query))) {\r\n			trigger_error(\"Error executing query!\", E_USER_ERROR);\r\n			exit(1);\r\n		}\r\n			\r\n		//bind if needed\r\n		if($_SESSION[\"ODOUserO\"]->isNonGuestLogin()) {\r\n			$UID = $_SESSION[\"ODOUserO\"]->getUID();\r\n			$MyStm->bind_param(\"i\", $UID);\r\n		}\r\n		\r\n		if(!$MyStm->execute()) {\r\n			trigger_error(\"Error executing query!\", E_USER_ERROR);\r\n			exit(1);\r\n		}\r\n			\r\n		/* store result */\r\n		$MyStm->store_result();\r\n		\r\n		if(!$MyStm->bind_result($PostID, $dt, $title, $art, $catID, $CatName, $AllowGuest)) \r\n		{\r\n			trigger_error(\"Error binding result!\", E_USER_ERROR);\r\n			exit(1);\r\n		}\r\n		\r\n		if($MyStm->fetch()) {\r\n				\r\n			$Post->PostID = $PostID;\r\n			$Post->PostDate = $dt;\r\n			$Post->Title = $title;\r\n			$Post->Article = $art;\r\n			$Post->CatID = $catID;\r\n			$Post->CategoryName = $CatName;\r\n			$Post->AllowGuest = $AllowGuest;\r\n			\r\n		}\r\n		\r\n		/* free result */\r\n		$MyStm->free_result();\r\n\r\n		/* close statement */\r\n		$MyStm->close();\r\n		\r\n		\r\n		return $Post;\r\n		\r\n	}\r\n	\r\n}\r\n\r\n\r\n\r\n',0,0,32),(158,'NewsView',_binary '\r\n\r\nclass NewsView {\r\n\r\n	private $NewsDBO;\r\n\r\n	function  __construct() {\r\n		//check for registered object.\r\n		if(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"NewsDBO\")) {\r\n			$this->NewsDBO = new NewsDB();\r\n			$_SESSION[\"ODOSessionO\"]->RegisterObject(\"NewsDBO\", $this->NewsDBO);\r\n\r\n		} else {\r\n			$this->NewsDBO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"NewsDBO\");\r\n		}\r\n	}\r\n\r\n\r\n	function GetLastPost() {\r\n\r\n		$Post = $this->NewsDBO->GetLastPost();\r\n		$ArticleStripped = $this->FormatPost($Post->Article);\r\n\r\n		$content = \"<div id=\\\"banner_title\\\">{$Post->Title}</div>\\n<p>{$ArticleStripped}</p>\\n\";\r\n\r\n		return $content;\r\n	}\r\n\r\n\r\n	private function FormatPost($Article) {\r\n\r\n		return strip_tags(substr($Article, 0, 500), \'<p><a>\');\r\n\r\n	}\r\n\r\n	//begin footer\r\n\r\n	function __sleep() {\r\n\r\n		$this->NewsDBO = null;\r\n\r\n\r\n		return( array_keys( get_object_vars( $this ) ) );\r\n	}\r\n\r\n\r\n	function __wakeup() {\r\n		//check for registered object.\r\n		if(!$_SESSION[\"ODOSessionO\"]->IsRegistered(\"NewsDBO\")) {\r\n			$this->NewsDBO = new NewsDB();\r\n			$_SESSION[\"ODOSessionO\"]->RegisterObject(\"NewsDBO\", $this->NewsDBO);\r\n\r\n		} else {\r\n			$this->NewsDBO = $_SESSION[\"ODOSessionO\"]->GetObjectRef(\"NewsDBO\");\r\n		}\r\n\r\n	}\r\n}\r\n',0,0,33),(192,'BPTPOINTGenericObjects',_binary 'BPTPOINTGenericObjects(){\n//place holder\n}\n',0,0,48),(204,'FileUtil',_binary '\r\n/**\r\n * FileUtil class\r\n * @author nict\r\n *\r\n */\r\nclass FileUtil {\r\n\r\n\r\n	/**\r\n	 * Adds a file to the system\r\n	 * @param string $fileName\r\n	 * @param array $groups\r\n	 * @param string $type\r\n	 * @return int FID file id of the inserted file\r\n	 */\r\n	public function addFile($fileName, $fileLoc, $Description, $groups, $type) {\r\n		$fid = 0;\r\n\r\n		global $ODODBO;\r\n\r\n		//verify file exists\r\n		if(!file_exists($fileLoc)) {\r\n			//log error\r\n			$comment = \"File not found {$fileLoc}\";\r\n			$GLOBALS[\'globalref\'][4]->LogEvent(\"FILEUTIL\", $comment, 3);\r\n\r\n			return -1;\r\n		}\r\n\r\n		//get group ids\r\n		$groupIDs = array();\r\n\r\n		if(($groups != null)&&(count($groups)>0)) {\r\n\r\n			foreach($groups as $group) {\r\n				$query = \"SELECT GID FROM ODOGroups WHERE GroupName=\'{$group}\'\";\r\n\r\n				$tempRecords = $ODODBO->Query($query);\r\n\r\n				if($row = mysqli_fetch_assoc($tempRecords)) {\r\n\r\n					array_push($groupIDs,$row[\"GID\"]);\r\n\r\n				} else {\r\n					//log error\r\n					$comment = \"Group passed not found {$group}\";\r\n					$GLOBALS[\'globalref\'][4]->LogEvent(\"FILEUTIL\", $comment, 3);\r\n\r\n				}\r\n\r\n\r\n			}\r\n\r\n		}\r\n\r\n		//get fileType id first\r\n		$query = \"SELECT FTypeID FROM FileTypes WHERE Type=\'{$type}\'\";\r\n\r\n		$tempRecords = $ODODBO->Query($query);\r\n\r\n		if(!($row = mysqli_fetch_assoc($tempRecords))) {\r\n\r\n			//log error\r\n			$comment = \"FileUtil error missing type:{$type}\";\r\n			$GLOBALS[\'globalref\'][4]->LogEvent(\"FILEUTIL\", $comment, 3);\r\n\r\n			return -1;\r\n		}\r\n\r\n		$typeID = $row[\"FTypeID\"];\r\n\r\n\r\n\r\n		//get md5sum and size of file\r\n		$md5sum = md5_file($fileLoc);\r\n\r\n		$size = filesize($fileLoc);\r\n		\r\n		//read in file as blob\r\n		$handle = fopen($fileLoc, \"r\");\r\n		$contents = fread($handle, $size);\r\n\r\n		$contents = $ODODBO->EscapeMe($contents);\r\n		\r\n		fclose($handle);\r\n\r\n		$ODODBO->startTransaction();\r\n\r\n		$query = \"INSERT INTO ODOFiles(Name, BFile, Description, chksum, Size, PermFlag, FTypeID) values(\'{$fileName}\',\";\r\n		$query .= \"\'{$contents}\',\";\r\n		$query .= \"\'{$Description}\',\'{$md5sum}\',{$size},\";\r\n\r\n		if(($groups != null)&&(count($groups)>0)) {\r\n			$query .= \"1,\";\r\n		} else {\r\n			$query .= \"0,\";\r\n		}\r\n\r\n		$query .= \"{$typeID})\";\r\n\r\n		$tempRecords = $ODODBO->Query($query);\r\n\r\n		if($ODODBO->GetNumRowsAffected() < 1) {\r\n			$ODODBO->rollBack();\r\n			$_SESSION[\"ODOLoggingO\"]->LogEvent(\"FILEUTIL\", \"Insert failed for file {$fileLoc}\", 5);\r\n			return -1;\r\n		}\r\n\r\n		//get last insert id\r\n		$tempFID = $ODODBO->LastInsertID();\r\n\r\n		if(count($groupIDs)>0) {\r\n\r\n			foreach($groupIDs as $GID) {\r\n				$query = \"INSERT INTO GroupsForFiles(GID,FID) values({$GID},{$tempFID})\";\r\n				$tempRecords = $ODODBO->Query($query);\r\n\r\n				if($ODODBO->GetNumRowsAffected() < 1) {\r\n					$ODODBO->rollBack();\r\n					$_SESSION[\"ODOLoggingO\"]->LogEvent(\"FILEUTIL\", \"Insert failed for file {$fileLoc}\", 5);\r\n					return -1;\r\n				}\r\n			}\r\n		}\r\n\r\n		if(!$ODODBO->commit()) {\r\n			$_SESSION[\"ODOLoggingO\"]->LogEvent(\"FILEUTIL\", \"Commit failed for inserting file.\", 5);\r\n			return -1;\r\n		}\r\n\r\n		$fid = $tempFID;\r\n\r\n		return $fid;\r\n	}\r\n\r\n	/**\r\n	 * Updates a file based on fid\r\n	 * @param int $fid\r\n	 * @param string $fileName\r\n	 * @param array $groups\r\n	 * @param string $type\r\n	 * @return boolean true on success otherwise false\r\n	 */\r\n	public function updateFile($fid, $fileLoc) {\r\n\r\n		global $ODODBO;\r\n\r\n		//verify file exists\r\n		if(!file_exists($fileLoc)) {\r\n			//log error\r\n			$comment = \"File not found {$fileLoc}\";\r\n			$GLOBALS[\'globalref\'][4]->LogEvent(\"FILEUTIL\", $comment, 3);\r\n\r\n			return false;\r\n		}\r\n\r\n		//get md5sum and size of file\r\n		$md5sum = md5_file($fileLoc);\r\n\r\n		$size = filesize($fileLoc);\r\n		\r\n		//read in file as blob\r\n		$handle = fopen($fileLoc, \"r\");\r\n		$contents = fread($handle, $size);\r\n		$contents = $ODODBO->EscapeMe($contents);\r\n		\r\n		fclose($handle);\r\n\r\n		$ODODBO->startTransaction();\r\n\r\n		$query = \"UPDATE ODOFiles SET BFile=\";\r\n		$query .= \"\'{$contents}\',\";\r\n		$query .= \"chksum=\'{$md5sum}\', Size={$size}\";\r\n		$query .= \" WHERE FID={$fid}\";\r\n\r\n		$tempRecords = $ODODBO->Query($query);\r\n\r\n		if($ODODBO->GetNumRowsAffected() < 1) {\r\n			$ODODBO->rollBack();\r\n			$_SESSION[\"ODOLoggingO\"]->LogEvent(\"FILEUTIL\", \"Update failed for file {$fileLoc}\", 5);\r\n			return false;\r\n		}\r\n\r\n		if(!$ODODBO->commit()) {\r\n			$_SESSION[\"ODOLoggingO\"]->LogEvent(\"FILEUTIL\", \"Commit failed for updating file.\", 5);\r\n			return false;\r\n		}\r\n\r\n\r\n		return true;\r\n	}\r\n\r\n}\r\n\r\n',0,0,50);
/*!40000 ALTER TABLE `Objects` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PageCategories`
--

DROP TABLE IF EXISTS `PageCategories`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PageCategories` (
  `CatID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(256) CHARACTER SET latin1 NOT NULL,
  `Description` varchar(256) CHARACTER SET latin1 DEFAULT NULL,
  PRIMARY KEY (`CatID`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PageCategories`
--

LOCK TABLES `PageCategories` WRITE;
/*!40000 ALTER TABLE `PageCategories` DISABLE KEYS */;
INSERT INTO `PageCategories` VALUES (2,'ODO Admin','All ODO Admin Pages'),(5,'General','Random pages'),(10,'News Module','Pages for News/Blog Posts');
/*!40000 ALTER TABLE `PageCategories` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `PagesIsOfCats`
--

DROP TABLE IF EXISTS `PagesIsOfCats`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `PagesIsOfCats` (
  `CatID` int(10) unsigned NOT NULL,
  `PageID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`CatID`,`PageID`) USING BTREE,
  KEY `fk_PagesCats_PageID` (`PageID`),
  CONSTRAINT `fk_PagesCats_CatID` FOREIGN KEY (`CatID`) REFERENCES `PageCategories` (`CatID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_PagesCats_PageID` FOREIGN KEY (`PageID`) REFERENCES `ODOPages` (`PageID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `PagesIsOfCats`
--

LOCK TABLES `PagesIsOfCats` WRITE;
/*!40000 ALTER TABLE `PagesIsOfCats` DISABLE KEYS */;
INSERT INTO `PagesIsOfCats` VALUES (2,3000),(10,10111);
/*!40000 ALTER TABLE `PagesIsOfCats` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `RegAssignedToGroups`
--

DROP TABLE IF EXISTS `RegAssignedToGroups`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RegAssignedToGroups` (
  `RegID` int(10) unsigned NOT NULL,
  `GID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`RegID`,`GID`) USING BTREE,
  KEY `fk_RegAsToGroup_GID` (`GID`),
  CONSTRAINT `fk_RegAsToGroup_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_RegAsToGroup_RegID` FOREIGN KEY (`RegID`) REFERENCES `RegistrationTypes` (`RegID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `RegAssignedToGroups`
--

LOCK TABLES `RegAssignedToGroups` WRITE;
/*!40000 ALTER TABLE `RegAssignedToGroups` DISABLE KEYS */;
INSERT INTO `RegAssignedToGroups` VALUES (1,2),(1,5);
/*!40000 ALTER TABLE `RegAssignedToGroups` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `RegisteredUsers`
--

DROP TABLE IF EXISTS `RegisteredUsers`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RegisteredUsers` (
  `RegID` int(10) unsigned NOT NULL,
  `UID` int(10) unsigned NOT NULL,
  `CREATION_TS` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`RegID`,`UID`),
  KEY `fk_RegisteredUsers_UID` (`UID`),
  CONSTRAINT `fk_RegisteredUsers_RegID` FOREIGN KEY (`RegID`) REFERENCES `RegistrationTypes` (`RegID`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_RegisteredUsers_UID` FOREIGN KEY (`UID`) REFERENCES `ODOUsers` (`UID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Used to verify tables already updated for given users';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `RegisteredUsers`
--

LOCK TABLES `RegisteredUsers` WRITE;
/*!40000 ALTER TABLE `RegisteredUsers` DISABLE KEYS */;
/*!40000 ALTER TABLE `RegisteredUsers` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `RegistrationTypes`
--

DROP TABLE IF EXISTS `RegistrationTypes`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `RegistrationTypes` (
  `RegID` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `Name` varchar(254) CHARACTER SET latin1 NOT NULL,
  `AfterRegCompleteURL` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `ODOStoreAfterRegURL` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `AllowGuest` tinyint(1) unsigned NOT NULL,
  `NeedVerify` tinyint(1) unsigned NOT NULL,
  `UserInputCode` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `InsertDataCode` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `DataCheckCode` varchar(254) CHARACTER SET latin1 DEFAULT NULL,
  `emailMsg` text CHARACTER SET latin1,
  PRIMARY KEY (`RegID`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `RegistrationTypes`
--

LOCK TABLES `RegistrationTypes` WRITE;
/*!40000 ALTER TABLE `RegistrationTypes` DISABLE KEYS */;
INSERT INTO `RegistrationTypes` VALUES (1,'Standard User Registration',NULL,'index.php?pg=ODOStoreTest&ob=ODOStoreViewO&fn=PPUpload',1,0,'','',NULL,'<html>\r\n\r\n<head>\r\n<TITLE>Welcome to [[ServerName]]</TITLE>\r\n</head>\r\n<body bgcolor=\"Gray\" text=\"White\">\r\n[[Logo]]<br>\r\n<H3>Your Registration at [[ServerName]] has been accepted!</H3>\r\n<Hr>\r\n<P>The Administrator at [[ServerName]] has accepted your request to register for [[RegName]]. You will have limited access while we are beta testing if you are not a beta user. If you have entered the correct promo code for beta testing you will need to wait to login until an admin accepts your request.</P>\r\n\r\n<P>To access your account please login <a href=\"http://[[ServerAddress]]/login.php\">here</a>. Or simply visit <B>http://[[ServerAddress]]/login.php</B> .</P>[[LoginInfo]]\r\n<BR>\r\n<BR>\r\n<B>Thank You!</B>\r\n<br>\r\n[[ServerName]]\r\n</body>\r\n</html>');
/*!40000 ALTER TABLE `RegistrationTypes` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `ResetQuestions`
--

DROP TABLE IF EXISTS `ResetQuestions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ResetQuestions` (
  `ResetQID` tinyint(3) unsigned NOT NULL AUTO_INCREMENT,
  `ResetQ` varchar(255) CHARACTER SET latin1 NOT NULL,
  PRIMARY KEY (`ResetQID`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8 COMMENT='Table for all reset questions of site';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ResetQuestions`
--

LOCK TABLES `ResetQuestions` WRITE;
/*!40000 ALTER TABLE `ResetQuestions` DISABLE KEYS */;
INSERT INTO `ResetQuestions` VALUES (1,'What is your father\'s first name?'),(2,'What street did you grow up on?'),(3,'What was the name of your first pet?'),(4,'In what city were you born?'),(5,'What is your mother\'s maiden name?');
/*!40000 ALTER TABLE `ResetQuestions` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `news`
--

DROP TABLE IF EXISTS `news`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `news` (
  `PriKey` int(11) NOT NULL AUTO_INCREMENT,
  `Date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `Title` text CHARACTER SET latin1 NOT NULL,
  `Article` longtext CHARACTER SET latin1 NOT NULL,
  `CatID` int(10) unsigned NOT NULL,
  `AllowGuest` tinyint(1) NOT NULL DEFAULT '1',
  PRIMARY KEY (`PriKey`),
  KEY `fk_news_CatID` (`CatID`),
  CONSTRAINT `fk_news_CatID` FOREIGN KEY (`CatID`) REFERENCES `newsCats` (`PriKey`) ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=36 DEFAULT CHARSET=utf8 COMMENT='Stores news';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `news`
--

LOCK TABLES `news` WRITE;
/*!40000 ALTER TABLE `news` DISABLE KEYS */;
INSERT INTO `news` VALUES (35,'2016-10-06 06:53:06','Example News item','You can enter any standard html<br />',11,1);
/*!40000 ALTER TABLE `news` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `newsCats`
--

DROP TABLE IF EXISTS `newsCats`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `newsCats` (
  `PriKey` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `CatName` varchar(50) CHARACTER SET latin1 NOT NULL,
  PRIMARY KEY (`PriKey`)
) ENGINE=InnoDB AUTO_INCREMENT=12 DEFAULT CHARSET=utf8 COMMENT='Categories for News';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `newsCats`
--

LOCK TABLES `newsCats` WRITE;
/*!40000 ALTER TABLE `newsCats` DISABLE KEYS */;
INSERT INTO `newsCats` VALUES (11,'test');
/*!40000 ALTER TABLE `newsCats` ENABLE KEYS */;
UNLOCK TABLES;

--
-- Table structure for table `newsGACL`
--

DROP TABLE IF EXISTS `newsGACL`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `newsGACL` (
  `NewsGID` int(10) unsigned NOT NULL,
  `GID` int(10) unsigned NOT NULL,
  PRIMARY KEY (`NewsGID`,`GID`) USING BTREE,
  KEY `fk_newsGACL_GID` (`GID`),
  CONSTRAINT `fk_newsGACL` FOREIGN KEY (`NewsGID`) REFERENCES `newsCats` (`PriKey`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_newsGACL_GID` FOREIGN KEY (`GID`) REFERENCES `ODOGroups` (`GID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='ACL for news articles.';
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `newsGACL`
--

LOCK TABLES `newsGACL` WRITE;
/*!40000 ALTER TABLE `newsGACL` DISABLE KEYS */;
INSERT INTO `newsGACL` VALUES (11,5);
/*!40000 ALTER TABLE `newsGACL` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2020-01-03  2:21:42
CREATE DATABASE  IF NOT EXISTS `BPTPOINTSESS` /*!40100 DEFAULT CHARACTER SET utf8 */;
USE `BPTPOINTSESS`;
-- MySQL dump 10.13  Distrib 5.7.28, for Linux (x86_64)
--
-- Host: 192.168.1.101    Database: BPTPOINTSESS
-- ------------------------------------------------------
-- Server version	5.7.25

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `ODOSessions`
--

DROP TABLE IF EXISTS `ODOSessions`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `ODOSessions` (
  `SessionID` varchar(254) NOT NULL,
  `CreationTS` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `RevisionTS` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `data` blob,
  PRIMARY KEY (`SessionID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `ODOSessions`
--

LOCK TABLES `ODOSessions` WRITE;
/*!40000 ALTER TABLE `ODOSessions` DISABLE KEYS */;
/*!40000 ALTER TABLE `ODOSessions` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2020-01-03  2:21:42
